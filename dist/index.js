"use strict";var vl=Object.create;var _t=Object.defineProperty;var Pl=Object.getOwnPropertyDescriptor;var wl=Object.getOwnPropertyNames;var kl=Object.getPrototypeOf,Hl=Object.prototype.hasOwnProperty;var at=(e,t)=>{for(var r in t)_t(e,r,{get:t[r],enumerable:!0})},qs=(e,t,r,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of wl(t))!Hl.call(e,s)&&s!==r&&_t(e,s,{get:()=>t[s],enumerable:!(o=Pl(t,s))||o.enumerable});return e};var T=(e,t,r)=>(r=e!=null?vl(kl(e)):{},qs(t||!e||!e.__esModule?_t(r,"default",{value:e,enumerable:!0}):r,e)),Cl=e=>qs(_t({},"__esModule",{value:!0}),e);var Rs={};at(Rs,{AbstractRequestClient:()=>ht,ExecuteHook:()=>qe,HookCancel:()=>gt,HttpSymbol:()=>P,HttpSymbolKind:()=>W,LogLevel:()=>Ke,OnRequestHook:()=>Se,OnResponseHook:()=>Te,OnStreaming:()=>Le,ParseEndRegionHook:()=>pt,ParseHook:()=>lt,ParseMetaDataHook:()=>dt,ProvideAssertValue:()=>ut,ProvideEnvironmentsHook:()=>ft,ProvideVariablesHook:()=>ct,RepeatOrder:()=>to,ReplaceVariableHook:()=>mt,RequestClientEvent:()=>ue,ResponseLoggingHook:()=>Ee,TestResultStatus:()=>ee,VariableType:()=>se,cli:()=>Es,createEmptyProcessorContext:()=>_e,getEnvironments:()=>rp,getVariables:()=>Fa,io:()=>B,send:()=>Ps,store:()=>Jo,testSymbols:()=>Z,utils:()=>x});module.exports=Cl(Rs);var Es={};at(Es,{createProgram:()=>Rl,execute:()=>uc,initFileProvider:()=>sn,initIOProvider:()=>_o});var xl=require("path");var x={};at(x,{ENVIRONMENT_NONE:()=>js,HandlebarsSingleLine:()=>Ht,OAuth2Regex:()=>pd,RegionSeparator:()=>me,addHttpFileRequestClientHooks:()=>kt,addSkippedTestResult:()=>oe,addTestResultToHttpRegion:()=>ve,assertHasNoResponseBody:()=>vo,assertHasResponseBody:()=>Ro,assertHeaderContains:()=>xo,assertHeaderEquals:()=>bo,assertMaxTotalTime:()=>yo,assertResponseBodyEquals:()=>Po,assertStatusEquals:()=>ho,cleanVariables:()=>Xt,cloneRequest:()=>Ds,cloneResponse:()=>ce,createResponseProxy:()=>Yt,decodeJWT:()=>po,defaultConfigFiles:()=>Jt,deleteHeader:()=>uo,deleteVariableInContext:()=>Ie,distinct:()=>Sl,ensureString:()=>Gt,equalsPath:()=>ko,errorToString:()=>zl,executeGlobalScripts:()=>Pe,executeRequestClientFactory:()=>Eo,expandVariable:()=>Vs,extensionName:()=>wo,findHttpRegionInContext:()=>Me,findRootDir:()=>Kt,findRootDirOfFile:()=>Rt,getBufferEncoding:()=>Xe,getDisplayName:()=>wt,getHeader:()=>A,getHeaderArray:()=>Il,getHeaderBoolean:()=>Dl,getHeaderNumber:()=>Fl,getHeaderString:()=>Al,getHttpyacConfig:()=>Ho,getMarkdownSyntax:()=>zs,getPartOfBody:()=>fo,getPlugins:()=>Co,getRegionDescription:()=>qo,importHttpFileInContext:()=>Tt,isBufferEncoding:()=>Fs,isError:()=>ie,isHttpRegionSendContext:()=>Vo,isHttpRegionsSendContext:()=>Bo,isHttpRequest:()=>D,isHttpRequestMethod:()=>$l,isHttpResponse:()=>mo,isMimeTypeCSS:()=>no,isMimeTypeFormUrlEncoded:()=>$e,isMimeTypeHtml:()=>so,isMimeTypeImage:()=>ql,isMimeTypeJSON:()=>bt,isMimeTypeJavascript:()=>ro,isMimeTypeMarkdown:()=>xt,isMimeTypeMultiPartFormData:()=>io,isMimeTypeMultiPartMixed:()=>ao,isMimeTypeNewlineDelimitedJSON:()=>lo,isMimeTypePdf:()=>El,isMimeTypeXml:()=>oo,isOpenIdInformation:()=>dd,isProcessorContext:()=>ud,isPromise:()=>Ye,isString:()=>m,isStringEmpty:()=>Oe,isUndefined:()=>Je,iterateDirectoryTree:()=>Wt,iterateUntilRoot:()=>Re,joinMarkdown:()=>Qt,knownMetaData:()=>en,logResponse:()=>je,mergeRawHttpHeaders:()=>Nl,mergeResponses:()=>zt,parseComments:()=>Ct,parseContentType:()=>Ae,parseDefaultHeadersFactory:()=>Do,parseError:()=>De,parseFileImport:()=>St,parseHandlebarsString:()=>G,parseHandlebarsSymbols:()=>ae,parseInlineResponse:()=>jo,parseJson:()=>vt,parseMimeType:()=>yt,parseQueryLineFactory:()=>Io,parseRequestHeaderFactory:()=>er,parseRequestLineFactory:()=>Mo,parseSubsequentLines:()=>Zt,parseUrlLineFactory:()=>Fo,promiseQueue:()=>No,randomArrayValue:()=>Uo,randomData:()=>Lt,randomEmail:()=>Qe,randomText:()=>Y,repeat:()=>So,replaceFilePath:()=>fe,replaceInvalidChars:()=>Ul,replaceVariables:()=>M,report:()=>q,requestLoggerFactory:()=>co,resolveClientCertificates:()=>Is,setVariableInContext:()=>F,shortenFileName:()=>_l,shrinkCloneResponse:()=>go,sleep:()=>we,stateGenerator:()=>Tl,stringifySafe:()=>I,testFactory:()=>Pt,testFactoryAsync:()=>To,toAbsoluteFilename:()=>_,toBoolean:()=>xe,toBufferLike:()=>pe,toEnvironmentKey:()=>j,toHttpString:()=>ad,toHttpStringHeader:()=>Oo,toHttpStringRequest:()=>Ws,toHttpStringResponse:()=>Ks,toMarkdown:()=>ld,toMarkdownHeader:()=>$o,toMarkdownMeta:()=>Qs,toMarkdownRequest:()=>Xs,toMarkdownResponse:()=>Js,toMarkdownTestResults:()=>Ys,toMarkdownTimings:()=>Zs,toMultiLineArray:()=>re,toMultiLineString:()=>J,toNumber:()=>C,toQueryParams:()=>jl,toString:()=>v,unsetVariableInContext:()=>Yl,useDefaultOnError:()=>Fe});function Sl(e){function t(r,o,s){return s.indexOf(r)===o}return e.filter(t)}var z=T(require("chalk")),As=require("util");var B={};at(B,{Logger:()=>We,completionItemProvider:()=>Q,fileProvider:()=>f,httpClientProvider:()=>de,javascriptProvider:()=>L,log:()=>g,userInteractionProvider:()=>$});var Q={emptyLineProvider:[],variableProvider:[],requestHeaderProvider:[]};var f={EOL:`\r
`,exists:()=>{throw new Error("Not Implemented")},dirname:()=>{throw new Error("Not Implemented")},hasExtension:()=>{throw new Error("Not Implemented")},isAbsolute:()=>{throw new Error("Not Implemented")},joinPath:()=>{throw new Error("Not Implemented")},readFile:()=>{throw new Error("Not Implemented")},readBuffer:()=>{throw new Error("Not Implemented")},writeBuffer:()=>{throw new Error("Not Implemented")},readdir:()=>{throw new Error("Not Implemented")},fsPath:Os,toString:Os};function Os(e){return typeof e=="string"?e:e.toString()}var de={};var L={require:{},evalExpression:async function(t,r){return r.variables[t]}};var X=require("hookpoint"),lt=class extends X.LastOutHook{constructor(){super(t=>!!t),this.id="ParseHook"}},dt=class extends X.LastOutHook{constructor(){super(t=>!!t),this.id="ParseMetaDataHook"}},ut=class extends X.LastOutHook{constructor(){super(t=>t!==!1),this.id="ProvideAssertValue"}},pt=class extends X.SeriesHook{constructor(){super(),this.id="ParseEndRegionHook"}},ct=class extends X.SeriesHook{constructor(){super(),this.id="ProvideVariablesHook"}},ft=class extends X.SeriesHook{constructor(){super(),this.id="ProvideEnvironmentsHook"}},mt=class extends X.WaterfallHook{constructor(){super(t=>t===void 0),this.id="ReplaceVariableHook"}},Se=class extends X.SeriesHook{constructor(){super(),this.id="BeforeRequestHook"}},Te=class extends X.SeriesHook{constructor(){super(),this.id="AfterRequestHook"}},Le=class extends X.SeriesHook{constructor(){super(),this.id="OnStreaming"}},Ee=class extends X.SeriesHook{constructor(){super(),this.id="ResponseLoggingHook"}},qe=class extends X.SeriesHook{constructor(){super(t=>!t),this.id="ExecuteHook"}};var $s=require("hookpoint"),gt=$s.HookCancel;var P=class{constructor(t){this.name=t.name||"symbol",this.description=t.description,this.kind=t.kind,this.startLine=t.startLine,this.startOffset=t.startOffset,this.endLine=t.endLine,this.endOffset=t.endOffset,this.children=t.children,this.source=t.source}getSymbolsForLine(t){let r=[];if((this.startLine<=t||this.endLine>=t)&&(r.push(this),this.children))for(let o of this.children)r.push(...o.getSymbolsForLine(t));return r}filter(t){let r=[];if(t(this)&&r.push(this),this.children)for(let o of this.children)r.push(...o.filter(t));return r}};var W=(y=>(y.request="request",y.requestLine="requestLine",y.requestHeader="requestHeader",y.requestBody="requestBody",y.response="response",y.gql="gql",y.proto="proto",y.script="script",y.metaData="metaData",y.comment="comment",y.url="url",y.operator="operator",y.key="key",y.value="value",y.variable="variable",y.path="path",y.variableDefinition="variableDefinition",y.text="text",y))(W||{});var Ke=(i=>(i[i.trace=1]="trace",i[i.debug=2]="debug",i[i.warn=5]="warn",i[i.info=10]="info",i[i.error=100]="error",i[i.none=1e3]="none",i))(Ke||{});var to=(r=>(r[r.sequential=0]="sequential",r[r.parallel=1]="parallel",r))(to||{});var ue=class extends Event{constructor(r,o){super(r);this.detail=o}},ht=class{constructor(){this.eventEmitter=new EventTarget}addEventListener(t,r){this.eventEmitter.addEventListener(t,o=>this.isRequestClientEvent(o)?r(o):void 0)}removeEventListener(t,r){this.eventEmitter.removeEventListener(t,o=>this.isRequestClientEvent(o)?r(o):void 0)}isRequestClientEvent(t){return t instanceof ue}onMessage(t,r){this.eventEmitter.dispatchEvent(new ue("message",[t,r]))}onProgress(t){this.eventEmitter.dispatchEvent(new ue("progress",t))}onMetaData(t,r){this.eventEmitter.dispatchEvent(new ue("metaData",[t,r]))}onDisconnect(){this.eventEmitter.dispatchEvent(new ue("disconnect",void 0))}triggerEnd(){this.eventEmitter.dispatchEvent(new ue("end",void 0))}};var Z={ok:"\u2713",error:"\u2716",skipped:"\u25CB"};var ee=(s=>(s.SUCCESS="SUCCESS",s.FAILED="FAILED",s.SKIPPED="SKIPPED",s.ERROR="ERROR",s))(ee||{});var se=(s=>(s.variable="Variable",s.url="Url",s.body="Body",s.filePath="FilePath",s))(se||{});var We=class{constructor(t,r){this.options=t;this.parentLogger=r}collectMessages(){var t;(t=this.parentLogger)==null||t.collectMessages(),this.collectCache=[],this.priorityCache=[]}flush(){var t;(t=this.parentLogger)==null||t.flush(),this.priorityCache=this.flushCache(this.priorityCache),this.collectCache=this.flushCache(this.collectCache)}flushCache(t){if(t){for(let r of t)r();return[]}}writeLog(t,r,o,s){var n,i;if(!((n=this.options)!=null&&n.level)||t>=this.options.level){let a=()=>o(...s);(i=this.options)!=null&&i.logMethod&&(a=()=>{var l,d;return(d=(l=this.options)==null?void 0:l.logMethod)==null?void 0:d.call(l,t,...s)}),r?r.push(a):a()}}info(...t){var r;(r=this.parentLogger)==null||r.info(...t),this.writeLog(10,this.collectCache,console.info,t)}log(...t){var r;(r=this.parentLogger)==null||r.log(...t),this.writeLog(10,this.collectCache,console.log,t)}trace(...t){var r;(r=this.parentLogger)==null||r.trace(...t),this.writeLog(1,this.collectCache,this.options.noTrace?console.debug:console.trace,t)}debug(...t){var r;(r=this.parentLogger)==null||r.debug(...t),this.writeLog(2,this.collectCache,console.debug,t)}error(...t){var r;(r=this.parentLogger)==null||r.error(...t),this.writeLog(100,this.collectCache,console.error,t)}warn(...t){var r;(r=this.parentLogger)==null||r.warn(...t),this.writeLog(5,this.collectCache,console.warn,t)}logPriority(...t){this.writeLog(10,this.priorityCache,console.info,t)}clear(){console.clear()}},g=new We({level:5,noTrace:!0});var $={isTrusted:()=>!0,showNote:async function(){throw new Error("Not Implemented")},showInputPrompt:async function(){throw new Error("Not Implemented")},showListPrompt:async function(){throw new Error("Not Implemented")}};function J(e){return e.join(f.EOL)}function re(e){return e.split(/\r?\n/gu)}function Je(e){return typeof e>"u"}function m(e){return typeof e=="string"}function Oe(e){return typeof e=="string"&&/^(\s*)?$/u.test(e)}function Tl(e=30){let t="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-._~",r=[];for(let o=e;o>0;--o)r.push(t[Math.floor(Math.random()*t.length)]);return r.join("")}function v(e){if(m(e))return e;if(typeof e=="number")return`${e}`;if(e instanceof Date)return e.toISOString();if(e instanceof Error)return e.message;if(Buffer.isBuffer(e))return e.toString("utf-8");if(Array.isArray(e)&&e.every(t=>Buffer.isBuffer(t))){let t=e.map(r=>Buffer.isBuffer(r)&&r.toString("utf8"));return I(t)}if(e)return I(e)}function I(e,t=0){try{return JSON.stringify(e,(r,o)=>Ll(o)?Buffer.from(o.data).toString("base64"):o,t)}catch(r){return g.debug("JSON.stringify error",r),JSON.stringify(e,(()=>{let s=new WeakSet;return(n,i)=>{if(typeof i=="object"&&i!==null){if(s.has(i))return;s.add(i)}return i}})(),t)}}function Gt(e){return typeof e>"u"||e===null||m(e)?e:`${e}`}function Ll(e){let t=e;return(t==null?void 0:t.type)==="Buffer"&&Array.isArray(t.data)&&!!t.data.length}function xe(e,t=!1){var s;if(typeof e=="boolean")return e;if(typeof e=="number")return!!e;let r=(s=Gt(e))==null?void 0:s.trim();if(!r)return t;if(/^true$/iu.test(r))return!0;if(/^false$/iu.test(r))return!1;let o=parseFloat(r);return isNaN(o)?t:!!o}function C(e){if(typeof e=="number")return e;let t=Gt(e);if(t){let r=Number.parseFloat(t.trim());if(!Number.isNaN(r))return r}}function pe(e){return Buffer.isBuffer(e)?e:v(e)}function yt(e){var n,i;let[t,...r]=e.split(";").map(a=>a.trim()),o=(n=r.find(a=>a.startsWith("charset=")))==null?void 0:n.split("=")[1],s=(i=r.find(a=>a.startsWith("boundary=")))==null?void 0:i.split("=")[1];return{mimeType:t,contentType:e,charset:o,boundary:s}}function bt(e){return!!e&&(e.mimeType==="application/json"||e.mimeType==="text/json"||e.mimeType.indexOf("+json")>=0||e.mimeType.indexOf("x-amz-json")>=0)}function ro(e){return(e==null?void 0:e.mimeType)==="application/javascript"||(e==null?void 0:e.mimeType)==="text/x-javascript"}function oo(e){return!!e&&(e.mimeType==="application/xml"||e.mimeType==="text/xml"||e.mimeType.indexOf("+xml")>=0)}function so(e){return(e==null?void 0:e.mimeType)==="text/html"}function no(e){return(e==null?void 0:e.mimeType)==="text/css"}function xt(e){return(e==null?void 0:e.mimeType)==="text/markdown"}function io(e){return(e==null?void 0:e.mimeType)==="multipart/form-data"}function ao(e){return(e==null?void 0:e.mimeType)==="multipart/mixed"}function lo(e){return(e==null?void 0:e.mimeType)==="application/x-ndjson"}function $e(e){return(e==null?void 0:e.mimeType)==="application/x-www-form-urlencoded"}function El(e){return(e==null?void 0:e.mimeType)==="application/pdf"}function ql(e){return e?["image/jpeg","image/gif","image/webp","image/png","image/bmp"].indexOf(e.mimeType)>=0:!1}function $l(e){return e?["ACL","BASELINE-CONTROL","CHECKIN","CHECKOUT","CONNECT","COPY","DELETE","GET","GRAPHQL","HEAD","LOCK","MERGE","MKACTIVITY","MKCALENDAR","MKCOL","MKWORKSPACE","MOVE","OPTIONS","PATCH","POST","PROPFIND","PROPPATCH","PUT","REPORT","SEARCH","TRACE","UNLOCK","VERSION-CONTROL"].includes(e.toUpperCase()):!1}function D(e){return(e==null?void 0:e.protocol)==="HTTP"}function uo(e,...t){if(e)for(let r of t){let o=Object.entries(e).find(([s])=>s.toLowerCase()===r.toLowerCase());o&&o.length>1&&delete e[o[0]]}}function Al(e,t){let r=A(e,t);if(m(r))return r}function Dl(e,t,r=!1){let o=A(e,t);return xe(o,r)}function A(e,t){if(e){let r=Object.entries(e).find(([o])=>o.toLowerCase()===t.toLowerCase());if(r&&r.length>1)return r[1]}}function Fl(e,t){let r=A(e,t);return C(r)}function Il(e,t,r=[]){let o=A(e,t);return o?m(o)?[o]:o:r}function Ae(e){let t=A(e,"content-type");if(m(t))return yt(t)}function po(e){try{let t=e.split(".");if(t.length!==3)return null;let r=t[1];switch(r=r.replace(/-/gu,"+"),r=r.replace(/_/gu,"/"),r.length%4){case 0:break;case 2:r+="==";break;case 3:r+="=";break;default:return null}let o=new As.TextDecoder().decode(Buffer.from(r,"base64"));return JSON.parse(o)}catch(t){return g.warn(t),null}}function jl(e){return Object.entries(e).filter(([,t])=>!!t).map(([t,r])=>Array.isArray(r)?r.map(o=>`${t}=${encodeURIComponent(o||"")}`).join("&"):`${t}=${encodeURIComponent(r||"")}`).join("&")}function co(e,t,r){return async function(s,n){var l,d,u,p,c,h,b,w,H,R;let i=t;if(r&&(n!=null&&n.testResults)&&n.testResults.some(y=>["FAILED","ERROR"].includes(y.status))&&(i=r),!i||i.onlyFailed&&(!(n!=null&&n.testResults)||n.testResults.every(y=>y.status==="SUCCESS")))return;if(e(""),e("---------------------"),e(""),(l=n==null?void 0:n.metaData)!=null&&l.title||(d=n==null?void 0:n.metaData)!=null&&d.name||(u=n==null?void 0:n.metaData)!=null&&u.description){let y=((p=n==null?void 0:n.metaData)==null?void 0:p.title)||((c=n==null?void 0:n.metaData)==null?void 0:c.name);y&&e(z.default`{gray === ${y} ===}`),(h=n==null?void 0:n.metaData)!=null&&h.description&&e(z.default`{gray ${n.metaData.description}}`),e("")}let a=(s==null?void 0:s.request)||(n==null?void 0:n.request);if(a&&(i.useShort?e(z.default`{yellow ${(a==null?void 0:a.method)||"GET"}} {gray ${(a==null?void 0:a.url)||"?"}}`):i.requestOutput&&Ml(a,{headers:i.requestHeaders,bodyLength:i.requestBodyLength}).forEach(y=>e(y))),s)if(i.useShort)e(z.default`{gray =>} {cyan.bold ${s.statusCode}} ({yellow ${((b=s.timings)==null?void 0:b.total)||"?"} ms}, {yellow ${((w=s.meta)==null?void 0:w.size)||"?"}})`);else{let y=[];if(i.responseHeaders&&(y.length>0&&y.push(""),y.push(...Vl(s))),i.timings&&(y.length>0&&y.push(""),y.push(...Bl(s))),m(s.body)&&i.responseBodyLength!==void 0){let k=s.body;i.responseBodyPrettyPrint&&s.prettyPrintBody&&(k=s.prettyPrintBody),k=fo(k,i.responseBodyLength),k&&(y.length>0&&y.push(""),y.push(k))}e(J(y))}if(n!=null&&n.testResults)for(let y of n.testResults){let k=z.default`{green ${Z.ok} ${y.message||"Test passed"}}`;if(y.status==="SKIPPED")k=z.default`{yellow ${Z.skipped} Test skipped}`;else if(["ERROR","FAILED"].includes(y.status)){let K=y.error?` (${(H=y.error)==null?void 0:H.displayMessage})`:"";if(k=z.default`{red ${Z.error} ${y.message||"Test failed"}${K}}`,!(t!=null&&t.useShort)&&y.status==="ERROR"&&((R=y.error)!=null&&R.error.stack)){let O=re(y.error.error.stack).slice(0,3);k=J([k,...O])}}e(k)}}}function fo(e,t){let r=e;if(!(typeof t>"u"||t<0))return t>0&&(r=e.slice(0,Math.min(e.length,t)),e.length>=t&&(r+=`... (${e.length-t} characters more)`)),r}function Ml(e,t){var o,s,n,i;let r=[];return r.push(z.default`{cyan.bold ${e.method} ${e.url}}`),e.headers&&t.headers&&r.push(...Object.entries(e.headers).map(([a,l])=>z.default`{yellow ${a}}: ${l}`).sort()),D(e)&&((s=(o=e.options)==null?void 0:o.https)!=null&&s.certificate||(i=(n=e.options)==null?void 0:n.https)!=null&&i.pfx)&&r.push(z.default`{yellow client-cert}: true`),m(e.body)&&t.bodyLength!==void 0&&(r.push(""),r.push(z.default`{gray ${fo(e.body,t.bodyLength)}}`)),r}function Vl(e){let t=[];return t.push(z.default`{cyan.bold ${e.protocol}} {cyan.bold ${e.statusCode}} {bold ${e.statusMessage?` - ${e.statusMessage}`:""}}`),e.headers&&t.push(...Object.entries(e.headers).filter(([r])=>!r.startsWith(":")).map(([r,o])=>z.default`{yellow ${r}}: ${o}`).sort()),t}function Bl(e){let t=[];return e.timings&&(t.push(z.default`{cyan.bold Timings}:`),t.push(...Object.entries(e.timings).filter(([,r])=>!!r).map(([r,o])=>z.default`{yellow ${r}}: ${o}`).sort())),t}function Ds(e){return{url:e.url,method:e.method,body:e.body,contentType:e.contentType&&{...e.contentType},headers:e.headers&&{...e.headers},supportsStreaming:e.supportsStreaming}}function mo(e){let t=e;return!!(t!=null&&t.statusCode)}function go(e){let t=ce(e);return delete t.rawBody,delete t.prettyPrintBody,delete t.request,t}function ce(e){return{name:e.name,protocol:e.protocol,statusCode:e.statusCode,statusMessage:e.statusMessage,httpVersion:e.httpVersion,headers:e.headers,body:e.body,rawHeaders:e.rawHeaders,rawBody:e.rawBody,parsedBody:e.parsedBody,prettyPrintBody:e.prettyPrintBody,contentType:e.contentType,timings:e.timings&&{...e.timings},meta:e.meta,tags:e.tags,request:e.request&&Ds(e.request)}}function Nl(e){let t={};for(let r=0;r<e.length;r+=2){let o=e[r],s=e[r+1];if(typeof s>"u")continue;let n=o.toLowerCase();t[n]=t[n]||[],t[n].push(s)}return t}function ze(e,t){if(!e)throw new Error(t)}function ho(e,t){ze(e.statusCode===t,`response status is ${e.statusCode} (expected: ${t})`)}function yo(e,t){var r,o;ze((r=e.timings)!=null&&r.total?e.timings.total<t:!0,`total time is ${(o=e.timings)==null?void 0:o.total} (expected max ${t})`)}function bo(e,t,r){let o=A(e.headers,t);ze(o===r,`response header ${t} is ${o} (expected: ${r})`)}function xo(e,t,r){let o=A(e.headers,t);(m(o)||Array.isArray(o))&&ze(!!o.indexOf(r),`response header contains ${r}`)}function Ro(e){console.assert(!!e.body,"response body exists")}function vo(e){ze(!e.body,"response body does not exists")}function Po(e,t){ze(e.body===t,`response body equals ${t}`)}function Fs(e){return["ascii","utf8","utf-8","utf16le","ucs2","ucs-2","base64","latin1","binary","hex"].indexOf(e)>=0}function Xe(e){return e&&Fs(e)?e:"utf8"}async function _(e,t){if(e){if(await f.isAbsolute(e)&&await f.exists(e))return e;if(t&&m(e)){let r=f.joinPath(t,e);if(await f.exists(r))return r}}}function wo(e){let t=f.toString(e),r=t.lastIndexOf(".");if(r>0&&r<t.length-2)return t.slice(r+1)}function Ul(e){return e.replace(/[/\\?%*:|"<>\s()@\-~,=$]/gu,"_").split("_").filter(r=>r.length>0).join("_")}function _l(e,t=50){let r=[],o=0;for(let n of e.split("_").reverse())n.length+o<t?(r.push(n),o+=n.length+1):r.length===0&&r.push(n);let s=r.reverse().join("_");return s.slice(Math.max(s.length-t,0))}async function Rt(e,t,...r){let o=e,s=f.fsPath(e);!await f.isAbsolute(e)&&t&&s&&(o=f.joinPath(t,s));let n=f.dirname(o);return await Kt(n,...r)}async function Kt(e,...t){return Wt(e,async r=>{let o=await f.readdir(r);if(o.some(s=>t.indexOf(s)>=0))return!0;for(let s of t)if(o.some(n=>s.startsWith(n))&&await f.exists(f.joinPath(r,s)))return!0;return!1})}async function Re(e,t,r){return Wt(e,async o=>(await r(o),!!t&&ko(t,o)))}async function Wt(e,t){if(e){if(await t(e))return e;if(!ko(f.dirname(e),e))return Wt(f.dirname(e),t)}}function ko(e,t){return!!e&&!!t&&f.toString(e)===f.toString(t)}async function Ho(e,t){let r;return t&&(r=await Gl(t),r||(r=await Kl(e,t)),r&&await Is(r,t)),r}var Jt=[".httpyac.js",".httpyac.cjs",".httpyac.config.js",".httpyac.config.cjs","httpyac.config.js","httpyac.config.cjs",".httpyac.json","httpyac.config.json"];async function Gl(e){let t;for(let r of Jt){let o=r&&f.joinPath(e,r);if(o&&await f.exists(o)){t=f.fsPath(o);break}}if(t){let r=f.fsPath(e);if(r&&L.loadModule){let o=L.loadModule(t,r,!0);return typeof o=="function"?o():o}}}async function Kl(e,t){let r=[];if(await Re(e,t,async o=>{var n;let s=(n=await vt(f.joinPath(o,"package.json")))==null?void 0:n.httpyac;s&&r.push(s)}),r.length>0)return Object.assign({},...r.reverse())}async function vt(e){try{if(await f.exists(e)){let t=await f.readFile(e,"utf-8");return JSON.parse(t)}}catch(t){g.debug(`json parse of ${e} failed`,t)}}async function Is(e,t){if(e.clientCertificates)for(let[,r]of Object.entries(e.clientCertificates))r.cert&&(r.cert=await _(r.cert,t)||r.cert),r.key&&(r.key=await _(r.key,t)||r.key),r.pfx&&(r.pfx=await _(r.pfx,t)||r.pfx)}async function Co(e){let t=await Wl(e),r={};if(t!=null&&t.json){let o=[...Object.keys(t.json.dependencies||{}),...Object.keys(t.json.devDependencies||{})].filter(Jl);for(let s of o){let n=f.fsPath(t.dir);if(n&&L.loadModule){let i=L.loadModule(s,n);i&&(r[s]=i)}}}return r}async function Wl(e){let t=await Kt(e,"package.json");if(t)return{dir:t,json:await vt(f.joinPath(t,"package.json"))}}function Jl(e){return/^(httpyac-|@[\w-]+(\.)?[\w-]+\/httpyac-)plugin-/u.test(e)}var js="__NONE__";function j(e){return e&&e.length>0?e.sort().join(","):js}function ie(e){if(!e)return!1;if(e instanceof Error)return!0;let t=e;return!!t.message&&!!t.stack&&!!t.name}function De(e){var t;if(e.stack){let r=/^(?<error>.*):\s*(?<message>.*)\r?\n\s*at (?<file>.*):(?<line>\d*):(?<offset>\d*)/mu.exec(e.stack);if(r&&((t=r.groups)!=null&&t.error))return{error:e,errorType:r.groups.error,message:r.groups.message,file:r.groups.file,line:r.groups.line,offset:r.groups.offset,displayMessage:`${r.groups.error}: ${r.groups.message} - ${r.groups.file}:${r.groups.line}:${r.groups.offset}`}}return{error:e,displayMessage:e.message}}function zl(e){return ie(e)?I({message:e.message,name:e.name,stack:e.stack}):v(e)}async function Fe(e,t){try{return await e}catch(r){return g.warn("promise has read error",r),t}}var Gs=require("hookpoint");var Lo=require("hookpoint");function q(e,t){var r,o;g.debug(t),(o=(r=e.progress)==null?void 0:r.report)==null||o.call(r,{message:t})}async function So(e,t){var n,i;let r=[],o=1;(n=t.repeat)!=null&&n.count&&t.isMainContext&&(o=t.repeat.count);for(let a=0;a<o;a++)r.push(e);let s=[];if(((i=t.repeat)==null?void 0:i.type)===1){let a=await Promise.all(r.map(l=>l()));for(let l of a)l&&a.push(l)}else for(let a of r){let l=await a();l&&s.push(l)}return zt(s)}function zt(e){if(e.length>1){let t=ce(e[0]);delete t.prettyPrintBody,delete t.rawBody,delete t.meta,delete t.timings;let r={responses:[],statusCount:{},count:e.length},o=[];for(let s of e){s.statusCode>t.statusCode&&(t.statusCode=s.statusCode,t.statusMessage=s.statusMessage);let n=`${s.statusCode}`;r.statusCount[n]?r.statusCount[n]+=1:r.statusCount[n]=1,s.timings&&o.push(s.timings),delete s.prettyPrintBody,delete s.parsedBody,delete s.rawBody,r.responses.push(ce(s)),o.length>0&&(t.timings=Xl(o))}return t.parsedBody=r,t.body=I(r,2),t}return e.pop()}function Xl(e){let t=[],r=[],o=[],s=[],n=[],i=[],a=[],l=[];for(let u of e)t.push(u.dns||0),r.push(u.download||0),o.push(u.firstByte||0),s.push(u.request||0),n.push(u.tcp||0),i.push(u.tls||0),a.push(u.total||0),l.push(u.wait||0);let d=u=>{let p=u.filter(c=>c>0);if(p.length>0)return p.reduce((c,h)=>c+h,0)/p.length};return{dns:d(t),download:d(r),firstByte:d(o),request:d(s),tcp:d(n),tls:d(i),total:d(a),wait:d(l)}}var Ms=require("hookpoint");async function M(e,t,r){var o,s;return(s=(o=r.progress)==null?void 0:o.isCanceled)!=null&&s.call(o)?(g.trace("process canceled by user"),Ms.HookCancel):await r.httpFile.hooks.replaceVariable.trigger(e,t,r)}async function fe(e,t,r){var s,n,i,a;let o=await M(e,"FilePath",t);if(m(o)){let l=await _(o,f.dirname(t.httpFile.fileName));if(l)return await r(l);let d=`file not found: ${e}`;(n=(s=$).showWarnMessage)==null||n.call(s,d),g.warn(d)}else{let l=`file replace made file invalid: ${e} <> ${o}`;(a=(i=$).showWarnMessage)==null||a.call(i,l),g.warn(l)}}function Vs(e,t){if(e&&m(e)){let r=e,o,s=/\{{2}\s*([a-zA-Z0-9_]+)\s*\}{2}/gu;for(;(o=s.exec(r))!==null;){let[n,i]=o,a=Vs(t[i],t);t[i]=a,r=r.replace(n,()=>`${a}`)}return r}return e}function F(e,t){if(e){let r=Xt(e);Object.assign(t.variables,r);let o=j(t.activeEnvironment);t.httpRegion.variablesPerEnv[o]||(t.httpRegion.variablesPerEnv[o]={}),Object.assign(t.httpRegion.variablesPerEnv[o],r)}}function Xt(e){return Object.fromEntries(Object.entries(e).filter(([t])=>!L.isAllowedKeyword||L.isAllowedKeyword(t)))}function Ie(e,t){delete t.variables[e];let r=j(t.activeEnvironment);t.httpRegion.variablesPerEnv[r]&&delete t.httpRegion.variablesPerEnv[r][e]}function Yl(e,t){let r=j(t.activeEnvironment),o=t.httpRegion.variablesPerEnv[r];for(let s of Object.keys(e))delete t.variables[s],o&&delete o[s]}var Us=require("uuid");function To({httpRegion:e},t){return async function(o,s){var i;let n={message:o,status:"SUCCESS"};if(typeof s=="function")try{await s(n)}catch(a){Bs(n,a),t.ignoreErrorFile&&((i=n.error)!=null&&i.errorType)&&(n.error.displayMessage=`${n.error.errorType}: ${n.error.message}`)}ve(e,n)}}function Bs(e,t){e.status="FAILED",ie(t)?e.error=De(t):e.error={displayMessage:`${t}`,error:new Error(`${t}`)}}function Pt({httpRegion:e,variables:t}){let r=function(n,i){let a={message:n,status:"SUCCESS"};if(typeof i=="function")try{i()}catch(l){Bs(a,l)}ve(e,a)};function o(){return mo(t.response)?t.response:e.response}return r.status=s=>{let n=o();n&&r(`response status equals to ${s}`,()=>ho(n,s))},r.totalTime=s=>{let n=o();n&&r(`total time exceeded ${s}`,()=>yo(n,s))},r.header=(s,n)=>{let i=o();i&&r(`response header ${s} equals ${n}`,()=>bo(i,s,n))},r.headerContains=(s,n)=>{let i=o();i&&r(`response header ${s} contains ${n}`,()=>xo(i,s,n))},r.responseBody=s=>{let n=o();n&&r(`response body equals ${s}`,()=>Po(n,s))},r.hasResponseBody=()=>{let s=o();s&&r("response body exists",()=>Ro(s))},r.hasNoResponseBody=()=>{let s=o();s&&r("response body does not exists",()=>vo(s))},r}function ve(e,t){e.testResults||(e.testResults=[]),e.testResults.push(t)}function oe(e,t="request is skipped"){ve(e,{message:t,status:"SKIPPED"})}function Eo(e,t){return async function(r){var s;let{request:o}=r;if(o!=null&&o.url){if(!await od(r))return!1;let n=e(o,r);F({$requestClient:n},r),r.requestClient=n;let i=Zl(n,r),a=((s=n.getSessionId)==null?void 0:s.call(n))||(0,Us.v4)(),l=id(t,a,o,()=>{n.disconnect(new Error("user cancellation"))});try{let d=[];ed(n,r),td(n,r,d),rd(n,r,d),q(r,n.reportMessage);let u=await n.connect(l.connection);g.debug(`requestClient ${o.url} connect`),l.connectionCount++,u!==l.connection&&(l.connection=u),await Promise.all([So(()=>n.send(),r),sd(r).then(()=>{var h;(h=n.streamEnded)==null||h.call(n)})]);let p=await Promise.all(d),c=zt(Ql(...p));return c&&!await nd(c,r)?!1:(l.connectionCount--,Ns(t,l)&&(g.debug(`requestClient ${o.url} disconnect`),n.disconnect()),!0)}catch(d){throw l.connectionCount--,Ns(t,l)&&((r.scriptConsole||g).error(r.request),g.debug(`requestClient ${o.url} disconnect`),ie(d)?n.disconnect(d):n.disconnect(new Error(v(d)))),d}finally{n.triggerEnd(),i==null||i(),delete r.requestClient,Ie("$requestClient",r)}}return!1}}function Ql(...e){let t=[];for(let r of e)r&&t.push(r);return t}function Zl(e,t){var r,o;if((r=t.progress)!=null&&r.register)return(o=t.progress)==null?void 0:o.register(()=>{oe(t.httpRegion,"user cancellation"),e.disconnect(new Error("user cancellation"))})}function ed(e,t){var r;if(t.isMainContext&&((r=t.progress)!=null&&r.report)){let o=0;e.addEventListener("progress",s=>{var a;let n=s.detail,i=n-o;if(o=n,(a=t.progress)!=null&&a.report){g.trace(`progress to ${n}`);let l=t.progress.divider||1;t.progress.report({message:"request progress",increment:i/l*100})}})}}function td(e,t,r){e.addEventListener("message",o=>{let[s,n]=o.detail;g.debug(s,(n==null?void 0:n.message)||(n==null?void 0:n.body)),r.push(Promise.resolve(n)),e.supportsStreaming&&!t.httpRegion.metaData.noStreamingLog&&t.logStream&&r.push(t.logStream(s,{...n}))})}function rd(e,t,r){e.addEventListener("metaData",o=>{let[s,n]=o.detail;g.debug(`event ${s} for ${n.protocol}`,(n==null?void 0:n.message)||(n==null?void 0:n.body)),t.httpRegion.metaData.metaDataLogging&&t.logStream&&r.push(t.logStream(s,n))})}async function od(e){let t=e.hooks.onRequest;return e.progress&&t.addInterceptor(_s(()=>{var r;return!!((r=e.progress)!=null&&r.isCanceled())})),e.request&&await t.trigger(e.request,e)!==Lo.HookCancel}async function sd(e){let t=e.hooks.onStreaming;e.progress&&t.addInterceptor(_s(()=>{var r;return!!((r=e.progress)!=null&&r.isCanceled())})),await t.trigger(e)}async function nd(e,t){return await t.hooks.onResponse.trigger(Yt(e),t)===Lo.HookCancel?!1:(t.httpRegion.response=e,!0)}function _s(e){return{id:"isCanceled",async beforeTrigger(){return!e()},async afterTrigger(){return!e()}}}function Yt(e){return new Proxy(e,{set(...r){let[o,s,n]=r,i=Reflect.set(...r);return s==="body"&&(delete o.prettyPrintBody,delete o.parsedBody,delete o.rawBody,typeof n=="string"&&(o.rawBody=Buffer.from(n))),i}})}function id(e,t,r,o){let s=e.getUserSession(t);if(s!=null&&s.connection)return s;let n={id:t,description:"Pending Connection",details:{method:r.method,url:r.url},title:`${r.method} ${r.url}`,type:"Stream",connectionCount:0,delete:o};return e.setUserSession(n),n}function Ns(e,t){return t.connectionCount<=0&&(delete t.delete,e.removeUserSession(t.id)),t.connectionCount===0}function wt(e,t="global"){var r,o,s,n;if(e){if(m(e.metaData.title))return e.metaData.title;if(m(e.metaData.name))return e.metaData.name;if((r=e.request)!=null&&r.url){let i=e.request.url.indexOf("?");i<0&&(i=e.request.url.length);let a=((n=(s=(o=e.symbol.children)==null?void 0:o.find)==null?void 0:s.call(o,l=>l.kind==="requestLine"))==null?void 0:n.startLine)||e.symbol.startLine;return`${e.request.method} ${e.request.url.slice(0,i)} (line: ${a+1})`}}return t}function qo(e,t="-"){var r;return m(e.metaData.description)?e.metaData.description:(r=e.request)!=null&&r.url?`${e.request.method} ${e.request.url}`:t}async function je(e,t){let r;e&&(r=ce(e),await t.hooks.responseLogging.trigger(Yt(r),t)===Gs.HookCancel)||!t.httpRegion.metaData.noLog&&t.logResponse&&await t.logResponse(r,t.httpRegion)}async function Pe(e){for(let t of e.httpFile.globalHttpRegions)if(!await t.execute(e))return!1;return!0}function kt(e,t){return{onRequest:t.hooks.onRequest.merge(...t.globalHttpRegions.map(r=>r.hooks.onRequest),e.onRequest),onResponse:t.hooks.onResponse.merge(e.onResponse,...t.globalHttpRegions.map(r=>r.hooks.onResponse)),onStreaming:t.hooks.onStreaming.merge(e.onStreaming,...t.globalHttpRegions.map(r=>r.hooks.onStreaming)),responseLogging:t.hooks.responseLogging.merge(e.responseLogging,...t.globalHttpRegions.map(r=>r.hooks.responseLogging))}}function ad(e,t){let r=[];return e.request&&(r.push(...Ws(e.request,{body:!!(t!=null&&t.requestBody)})),r.push("")),r.push(...Ks(e,{prettyPrint:!!(t!=null&&t.prettyPrint),body:!!(t!=null&&t.responseBody)})),J(r)}function Ks(e,t){let r=[];return r.push(`${e.protocol} ${e.statusCode} ${e.statusMessage?` - ${e.statusMessage}`:""}`),e.headers&&r.push(...Oo(e.headers)),t!=null&&t.body&&m(e.body)&&(r.push(""),r.push(t!=null&&t.prettyPrint&&e.prettyPrintBody?e.prettyPrintBody:e.body)),r}function Ws(e,t){let r=[];return r.push(`${e.method} ${e.url}`),e.headers&&r.push(...Oo(e.headers)),t!=null&&t.body&&m(e.body)&&(r.push(""),r.push(e.body)),r}function Oo(e){return Object.entries(e).map(([t,r])=>{let o=r||"";return r&&(Array.isArray(r)?o=r.join(", "):m(r)||(o=I(r))),`${t}: ${o}`})}function ld(e,t){let r=[];return e.request&&(r.push(...Xs(e.request,{body:!!(t!=null&&t.requestBody)})),r.push("")),r.push(...Js(e,{prettyPrint:!!(t!=null&&t.prettyPrint),body:!!(t!=null&&t.responseBody)})),t!=null&&t.testResults&&(r.push(""),r.push(""),r.push(...Ys(t.testResults))),t!=null&&t.timings&&e.timings&&(r.push(""),r.push(""),r.push(...Zs(e.timings))),t!=null&&t.meta&&e.meta&&(r.push(""),r.push(""),r.push(...Qs(e.meta))),Qt(r)}function Js(e,t){let r=[];if(r.push(`\`${e.protocol} ${e.statusCode}${e.statusMessage?` - ${e.statusMessage}`:""}\``),e.headers&&r.push(...$o(e.headers)),t!=null&&t.body&&m(e.body)){r.push(""),r.push(`\`\`\`${zs(e.contentType)}`);let o=t.prettyPrint&&e.prettyPrintBody?e.prettyPrintBody:e.body;r.push(Qt(re(o))),r.push("```")}return r}function zs(e){return bt(e)?"json":oo(e)?"xml":so(e)?"html":ro(e)?"js":no(e)?"css":xt(e)?"markdown":""}function Xs(e,t){let r=[];return r.push(`\`${e.method} ${e.url}\``),e.headers&&r.push(...$o(e.headers)),t!=null&&t.body&&m(e.body)&&(r.push(""),r.push("```json"),r.push(Qt(re(e.body))),r.push("```")),r}function Ys(e){let t=[];t.push("`TestResults`"),t.push("");for(let r of e){let o=`${Z.ok}: ${r.message}`;r.status==="SKIPPED"?o=`${Z.skipped}: ${r.message}`:["FAILED","ERROR"].includes(r.status)&&(o=`${Z.error}: ${r.message}`,r.error&&(o+=` (${r.error.displayMessage})`)),t.push(o)}return t}function $o(e){return Object.entries(e).map(([t,r])=>{let o=r||"";return r&&(Array.isArray(r)?o=r.join(", "):m(r)||(o=I(r))),`*${t}*: ${o}`}).sort()}function Qs(e){let t=[];t.push("`Meta`"),t.push("");for(let[r,o]of Object.entries(e))Array.isArray(o)?o.length>0&&t.push(`*${r}*: ${o.join(",")}`):t.push(`*${r}*: ${o}`);return t}function Zs(e){let t=[];return t.push("`Timings`"),t.push(""),e.wait&&t.push(`*Wait*: ${e.wait} ms`),e.dns&&t.push(`*DNS*: ${e.dns} ms`),e.tcp&&t.push(`*TCP*: ${e.tcp} ms`),e.tls&&t.push(`*TLS*: ${e.tls} ms`),e.request&&t.push(`*Request*: ${e.request} ms`),e.firstByte&&t.push(`*First Byte*: ${e.firstByte} ms`),e.download&&t.push(`*Download*: ${e.download} ms`),e.total&&t.push(`*Total*: ${e.total} ms`),t}function Qt(e){return e.join(`  ${f.EOL}`)}function dd(e){let t=e;return!!(t!=null&&t.accessToken)}function ud(e){let t=e;return!!(t!=null&&t.httpRegion)&&!!(t!=null&&t.httpFile)&&!!(t!=null&&t.variables)&&!!(t!=null&&t.config)}var Ht=/\{{2}\s*(.+?)\s*\}{2}/gu,me=/^\s*#{3,}(?<title>.*)$/u,pd=/^\s*(?<type>openid|oauth2)(\s+(?<flow>client(_credentials)?|(authorization_)?code|device(_code)?|password|implicit|hybrid))?(\s+(?<variablePrefix>[^\s]*))?\s*((token_exchange)\s+(?<tokenExchangePrefix>[^\s]*))?\s*$/iu;async function Zt(e,t,r){let o={parseResults:[]},s=e.next();for(;!s.done;){let n=!1;for(let i of t){let a=await i(s.value,r);if(a){o.parseResults.push(a),n=!0;break}}if(!n)break;o.nextLine=s.value.line,s=e.next()}return o}function er(e){return async function(r){var s;let o=/^\s*(?<key>[!#$%&'*+\-.^_`|~0-9A-Za-z]+)\s*:\s*(?<value>.*?),?\s*$/u.exec(r.textLine);if((s=o==null?void 0:o.groups)!=null&&s.key){let n=o.groups.key,i=o.groups.value,a=e[n];a?Array.isArray(a)?a.push(i):e[n]=[a,i]:e[n]=i;let l=r.textLine.indexOf(i);return{symbols:[new P({name:n,description:i,kind:"requestHeader",startLine:r.line,startOffset:r.textLine.indexOf(n),endLine:r.line,endOffset:r.textLine.length,children:[new P({name:n,description:"request header key",kind:"key",startLine:r.line,startOffset:r.textLine.indexOf(n),endLine:r.line,endOffset:r.textLine.indexOf(n)+n.length}),i?new P({name:i,description:"request header value",kind:"value",startLine:r.line,startOffset:l,endLine:r.line,endOffset:l+i.length,children:ae(i,r.line,l)}):void 0].filter(d=>!!d)})]}}return!1}}function Do(e=(t,r)=>{r.request&&(r.request.headers?Object.assign(r.request.headers,t):r.request.headers=t)}){return async function(r,o){var n;let s=/^\s*\.{3}(?<variableName>[^\s]+),?\s*$/u.exec(r.textLine);if((n=s==null?void 0:s.groups)!=null&&n.variableName){let i=new Ao(s.groups.variableName,e);o.httpRegion.hooks.execute.addObjHook(l=>l.process,i);let a=r.textLine.trim();return{symbols:[new P({name:a||"hader variable",description:"Header Variable",kind:"requestHeader",startLine:r.line,startOffset:r.textLine.indexOf(a),endOffset:r.textLine.length,endLine:r.line,children:[new P({name:s.groups.variableName,description:"Header Variable",kind:"variable",startLine:r.line,startOffset:s.index,endOffset:s.groups.variableName.length,endLine:r.line})]})]}}return!1}}var Ao=class{constructor(t,r){this.data=t;this.setHeaders=r;this.id="defaultHeaders"}async process(t){if(this.data&&t.variables){q(t,"set request headers");let r=await L.evalExpression(this.data,t);r&&this.setHeaders(Object.assign({},r),t)}return!0}};function Fo(e){return async function(r){if(/^\s*(\/)[^*]*$/u.test(r.textLine)){let o=r.textLine.trim();return e(o),{symbols:[new P({name:o||"URL Part",description:"URL Part",kind:"url",startLine:r.line,startOffset:r.textLine.indexOf(o),endOffset:r.textLine.length,endLine:r.line,children:ae(r.textLine,r.line)})]}}return!1}}function Io(e){return async function(r){if(/^\s*(\?|&)((([^(=?&)]+)=(.*))|\{\{.*\}\})\s*$/u.test(r.textLine)){let o=r.textLine.trim();return e(o),{symbols:[new P({name:o||"Query",description:"Query",kind:"url",startLine:r.line,startOffset:r.textLine.indexOf(o),endOffset:r.textLine.length,endLine:r.line,children:ae(r.textLine,r.line,0)})]}}return!1}}async function Ct(e,t,r=/^\s*((#\s+)|(\/{2}))/u){var o;if(r.test(e.textLine)){let s={symbols:[new P({name:"comment",description:e.textLine,kind:"metaData",startLine:e.line,startOffset:0,endLine:e.line,endOffset:e.textLine.length})]},n=/^\s*(#+|\/{2,})\s+@(?<key>[^\s]*)(\s+)?"?(?<value>.*)?"?$/u.exec(e.textLine);if(n&&n.groups&&n.groups.key){let i=n.groups.key.replace(/-./gu,l=>l[1].toUpperCase());s.symbols[0].children=[new P({name:i||"metadata",description:n.groups.value||"-",kind:"metaData",startLine:e.line,startOffset:0,endLine:e.line,endOffset:e.textLine.length,children:[new P({name:i||"metadata key",description:((o=en.find(l=>l.name===i))==null?void 0:o.description)||"key of meta data",kind:"key",startLine:e.line,startOffset:e.textLine.indexOf(n.groups.key),endLine:e.line,endOffset:e.textLine.indexOf(n.groups.key)+n.groups.key.length})]})];let a;n.groups.value&&(a=n.groups.value.trim(),s.symbols[0].children.push(new P({name:n.groups.value||"metadata value",description:"value of meta data",kind:"value",startLine:e.line,startOffset:e.textLine.indexOf(n.groups.value),endLine:e.line,endOffset:e.textLine.indexOf(n.groups.value)+n.groups.value.length}))),t.httpRegion.metaData=Object.assign(t.httpRegion.metaData||{},{[i]:a||!0}),await t.httpFile.hooks.parseMetaData.trigger(i,a,t)}return s}return!1}var en=[{name:"name",description:"responses of a requests with a name are automatically added as variables and can be reused by other requests",completions:["${1}"]},{name:"debug",description:"enable debug log level"},{name:"description",description:"additional description of region",completions:["${1}"]},{name:"disabled",description:"requests can be disabled"},{name:"extension",description:"extension of file for save or openWith.",completions:["${1}"]},{name:"forceRef",description:"When the request is called, it is ensured that the referenced request is always called beforehand",completions:["${1}"]},{name:"import",description:"reference Requests from other files.",completions:["${1}"]},{name:"injectVariables",description:"Inject Variables in request body (needed because of compatibility with Intellij)."},{name:"jwt",description:"supports auto decode of jwt token."},{name:"language",description:"language id of the response view",completions:["${1}"]},{name:"loop",description:"allows multiple Invocations of a Request with different parameters.",completions:["for ${1} of ${2}","for ${1}","while ${1}"]},{name:"keepStreaming",description:"keep streaming until the user session is ended manually"},{name:"noLog",description:"prevent logging of request data in output console"},{name:"noCookieJar",description:"cookieJar support is disabled for this request"},{name:"noClientCert",description:"SSL client certificate is not send for this request"},{name:"noProxy",description:"disable proxy for this request"},{name:"noRejectUnauthorized",description:"all invalid SSL certificates will be ignored and no error will be thrown."},{name:"noResponseView",description:"prevent output in editor document."},{name:"noStreamingLog",description:"prevent logging of streaming request data in output console"},{name:"note",description:"shows a confirmation dialog before sending request",completions:["${1}"]},{name:"openWith",description:"viewType of custom editor to preview files",completions:["${1}"]},{name:"ref",description:"When the request is called, it is ensured that the referenced request is called beforehand",completions:["${1}"]},{name:"ratelimit",description:"allows throttling requests",completions:["minIdleTime ${1}","max ${1} expire ${2}","minIdleTime ${1} max ${2} expire ${3}"]},{name:"save",description:"If specified, the response will not be displayed but saved directly."},{name:"sleep",description:"wait specified milliseconds, before next step.",completions:["${1}"]},{name:"title",description:"additional title of region",completions:["${1}"]},{name:"timeout",description:"set timeout for request",completions:["${1}"]},{name:"verbose",description:"enable trace log level"}],cd=100;async function G(e,t){if(!m(e))return e;let r,o,s=e,n=0;for(;o!==s&&n++<cd;)for(o=s;(r=Ht.exec(o))!==null;){let[i,a]=r,l=await t(a,i);if(typeof l<"u"&&i===e)return l;let d=l===null?"null":v(l);typeof d<"u"&&(s=s.replace(i,()=>d))}return s}function ae(e,t,r=0){let o=[];if(e){let s;for(;(s=Ht.exec(e))!==null;){let[n,i]=s;o.push(new P({name:i||"variable",description:i,startLine:t,endLine:t,kind:"variable",startOffset:r+s.index,endOffset:r+s.index+n.length,source:i}))}}return o}async function jo(e,t,r){var n,i;let o=e(),s=o.next();if(!s.done){if(t.data.httpResponseSymbol){let l=t.data.httpResponseSymbol;return l.body.push(s.value.textLine),l.symbol.endLine=s.value.line,l.symbol.endOffset=s.value.textLine.length,{nextParserLine:s.value.line,symbols:[]}}let a=r.exec(s.value.textLine);if(a&&((n=a.groups)!=null&&n.statusCode)){let l={};t.httpRegion.response={protocol:`HTTP/${a.groups.httpVersion||"1.1"}`,httpVersion:a.groups.httpVersion,statusCode:+a.groups.statusCode,statusMessage:a.groups.statusMessage,headers:l};let d=new P({name:"response",description:"response",kind:"response",startLine:s.value.line,startOffset:0,endLine:s.value.line,endOffset:s.value.textLine.length,children:[]});t.data.httpResponseSymbol={symbol:d,body:[]};let u=[t.data.httpResponseSymbol.symbol],p={nextParserLine:s.value.line,symbols:u},c=await Zt(o,[er(l)],t);p.nextParserLine=c.nextLine||p.nextParserLine;for(let h of c.parseResults)for(let b of h.symbols)(i=d.children)==null||i.push(b),d.endLine=b.endLine,d.endOffset=b.endOffset;return p}}return!1}function St(e){let t=/^<(?:(?<injectVariables>@)(?<encoding>\w+)?)?\s+(?<fileName>.+?)\s*$/u.exec(e);if(t&&t.length===4&&t.groups)return{fileName:t.groups.fileName.trim(),injectVariables:!!t.groups.injectVariables,encoding:Xe(t.groups.encoding)}}function Mo(e){return async function(r,o){var i,a,l;let s=r(),n=s.next();if(!n.done&&gd(n.value,o,e)){if(o.httpRegion.request)return{endRegionLine:n.value.line-1,nextParserLine:n.value.line-1,symbols:[]};let d=md(n.value,e);if(!d)return!1;o.httpRegion.request=d.request;let u=new P({name:n.value.textLine||"request line",description:`${e.protocol} request-line`,kind:"requestLine",startLine:n.value.line,startOffset:0,endLine:n.value.line,endOffset:n.value.textLine.length,children:[d.symbol]}),p={nextParserLine:n.value.line,symbols:[u]},c={};d.request.headers=c;let h=await Zt(s,[Ct,er(c),Do(),Io(b=>d.request.url+=b),Fo(b=>d.request.url+=b)],o);p.nextParserLine=h.nextLine||p.nextParserLine;for(let b of h.parseResults)(a=(i=p.symbols)==null?void 0:i.push)==null||a.call(i,...b.symbols);if((l=e.modifyRequest)==null||l.call(e,d.request),d.request.headers){let b=A(d.request.headers,"content-type");m(b)&&(d.request.contentType=yt(b))}return o.httpRegion.hooks.execute.addHook(e.protocol.toLowerCase(),Eo(e.requestClientFactory,e.sessionStore)),p}return!1}}function md(e,t){var s,n,i,a;let r=t.methodRegex.exec(e.textLine);if(r&&r.length>1&&r.groups)return{request:{url:r.groups.url,protocol:t.protocol.toUpperCase(),method:((s=r.groups)==null?void 0:s.method)||t.method||t.protocol},symbol:new P({name:r.groups.url||"request",description:`${t.protocol} Url`,kind:"url",startLine:e.line,startOffset:0,endLine:e.line,endOffset:e.textLine.length,children:ae(e.textLine,e.line)})};let o=(n=t.protocolRegex)==null?void 0:n.exec(e.textLine);if(o&&o.length>1&&((i=o.groups)!=null&&i.url))return{request:{url:o.groups.url,protocol:t.protocol.toUpperCase(),method:((a=o.groups)==null?void 0:a.method)||t.method||t.protocol},symbol:new P({name:o.groups.url||"request",description:`${t.protocol} Url`,kind:"url",startLine:e.line,startOffset:0,endLine:e.line,endOffset:e.textLine.length,children:ae(e.textLine,e.line)})}}function gd(e,t,r){var o,s,n,i;return Oe(e.textLine)||t.forceRegionDelimiter&&t.httpRegion.request?!1:(s=(o=r.methodRegex.exec(e.textLine))==null?void 0:o.groups)!=null&&s.url?!0:!t.httpRegion.request&&r.protocolRegex?!!((i=(n=r.protocolRegex.exec(e.textLine))==null?void 0:n.groups)!=null&&i.url):!1}function Vo(e){let t=e;return!!(t!=null&&t.httpRegion)}function Bo(e){let t=e;return Array.isArray(t==null?void 0:t.httpRegions)}function Me(e,t){let r=t.httpFile.findHttpRegion(e);if(r)return r;if(t.options.httpFiles)for(let{ref:o}of t.options.httpFiles.filter(s=>s.base===t.httpFile)){let s=o.findHttpRegion(e);if(s)return s}}async function Tt(e,t,r){var s,n;let o=await fe(e,r,async i=>{g.debug(`parse imported file ${i}`),r.options.httpFiles||(r.options.httpFiles=[]);let a=r.options.httpFiles.filter(d=>d.ref.fileName===i);if(a.length>0){let d=a[0].ref;return a.some(u=>u.base===r.httpFile)||r.options.httpFiles.push({base:r.httpFile,ref:d}),d}let l=await t.getOrCreate(i,async()=>await f.readFile(i,"utf-8"),0,{workingDir:r.httpFile.rootDir,config:r.config});return r.hooks=kt(r.hooks,l),r.options.httpFiles.push({base:r.httpFile,ref:l}),l});if(o&&(!r.options.globalScriptsExecuted||((n=(s=r.options.globalScriptsExecuted).indexOf)==null?void 0:n.call(s,o))<0)){r.options.globalScriptsExecuted||(r.options.globalScriptsExecuted=[]),g.debug(`execute global scripts for import ${o.fileName}`),r.options.globalScriptsExecuted.push(o);let i={...r,httpFile:o};return await Pe(i)}return!!o}function Ye(e){let t=e;return t&&!!t.then}function we(e){return new Promise(t=>setTimeout(t,e))}async function No(e,...t){let r=[],o=async()=>{let n;for(;n=t.shift();)r.push(await n())},s=[];for(let n=0;n<e;n++)s.push(o());return await Promise.all(s),r}var tn=T(require("dayjs")),rn=require("uuid"),Lt={alphabetic:(e=10)=>Y(e,"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"),numeric:(e=10)=>Y(e),hexadecimal:(e=10)=>Y(e,"1234567890ABCDEF"),email:Qe,float:(e=0,t=100)=>Math.random()*(t-e)+e,integer:(e=0,t=100)=>Math.floor(Math.random()*(t-e)+e),uuid:()=>(0,rn.v4)(),date:(e=new Date,t=void 0)=>(0,tn.default)(e).format(t)};function Qe(){return`${Y(30)}@${Y(10)}.${Uo(["com","org","at","de","fr","uk","it","ch","info","edu","asia","gov","app","io"])}`}function Y(e,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_"){let r=[];if(e>0){let o=t.split("");for(let s=0;s<e;s++)r.push(Uo(o))}return r.join("")}function Uo(e){return e[Math.floor(Math.random()*(e.length-1))]}var Ve=require("fs"),on=require("os"),ke=require("path");async function _o(){sn(),await bd(),hd()}function hd(){process.platform==="win32"&&(Z.ok="[x]",Z.error="[-]",Z.skipped="[*]")}function sn(){f.EOL=on.EOL,f.isAbsolute=async e=>(0,ke.isAbsolute)(f.toString(e)),f.dirname=e=>(0,ke.dirname)(f.toString(e)),f.hasExtension=(e,...t)=>{let r=(0,ke.extname)(f.toString(e));return r.startsWith(".")&&(r=r.slice(1)),t.indexOf(r)>=0},f.joinPath=(e,t)=>(0,ke.join)(f.toString(e),t),f.exists=async e=>{try{return!!await Ve.promises.stat(f.toString(e))}catch{return!1}},f.readFile=async(e,t)=>{let r=f.fsPath(e);if(r)return Ve.promises.readFile(r,t);throw new Error("No valid path for cli")},f.readBuffer=async e=>{let t=f.fsPath(e);if(t){let r=(0,Ve.createReadStream)(t);return yd(r)}throw new Error("No valid path for cli")},f.writeBuffer=(e,t)=>Ve.promises.writeFile(f.toString(e),t),f.readdir=async e=>Ve.promises.readdir(f.toString(e))}function yd(e){return new Promise((t,r)=>{let o=[];e.on("data",s=>{Buffer.isBuffer(s)?o.push(s):o.push(Buffer.from(s))}),e.on("end",()=>t(Buffer.concat(o))),e.on("error",s=>r(s)),e.resume()})}async function bd(){$.showNote=async function(t){return console.log(`Note: ${t}`),!0},$.showInputPrompt=async function(t,r,o){if(r!==void 0)return r;throw new Error("Interactive input not supported in uctest. Use --var to pass values.")},$.showListPrompt=async function(t,r){if(r.length>0)return r[0];throw new Error("Interactive selection not supported in uctest.")},$.getClipboard=async function(){return""},$.setClipboard=async function(t){}}var nt=T(require("chalk")),dl=require("commander"),it=require("fs"),V=require("path");var un=require("assert");var tr=class{constructor(){this.id=["endsWith"]}match(t,r){let o=v(t),s=v(r);return o&&s?o==null?void 0:o.endsWith(s):!1}};var rr=class{constructor(){this.id=["==","===","equals"]}match(t,r){return typeof t=="object"?I(t)===I(r):t===r}};var or=class{constructor(){this.id=["exists","isTrue"]}match(t){return!!t}};var sr=class{constructor(){this.id=[">="]}match(t,r){let o=C(t),s=C(r);return o!==void 0&&s!==void 0?o>=s:!1}};var nr=class{constructor(){this.id=[">"]}match(t,r){let o=C(t),s=C(r);return o!==void 0&&s!==void 0?o>s:!1}};var ir=class{constructor(){this.id=["contains","includes"]}match(t,r){let o=v(t),s=v(r);return o&&s?o.includes(s):Array.isArray(t)?t.indexOf(r)>=0:!1}};var ar=class{constructor(){this.id=["isArray"]}match(t){return Array.isArray(t)}};var lr=class{constructor(){this.id=["isBoolean"]}match(t){return typeof t=="boolean"}};var dr=class{constructor(){this.id=["isFalse"]}match(t){return!t}};var ur=class{constructor(){this.id=["isNumber"]}match(t){return typeof t=="number"}};var pr=class{constructor(){this.id=["isString"]}match(t){return typeof t=="string"}};var cr=class{constructor(){this.id=["<="]}match(t,r){let o=C(t),s=C(r);return o!==void 0&&s!==void 0?o<=s:!1}};var fr=class{constructor(){this.id=["<"]}match(t,r){let o=C(t),s=C(r);return o!==void 0&&s!==void 0?o<s:!1}};var mr=class{constructor(){this.id=["matches"];this.noAutoConvert=!0}match(t,r){let o=v(t),s=v(r);return o&&s?new RegExp(s,"u").test(o):!1}};var nn=require("crypto");var gr=class{constructor(){this.id=["md5"];this.noAutoConvert=!0}match(t,r){let o=pe(t);return o?(0,nn.createHash)("md5").update(o).digest("base64")===r:!1}};var hr=class{constructor(){this.id=["!=","!==","not equals"]}match(t,r){return t!==r}};var an=require("crypto");var yr=class{constructor(){this.id=["sha256"];this.noAutoConvert=!0}match(t,r){let o=pe(t);return o?(0,an.createHash)("sha256").update(o).digest("base64")===r:!1}};var ln=require("crypto");var br=class{constructor(){this.id=["sha512"];this.noAutoConvert=!0}match(t,r){let o=pe(t);return o?(0,ln.createHash)("sha512").update(o).digest("base64")===r:!1}};var xr=class{constructor(){this.id=["startsWith"]}match(t,r){let o=v(t),s=v(r);return o&&s?o==null?void 0:o.startsWith(s):!1}};var dn=[new tr,new rr,new or,new sr,new nr,new ir,new ar,new lr,new ur,new pr,new cr,new fr,new mr,new hr,new xr,new yr,new gr,new br,new dr];async function pn(e,{httpRegion:t}){let o=e().next();if(!o.done&&o.value.textLine){let s=o.value.textLine,i=`^\\s*\\?\\?\\s*(?<type>[^\\s]*)(\\s+(?<value>.*))?\\s+(?<predicate>(${dn.reduce((l,d)=>(l.push(...d.id),l),[]).join("|")}))\\s*(?<expected>.*)\\s*$`,a=new RegExp(i,"iu").exec(s);if(a&&a.groups&&a.groups.type&&a.groups.predicate){let l=a.groups.type,d=a.groups.value,u=a.groups.expected,p=dn.find(c=>{var h;return((h=a.groups)==null?void 0:h.predicate)&&c.id.indexOf(a.groups.predicate)>=0});return p&&t.hooks.onResponse.addHook(`test ${s}`,async(c,h)=>{await To(h,{ignoreErrorFile:!0})(`${d||l} ${p.id[0]} ${u||""}`.trim(),async w=>{let H=await h.httpFile.hooks.provideAssertValue.trigger(l,d,c,h),R=u&&await M(u,"Variable",h);R!==u&&(w.message=`${d||l} ${p.id[0]} ${R}`);let y=p.noAutoConvert?R:Rd(H,R);(0,un.ok)(p.match(H,y),`${d||l} (${H}) ${p.id[0]} ${v(y)||""}`.trim())})}),{nextParserLine:o.value.line,symbols:[new P({name:`assert ${a.groups.type}`,description:`${a.groups.predicate} ${a.groups.expected||""}`.trim(),kind:"script",startLine:o.value.line,startOffset:0,endLine:o.value.line,endOffset:o.value.textLine.length})]}}}return!1}function Rd(e,t){if(t!=null){if(typeof e=="number")return C(t);if(typeof e=="boolean")return xe(t,!!t);if(typeof e=="string")return v(t);if(e===null&&t==="null")return null;if(e===void 0&&t==="undefined")return;if(typeof e=="object"&&typeof t=="string")try{return JSON.parse(t)}catch{return t}}return t}Q.emptyLineProvider.push(()=>[{name:"?? status == ",description:"Status assert (200)"},{name:"?? status == 200",description:"Status assert (200)"},{name:"?? duration <",description:"Duration assert"},{name:"?? body contains",description:"Body assert"},{name:"?? body matches",description:"Body assert"},{name:"?? body md5",description:"Body assert"},{name:"?? body sh256",description:"Body assert"},{name:"?? header",description:"Header assert"}]);function cn(e,t,r){var o,s,n,i,a,l,d;if(e==="duration")switch(t){case"firstByte":return(o=r==null?void 0:r.timings)==null?void 0:o.firstByte;case"download":return(s=r==null?void 0:r.timings)==null?void 0:s.download;case"wait":return(n=r==null?void 0:r.timings)==null?void 0:n.wait;case"request":return(i=r==null?void 0:r.timings)==null?void 0:i.request;case"tcp":return(a=r==null?void 0:r.timings)==null?void 0:a.tcp;case"tls":return(l=r==null?void 0:r.timings)==null?void 0:l.tls;default:return(d=r==null?void 0:r.timings)==null?void 0:d.total}return!1}function fn(e,t,r){return e==="header"&&t?A(r.headers,t):!1}async function mn(e,t,r,o){return e==="js"&&t?await L.evalExpression(t,o,{response:r}):e==="body"?t?await L.evalExpression(`(response.parsedBody || response.body).${t}`,o,{response:r}):r.body:!1}function gn(e,t,r){return e==="status"?r==null?void 0:r.statusCode:!1}var Rr=class{constructor(){this.id="testFailed";this.before=["processedHttpRegion"]}async onError(t,r){if(ie(t)){let{httpRegion:o}=r.args[0];ve(o,{message:t.message,error:De(t),status:"ERROR"})}return!0}};function hn(e){e.hooks.execute.addInterceptor(new Rr),e.hooks.provideAssertValue.addHook("status",gn,{before:["request"]}),e.hooks.provideAssertValue.addHook("header",fn,{before:["request"]}),e.hooks.provideAssertValue.addHook("javascript",mn,{before:["request"]}),e.hooks.provideAssertValue.addHook("duration",cn,{before:["request"]}),e.hooks.parse.addHook("assert",pn,{before:["request"]})}Q.variableProvider.push(()=>[{name:"$prompt ",description:"Prompt"},{name:"$input",description:"Input"},{name:"$input-askonce",description:"Input"},{name:"$password",description:"Password"},{name:"$pick <placeholder> $value:",description:"Password"},{name:"$pick-askonce <placeholder> $value:",description:"Password"},{name:"$timestamp",description:"Timestamp"},{name:"$datetime",description:"Datetime"},{name:"$localDatetime",description:"Local Datetime"}]);var yn="$default",bn="$shared";async function xn(e){var t;if((t=e.config)!=null&&t.environments){let r=Object.keys(e.config.environments).filter(o=>[yn,bn].indexOf(o)<0);return g.info("Config Env Provider found environments",r),r}return[]}async function Rn(e,t){var o;let r=[];if((o=t.config)!=null&&o.environments){let s=t.config.environments;r.push(s[bn]),e&&e.length>0?r.push(...e.map(n=>s[n])):r.push(s[yn])}return Object.assign({},...r)}var Jo={};at(Jo,{HttpFile:()=>Et,HttpFileStore:()=>qt,HttpRegion:()=>et,UserSessionStore:()=>Pr,closeHttpRegion:()=>vr,createReaderFactory:()=>Go,getEnvironmentConfig:()=>Ze,parseHttpFile:()=>Wo,pluginStore:()=>ne,setSource:()=>Ko,userSessionStore:()=>S});var vn=T(require("chalk")),Pn=T(require("lodash/merge"));async function Ze(e,t){let r=[];if(t){let s=await Ho(t.fileName,t.rootDir);s&&r.push(s)}e&&r.push(e);let o=(0,Pn.default)({log:{level:5,supportAnsiColors:!0},cookieJarEnabled:!0,envDirName:"env"},...r);return vd(o),o}function vd(e){var t,r,o;typeof((t=e==null?void 0:e.log)==null?void 0:t.level)>"u"?g.options.level=5:g.options.level=(r=e==null?void 0:e.log)==null?void 0:r.level,((o=e==null?void 0:e.log)==null?void 0:o.supportAnsiColors)===!1&&(vn.default.level=0)}var Et=class{constructor(t,r){this.fileName=t;this.rootDir=r;this.hooks={parse:new lt,parseMetaData:new dt,parseEndRegion:new pt,provideAssertValue:new ut,replaceVariable:new mt,provideEnvironments:new ft,provideVariables:new ct,execute:new qe,onStreaming:new Le,onRequest:new Se,onResponse:new Te,responseLogging:new Ee};this.httpRegions=[]}findHttpRegion(t){return this.httpRegions.find(r=>{var o;return((o=r.metaData)==null?void 0:o.name)===t&&!r.metaData.disabled})}get globalHttpRegions(){return this.httpRegions.filter(t=>t.isGlobal()&&!t.metaData.disabled)}};var Cn=require("hookpoint");async function vr(e){await e.httpFile.hooks.parseEndRegion.trigger(e);let{httpRegion:t}=e;e.httpRegion.symbol.name=wt(t),e.httpRegion.symbol.description=qo(t),e.httpFile.httpRegions.push(e.httpRegion),delete e.forceRegionDelimiter}function Go(e,t){return function*(o){for(let s=e;s<t.length;s++){let n=t[s];if(yield{textLine:n,line:s},!o&&me.test(n))break}}}var Hn=require("hookpoint");var wn=require("hookpoint");var et=class e{constructor(t,r=0){this.httpFile=t;this.variablesPerEnv={};this.metaData={};this.hooks={execute:new qe,onRequest:new Se,onStreaming:new Le,onResponse:new Te,responseLogging:new Ee};this.dependentsPerEnv=[];this.symbol=new P({name:"-",description:"-",kind:"request",startLine:r,startOffset:0,endLine:r,endOffset:0})}get id(){return`${this.httpFile.fileName}_${this.symbol.startLine}`}isGlobal(){return!(this.request||this.metaData.name)}clone(t){let r=new e(t||this.httpFile);return r.request=this.request,Object.assign(r.symbol,this.symbol),Object.assign(r.hooks,this.hooks),Object.assign(r.variablesPerEnv,this.variablesPerEnv),Object.assign(r.metaData,this.metaData),r}async execute(t,r){var s,n,i;delete this.response,this.testResults=[],t.httpRegion&&this.registerRegionDependent(t.httpRegion),(n=(s=t.progress)==null?void 0:s.report)==null||n.call(s,{message:`${this.symbol.name}`});let o=this.hooks.execute;if(!this.isGlobal()){o=this.httpFile.hooks.execute.merge(o);for(let a of this.httpFile.httpRegions.filter(l=>l.isGlobal()))a instanceof e&&a.registerRegionDependent(this)}try{let a=await o.trigger({...t,httpFile:this.httpFile,httpRegion:this,hooks:kt(this.hooks,this.httpFile),isMainContext:r});return this.isGlobal()||this.resetDependentRegionsWithVisitor(j(t.activeEnvironment),this,[]),a!==wn.HookCancel&&a.every(l=>!!l)}catch(a){return ie(a)&&(ve(this,{message:a.message,status:"ERROR",error:De(a)}),a.handled||(await((i=t.logResponse)==null?void 0:i.call(t,this.response,this)),a.handled=!0)),!1}}resetDependentRegionsWithVisitor(t,r,o){let s=r.dependentsPerEnv.filter(n=>!o.includes(n));for(let n of s)delete n.response,delete n.variablesPerEnv[t],o.push(n),n instanceof e&&this.resetDependentRegionsWithVisitor(t,n,o)}registerRegionDependent(t){t&&!this.dependentsPerEnv.includes(t)&&t!==this&&this.dependentsPerEnv.push(t)}};function Ko(e,t){for(let r of e)kn(r.symbol,t)}function kn(e,t){e.source=J(t.slice(e.startLine,e.endLine+1));let r=e.endOffset-t[e.endLine].length;if(r>=0&&(r=void 0),e.source=e.source.slice(e.startOffset,r),e.children)for(let o of e.children)kn(o,t)}async function Wo(e,t,r){let o=re(t),s={lines:o,httpFile:e,httpRegion:new et(e,0),data:{},httpFileStore:r};for(let n=0;n<o.length;n++){let i=await e.hooks.parse.trigger(Go(n,o),s);i&&i!==Hn.HookCancel&&(i.endRegionLine!==void 0&&i.endRegionLine>=0&&(s.httpRegion.symbol.endLine=i.endRegionLine,s.httpRegion.symbol.endOffset=o[i.endRegionLine].length,await vr(s),s.httpRegion=new et(e,i.nextParserLine+1)),i.symbols&&(s.httpRegion.symbol.children?s.httpRegion.symbol.children.push(...i.symbols):s.httpRegion.symbol.children=i.symbols),n=i.nextParserLine)}return await vr(s),s.httpRegion.symbol.endLine=o.length-1,s.httpRegion.symbol.endOffset=o[o.length-1].length,Ko(e.httpRegions,o),e}var ne={};var qt=class{constructor(t={}){this.plugins=t;this.storeCache=[]}getFromStore(t,r){let o=f.toString(t),s=this.storeCache.find(n=>n.cacheKey===o);return s||(s={cacheKey:o,version:r},this.storeCache.push(s)),s}get(t){var o;let r=f.toString(t);return(o=this.storeCache.find(s=>s.cacheKey===r))==null?void 0:o.httpFile}getAll(){let t=[];for(let r of this.storeCache)r.httpFile&&t.push(r.httpFile);return t}getOrCreate(t,r,o,s){let n=this.getFromStore(t,o);return o>n.version||!n.httpFile?(n.promise&&o<=n.version||(n.promise=r().then(i=>this.parse(t,i,s)).then(i=>{if(delete n.promise,n.httpFile)for(let a of i.httpRegions){let l=n.httpFile.httpRegions.find(d=>d.symbol.source===a.symbol.source);l&&Object.assign(a.variablesPerEnv,l.variablesPerEnv)}return n.version=o,n.httpFile=i,i}).catch(i=>{throw delete n.promise,n.httpFile&&this.remove(n.httpFile.fileName),i})),n.promise):n.promise||Promise.resolve(n.httpFile)}async parse(t,r,o){let s=await this.initHttpFile(t,o);return await Wo(s,r,this)}remove(t){let r=f.toString(t),o=this.storeCache.findIndex(s=>s.cacheKey===r);return o>=0?(this.storeCache.splice(o,1),!0):!1}rename(t,r){let o=f.toString(t),s=this.storeCache.find(n=>n.cacheKey===o);s&&(s.cacheKey=f.toString(r),s.httpFile&&(s.httpFile.fileName=r))}clear(){this.storeCache.length=0}async initHttpFile(t,r){var l,d;let o=await _(t,r.workingDir)||t,s=await Rt(o,r.workingDir,...Jt)||await Rt(o,r.workingDir,"package.json",((l=r.config)==null?void 0:l.envDirName)||"env")||r.workingDir,n=new Et(o,s);r.config=await Ze(r.config,n);let i={...ne,...this.plugins};s&&(Object.assign(i,await Co(s)),(d=r.config)!=null&&d.configureHooks&&(i[".httpyac.js"]=r.config.configureHooks));let a=process.env.HTTPYAC_PLUGIN;if(a)try{let u=require(a);u.configureHooks&&(i.HTTPYAC_PLUGIN=u.configureHooks)}catch(u){g.warn("Global Hook Plugin not loaded",u)}return await this.configureHooks(n,r,i),n}async configureHooks(t,r,o){if(r.config){let s={version:"1.0.0",rootDir:t.rootDir,config:r.config,httpFile:t,hooks:t.hooks,log:g,fileProvider:f,sessionStore:S,userInteractionProvider:$,httpClientProvider:de,javascriptProvider:L,utils:x,getHookCancel:()=>Cn.HookCancel};for(let[n,i]of Object.entries(o))try{let a=i(s);Ye(a)&&await a}catch(a){g.error(`error in ${n}`,a)}}}};var Pr=class{constructor(){this.userSessions=[];this.sessionChangedListener=[]}onSessionChanged(t){return this.sessionChangedListener.push(t),()=>{let r=this.sessionChangedListener.indexOf(t);r>=0&&this.sessionChangedListener.splice(r,1)}}async reset(){for(let t of this.userSessions)t.delete&&t.delete();this.userSessions.length=0,this.notifySessionChanged()}getUserSession(t){return this.userSessions.find(r=>r.id===t)}setUserSession(t){this.removeUserSession(t.id),this.userSessions.push(t),this.notifySessionChanged()}notifySessionChanged(){for(let t of this.sessionChangedListener)t()}removeUserSession(t){let r=this.userSessions.find(o=>o.id===t);r&&(this.userSessions.splice(this.userSessions.indexOf(r),1),r.delete&&r.delete(),this.notifySessionChanged())}isUserSession(t){let r=t;return r&&!!r.description&&!!r.id&&!!r.title&&!!r.type&&!!r.details}},S=new Pr;async function Sn(){let e=S.getUserSession("last_response");return e!=null&&e.response?{response:e.response}:{}}var Tn=T(require("lodash/cloneDeep"));var wr=class{constructor(){this.id="createRequest"}async beforeLoop(t){let[r]=t.args;return r.httpRegion.request&&(q(r,"init request"),r.request=(0,Tn.default)(r.httpRegion.request)),!0}};var Ln=require("hookpoint");var wd="variable",kr=class{constructor(){this.id="variable"}async beforeLoop(t){let r=t.args[0];return r.options.lazyVariables=!0,!0}async beforeTrigger(t){var o;let r=t.args[0];return((o=t.hookItem)==null?void 0:o.id)!==wd&&r.options.lazyVariables&&(await this.replaceAllVariables(r),delete r.options.lazyVariables),!0}async replaceAllVariables(t){for(let[r,o]of Object.entries(t.variables)){let s=await M(o,"Variable",t);s!==Ln.HookCancel&&(t.variables[r]=s)}}};var Hr=class{constructor(){this.id="logResponse"}async afterLoop(t){let r=t.args[0],o;return r.httpRegion.response&&(o=ce(r.httpRegion.response),o.tags||(o.tags=[]),o.tags.push("httpRegion",r.isMainContext?"mainResponse":"refResponse"),delete r.httpRegion.response),await je(o,r),!0}};var Cr=class{constructor(){this.id="processedHttpRegion";this.emitted=new WeakSet}getResponseLoggingInterceptor(){return{id:this.id,afterLoop:this.afterResponseLoggingLoop.bind(this)}}async beforeLoop(t){let[r]=t.args;if(r.processedHttpRegions){let o=this.toProcessedHttpRegion(r);r.processedHttpRegions.push(o)}return!0}async onError(t,r){return this.updateProcessedHttpRegionAfterLoop(r.args[0]),this.emitProcessedHttpRegion(r.args[0]),!0}async afterLoop(t){return this.updateProcessedHttpRegionAfterLoop(t.args[0]),this.emitProcessedHttpRegion(t.args[0]),!0}updateProcessedHttpRegionAfterLoop(t){var o,s,n;let r=(s=(o=t.processedHttpRegions)==null?void 0:o.slice().reverse())==null?void 0:s.find(i=>i.id===t.httpRegion.id);r&&(r.end=performance.now(),r.duration=r.end-r.start,r.metaData={...t.httpRegion.metaData},r.testResults=t.httpRegion.testResults,r.response=t.httpRegion.response||r.response,r.request=((n=t.httpRegion.response)==null?void 0:n.request)||r.request)}async afterResponseLoggingLoop(t){var n;let[r,o]=t.args,s=(n=o.processedHttpRegions)==null?void 0:n.find(i=>i.id===o.httpRegion.id);return s&&(s.request=r.request,s.response=r),this.updateProcessedHttpRegionAfterLoop(o),this.emitProcessedHttpRegion(o),!0}toProcessedHttpRegion(t){return{id:t.httpRegion.id,filename:t.httpFile.fileName,symbol:t.httpRegion.symbol,isGlobal:t.httpRegion.isGlobal(),testResults:t.httpRegion.testResults,start:performance.now()}}emitProcessedHttpRegion(t){var o;if(!t.processedHttpRegionListener)return;let r=(o=t.processedHttpRegions)==null?void 0:o.find(s=>s.id===t.httpRegion.id);r&&!this.emitted.has(r)&&r.duration!==void 0&&(this.emitted.add(r),t.processedHttpRegionListener(r))}};var Sr=class{constructor(){this.id="regionScopedVariables"}async beforeLoop(t){var s;let r=t.args[0],o=j(r.activeEnvironment);if((s=r.config)!=null&&s.useRegionScopedVariables){let n=r.options;n.variables=r.variables,r.variables=Object.assign({},r.variables,...r.httpFile.globalHttpRegions.map(i=>i.variablesPerEnv[o]))}else r.variables=Object.assign(r.variables,...r.httpFile.httpRegions.map(n=>n.variablesPerEnv[o]));return!0}async afterLoop(t){var o;let r=t.args[0];if((o=r.config)!=null&&o.useRegionScopedVariables){let s=r.options;if(s.variables){let n=r.variables;r.variables=s.variables,this.autoShareNewVariables(n,r)}}return!0}autoShareNewVariables(t,r){for(let[o,s]of Object.entries(t))r.variables[o]||(r.variables[o]=s)}};function En(e,t,r){return e==="disabled"?(t?typeof t=="string"&&r.httpRegion.hooks.execute.addHook("disabled",async o=>{let s=await L.evalExpression(t,o);return s&&oe(o.httpRegion),!s}):r.httpRegion.hooks.execute.addInterceptor({id:"disabled",async beforeLoop(o){o.bail=!0;let{httpRegion:s}=o.args[0];return oe(s),!0}}),!0):!1}function qn(e,t,r){return e==="forceRegionDelimiter"&&(r.forceRegionDelimiter=!0),!1}function On(e,t,r){return e==="import"&&t?(r.httpRegion.hooks.execute.addObjHook(o=>o.process,new zo(t,r.httpFileStore)),!0):!1}var zo=class{constructor(t,r){this.fileName=t;this.httpFileStore=r;this.id="import"}async process(t){return Tt(this.fileName,this.httpFileStore,t)}};function $n(e,t,r){return e==="jwt"?(r.httpRegion.hooks.onResponse.addHook("jwt",async o=>{let s=o.parsedBody||o.body;if(s&&typeof s=="object"){let n=Object.entries(s),i=n;t&&(i=n.filter(([d])=>t.indexOf(d)>=0));for(let[d,u]of i){let p=Hd(u);p&&n.push([`${d}_parsed`,p])}let a=Object.fromEntries(n),l=I(a,2);o.body=l,o.prettyPrintBody=l,o.parsedBody=a}}),!0):!1}function Hd(e){return m(e)?po(e):null}var An=require("uuid");function Dn(e,t,r){if(e==="keepStreaming"){let o=`keep_streaming_${(0,An.v4)()}`;return r.httpRegion.hooks.onStreaming.addHook("keepStreaming",async s=>{s.request&&(q(s,"stream until manual cancellation"),await new Promise(n=>{s.requestClient&&s.requestClient.addEventListener("disconnect",()=>n(!0))}))}),r.httpRegion.hooks.onResponse.addHook("keepStreaming",()=>{S.removeUserSession(o)}),!0}return!1}var Fn=require("hookpoint"),In=require("uuid");function jn(e,t,r){var o,s,n,i;if(e==="loop"&&t){let a=/^\s*for\s+(?<variable>.*)\s+of\s+(?<iterable>.*)\s*/u.exec(t);if((o=a==null?void 0:a.groups)!=null&&o.iterable&&((s=a==null?void 0:a.groups)!=null&&s.variable))return Xo(r,{type:1,variable:a.groups.variable,iterable:a.groups.iterable}),!0;let l=/^\s*for\s*(?<counter>\d*)\s*$/u.exec(t);if((n=l==null?void 0:l.groups)!=null&&n.counter)return Xo(r,{type:0,counter:Number.parseInt(l.groups.counter,10)}),!0;let d=/^\s*while\s*(?<expression>.*)\s*$/u.exec(t);if((i=d==null?void 0:d.groups)!=null&&i.expression)return Xo(r,{type:2,expression:d.groups.expression}),!0}return!1}function Xo(e,t){let r=new Yo(t);e.httpRegion.hooks.execute.addInterceptor(r),e.httpRegion.hooks.execute.addObjHook(o=>o.process,r)}var Yo=class{constructor(t){this.data=t;this.isInLoop=!1;this.id=`loop_${(0,In.v4)()}`}async beforeLoop(t){return this.hook=t.hook,this.isInLoop&&(t.index=t.hook.items.findIndex(r=>r.id===this.id)),!0}async process(t){if(this.hook&&!this.isInLoop){let r=[];try{this.isInLoop=!0;let o=this.iterate(t),s=await o.next();for(;!s.done;){q(t,`${s.value.index+1} loop pass`);let n={...t,httpRegion:this.createHttpRegionClone(t.httpRegion,s.value.index),variables:Object.assign(t.variables,s.value.variables)};if(await this.hook.trigger(n)===Fn.HookCancel)return!1;r.push(n.variables.response),s=await o.next()}t.httpRegion.metaData.name&&r.length>0&&F({[`${t.httpRegion.metaData.name}`]:r[0],[`${t.httpRegion.metaData.name}List`]:r},t)}finally{this.isInLoop=!1}}return!0}async afterTrigger(t){var r;return!this.isInLoop&&((r=t.hookItem)==null?void 0:r.id)===this.id&&(t.bail=!0),!0}async*iterate(t){switch(this.data.type){case 1:yield*this.iterateForOfLoop(t);break;case 0:yield*this.iterateForLoop();break;case 2:yield*this.iterateWhileLoop(t);break;default:break}}async*iterateForOfLoop(t){if(this.data.variable&&this.data.iterable){let r=await L.evalExpression(this.data.iterable,t),o;if(Array.isArray(r)&&(o=r),o){let s=0;for(let n of o){let i={$index:s};i[this.data.variable]=n,yield{index:s,variables:i},s++}}}}async*iterateWhileLoop(t){if(this.data.expression){let r=0;for(;await L.evalExpression(this.data.expression,t);)yield{index:r,variables:{$index:r}},r++}}*iterateForLoop(){if(this.data.counter)for(let t=0;t<this.data.counter;t++)yield{index:t,variables:{$index:t}}}createHttpRegionClone(t,r){let o=t.clone();return o.metaData.name=t.metaData.name?`${t.metaData.name}${r}`:void 0,o}};function Mn(e,t,r){return e==="noRedirect"?(r.httpRegion.hooks.onRequest.addHook("noRedirect",async o=>{o.noRedirect=!0}),!0):!1}function Vn(e,t,r){return e==="noRejectUnauthorized"?(r.httpRegion.hooks.onRequest.addHook("noRejectUnauthorized",async o=>{o.noRejectUnauthorized=!0}),!0):!1}function Bn(e,t,r){if(e==="note"){let o=t||`Are you sure you want to send the request ${wt(r.httpRegion)}?`;return r.httpRegion.hooks.execute.addInterceptor({id:"note",beforeLoop:()=>$.showNote(o)}),!0}return!1}function Nn(e,t,r){return e==="proxy"?(r.httpRegion.hooks.onRequest.addHook("proxy",async o=>{o.proxy=t}),!0):!1}function Un(e,t,{httpRegion:r}){if(e==="ratelimit"&&t){let o=/^\s*(slot(:)?\s*(?<slot>[^\s]+))?\s*(minIdleTime(:)?\s*(?<minIdleTime>\d*))?\s*(max(:)?\s*(?<max>\d*))\s*(expire(:)?\s*(?<expire>\d*))?\s*$/iu.exec(t);if(o!=null&&o.groups){let s=o.groups.slot||"rateLimit",n=o.groups.minIdleTime||"0",i=o.groups.max||"0",a=o.groups.expire||"0";r.hooks.execute.addHook("rateLimit",async l=>{let d=Td(s,Number.parseInt(n,10),Number.parseInt(i,10),Number.parseInt(a,10));return d.requests.push(await Cd(d,l)),!0})}}return!1}async function Cd(e,t){for(;e.requests.length>0;){let r=new Date;if(Ld(e.requests,r,e.expire),e.max>0&&e.requests.length>=e.max){let o=e.requests[0],s=e.expire+o.getTime()-r.getTime();s>0&&(q(t,`rate limit max reached. wait for ${s}`),g.debug(`rate limit max reached. wait for ${s} (slot ${e.slot})`),await we(s),g.debug("rate limit max waited"));continue}if(e.requests.length>0){let o=e.requests[e.requests.length-1];if(o&&e.minIdleTime>0){let s=o.getTime()+e.minIdleTime-r.getTime();if(s>0){q(t,`rate limit minIdleTime, wait for ${s}`),g.debug(`rate limit minIdleTime, wait for ${s} (slot ${e.slot})`),await we(s),g.debug("rate limit minIdleTime waited");continue}}}return r}return new Date}function Sd(e){let t=e;return!!(t!=null&&t.requests)&&t.type==="RateLimit"}function Td(e,t,r,o){let s=`ratelimit_${e}`,n=S.getUserSession(s);if(Sd(n))return n.max=r,n.minIdleTime=t,n.expire=o,n;let i=[];t>0&&i.push(`minIdleTime ${t}ms`),o>0&&i.push(`max ${r} with expire ${o}ms`);let a={id:s,type:"RateLimit",title:`rate limit slot ${e}`,details:{slot:e,minIdleTime:t,max:r,expire:o},description:i.join(", "),slot:e,minIdleTime:t,max:r,expire:o,requests:[]};return S.setUserSession(a),a}function Ld(e,t,r){if(r>0){let o=0;for(let s of e)if(t.getTime()-s.getTime()>=r)o++;else break;e.splice(0,o)}else e.splice(0,e.length-1)}var _n=20,Tr=[],Lr=0,Gn=500;function Kn(e,t,r){return["ref","forceRef"].indexOf(e)>=0&&t?(r.httpRegion.hooks.execute.addObjHook(o=>o.process,new Qo({name:t,force:e==="forceRef"})),!0):!1}var Qo=class{constructor(t){this.data=t;this.id="ref"}async process(t){var s,n,i;if(((s=t.options)==null?void 0:s.skipRefResolution)===!0){let a=await M(this.data.name,this.id,t);if(typeof a!="string"||!a)return!0;let l=Me(a,t);if(l&&((n=t.processedHttpRegions)!=null&&n.some(d=>d.id===l.id))){let d=j(t.activeEnvironment);F(l.variablesPerEnv[d],t)}return!0}let r=await M(this.data.name,this.id,t);if(typeof r!="string"||!r)throw g.error(`ref ${this.data.name} not resolvable to a valid name: ${this.data.name} -> ${r}`),new Error(`ref ${this.data.name} not resolvable to a valid name: ${this.data.name} -> ${r}`);Lr++;let o=`${t.httpRegion.id}:${r}`;if(Lr>Gn)throw g.error(`Total reference calls (${Lr}) exceeded limit (${Gn})`),new Error(`Too many reference calls (${Lr}) - possible infinite loop or runaway forceRef`);if(Tr.length>=_n){let a=Tr.slice(-10).join(" -> ");throw g.error(`Reference depth limit (${_n}) exceeded. Recent refs: ${a}`),new Error(`Reference depth limit exceeded - possible infinite loop. Recent: ${a}`)}Tr.push(o);try{let a=!0;q(t,`load reference ${r}`);let l=Me(r,t);if(l){if(this.isReferenceErroredOrSkipped(l))return oe(t.httpRegion),!1;let d=j(t.activeEnvironment);F(l.variablesPerEnv[d],t),g.trace("import variables",l.variablesPerEnv[d]);let u=Je(t.variables[r])&&!((i=t.processedHttpRegions)!=null&&i.some(p=>p.id===l.id));(this.data.force||u)&&(a=await l.execute(t),a&&F(l.variablesPerEnv[d],t))}else throw g.error(`ref ${r} not found`),new Error(`ref ${r} not found`);return a}finally{Tr.pop()}}isReferenceErroredOrSkipped(t){var r;return!!((r=t.testResults)!=null&&r.some(o=>o.status==="ERROR"||o.status==="SKIPPED"))}};function Wn(e,t,r){return e==="responseRef"&&t&&(r.httpRegion.responseRefs||(r.httpRegion.responseRefs=[]),r.httpRegion.responseRefs.push(t)),!1}function Jn(e,t,r){return e==="sleep"&&t?(r.httpRegion.hooks.execute.addHook("sleep",async o=>{let s=await L.evalExpression(t,o);return Number.isSafeInteger(s)&&(await q(o,`Sleep for ${s}ms`),await we(s)),!0}),!0):!1}function zn(e,t,r){let o=C(t);return e==="timeout"&&o!==void 0?(r.httpRegion.hooks.onRequest.addHook("timeout",async s=>{s.timeout=o}),!0):!1}function Xn(e,t,r){if(e==="verbose"||e==="debug"){let o=e==="debug"?2:1;return g.options.level=o,r.httpRegion.hooks.execute.addInterceptor({id:"verbose",async beforeLoop(){return g.options.level=o,!0}}),!0}return!1}async function Yn(e,{httpRegion:t}){let r=e(!0),o=qd(r);return o?(t.metaData.description||(t.metaData.description=o.comment),{nextParserLine:o.endLine,symbols:[new P({name:"comment",description:o.comment,kind:"comment",startLine:o.startLine,startOffset:0,endLine:o.endLine,endOffset:o.endOffset})]}):!1}function qd(e){var r;let t=e.next();if(!t.done){let o=t.value.line,s=/^\s*\/\/\s*(?<comment>.*)\s*$/u.exec(t.value.textLine);if((r=s==null?void 0:s.groups)!=null&&r.comment)return{startLine:o,endLine:o,endOffset:t.value.textLine.length,comment:s.groups.comment};if(/^\s*\/\*$/u.exec(t.value.textLine)){t=e.next();let i=[];for(;!t.done;){if(/^\s*\*\/\s*$/u.test(t.value.textLine))return{startLine:o,endLine:t.value.line,endOffset:t.value.textLine.length,comment:J(i)};i.push(t.value.textLine),t=e.next()}}}return!1}var Qn=/^\s*(#+|\/{2})/u;async function Zn(e,t){var i,a;let r=e(),{httpRegion:o,data:s}=t;s.metaTitle&&(o.metaData.title=s.metaTitle.trim(),o.metaData.name||(o.metaData.name=s.metaTitle.trim()),delete s.metaTitle);let n=r.next();if(!n.done){let l=n.value.textLine;if(Qn.test(l)){if(Od(t)&&l.trim()!=="###")return g.debug("request with markdown only supports delimiter after request line"),!1;let d={nextParserLine:n.value.line,symbols:[]},u=me.exec(l);if(u)d.endRegionLine=n.value.line-1,d.symbols.push(new P({name:"separator",description:((i=u.groups)==null?void 0:i.title)||"-",kind:"metaData",startLine:n.value.line,startOffset:0,endLine:n.value.line,endOffset:l.length})),s.metaTitle=(a=u.groups)==null?void 0:a.title;else{let p=await Ct(n.value,t,Qn);p&&(d.symbols=p.symbols)}return d}}return!1}function Od(e){var t;if((t=e.httpRegion.request)!=null&&t.headers){let r=Ae(e.httpRegion.request.headers);if(xt(r))return!0}return!1}async function ei(e,t){var o,s,n;let r=e();if(t.httpRegion.request){let i=Zo(t),a=r.next();if(!a.done&&(i.rawBody.length>0||!Oe(a.value.textLine))){let l=[];!i.symbol||i.symbol.endLine!==a.value.line-1?(i.symbol=new P({name:"request body",description:"request body",kind:"requestBody",startLine:a.value.line,startOffset:0,endLine:a.value.line,endOffset:a.value.textLine.length,children:ae(a.value.textLine,a.value.line)}),l.push(i.symbol)):(i.symbol.endLine=a.value.line,i.symbol.endOffset=a.value.textLine.length,(s=(o=i.symbol.children)==null?void 0:o.push)==null||s.call(o,...ae(a.value.textLine,a.value.line)));let d=St(a.value.textLine);return d?(i.rawBody.push(d),(n=i.symbol.children)==null||n.push(new P({name:"filename",description:d.fileName,kind:"path",startLine:a.value.line,startOffset:a.value.textLine.indexOf(d.fileName),endLine:a.value.line,endOffset:a.value.textLine.indexOf(d.fileName)+d.fileName.length}))):i.rawBody.push(a.value.textLine),{nextParserLine:a.value.line,symbols:l}}}return!1}function Zo(e){let t=e.data.request_body;return t||(t={rawBody:[]},e.data.request_body=t),t}var Er=class{get id(){return"multipart/mixed"}async beforeLoop(t){var o;let r=t.args[1];if(r.httpRegion.request&&ao(r.httpRegion.request.contentType)){if(r.forceRegionDelimiter===void 0)r.forceRegionDelimiter=!0;else if(r.forceRegionDelimiter){let s=((o=r.httpRegion.request.contentType)==null?void 0:o.boundary)||"",n=Zo(r).rawBody.slice().pop();m(n)&&n.includes(`--${s}--`)&&(r.forceRegionDelimiter=!1)}}return!0}};async function ti(e,{httpRegion:t}){var s;let o=e().next();if(!o.done){let n=o.value.textLine,i=/^\s*>>(?<force>!)?\s+(?<fileName>.+)\s*$/u.exec(n);if(i&&((s=i.groups)!=null&&s.fileName)){let a=i.groups.fileName.trim(),l=!!i.groups.force;return t.hooks.onResponse.addHook("outputRedirection",async(d,u)=>{try{if(d.rawBody){let p=v(await M(a,"Variable",u));if(p){let c=await $d(p,l,u.httpFile.fileName);c?await f.writeBuffer(c,d.rawBody):g.debug(`file ${a} not found`)}else g.debug(`file ${a} not found`)}}catch(p){g.error(`output redirection failed for ${a}`,p)}}),{nextParserLine:o.value.line,symbols:[new P({name:"outputredirection",description:i.groups.filename,kind:"response",startLine:o.value.line,startOffset:0,endLine:o.value.line,endOffset:o.value.textLine.length,children:[new P({name:"filename",description:a,kind:"path",startLine:o.value.line,startOffset:o.value.textLine.indexOf(a),endLine:o.value.line,endOffset:o.value.textLine.indexOf(a)+a.length})]})]}}}return!1}async function $d(e,t,r){let o=await es(e,r);if(!t&&await f.exists(o)){let s=e.lastIndexOf(".");if(s>0&&s<e.length-2){let n=e.slice(0,s),i=e.slice(s+1),a=1;for(o=await es(`${n}-${a}.${i}`,r);await f.exists(o);)o=await es(`${n}-${a++}.${i}`,r)}}return o}async function es(e,t){if(!await f.isAbsolute(e)){let r=f.dirname(t);if(r)return f.joinPath(r,e)}return e}var ri=Mo({protocol:"HTTP",methodRegex:/^\s*(?<method>GET|POST|PUT|DELETE|PATCH|HEAD|OPTIONS|CONNECT|TRACE|PROPFIND|PROPPATCH|MKCOL|COPY|MOVE|LOCK|UNLOCK|CHECKOUT|CHECKIN|REPORT|MERGE|MKACTIVITY|MKWORKSPACE|VERSION-CONTROL|BASELINE-CONTROL|MKCALENDAR|ACL|SEARCH|GRAPHQL)\s+(?<url>.+?)$/u,protocolRegex:/^\s*(?<url>.+)\s*$/iu,requestClientFactory(e,t){if(de.createRequestClient)return de.createRequestClient(e,t);throw new Error("Missing Http Client Provider")},modifyRequest(e){e.method==="HTTP"&&(e.method="GET"),D(e)&&Ad(e)},sessionStore:S});function Ad(e){var t;if(e.url){let r=/(?<url>.*)\s+HTTP\/(?<version>(\S+))/u.exec(e.url);(t=r==null?void 0:r.groups)!=null&&t.version&&r.groups.url&&(e.url=r.groups.url.trim(),["1.1","1.0"].indexOf(r.groups.version)<0&&(e.options||(e.options={}),e.options.http2=!0))}}async function oi(e,t){return jo(e,t,/^\s*HTTP\/(?<httpVersion>\S+)\s*(?<statusCode>[1-5][0-9][0-9])\s*(-)?\s*(?<statusMessage>.*)$/u)}async function si(e,{httpRegion:t}){var s;let o=e().next();if(!o.done){let n=o.value.textLine,i=/^\s*<>\s*(?<fileName>.+?)\s*$/u.exec(n);if(i&&((s=i.groups)!=null&&s.fileName)){t.responseRefs||(t.responseRefs=[]);let a=i.groups.fileName;return t.responseRefs.push(a),{nextParserLine:o.value.line,symbols:[new P({name:"responseRef",description:i.groups.filename,kind:"response",startLine:o.value.line,startOffset:0,endLine:o.value.line,endOffset:o.value.textLine.length,children:[new P({name:"filename",description:a,kind:"path",startLine:o.value.line,startOffset:n.indexOf(a),endLine:o.value.line,endOffset:n.indexOf(a)+a.length})]})]}}}return!1}async function ni(e,{httpRegion:t}){let o=e().next();if(!o.done){let s=o.value.textLine,n=/^\s*@(?<useGlobal>global\.)?(?<key>[^\s=:]*)\s*(?<lazyIndicator>:?)=*\s*"?(?<value>.*)"?\s*$/u.exec(s);if(n&&n.groups&&n.groups.key&&n.groups.value){let i=n.groups.key,a=!!n.groups.lazyIndicator,l=!!n.groups.useGlobal,d=n.groups.value;return t.hooks.execute.addHook(`variable_${i}`,async u=>{let p=d;a?u.options.lazyVariables=!0:p=await M(d,"Variable",u);let c=u.variables.$global;return l&&c&&typeof c=="object"?Object.assign(c,{[i]:p}):F({[i]:p},u),!0}),{nextParserLine:o.value.line,symbols:[new P({name:n.groups.key,description:n.groups.value,kind:"variableDefinition",startLine:o.value.line,startOffset:0,endLine:o.value.line,endOffset:o.value.textLine.length,children:[new P({name:n.groups.key,description:"key",kind:"key",startLine:o.value.line,startOffset:o.value.textLine.indexOf(n.groups.key),endLine:o.value.line,endOffset:o.value.textLine.indexOf(n.groups.key)+n.groups.key.length}),new P({name:n.groups.value,description:"value",kind:"value",startLine:o.value.line,startOffset:o.value.textLine.indexOf(n.groups.value),endLine:o.value.line,endOffset:o.value.textLine.indexOf(n.groups.value)+n.groups.value.length})]})]}}}return!1}function ii(e){e.httpRegion.hooks.execute.addInterceptor({id:"cancel",beforeLoop:async function(r){var s,n;return(n=(s=r.args[0].progress)==null?void 0:s.isCanceled)!=null&&n.call(s)?(g.debug("process canceled by user"),!1):!0}})}async function ai(e,t){var r;if(e&&((r=t.config)!=null&&r.defaultHeaders)){q(t,"set default request headers");let o=t.config.defaultHeaders;if(!e.headers)e.headers={...o};else for(let[s,n]of Object.entries(o))A(e.headers,s)||(e.headers[s]=n)}}var li=T(require("encodeurl"));async function di(e){e.body&&m(e.body)&&$e(e.contentType)&&(e.body=(0,li.default)(e.body))}var ui={id:"excludeProxy",afterLoop:async function(t){var s,n;let[r,o]=t.args;return r.proxy||(r.proxy=(s=o.config)==null?void 0:s.proxy),r.proxy&&(o.httpRegion.metaData.noProxy||(n=o.config)!=null&&n.proxyExcludeList&&o.config.proxyExcludeList.some(i=>r.url.startsWith(i)))&&delete r.proxy,!0}};var pi={id:"isTrusted",afterLoop:async function(t){if(!$.isTrusted()){let[r]=t.args;return await $.showNote(`Is call to ${r.method} ${r.url} allowed, because workspace is not trusted.`)}return!0}};var ge=require("hookpoint");async function ci(e,t){if(q(t,"replace variables in request"),e.url){let r=await M(e.url,"Url",t)||e.url;if(r===ge.HookCancel)return ge.HookCancel;m(r)&&(e.url=r)}if(await ts(e,t)===!1)return ge.HookCancel;if(await Fd(e,t)===!1)return ge.HookCancel}async function ts(e,t){if(e.body){if(m(e.body)){let r=await M(e.body,"Body",t);if(r===ge.HookCancel)return!1;m(r)||Buffer.isBuffer(r)?e.body=r:e.body=v(r)}else if(Array.isArray(e.body)){let r=[];for(let o of e.body)if(m(o)){let s=await M(o,"Body",t);if(s===ge.HookCancel)return!1;m(s)&&r.push(s)}else r.push(o);e.body=r}}return!0}async function Fd(e,t){if(e.headers)for(let[r,o]of Object.entries(e.headers))if(Array.isArray(o)){let s=[];for(let n of o){let i=await M(n,r,t);if(i===ge.HookCancel)return!1;s.push(i)}e.headers[r]=s}else{let s=await M(o,r,t);if(s===ge.HookCancel)return!1;e.headers[r]=s}return!0}async function fi(e,t){if(e.body&&Array.isArray(e.body)){let r=[];for(let o of e.body)if(m(o))r.push(o);else if(Buffer.isBuffer(o))r.push(o);else{let s=await o(t);s&&r.push(s)}e.body=r}}async function mi(e){if(e){let t={Accept:"*/*","User-Agent":"httpyac"};if(!e.headers)e.headers=t;else for(let[r,o]of Object.entries(t))A(e.headers,r)||(e.headers[r]=o)}}async function gi(e,{variables:t}){Id(e,t),jd(e,t),Md(e,t),Bd(e,t),Vd(e)}function Id(e,t){e&&t&&typeof t.request_rejectUnauthorized<"u"&&(e.noRejectUnauthorized=!xe(t.request_rejectUnauthorized))}function jd(e,t){e&&t&&typeof t.request_noRedirect<"u"&&(e.noRedirect=xe(t.request_noRedirect))}function Md(e,t){m(t==null?void 0:t.request_proxy)&&(e.proxy=t.request_proxy)}function Vd(e){if(e.proxy||!D(e))return;let t=process.env.https_proxy||process.env.HTTPS_PROXY,r=process.env.http_proxy||process.env.HTTP_PROXY;e.url.toLowerCase().startsWith("https")&&m(t)?e.proxy=t:m(r)&&(e.proxy=process.env.httpProxy)}function Bd(e,t){let r=C(t==null?void 0:t.request_timeout);r!==void 0&&(e.timeout=r)}async function hi(e,t){e.body&&(e.body=await rs(e.body,t))}async function rs(e,t){return m(e)||Buffer.isBuffer(e)?e:await Nd(e,t)}async function Nd(e,t){let r=[];for(let o of e)if(m(o))r.push(o);else if(Buffer.isBuffer(o))r.push(o);else{let s=await o(t);s&&r.push(s)}return r.some(o=>Buffer.isBuffer(o))?Buffer.concat(r.map(o=>Buffer.isBuffer(o)?o:Buffer.from(o))):r.join("")}async function yi(e){if(e.body&&m(e.body)&&$e(e.contentType)){let t=re(e.body);if(t.length>0){let r=[],o=["=","&"];for(let s of t)r.push(o.reduce((n,i)=>n.split(i).map(a=>a.trim()).join(i),s));e.body=r.join("")}}}async function Ri(e){var r;let t=Gd(e);if(e.httpRegion.request&&t){let o=e.httpRegion.request;Wd(t.rawBody);let s=await Jd(t.rawBody);if(s.length>0){let n=Xd(s,o.contentType);n.length>0&&!n[0].wait&&(o.body=(r=n.shift())==null?void 0:r.body),n.length>0&&Qd(n,e)}}}function bi(e,t){return $e(t)?zd(e):(Kd(e,t),_d(e,t))}function _d(e,t){let r=[],o=[],s=io(t)?`\r
`:f.EOL;for(let n of e)m(n)?o.push(n):(o.length>0&&(o.push(""),r.push(o.join(s)),o.length=0),r.push(n),o.push(""));return o.length>0&&r.length===0?o.join(s):(o.length>0&&r.push(o.join(s)),r)}function Gd(e){let t=e.data.request_body;return t&&delete e.data.request_body,t}function Kd(e,t){e.every(r=>m(r))&&lo(t)&&e.push("")}function Wd(e){for(;e.length>0&&Oe(e[e.length-1]);)e.pop();if(e.length>0){let t=e[e.length-1];m(t)&&/\s*<--->\s*/u.test(t)&&e.pop()}}async function Jd(e){let t=[];for(let r of e)if(m(r))t.push(r);else{let{injectVariables:o,fileName:s}=r,n=(i,a)=>{var l;if(a.httpRegion.metaData.injectVariables)return!0;if((l=a.config)!=null&&l.requestBodyInjectVariablesExtensions){let d=wo(i);if(d)return a.config.requestBodyInjectVariablesExtensions.indexOf(d)>=0}return!1};t.push(async i=>await fe(s,i,async a=>o||n(r.fileName,i)?await f.readFile(a,r.encoding):f.readBuffer(a)))}return t}function zd(e){let t=e.reduce((r,o,s)=>{let n=r;return m(o)&&(n+=`${s===0||o.startsWith("&")?"":f.EOL}${o}`),n},"");return m(t)?t:""}function Xd(e,t){let r=[],o=[],s=!1;for(let n of e){let i=Yd(n);i?(o.push({wait:s,body:bi(r,t)}),s=i.waitForServer,r.length=0):r.push(n)}return r.length>0&&o.push({wait:s,body:bi(r,t)}),o}function Yd(e){var t;if(m(e)){let r=/\s*={3}\s*(?<wait>wait-for-server)?\s*$/u.exec(e);if(r)return{waitForServer:!!((t=r==null?void 0:r.groups)!=null&&t.wait)}}}function Qd(e,t){t.httpRegion.hooks.onStreaming.addHook("streaming_body",async r=>{if(r.requestClient)return new Promise(o=>{Zd(e,r,o)})})}async function Zd(e,t,r){var s;let o=0;for(let n of e){let i=e.indexOf(n)===e.length-1;if(n.wait&&o++,o===0)await xi(n,t),i&&r();else{let a=0,l=o;(s=t.requestClient)==null||s.addEventListener("message",async()=>{++a===l&&(await xi(n,t),i&&r())})}}}async function xi(e,t){var r;if(await ts(e,t),e.body){let o=await rs(e.body,t);o&&await((r=t.requestClient)==null?void 0:r.send(o))}}async function vi(e){if(e.data.httpResponseSymbol){if(e.httpRegion.response&&e.data.httpResponseSymbol.body.length>0){let t=e.httpRegion.response,r=J(e.data.httpResponseSymbol.body);t.body=r,t.rawBody=Buffer.from(r),t.headers&&(t.contentType=Ae(t.headers));let o=e.data.httpResponseSymbol.symbol;if(o.children){let s=e.data.httpResponseSymbol.body.at(-1);o.children.push(new P({name:"response body",description:"response body",kind:"response",startLine:o.endLine-e.data.httpResponseSymbol.body.length+1,startOffset:0,endLine:o.endLine,endOffset:(s==null?void 0:s.length)||0}))}}delete e.data.httpResponseSymbol}}async function Pi(e){let{httpRegion:t,httpFile:r}=e,{metaData:o}=t;eu(o),tu(t,r)}function eu(e){let t=e.name;if(typeof t!="string")return;let r=os(e);for(let o of r)if(o===t){let s=`Self-reference detected: region named "${t}" has @ref/@forceRef to itself. This causes an infinite loop. Check for missing ### separator between requests.`;throw g.error(s),new Error(s)}}function tu(e,t){let r=e.metaData.name;if(typeof r!="string")return;let o=os(e.metaData);if(o.length===0)return;let s=new Map;for(let d of t.httpRegions){let u=d.metaData.name;typeof u=="string"&&s.set(u,os(d.metaData))}s.set(r,o);let n=new Set,i=[];function a(d){if(i.includes(d)){let p=i.indexOf(d);return[...i.slice(p),d]}if(n.has(d))return null;n.add(d),i.push(d);let u=s.get(d);if(u)for(let p of u){let c=a(p);if(c)return c}return i.pop(),null}let l=a(r);if(l){let u=`Circular reference detected: ${l.join(" -> ")}. This will cause an infinite loop at runtime.`;throw g.error(u),new Error(u)}}function os(e){let t=[];return typeof e.ref=="string"&&t.push(...e.ref.split(/\s*,\s*/)),typeof e.forceRef=="string"&&t.push(...e.forceRef.split(/\s*,\s*/)),t}var wi={id:"escapeVariable",afterLoop:async function(t){let[r]=t.args;if(m(r)){let o=/(?:\\\{){2}([^}]+?)(?:\\\}){2}/gu,s,n=r;for(;m(n)&&(s=o.exec(r))!==null;){let[i,a]=s;n=n.replace(i,()=>`{{${a}}}`)}n!==r&&t.results.push(n)}return!0}};async function ki(e,t,r){return G(e,async o=>{let s=St(o);if(s){let n=await fe(s.fileName,r,async i=>s.injectVariables||s.encoding?await f.readFile(i,s.encoding):f.readBuffer(i));return s.injectVariables&&(n=await M(n,t,r)),n}})}async function Hi(e,t,{variables:r,request:o}){if(m(e)&&"Url"===t&&e.startsWith("/")){let s=A(o==null?void 0:o.headers,"Host");if(m(s)){let[,n]=s.toString().split(":");return`${n==="443"||n==="8443"?"https":"http"}://${s}${e}`}if(r.host)return`${r.host}${e}`}return e}async function Ci(e,t,r){return G(e,async o=>r.variables[o])}var tt=T(require("dayjs")),ss=T(require("dayjs/plugin/utc")),Si=require("uuid");tt.default.extend(ss.default);async function Ti(e,t,{variables:r}){return G(e,async o=>{var n,i,a,l,d,u,p,c,h,b,w,H;let s=o.trim();if(s==="$guid")return(0,Si.v4)();if(s.startsWith("$randomInt")){let R=/^\$randomInt\s*(?<min>-?\d+)?\s*(?<max>-?\d+)?\s*$/u.exec(s);if(R&&((n=R.groups)!=null&&n.min)&&((i=R.groups)!=null&&i.max)){let y=C((a=R.groups)==null?void 0:a.min)??0,k=C((l=R.groups)==null?void 0:l.max)??100;if(!Number.isNaN(y)&&!Number.isNaN(k)){if(y>k){let K=k;k=y,y=K}return`${Math.floor(Math.random()*(k-y))+y}`}}}else if(s.startsWith("$timestamp")){let R=/^\$timestamp(?:\s(?<offset>-?\d+)\s(?<option>y|Q|M|w|d|h|m|s|ms))?/u.exec(s);if(R){tt.default.extend(ss.default);let y=tt.default.utc();return(d=R.groups)!=null&&d.offset&&((u=R.groups)!=null&&u.option)&&(y=y.add(Number(R.groups.offset),R.groups.option)),`${y.unix()}`}}else if(s.startsWith("$datetime")){let R=/^\$datetime\s(?<type>rfc1123|iso8601|'.+'|".+")(?:\s(?<offset>-?\d+)\s(?<option>y|Q|M|w|d|h|m|s|ms))?/u.exec(s);if((p=R==null?void 0:R.groups)!=null&&p.type){let y=tt.default.utc();return(c=R.groups)!=null&&c.offset&&((h=R.groups)!=null&&h.option)&&(y=y.add(Number(R.groups.offset),R.groups.option)),R.groups.type==="rfc1123"?y.toDate().toUTCString():R.groups.type==="iso8601"?y.toISOString():y.format(R.groups.type.slice(1,R.groups.type.length-1))}}else if(s.startsWith("$localDatetime")){let R=/^\$localDatetime\s(?<type>rfc1123|iso8601|'.+'|".+")(?:\s(?<offset>-?\d+)\s(?<option>y|Q|M|w|d|h|m|s|ms))?/u.exec(s);if((b=R==null?void 0:R.groups)!=null&&b.type){let y=tt.default.utc().local();return(w=R.groups)!=null&&w.offset&&((H=R.groups)!=null&&H.option)&&(y=y.add(Number(R.groups.offset),R.groups.option)),R.groups.type==="rfc1123"?y.locale("en").format("ddd, DD MMM YYYY HH:mm:ss ZZ"):R.groups.type==="iso8601"?y.format():y.format(R.groups.type.slice(1,R.groups.type.length-1))}}else{if(s.startsWith("$processEnv"))return process.env[s.slice(11).trim()]||"";if(s.startsWith("$dotenv"))return r[s.slice(7).trim()]||""}})}var Li=require("hookpoint");async function Ei(e,t,{variables:r}){return G(e,async o=>{var i;let n=/^\$(?<type>(prompt|input|password))(?<askonce>-askonce)?\s*(?<placeholder>[^$]*)(\$value:\s*(?<value>.*))?\s*$/u.exec(o);if((i=n==null?void 0:n.groups)!=null&&i.placeholder){let a=n.groups.placeholder.trim(),l=n.groups.type,d=`input_${a}`,u=S.getUserSession(d);if(n.groups.askonce){if((r==null?void 0:r[a])!==void 0)return r[a];if(u!=null&&u.answer)return u.answer}let p=l==="password",c=await $.showInputPrompt(a,(u==null?void 0:u.answer)||n.groups.value,p);return c!==void 0?(S.setUserSession({id:d,title:p?a:`${a}=${c}`,description:`Cache for ${l}`,type:"input",details:{placeholder:a,inputType:l,answer:p?void 0:c},answer:c}),c):Li.HookCancel}})}var qi=require("hookpoint");async function Oi(e,t,r){return G(e,async o=>{var n,i;let s=/^\$pick(?<save>-askonce)?\s*(?<placeholder>[^$]*)(\$value:\s*(?<value>.*))\s*$/u.exec(o);if((n=s==null?void 0:s.groups)!=null&&n.placeholder&&((i=s==null?void 0:s.groups)!=null&&i.value)){let a=s.groups.placeholder.trim(),l=`input_${a}`,d=S.getUserSession(l);if(d!=null&&d.answer&&s.groups.save)return d.answer;let u=await ou(s.groups.value,r),p=await $.showListPrompt(a,u);return p!==void 0?(S.setUserSession({id:l,title:`${a}=${p}`,description:"Cache for $pick",type:"input",details:{placeholder:a,answer:p},answer:p}),p):qi.HookCancel}})}async function ou(e,t){let r=e.split(",");if(r.length===1)try{let o=await L.evalExpression(e,t);if(Array.isArray(o))return o}catch(o){g.trace("error in quickpick",o)}return r}function $i(e,t){let{httpRegion:r}=t;if(m(r.metaData.name)){let o=r.metaData.name.trim().replace(/\s/gu,"-").replace(/-./gu,s=>s[1].toUpperCase());F({[o]:e.parsedBody||e.body,[`${o}Response`]:e},t)}}var Ai={id:"jsonResponseBody",beforeLoop:async function(t){let[r]=t.args;if(r&&bt(r.contentType)&&m(r.body)&&r.body.length>0)try{r.parsedBody||(r.parsedBody=JSON.parse(r.body)),r.prettyPrintBody||(r.prettyPrintBody=I(r.parsedBody,2))}catch(o){g.warn("json parse error",r.body,o)}return!0}};function Di(e,t){let r=go(e);S.setUserSession({id:"last_response",title:"last response",description:`response of ${t.httpRegion.symbol.name}`,details:{},type:"LAST_RESPONSE",response:r}),t.variables.response=e}function Fi(e){iu(e),au(e),lu(e),cu(e),pu(e),du(e),fu(e),uu(e)}function iu(e){e.hooks.onRequest.addHook("attachDefaultHeaders",ai),e.hooks.onRequest.addHook("setEnvRequestOptions",gi),e.hooks.onRequest.addHook("resolveRequestBody",fi),e.hooks.onRequest.addHook("setDefaultHttpyacHeaders",mi),e.hooks.onRequest.addHook("requestVariableReplacer",ci),e.hooks.onRequest.addHook("transformRequestBody",hi),e.hooks.onRequest.addHook("transformMultilineFormUrlEncoded",yi),e.hooks.onRequest.addHook("encodeRequestBody",di),e.hooks.onRequest.addInterceptor(pi),e.hooks.onRequest.addInterceptor(ui)}function au(e){e.hooks.onResponse.addHook("handleMetaDataName",$i),e.hooks.onResponse.addHook("setLastResponseInVariables",Di),e.hooks.onResponse.addInterceptor(Ai)}function lu(e){e.hooks.parse.addHook("meta",Zn),e.hooks.parse.addHook("comment",Yn),e.hooks.parse.addHook("variable",ni),e.hooks.parse.addHook("request",ri),e.hooks.parse.addHook("outputRedirection",ti),e.hooks.parse.addHook("responseRef",si),e.hooks.parse.addHook("response",oi),e.hooks.parse.addHook("requestBody",ei),e.hooks.parse.addInterceptor(new Er)}function du(e){e.hooks.parseEndRegion.addHook("registerCancelExecutionInterceptor",ii),e.hooks.parseEndRegion.addHook("response",vi),e.hooks.parseEndRegion.addHook("requestBody",Ri),e.hooks.parseEndRegion.addHook("validateHttpRegion",Pi)}function uu(e){e.hooks.replaceVariable.addHook("host",Hi),e.hooks.replaceVariable.addHook("name",Ci),e.hooks.replaceVariable.addHook("file",ki),e.hooks.replaceVariable.addHook("showInputBox",Ei),e.hooks.replaceVariable.addHook("showQuickPick",Oi),e.hooks.replaceVariable.addHook("restClientDynamic",Ti),e.hooks.replaceVariable.addInterceptor(wi)}function pu(e){e.hooks.parseMetaData.addHook("disabled",En),e.hooks.parseMetaData.addHook("import",On),e.hooks.parseMetaData.addHook("jwt",$n),e.hooks.parseMetaData.addHook("keepStreaming",Dn),e.hooks.parseMetaData.addHook("loop",jn),e.hooks.parseMetaData.addHook("noRedirect",Mn),e.hooks.parseMetaData.addHook("noRejectUnauthorized",Vn),e.hooks.parseMetaData.addHook("timeout",zn),e.hooks.parseMetaData.addHook("note",Bn),e.hooks.parseMetaData.addHook("proxy",Nn),e.hooks.parseMetaData.addHook("rateLimit",Un),e.hooks.parseMetaData.addHook("ref",Kn),e.hooks.parseMetaData.addHook("responseRef",Wn),e.hooks.parseMetaData.addHook("sleep",Jn),e.hooks.parseMetaData.addHook("verbose",Xn),e.hooks.parseMetaData.addHook("forceRegionDelimiter",qn)}function cu(e){let t=new Cr;e.hooks.execute.addInterceptor(new Sr),e.hooks.execute.addInterceptor(t),e.hooks.responseLogging.addInterceptor(t.getResponseLoggingInterceptor()),e.hooks.execute.addInterceptor(new wr),e.hooks.execute.addInterceptor(new kr),e.hooks.execute.addInterceptor(new Hr)}function fu(e){e.hooks.provideEnvironments.addHook("config",xn),e.hooks.provideVariables.addHook("config",Rn),e.hooks.provideVariables.addHook("response",Sn)}var Ii=require("dotenv");var ns=".env";async function ji(e){let t=[];if(process.env.HTTPYAC_ENV)try{t.push(...await f.readdir(process.env.HTTPYAC_ENV))}catch(s){g.warn(`HTTPYAC_ENV ${process.env.HTTPYAC_ENV} has read error`,s)}let r=f.dirname(e.httpFile.fileName);r&&await Re(r,e.httpFile.rootDir,async s=>{t.push(...await mu(Vi(e),s)),t.push(...await Fe(f.readdir(s),[]))});let o=[];for(let s of t){let n;s.startsWith(`${ns}.`)?n=s.slice(5):s.endsWith(ns)&&(n=s.slice(0,s.length-4)),n&&o.push(n)}return g.info("dotenv Env Provider found environments",o),o}async function mu(e,t){let r=[];if(e){let o=await _(e,t);o&&r.push(...await Fe(f.readdir(o),[]))}return r}async function Mi(e,t){let r=gu(e),o=[];process.env.HTTPYAC_ENV&&o.push(...await is(r,process.env.HTTPYAC_ENV));let s=f.dirname(t.httpFile.fileName);if(s){let n=[];await Re(s,t.httpFile.rootDir,async i=>{n.unshift(...await hu(Vi(t),r,i)),n.unshift(...await is(r,i))}),o.push(...n)}return Object.assign({},...o)}function Vi(e){var t;return((t=e.config)==null?void 0:t.envDirName)||"env"}function gu(e){let t=[ns];if(e)for(let r of e)t.push(`${r}.env`,`.env.${r}`);return t}async function hu(e,t,r){let o=[];if(e){let s=await _(e,r);s&&o.push(...await is(t,s))}return o}async function is(e,t){let r=await Fe(f.readdir(t),[]),o=e.filter(n=>r.indexOf(n)>=0),s=[];for(let n of o){let i=f.joinPath(t,n);g.trace(`.env environment file found: ${i}`);try{let a=await f.readFile(i,"utf-8"),l=(0,Ii.parse)(a);s.push(l)}catch(a){g.trace(`${f.toString(i)} not found`,a)}}return s}function Bi(e){e.hooks.provideEnvironments.addHook("dotenv",ji),e.hooks.provideVariables.addHook("dotenv",Mi)}var Ni=T(require("aws4")),Ui=require("url");async function _i(e,t,r){var s;let{request:o}=r;if(t.toLowerCase()==="authorization"&&m(e)&&D(o)&&(o!=null&&o.url)){let n=/^\s*(aws)\s+(?<accessKeyId>[^\s]*)\s+(?<secretAccessKey>[^\s]*)\s*(token:\s*(?<token>[^\s]*))?\s*(region:\s*(?<region>[^\s]*))?\s*(service:\s*(?<service>[^\s]*))?\s*$/iu.exec(e);if(n&&n.groups&&n.groups.accessKeyId&&n.groups.secretAccessKey){q(r,"get AWS Authorization");let i={accessKeyId:n.groups.accessKeyId,secretAccessKey:n.groups.secretAccessKey,sessionToken:n.groups.token},a=new Ui.URL(o.url);o.headers||(o.headers={});let l={method:o.method,headers:o.headers,host:a.host,path:`${a.pathname}${a.search}`,region:n.groups.region,service:n.groups.service,body:Buffer.isBuffer(o.body)||m(o.body)?o.body:void 0},d=await Ni.default.sign(l,i);return Object.assign(o,{http2:!1}),Object.assign(o.headers,d.headers),(s=d.headers)==null?void 0:s.Authorization}}return e}var yu=/^\s*(basic)\s+(?<user>[^\s]*)\s+(?<password>([^\s]+.*))$/iu,bu=/^\s*(basic)\s+(?<user>.*):(?<password>.*)$/iu;async function Gi(e,t){if(t.toLowerCase()==="authorization"&&m(e)){let r=bu.exec(e)||yu.exec(e);if(r&&r.groups&&r.groups.user)return`Basic ${Buffer.from(`${r.groups.user}:${r.groups.password}`).toString("base64")}`}return e}var Ki=require("url");async function Wi(e,t,r){var i,a,l;let{request:o,httpRegion:s,httpFile:n}=r;if(m(e)&&D(o)&&!s.metaData.noClientCert){if(t==="Url"&&((i=r.config)!=null&&i.clientCertificates))await xu(e,o,r);else if(t.toLowerCase().endsWith("clientcert")){let d=/^\s*(cert:\s*(?<cert>[^\s]*)\s*)?(key:\s*(?<key>[^\s]*)\s*)?(pfx:\s*(?<pfx>[^\s]*)\s*)?(passphrase:\s*(?<passphrase>[^\s]*)\s*)?\s*$/u.exec(e);if((a=d==null?void 0:d.groups)!=null&&a.cert||(l=d==null?void 0:d.groups)!=null&&l.pfx){await Ji(o,{cert:d.groups.cert,key:d.groups.key,pfx:d.groups.pfx,passphrase:d.groups.passphrase},n);return}}}return e}async function xu(e,t,r){var s,n;let o=Ru(e);if(o&&((s=r.config)!=null&&s.clientCertificates)){let i=(n=r.config)==null?void 0:n.clientCertificates[o.host];i&&await Ji(t,i,r.httpFile)}}function Ru(e){try{return new Ki.URL(e)}catch{return}}async function Ji(e,t,r){let o=f.dirname(r.fileName);e.options||(e.options={}),e.options.https=Object.assign({},e.options.https,{certificate:await as(t.cert,o),key:await as(t.key,o),pfx:await as(t.pfx,o),passphrase:t.passphrase})}async function as(e,t){if(e)if(m(e)){let r=await _(e,t);if(r)return await f.readBuffer(r)}else return await f.readBuffer(e)}Q.emptyLineProvider.push(()=>[{name:"GET",description:"The GET method requests a representation of the specified resource. Requests using GET should only retrieve data."},{name:"HEAD",description:"The GET method requests a representation of the specified resource. Requests using GET should only retrieve data."},{name:"POST",description:"The POST method is used to submit an entity to the specified resource, often causing a change in state or side effects on the server."},{name:"PUT",description:"The PUT method replaces all current representations of the target resource with the request payload."},{name:"DELETE",description:"The DELETE method deletes the specified resource."},{name:"CONNECT",description:"The CONNECT method establishes a tunnel to the server identified by the target resource."},{name:"OPTIONS",description:"The OPTIONS method is used to describe the communication options for the target resource."},{name:"TRACE",description:"The TRACE method performs a message loop-back test along the path to the target resource."},{name:"PATCH",description:"The PATCH method is used to apply partial modifications to a resource."}]);Q.requestHeaderProvider.push(e=>D(e)?[{name:"A-IM",description:"Acceptable instance-manipulations for the request."},{name:"Accept",description:"Media type(s)\xA0that is/are acceptable for the response. See\xA0Content negotiation."},{name:"Accept-Charset",description:"Character sets that are acceptable."},{name:"Accept-Datetime",description:"Acceptable version in time."},{name:"Accept-Encoding",description:"List of acceptable encodings. See\xA0HTTP compression."},{name:"Accept-Language",description:"List of acceptable human languages for response. See\xA0Content negotiation."},{name:"Access-Control-Request-Method",description:"Initiates a request for\xA0cross-origin resource sharing\xA0with\xA0Origin\xA0(below)."},{name:"Access-Control-Request-Headers",description:"Initiates a request for\xA0cross-origin resource sharing\xA0with\xA0Origin\xA0(below)."},{name:"Authorization",description:"Authentication credentials for\xA0HTTP authentication."},{name:"Cache-Control",description:"Used to specify directives that\xA0must\xA0be obeyed by all caching mechanisms along the request-response chain."},{name:"Connection",description:"Control options for the current connection and list of hop-by-hop request fields. Must not be used with HTTP/2."},{name:"Content-Encoding",description:"The type of encoding used on the data. See\xA0HTTP compression."},{name:"Content-Length",description:"The length of the request body in\xA0octets\xA0(8-bit bytes)."},{name:"Content-MD5",description:"A\xA0Base64-encoded binary\xA0MD5\xA0sum of the content of the request body."},{name:"Content-Type",description:"The\xA0Media type\xA0of the body of the request (used with POST and PUT requests)."},{name:"Cookie",description:"An\xA0HTTP cookie\xA0previously sent by the server with\xA0Set-Cookie\xA0(below)."},{name:"Date",description:'The date and time at which the message was originated (in "HTTP-date" format as defined by\xA0RFC 7231 Date/Time Formats).'},{name:"Expect",description:"Indicates that particular server behaviors are required by the client."},{name:"Forwarded",description:"Disclose original information of a client connecting to a web server through an HTTP proxy."},{name:"From",description:"The email address of the user making the request."},{name:"Host",description:"The domain name of the server (for\xA0virtual hosting), and the\xA0TCP port\xA0number on which the server is listening. The\xA0port\xA0number may be omitted if the port is the standard port for the service requested. Mandatory since HTTP/1.1.\xA0If the request is generated directly in HTTP/2, it should not be used."},{name:"HTTP2-Settings",description:"A request that upgrades from HTTP/1.1 to HTTP/2 MUST include exactly one\xA0HTTP2-Setting\xA0header field. The\xA0HTTP2-Settings\xA0header field is a connection-specific header field that includes parameters that govern the HTTP/2 connection, provided in anticipation of the server accepting the request to upgrade."},{name:"If-Match",description:"Only perform the action if the client supplied entity matches the same entity on the server. This is mainly for methods like PUT to only update a resource if it has not been modified since the user last updated it."},{name:"If-Modified-Since",description:"Allows a\xA0304 Not Modified\xA0to be returned if content is unchanged."},{name:"If-None-Match",description:"Allows a\xA0304 Not Modified\xA0to be returned if content is unchanged, see\xA0HTTP ETag."},{name:"If-Range",description:"If the entity is unchanged, send me the part(s) that I am missing; otherwise, send me the entire new entity."},{name:"If-Unmodified-Since",description:"Only send the response if the entity has not been modified since a specific time."},{name:"Max-Forwards",description:"Limit the number of times the message can be forwarded through proxies or gateways."},{name:"Origin",description:"Initiates a request for\xA0cross-origin resource sharing\xA0(asks server for\xA0Access-Control-*\xA0response fields)."},{name:"Pragma",description:"Implementation-specific fields that may have various effects anywhere along the request-response chain."},{name:"Proxy-Authorization",description:"Authorization credentials for connecting to a proxy."},{name:"Range",description:"Request only part of an entity. Bytes are numbered from 0. See\xA0Byte serving."},{name:"Referer",description:'This is the address of the previous web page from which a link to the currently requested page was followed. (The word "referrer" has been misspelled in the RFC as well as in most implementations to the point that it has become standard usage and is considered correct terminology)'},{name:"TE",description:'The transfer encodings the user agent is willing to accept: the same values as for the response header field Transfer-Encoding can be used, plus the "trailers" value (related to the "chunked" transfer method) to notify the server it expects to receive additional fields in the trailer after the last, zero-sized, chunk. Only\xA0trailers\xA0is supported in HTTP/2.'},{name:"Trailer",description:"The Trailer general field value indicates that the given set of header fields is present in the trailer of a message encoded with\xA0chunked transfer coding."},{name:"Transfer-Encoding",description:"The form of encoding used to safely transfer the entity to the user.\xA0Currently defined methods\xA0are:\xA0chunked, compress, deflate, gzip, identity. Must not be used with HTTP/2"},{name:"User-Agent",description:"The\xA0user agent string\xA0of the user agent."},{name:"Upgrade",description:"Ask the server to upgrade to another protocol. Must not be used in HTTP/2."},{name:"Via",description:"Informs the server of proxies through which the request was sent."},{name:"Warning",description:"A general warning about possible problems with the entity body."},{name:"Upgrade-Insecure-Requests",description:"Tells a server which (presumably in the middle of a HTTP -> HTTPS migration) hosts mixed content that the client would prefer redirection to HTTPS and can handle\xA0Content-Security-Policy: upgrade-insecure-requests Must not be used with HTTP/2"},{name:"X-Requested-With",description:"Mainly used to identify\xA0Ajax\xA0requests (most\xA0JavaScript frameworks\xA0send this field with value of\xA0XMLHttpRequest); also identifies Android apps using WebView"},{name:"DNT",description:"Requests a web application to disable their tracking of a user. This is Mozilla`s version of the X-Do-Not-Track header field (since\xA0Firefox 4.0\xA0Beta 11).\xA0Safari\xA0and\xA0IE9\xA0also have support for this field.\xA0On March 7, 2011, a draft proposal was submitted to IETF.\xA0The\xA0W3C\xA0Tracking Protection Working Group is producing a specification."},{name:"X-Forwarded-For",description:"A\xA0de facto\xA0standard\xA0for identifying the originating IP address of a client connecting to a web server through an HTTP proxy or load balancer. Superseded by\xA0Forwarded\xA0header."},{name:"X-Forwarded-Host",description:"A\xA0de facto\xA0standard\xA0for identifying the original host requested by the client in the\xA0Host\xA0HTTP request header, since the host name and/or port of the reverse proxy (load balancer) may differ from the origin server handling the request. Superseded by\xA0Forwarded\xA0header."},{name:"X-Forwarded-Proto",description:"A\xA0de facto\xA0standard\xA0for identifying the originating protocol of an HTTP request, since a reverse proxy (or a load balancer) may communicate with a web server using HTTP even if the request to the reverse proxy is HTTPS. An alternative form of the header (X-ProxyUser-Ip) is used by Google clients talking to Google servers. Superseded by\xA0Forwarded\xA0header."},{name:"Front-End-Https",description:"Non-standard header field used by Microsoft applications and load-balancers"},{name:"X-Http-Method-Override",description:"Requests a web application to override the method specified in the request (typically POST) with the method given in the header field (typically PUT or DELETE). This can be used when a user agent or firewall prevents PUT or DELETE methods from being sent directly (note that this is either a bug in the software component, which ought to be fixed, or an intentional configuration, in which case bypassing it may be the wrong thing to do)."},{name:"X-ATT-DeviceId",description:"Allows easier parsing of the MakeModel/Firmware that is usually found in the User-Agent String of AT&T Devices"},{name:"X-Wap-Profile",description:"Links to an XML file on the Internet with a full description and details about the device currently connecting. In the example to the right is an XML file for an AT&T Samsung Galaxy S2."},{name:"Proxy-Connection",description:"Implemented as a misunderstanding of the HTTP specifications. Common because of mistakes in implementations of early HTTP versions. Has exactly the same functionality as standard Connection field. Must not be used with HTTP/2."},{name:"X-UIDH",description:'Server-side\xA0deep packet insertion\xA0of a unique ID identifying customers of\xA0Verizon Wireless; also known as "perma-cookie" or "supercookie"'},{name:"X-Csrf-Token",description:"Used to prevent\xA0cross-site request forgery. Alternative header names are:\xA0X-CSRFToken\xA0and\xA0X-XSRF-TOKEN"},{name:"X-Request-ID",description:"Correlates HTTP requests between a client and server."},{name:"X-Correlation-ID",description:"Correlates HTTP requests between a client and server."},{name:"Save-Data",description:"The Save-Data client hint request header available in Chrome, Opera, and Yandex browsers lets developers deliver lighter, faster applications to users who opt-in to data saving mode in their browser."}]:[]);var Ot=require("tough-cookie");var qr=class{constructor(){this.id="cookieJar"}async beforeTrigger(t){let{request:r,httpRegion:o,config:s,options:n}=t.args[0];if(D(r)&&!o.metaData.noCookieJar&&(s!=null&&s.cookieJarEnabled)){let i=this.getCookieStorePrefix(t.args[0]),a=S.userSessions.filter(p=>p.type==="Cookie"&&p.id.startsWith(i)),l=new Ot.MemoryCookieStore;for(let p of a)p.cookie&&l.putCookie(p.cookie,c=>{c&&g.info(c)});n.memoryStore=l;let d={};s.cookieJarEnabled!==!0&&Object.assign(d,s.cookieJarEnabled);let u=new Ot.CookieJar(l,d);r.options||(r.options={}),r.options.cookieJar=u}return!0}async afterTrigger(t){let{options:r}=t.args[0],o=r.memoryStore;if(o&&o instanceof Ot.MemoryCookieStore){o.getAllCookies((n,i)=>{if(!n)for(let a of i||[]){let l={id:`${this.getCookieStorePrefix(t.args[0])}_${a.toString()}`,title:`${a.domain} ${a.path} ${a.key}`,description:`${a}`,type:"Cookie",details:Object.fromEntries(Object.entries(a).map(([d,u])=>u?u instanceof Date?[d,u.toISOString()]:[d,u]:[]).filter(d=>d.length>0)),cookie:a};S.setUserSession(l)}});let s=S.userSessions.filter(n=>n.type==="Cookie");for(let n of s)n.cookie&&o.putCookie(n.cookie,i=>{i&&g.info(i)})}return!0}getCookieStorePrefix(t){var r,o;return`Cookies_${j(t.activeEnvironment)}_${((o=(r=t.httpFile.rootDir)==null?void 0:r.toString)==null?void 0:o.call(r))||"none"}`}};var zi=require("tough-cookie");async function Xi(e,t,r){var s;let{request:o}=r;if(t.toLowerCase()==="cookie"&&D(o)&&o.url&&((s=o.options)==null?void 0:s.cookieJar)instanceof zi.CookieJar){if(m(e))o.options.cookieJar.setCookie(e,o.url);else if(Array.isArray(e))for(let n of e)await o.options.cookieJar.setCookie(n,o.url);return}return e}var oa=require("crypto"),sa=require("url"),na=require("uuid");var Yi=require("filesize"),Or=T(require("got")),Qi=require("http-proxy-agent"),Zi=require("https-proxy-agent"),ea=T(require("lodash/merge")),ta=require("socks-proxy-agent");async function ra(e,t){try{let r=ls(e,t),s=await(0,Or.default)(e.url||"",r);return Be(s,e)}catch(r){if(r instanceof Or.CancelError)return!1;throw r}}function ls(e,t){var s;let{config:r}=t,o=(0,ea.default)({decompress:!0,retry:0,throwHttpErrors:!1,allowGetBody:!0},r==null?void 0:r.request,{method:e.method,headers:e.headers,body:e.body,timeout:e.timeout},e.options);return e.noRedirect&&(o.followRedirect=!1),e.noRejectUnauthorized&&(o.https=((s=e.options)==null?void 0:s.https)||{},o.https.rejectUnauthorized=!1),vu(o,e.proxy),Pu(o.headers),g.debug("request",o),o}function vu(e,t){if(t)if(t.startsWith("socks://")){let r=new ta.SocksProxyAgent(t);e.agent={http:r,https:r}}else e.agent={http:new Qi.HttpProxyAgent(t),https:new Zi.HttpsProxyAgent(t)}}function Pu(e){if(e){for(let[t,r]of Object.entries(e))if(typeof r<"u"){let o;Array.isArray(r)?o=r.map(s=>v(s)||s):o=v(r)||"",e[t]=o}}}function Be(e,t){var r;return{name:`${e.statusCode} - ${t.method||"GET"} ${t.url}`,statusCode:e.statusCode,protocol:`HTTP/${e.httpVersion}`,statusMessage:e.statusMessage,body:e.body,rawHeaders:e.rawHeaders,rawBody:e.rawBody,headers:e.headers,timings:e.timings.phases,httpVersion:e.httpVersion,request:{protocol:"HTTP",method:e.request.options.method,url:`${e.request.options.url}`,headers:e.request.options.headers,body:ds(e.request.options.body)},contentType:Ae(e.headers),meta:{ip:e.ip,redirectUrls:e.redirectUrls,size:(0,Yi.filesize)(e.rawHeaders.map(o=>o.length).reduce((o,s)=>o+s,0)+(((r=e.rawBody)==null?void 0:r.length)||0))}}}function ds(e){if(typeof e=="string"||Buffer.isBuffer(e))return e}var wu=/^\s*(digest)\s+(?<user>[^\s]*)\s+(?<password>([^\s]+.*))$/iu,ku=/^\s*(digest)\s+(?<user>.*):(?<password>.*)$/iu;async function ia(e,t,r){let{request:o}=r;if(t.toLowerCase()==="authorization"&&m(e)&&D(o)){let s=ku.exec(e)||wu.exec(e);if(s&&s.groups&&s.groups.user&&s.groups.password){o.options||(o.options={}),o.options.hooks||(o.options.hooks={}),o.options.hooks.afterResponse||(o.options.hooks.afterResponse=[]),o.options.hooks.afterResponse.push(Hu(s.groups.user,s.groups.password,r));return}}return e}function Hu(e,t,r){return async function(s,n){let i=s.headers["www-authenticate"];if(s.statusCode===401&&i&&i.toLowerCase().startsWith("digest")){let a=Be(s,{url:s.request.requestUrl});await je(a,r);let l=new sa.URL(s.url),d={qop:"",algorithm:"",realm:"",nonce:"",opaque:""};Tu(d,i);let u=/(^|,)\s*auth\s*($|,)/u.test(d.qop)&&"auth",p=u&&"00000001",c=u&&(0,na.v4)().replace(/-/gu,""),h=Su(d.algorithm,e,t,d.realm,d.nonce,c),b=$t(`${s.request.options.method}:${l.pathname}`),w=$t(u?`${h}:${d.nonce}:${p}:${c}:${u}:${b}`:`${h}:${d.nonce}:${b}`);return n({headers:{authorization:`Digest ${Cu({username:e,realm:d.realm,nonce:d.nonce,uri:l.pathname,qop:u,response:w,nc:p,cnonce:c,algorithm:d.algorithm,opaque:d.opaque})}`}})}return s}}function Cu(e){let t=[];for(let[r,o]of Object.entries(e))o&&(["qop","nc","algorithm"].indexOf(r)>=0?t.push(`${r}=${o}`):t.push(`${r}="${o}"`));return t.join(", ")}function $t(e){return(0,oa.createHash)("md5").update(e).digest("hex")}function Su(e,t,r,o,s,n){let i=$t(`${t}:${o}:${r}`);return n&&(e==null?void 0:e.toLowerCase())==="md5-sess"?$t(`${i}:${s}:${n}`):i}function Tu(e,t){for(let r of t.split(",")){let o=/([a-z0-9_-]+)=(?:"([^"]+)"|([a-z0-9_-]+))/giu.exec(r);o&&(e[o[1]]=o[2]||o[3])}}var At=T(require("got"));var $r=class extends ht{constructor(r,o){super();this.request=r;this.context=o}get reportMessage(){return`perform Http Request (${this.request.url})`}get supportsStreaming(){return!1}get nativeClient(){return At.default}async connect(){return this.nativeClient}async send(r){if(D(this.request)&&this.request.url)try{let o=ls(this.request,this.context);r&&(o.body=pe(r)),this.cancelableRequest=(0,At.default)(this.request.url,o),this.registerEvents(this.cancelableRequest);let s=await this.cancelableRequest;this.onMessage("message",Be(s,this.request))}catch(o){if(o instanceof At.CancelError)return;throw o instanceof TypeError&&o.message==="Invalid URL"&&(o.message=`Invalid URL: ${o.input||this.request.url}`),o}finally{delete this.cancelableRequest}}disconnect(r){var o;r&&((o=this.cancelableRequest)==null||o.cancel(),this.onDisconnect())}registerEvents(r){r.on("downloadProgress",s=>{this.onProgress(s.percent)});let o=s=>(...n)=>{this.onMetaData(s,{protocol:"HTTP",statusCode:0,message:n.length>0?`${v(n[0])}`:void 0,body:{...n}})};r.on("redirect",o("redirect")),r.on("retry",o("retry")),r.on("downloadProgress",o("downloadProgress")),r.on("uploadProgress",o("uploadProgress"))}};async function aa(e,t){var r,o;if(e&&D(e)){e.options||(e.options={}),(r=e.options)!=null&&r.hooks||(e.options.hooks={}),(o=e.options)!=null&&o.hooks.beforeRedirect||(e.options.hooks.beforeRedirect=[]),e.options.hooks.beforeRequest||(e.options.hooks.beforeRequest=[]);let s;e.options.hooks.beforeRequest.push(n=>{s={protocol:"HTTP",method:n.method,url:`${n.url}`,headers:n.headers,body:ds(n.body)}}),e.options.hooks.beforeRedirect.push(async(n,i)=>{let a=Be(i,s||{url:v(n.url)||""});await je(a,t)})}}function la(e,t,r){return e==="postRedirectGet"?(r.httpRegion.hooks.onRequest.addHook("postRedirectGet",async o=>{D(o)&&(o.options||(o.options={}),o.options.hooks||(o.options.hooks={}),o.options.hooks.beforeRedirect||(o.options.hooks.beforeRedirect=[]),o.options.hooks.beforeRedirect.push(s=>{s.method="GET",s.body=void 0}))}),!0):!1}de.exchange=ra;de.createRequestClient=(e,t)=>new $r(e,t);function da(e){e.hooks.parseMetaData.addHook("postRedirectGet",la),e.hooks.execute.addInterceptor(new qr),e.hooks.replaceVariable.addHook("aws",_i),e.hooks.replaceVariable.addHook("basicAuth",Gi),e.hooks.replaceVariable.addHook("clientCertificate",Wi),e.hooks.replaceVariable.addHook("digestAuth",ia),e.hooks.replaceVariable.addHook("cookie",Xi),e.hooks.onRequest.addHook("logHttpRedirect",aa)}var rt=class{constructor(t,r,o){this.extensions=t;this.beginCodeBlock=r;this.endCodeBlock=o}async beforeTrigger(t){let r=t.args[0],o=t.args[1];if(f.hasExtension(o.httpFile.fileName,...this.extensions)){let s=this.getHttpBlockLines(o.lines,o.data);t.args[0]=function*(i){if(s.length>0){let a=r(!0);for(let l of a){let d=s.find(u=>u.startLine<=l.line&&l.line<u.endLine);if(d)if(d.startLine===l.line)yield{line:l.line,textLine:"###"};else{if(!i&&me.test(l.textLine))break;yield l}else break}}}}return!0}getHttpBlockLines(t,r){if(r.codeBlocks)return r.codeBlocks;let o=[],s=-1;for(let n=0;n<t.length;n++){let i=t[n];s<0?Array.isArray(this.beginCodeBlock)?t.length>n+this.beginCodeBlock.length&&this.beginCodeBlock.every((a,l)=>a.test(t[n+l]))&&(s=n+this.beginCodeBlock.length-1,n+=this.beginCodeBlock.length-1):this.beginCodeBlock.test(i)&&(s=n):this.endCodeBlock.test(i)&&(o.push({startLine:s,endLine:n}),s=-1)}return r.codeBlocks=o,o}};var Ar=class extends rt{constructor(){super(["adoc","asciidoc","asc"],[/^\[source,http\]\s*$/iu,/^----\s*$/u],/^----\s*$/u);this.id="asciidoc"}};var Dr=class extends rt{constructor(){super(["md","markdown","mdown","mkdn","mdtxt","mdtext","text","rmd"],/^```\s*(http|rest)$/iu,/^```\s*$/u);this.id="markdown"}};function ua(e){e.hooks.parse.addInterceptor(new Dr),e.hooks.parse.addInterceptor(new Ar)}var te=require("crypto");var Fr=class{constructor(){this.hmac=new ps}sha1(){return new le((0,te.createHash)("sha1"))}sha256(){return new le((0,te.createHash)("sha256"))}sha384(){return new le((0,te.createHash)("sha384"))}sha512(){return new le((0,te.createHash)("sha512"))}md5(){return new le((0,te.createHash)("md5"))}},le=class e{constructor(t){this.hash=t}updateWithText(t,r){let o=Xe(r),s=this.hash.update(Buffer.from(t,o));return new e(s)}updateWithHex(t){let r=this.hash.update(Buffer.from(t,"hex"));return new e(r)}updateWithBase64(t,r){let o=this.hash.update(Buffer.from(t,r?"base64url":"base64"));return new e(o)}digest(){return new us(this.hash)}},us=class{constructor(t){this.hash=t}toHex(){return this.hash instanceof te.Hmac?this.hash.digest("hex"):this.hash.digest("hex")}toBase64(t){let r=t?"base64url":"base64";return this.hash instanceof te.Hmac?this.hash.digest(r):this.hash.digest(r)}},ps=class{sha1(){return new Ne("sha1")}sha256(){return new Ne("sha256")}sha384(){return new Ne("sha384")}sha512(){return new Ne("sha512")}md5(){return new Ne("md5")}},Ne=class{constructor(t){this.algorithm=t}withTextSecret(t,r){let o=(0,te.createHmac)(this.algorithm,Buffer.from(t,Xe(r)));return new le(o)}withHexSecret(t){let r=(0,te.createHmac)(this.algorithm,Buffer.from(t,"hex"));return new le(r)}withBase64Secret(t,r){let o=(0,te.createHmac)(this.algorithm,Buffer.from(t,r?"base64url":"base64"));return new le(o)}};var pa=require("assert");var Ue=class{constructor(t){this.context=t;this.userSession=this.getIntellijSession()}getIntellijSession(){let t="intellij_global_cache",r=S.getUserSession(t);if(this.isIntellijGlobalCacheSession(r))return r;let o={id:t,title:"Intellij Cache",description:"Global Cache for all Intellij Variables",details:{},type:"intellij_global_cache"};return S.setUserSession(o),o}isIntellijGlobalCacheSession(t){return!!(t!=null&&t.id)&&!!t.title}set(t,r){this.userSession.details[t]=r,F({[t]:r},this.context)}get(t){return this.context.variables[t]}isEmpty(){return Object.entries(this.userSession.details).length===0}clear(t){delete this.userSession.details[t],Ie(t,this.context)}clearAll(){for(let[t]of Object.entries(this.userSession.details))this.clear(t)}};var Ir=class{constructor(t){this.context=t;this.global=new Ue(t)}test(t,r){Pt(this.context)(t,r)}assert(t,r){(0,pa.ok)(t,r)}log(t){this.context.scriptConsole&&this.context.scriptConsole.info(t)}exit(){var t;(t=this.context.scriptConsole)==null||t.warn("exit not supported")}};var fa=require("uuid");function jr(e){let t=e.trim();if(["$uuid","$random.uuid"].indexOf(t)>=0)return(0,fa.v4)();if(t==="$timestamp")return v(Date.now());if(t==="$isoTimestamp")return new Date().toISOString();if(t==="$randomInt")return`${Math.floor(Math.random()*1e3)}`;if(t.startsWith("$random.integer")){let r=ca(t);if(r)return`${Math.floor(r)}`}if(t.startsWith("$random.float")){let r=ca(t);if(r)return`${r}`}if(t.startsWith("$random.alphabetic"))return Lu(t);if(t.startsWith("$random.alphanumeric"))return Eu(t);if(t.startsWith("$random.hexadecimal"))return qu(t);if(t.startsWith("$random.email"))return Qe()}function ca(e){var r,o,s,n;let t=/^\$random.(integer|float)\s*\(\s*(?<from>-?\d+)\s*,\s*(?<to>-?\d+)\s*\)$/u.exec(e);if(t&&((r=t.groups)!=null&&r.from)&&((o=t.groups)!=null&&o.to)){let i=C((s=t.groups)==null?void 0:s.from)||0,a=C((n=t.groups)==null?void 0:n.to)||0;if(!Number.isNaN(i)&&!Number.isNaN(a)){if(i>a){let l=a;a=i,i=l}return Math.random()*(a-i)+i}}}function Lu(e){var r,o;let t=/^\$random.alphabetic\s*\(\s*(?<length>-?\d+)\s*\)\s*$/u.exec(e);if(t&&((r=t.groups)!=null&&r.length)){let s=C((o=t.groups)==null?void 0:o.length);if(s)return Y(s,"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz")}}function Eu(e){var r,o;let t=/^\$random.alphanumeric\s*\(\s*(?<length>-?\d+)\s*\)\s*$/u.exec(e);if(t&&((r=t.groups)!=null&&r.length)){let s=C((o=t.groups)==null?void 0:o.length);if(s)return Y(s)}}function qu(e){var r,o;let t=/^\$random.hexadecimal\s*\(\s*(?<length>-?\d+)\s*\)\s*$/u.exec(e);if(t&&((r=t.groups)!=null&&r.length)){let s=C((o=t.groups)==null?void 0:o.length);if(s)return Y(s,"1234567890ABCDEF")}}async function ma(e,t,r){return G(e,async o=>jr(o))}var Mr=class{url(){return this._url}body(){return this._body||""}constructor(t){var r,o,s,n;this._url=((r=t.request)==null?void 0:r.url)||"",this.method=((o=t.request)==null?void 0:o.method)||"",this._body=((s=t.request)==null?void 0:s.body)&&v((n=t.request)==null?void 0:n.body),this.headers=new Br(t),this.environment=new Ur(t.variables),this.variables=new Ue(t)}},Vr=class{constructor(t){var r;this.url=new fs(t),this.method=((r=t.request)==null?void 0:r.method)||"",this.body=new cs(t),this.headers=new Br(t),this.environment=new Ur(t.variables),this.variables=new Ue(t)}},cs=class{constructor(t){this.context=t}getRaw(){var t;return v((t=this.context.request)==null?void 0:t.body)||""}tryGetSubstituted(){var r;let t=ms(this.getRaw(),this.context.variables);return t&&((r=this.context.request)!=null&&r.body)&&(this.context.request.body=t),t}},Br=class{constructor(t){this.context=t}all(){var t;return(t=this.context.request)!=null&&t.headers?Object.keys(this.context.request.headers).map(r=>new Nr(r,this.context)):[]}findByName(t){var r;return A((r=this.context.request)==null?void 0:r.headers,t)?new Nr(t,this.context):null}},Nr=class{constructor(t,r){this.name=t;this.context=r}value(){return this.getRawValue()}getRawValue(){var t;return v(A((t=this.context.request)==null?void 0:t.headers,this.name))||""}tryGetSubstitutedValue(){var r;let t=ms(this.getRawValue(),this.context.variables);return t&&((r=this.context.request)!=null&&r.headers)&&(uo(this.context.request.headers,this.name),this.context.request.headers[this.name]=t),t}},fs=class{constructor(t){this.context=t}getRaw(){var t;return((t=this.context.request)==null?void 0:t.url)||""}tryGetSubstituted(){var r;let t=ms(this.getRaw(),this.context.variables);return t&&((r=this.context.request)!=null&&r.body)&&(this.context.request.body=t),t}},Ur=class{constructor(t){this.variables=t}get(t){let r=v(this.variables[t]);return Je(r)?null:r}};function ms(e,t){let r=e,o=[jr,s=>{let n=t[s];if(!Je(n))return v(n)}];for(let s of o)r=Ou(r,s);return r}function Ou(e,t){if(!m(e))return e;let r,o,s=e,n=0;for(;o!==s&&n++<100;)for(o=s;(r=Ht.exec(o))!==null;){let[i,a]=r,l=t(a,i);if(typeof l<"u"&&i===e)return l;let d=v(l);typeof d<"u"&&(s=s.replace(i,()=>d))}return s}var _r=class{constructor(t){this.body=t.parsedBody||t.body,this.status=t.statusCode,this.contentType=gs(t.contentType),this.headers=new Gr(t.headers)}};function gs(e){return{mimeType:(e==null?void 0:e.mimeType)||"application/octet-stream",charset:(e==null?void 0:e.charset)||"utf-8"}}var Gr=class{constructor(t){this.headers=t}valueOf(t){if(this.headers){let r=A(this.headers,t);if(r&&m(r))return r}return null}valuesOf(t){if(this.headers){let r=A(this.headers,t);if(r){if(m(r))return[r];if(Array.isArray(r))return r}}return[]}},Kr=class{constructor(t,r){this.requestClient=t;this.resolve=r;this.status=0;this.contentType=gs();this.lazyHeaders={};this.body={onEachLine:(...o)=>this.onEachLine(...o),onEachMessage:(...o)=>this.onEachMessage(...o)},this.headers=new Gr(this.lazyHeaders)}onEachLine(t,r){this.onEachMessage(t,r)}onEachMessage(t,r){let o=s=>{let[,n]=s.detail;this.status=n.statusCode,Object.assign(this.headers,n.headers),this.contentType=gs(n.contentType);let i=v(n.body);i&&t(i,()=>{this.requestClient.removeEventListener("message",o),this.resolve()},d=>this.requestClient.send(d))};this.requestClient.addEventListener("message",o),r&&this.requestClient.addEventListener("end",r)}};var ga=T(require("dayjs"));var ha=require("uuid"),Wr=class{alphabetic(t=10){return Y(t,"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz")}numeric(t=10){return Y(t)}hexadecimal(t=10){return Y(t,"1234567890ABCDEF")}get email(){return Qe()}float(t=0,r=100){return Math.random()*(r-t)+t}integer(t=0,r=100){return Math.floor(Math.random()*(r-t)+t)}get uuid(){return(0,ha.v4)()}date(t=new Date,r=void 0){return(0,ga.default)(t).format(r)}};var Jr=class{btoa(t){return global.btoa(t)}atob(t){return global.atob(t)}};Q.variableProvider.push(()=>[{name:"$uuid",description:"UUID"},{name:"$uuid",description:"UUID"},{name:"$random.uuid",description:"UUID"},{name:"$timestamp",description:"Timestamp"},{name:"$isoTimestamp",description:"ISOTimestamp"},{name:"$randomInt",description:"randomInt (0 -1000)"},{name:"$random.integer",description:"integer"},{name:"$random.float",description:"float"},{name:"$random.alphabetic",description:"Alphabetic Text"},{name:"$random.alphanumeric",description:"Alphanumeric Text"},{name:"$random.hexadecimal",description:"Hexadecimal String"},{name:"$random.email",description:"EMail"}]);var zr=class{constructor(t,r){this.scriptData=t;this.id="intellij";r&&(this.before=["requestVariableReplacer"])}isStreamingScript(t){return["onEachLine","onEachMessage"].some(r=>t.script.indexOf(r)>0)}async processOnRequest(t,r){q(r,"execute Intellij Javascript");let o=await this.loadScript(r);if(this.isStreamingScript(o))return;let s=hs(r);await this.executeScriptData(o,s,r)}async processOnStreaming(t){let r=await this.loadScript(t);if(this.scriptData=r,this.isStreamingScript(r)&&t.requestClient){let o=t.requestClient;await new Promise(s=>{let n=hs(t);n.response=new Kr(o,s),this.executeScriptData(r,n,t)})}}async processOnResponse(t,r){q(r,"execute Intellij Javascript");let o=await this.loadScript(r);if(this.isStreamingScript(o))return;let s=hs(r);s.response=new _r(t),await this.executeScriptData(o,s,r)}async executeScriptData(t,r,o){return L.runScript?(await L.runScript(t.script,{fileName:o.httpFile.fileName,context:{console:o.scriptConsole,...r},lineOffset:t.lineOffset}),!0):!1}async loadScript(t){if(this.isIntellijScriptData(this.scriptData))try{return{script:await fe(this.scriptData.fileName,t,r=>f.readFile(r,"utf-8"))||"",lineOffset:0}}catch(r){throw(t.scriptConsole||g).error(this.scriptData.fileName,r),new Error(`error loading script ${this.scriptData.fileName}`)}else return this.scriptData}isIntellijScriptData(t){return!!t.fileName}};function hs(e){let t={client:new Ir(e),crypto:new Fr,$random:new Wr,$env:process.env,Window:new Jr};return e.request&&(e.httpRegion.response?t.request=new Mr(e):t.request=new Vr(e)),t}async function ya(){let e=S.getUserSession("intellij_global_cache");return(e==null?void 0:e.details)||{}}async function ba(e,{httpRegion:t}){let r=e(),o=Au(r,!!t.request);if(o){let s=new zr(o.data,o.isBeforeRequest);return o.isBeforeRequest?t.hooks.onRequest.addObjHook(n=>n.processOnRequest,s):(t.hooks.onStreaming.addObjHook(n=>n.processOnStreaming,s),t.hooks.onResponse.addObjHook(n=>n.processOnResponse,s)),{nextParserLine:o.endLine,symbols:[new P({name:"Intellij Script",description:"Intellij Script",kind:"script",startLine:o.startLine,startOffset:0,endLine:o.endLine,endOffset:o.endOffset,children:o.symbols})]}}return!1}function Au(e,t){var o,s,n;let r=e.next();if(!r.done){let i=r.value.line,a=/^\s*(?<event>(<|>))\s+(?<fileName>[^\s{%}]+\s*)$/u.exec(r.value.textLine);if((o=a==null?void 0:a.groups)!=null&&o.fileName){if(a.groups.event==="<"&&t)return!1;let u=a.groups.fileName.trim();return{startLine:i,endLine:i,endOffset:r.value.textLine.length,data:{fileName:u},isBeforeRequest:a.groups.event==="<",symbols:[new P({name:"filename",description:u,kind:"path",startLine:r.value.line,startOffset:r.value.textLine.indexOf(u),endLine:r.value.line,endOffset:r.value.textLine.indexOf(u)+u.length})]}}let l=/^\s*(?<event>(<|>))\s+\{%\s*(?<script>.*)\s*%\}\s*$/u.exec(r.value.textLine);if((s=l==null?void 0:l.groups)!=null&&s.script)return l.groups.event==="<"&&t?!1:{startLine:i,endLine:i,endOffset:r.value.textLine.length,data:{script:l.groups.script,lineOffset:i},isBeforeRequest:l.groups.event==="<"};let d=/^\s*(?<event>(<|>))\s+\{%\s*$/u.exec(r.value.textLine);if((n=d==null?void 0:d.groups)!=null&&n.event){if(d.groups.event==="<"&&t)return!1;r=e.next();let u=[];for(;!r.done;){if(/^\s*%\}\s*$/u.test(r.value.textLine))return{startLine:i,endLine:r.value.line,endOffset:r.value.textLine.length,data:{script:J(u),lineOffset:i},isBeforeRequest:d.groups.event==="<"};u.push(r.value.textLine),r=e.next()}}}return!1}async function xa(e,t,r){return G(e,async o=>{if(o.trim()==="$projectRoot")return r.httpFile.rootDir})}async function Ra(e){let t=Object.keys(await va(e));return g.info("Intellij Env Provider found environments",t),t}async function va(e){var i;let t=[],r=a=>["http-client.env.json","http-client.private.env.json"].includes(a),o=process.env.HTTPYAC_ENV;if(o&&m(o)){let a=await _(o,e.httpFile.rootDir);a&&t.push(...await ys(a,r))}if((i=e.config)!=null&&i.envDirName){let a=await _(e.config.envDirName,e.httpFile.rootDir);a&&t.push(...await ys(a,r))}let s=f.dirname(e.httpFile.fileName);s&&await Re(s,e.httpFile.rootDir,async a=>{t.push(...await ys(a,r))});let n={};t.length>0&&g.trace(`Intellij environment files found: ${t.join(", ")}`),t.sort((a,l)=>{let d=f.toString(a),u=f.toString(l),p=d.endsWith("private.env.json"),c=u.endsWith("private.env.json");return p===c?d.localeCompare(u):p?1:-1});for(let a of t){let l=await Du(a);if(l)for(let[d,u]of Object.entries(l))n[d]?(f.toString(a).endsWith("private.env.json")||g.warn(`Multiple files with environment ${d} were found.`),Object.assign(n[d],u)):n[d]=u}return n}async function ys(e,t){return(await Fe(f.readdir(e),[])).filter(t).map(o=>f.joinPath(e,o))}async function Pa(e,t){let r=await va(t),o=[];if(e)for(let s of e)o.push(r[s]);return Object.assign({},...o)}async function Du(e){try{if(await f.exists(e)){let t=await f.readFile(e,"utf-8");return JSON.parse(t)}}catch(t){g.trace(`${e} not found`),g.trace(t)}}function wa(e){e.hooks.parse.addHook("intellijScript",ba,{before:["request"]}),e.hooks.provideEnvironments.addHook("intellij",Ra),e.hooks.provideVariables.addHook("intellij",Pa),e.hooks.provideVariables.addHook("intellij_global",ya),e.hooks.replaceVariable.addHook("intellijDynamic",ma,{before:["name"]}),e.hooks.replaceVariable.addHook("intellijProjectContext",xa,{before:["name"]})}Q.emptyLineProvider.push(()=>[{name:`{{@streaming
`,description:"Streaming Javascript Block"},{name:`{{@response
`,description:"Response Javascript Block"},{name:`{{@request
`,description:"Request Javascript Block"}]);Q.variableProvider.push(()=>[{name:"$random.alphabetic()",description:"random letters"},{name:"$random.number()",description:"random number"},{name:"$random.hexadecimal()",description:"random hexadecimal"},{name:"$random.email()",description:"random email"},{name:"$random.float()",description:"random float"},{name:"$random.integer()",description:"random integer"},{name:"$random.uuid()",description:"random uuid"},{name:"$random.date()",description:"Date format function"}]);async function ka(e){let t=Ha(e),r=S.getUserSession(t);return(r==null?void 0:r.details)||{$global:{}}}var Xr=class{constructor(){this.id="globalVariables"}async afterLoop(t){let[r]=t.args,o=r.variables.$global;if(o&&typeof o=="object"&&Object.keys(o).length>0){let s=Ha(r.activeEnvironment);S.setUserSession({id:s,title:"global store",description:r.activeEnvironment?`global Variables for ${r.activeEnvironment.join(", ")}`:"global Variables",type:"global_cache",details:{$global:o}})}return!0}};function Ha(e){return`global_cache_${j(e)}`}var Yr=class{constructor(t,r){this.context=t;this.httpFileStore=r}findHttpRegionInContext(t){return Me(t,this.context)}async import(t){return await Tt(t,this.httpFileStore,this.context)}setVariables(t){F(t,this.context)}async execute(t,r){r&&F(r,this.context);let o;if(m(t)?o=Me(t,this.context):o=t,o&&await(o==null?void 0:o.execute(this.context))){let n=j(this.context.activeEnvironment);F(o.variablesPerEnv[n],this.context)}return this.context.variables}};var Dt=T(require("module")),Ft=T(require("path")),Ca=T(require("vm"));function Sa(e,t){let r;try{try{r=Dt.default.createRequire(Ft.default.resolve(t,"package.json")).resolve(e)}catch{r=require.resolve(e,{paths:[t]})}}catch(o){g.debug(o)}return r}function Ta(e,t,r=!1){if($.isTrusted("loadModule"))try{return r&&Iu(e,t),Dt.default.createRequire(Ft.default.resolve(t,"package.json"))(e)}catch{let o=Sa(e,t);if(o)return r&&bs(o),require(o)}}function Fu(e,t){let r=new Dt.default(e,require.main);return r.filename=e,r.paths=Dt.default._nodeModulePaths(Ft.default.dirname(e)),t&&r._compile(t,e),r}function Iu(e,t){let r=Sa(e,t);r&&bs(r)}function bs(e,t=new Map){let r=require.cache[e];r&&(t.set(e,!0),r.children.forEach(o=>{t.get(o.id)||bs(o.id,t)}),delete require.cache[e])}async function It(e,t){if(!$.isTrusted("runScript"))return{};let r=ju(t.fileName),o=Fu(r);function s(p){let c=L.require;return c&&c[p]?c[p]:o.require(p)}let n=Vu(t.context),i=Object.assign({$context:n,...n}),a=Object.keys(i),l=`(async function userJS(exports, require, module, __filename, __dirname, context){ with(context){${f.EOL}${e}${f.EOL}}})`;await Ca.default.runInThisContext(l,{filename:r,lineOffset:t.lineOffset,displayErrors:!0}).apply(i,[o.exports,s,o,r,Ft.default.dirname(r),i]),Mu(a,i,t.deleteVariable);let u=o.exports;if(Ye(u))u=await u;else for(let[p,c]of Object.entries(u))Ye(c)&&(u[p]=await c);return u}function ju(e){return f.fsPath(e)||f.toString(e)}function Mu(e,t,r){if(r)for(let o of e)try{t[o]===void 0&&r(o)}catch(s){g.info(`error on delete of ${o}`,s)}}async function Qr(e,t,r){if(!$.isTrusted("evalExpression"))return;let o=`exports.$result = (${e});`,s=t.httpRegion.symbol.startLine;if(t.httpRegion.symbol.source){let i=re(t.httpRegion.symbol.source).findIndex(a=>a.indexOf(e)>=0);i>=0&&(s+=i)}return(await It(o,{fileName:t.httpFile.fileName,context:{...t.variables,httpFile:t.httpFile,httpRegion:t.httpRegion,request:t.request,console:t.scriptConsole,$random:Lt,...r,$context:t},lineOffset:s})).$result}function Vu(e){let t={};for(let[r,o]of Object.entries(e)){let s=r.trim().replace(/\s/gu,"-").replace(/-./gu,n=>n[1].toUpperCase());Ea.indexOf(s)<0&&typeof o<"u"&&(t[s]=o)}return t}function La(e){return Ea.indexOf(e)>=0?(g.warn(`Keyword ${e} prevented, because Javascript Keyword`),!1):Bu.indexOf(e)>=0?(g.warn(`Keyword ${e} prevented, because used by httpYac`),!1):!0}var Bu=["httpFile","httpRegion","request","test","sleep"],Ea=["await","break","case","catch","class","const","continue","debugger","default","delete","do","else","enum","export","extends","false","finally","for","function","if","implements","import","in","instanceof","interface","let","new","null","package","private","protected","public","return","super","switch","static","this","throw","try","true","typeof","var","void","while","with","yield"];var Uu=/^\s*\{\{(@js\s+)?(?<modifier>\+|@)?(?<event>(request|streaming|response|after|responseLogging)?)?\s*$/iu,_u=/^\s*\}\}\s*$/u;async function qa(e,{httpRegion:t,httpFile:r,httpFileStore:o}){let s=e(),n=s.next();if(!n.done){let i=Uu.exec(n.value.textLine);if(i!=null&&i.groups){let a=n.value.line;n=s.next();let l=[];for(;!n.done;){if(_u.test(n.value.textLine)){let d={script:J(l),lineOffset:a},u=i.groups.modifier==="+";switch(i.groups.event){case"request":Wu(u?r.hooks:t.hooks,d,o);break;case"streaming":Gu(u?r.hooks:t.hooks,d,o);break;case"response":Ju(u?r.hooks:t.hooks,d,o);break;case"after":Xu(u?r.hooks:t.hooks,d,o);break;case"responseLogging":zu(u?r.hooks:t.hooks,d,o);break;default:Ku(u?r.hooks:t.hooks,d,o);break}return{nextParserLine:n.value.line,symbols:[new P({name:"script",description:"nodejs script",kind:"script",startLine:a,startOffset:0,endLine:n.value.line,endOffset:n.value.textLine.length})]}}l.push(n.value.textLine),n=s.next()}}}return!1}function Gu(e,t,r){e.onStreaming.addHook("js",async o=>await ot(t,o,r,"streaming")?void 0:gt)}function Ku(e,t,r){e.execute.addHook("js",o=>ot(t,o,r))}function Wu(e,t,r){e.onRequest.addHook("js",async(o,s)=>await ot(t,s,r,"request")?void 0:gt)}function Ju(e,t,r){e.onResponse.addHook("js",async(o,s)=>(s.variables.response=o,await ot(t,s,r,"response")?void 0:gt))}function zu(e,t,r){e.responseLogging.addHook("js",async(o,s)=>{let n=s.variables.response;s.variables.response=o,await ot(t,s,r,"responseLogging"),s.variables.response=n})}function Xu(e,t,r){e.execute.addInterceptor(new xs(t,r))}var xs=class{constructor(t,r){this.scriptData=t;this.httpFileStore=r;this.id=`afterJavascript_${t.script}`}async afterLoop(t){return await ot(this.scriptData,t.args[0],this.httpFileStore,"after")}};async function ot(e,t,r,o){q(t,o?`execute javascript (@${o})`:"execute javascript");let s=await It(e.script,{fileName:t.httpFile.fileName,context:{...t.variables,httpFile:t.httpFile,httpRegion:t.httpRegion,request:t.request,console:t.scriptConsole,sleep:we,test:Pt(t),$httpyac:new Yr(t,r),$random:Lt,$context:t},lineOffset:e.lineOffset,deleteVariable:i=>Ie(i,t)}),n=s.$cancel;return n&&(delete s.$cancel,oe(t.httpRegion)),F(s,t),!n}async function Oa(e,t,r){return await G(e,async(o,s)=>{try{return await Qr(o,r)}catch(n){if(t==="Variable")(r.scriptConsole||g).debug(`variable ${o} not defined`),(r.scriptConsole||g).debug(n);else throw(r.scriptConsole||g).error(`expression ${o} throws error`),n;return s}})}var $a=T(require("dayjs")),Yu=T(require("uuid"));B.javascriptProvider.loadModule=Ta;function Aa(e){e.hooks.replaceVariable.addHook("javascript",Oa,{before:["aws"]}),e.hooks.parse.addHook("javascript",qa,{before:["request"]}),e.hooks.execute.addInterceptor(new Xr),e.hooks.provideVariables.addHook("globalVariables",ka),Qu(),B.javascriptProvider.evalExpression=Qr,B.javascriptProvider.runScript=It,B.javascriptProvider.isAllowedKeyword=La}function Qu(){Object.assign(B.javascriptProvider.require,{httpyac:Rs,dayjs:$a.default,uuid:Yu})}ne.core=Fi;ne.dotenv=Bi;ne.http=da;ne.intellij=wa;ne.injection=ua;ne.javascript=Aa;ne.assert=hn;var vs=require("hookpoint");async function Ps(e){let t=!1;return Vo(e)?t=await ep(e):Bo(e)?t=await Da(e):t=await tp(e),t}async function ep(e){let t=await _e(e);return await Pe(t)?await e.httpRegion.execute(t,!0):!1}async function Da(e){let t=await _e(e);if(await Pe(t)){e.progress&&(e.progress.divider=e.httpRegions.length);let r=!0;for(let o of e.httpRegions){let s=await o.execute(t,!0);r=r&&s}return r}return!1}async function tp(e){let t=[];for(let r of e.httpFile.httpRegions)e.httpRegionPredicate&&!e.httpRegionPredicate(r)?g.debug(`${r.symbol.name} disabled by predicate`):r.isGlobal()||t.push(r);return await Da({...e,httpRegions:t})}async function _e(e){return Object.assign(e,{variables:await Fa(e),options:{}})}async function Fa(e){e.config=await Ze(e.config,e.httpFile);let t=await e.httpFile.hooks.provideVariables.trigger(e.activeEnvironment,e);if(t===vs.HookCancel)return e.variables||{};let r={...e.variables},o=Object.assign(e.variables||{},...t.map(s=>Xt(s)),r);return g.debug("current environment variables",o),o}async function rp(e){e.config=await Ze(e.config,e.httpFile);let t=await e.httpFile.hooks.provideEnvironments.trigger(e);return t!==vs.HookCancel&&t.length>0?t.reduce((r,o)=>{for(let s of o)r.indexOf(s)<0&&r.push(s);return r},[]).sort():[]}function jt(e,t){return e+t}function Zr(e,t){let r=[];for(let o of e)r.push(Mt(o,t));return{_meta:{version:"1.1.0"},requests:r,summary:op(r)}}function op(e){return{totalRequests:e.length,skippedRequests:e.filter(t=>t.summary.skippedTests>0).length,failedRequests:e.filter(t=>t.summary.failedTests>0).length,successRequests:e.filter(t=>t.summary.failedTests+t.summary.erroredTests+t.summary.skippedTests===0).length,erroredRequests:e.filter(t=>t.summary.erroredTests>0).length,totalTests:e.map(t=>t.summary.totalTests).reduce(jt,0),failedTests:e.map(t=>t.summary.failedTests).reduce(jt,0),successTests:e.map(t=>t.summary.successTests).reduce(jt,0),erroredTests:e.map(t=>t.summary.erroredTests).reduce(jt,0),skippedTests:e.map(t=>t.summary.skippedTests).reduce(jt,0)}}function Mt(e,t){var o,s,n,i,a,l,d,u,p,c,h,b,w,H;let r=t.output;return t.outputFailed&&((s=(o=e.testResults)==null?void 0:o.some)!=null&&s.call(o,R=>!R.status))&&(r=t.outputFailed),{fileName:f.fsPath(e.filename)||f.toString(e.filename),response:sp(e.response,r),name:v((n=e.metaData)==null?void 0:n.name)||e.symbol.name,line:e.symbol.startLine,title:v((i=e.metaData)==null?void 0:i.title),description:v((a=e.metaData)==null?void 0:a.description),testResults:e.testResults,timestamp:new Date(performance.timeOrigin+e.start).toISOString(),duration:e.duration,summary:{totalTests:((l=e.testResults)==null?void 0:l.length)||0,failedTests:((u=(d=e.testResults)==null?void 0:d.filter)==null?void 0:u.call(d,R=>R.status==="FAILED").length)||0,successTests:((c=(p=e.testResults)==null?void 0:p.filter)==null?void 0:c.call(p,R=>R.status==="SUCCESS").length)||0,erroredTests:((b=(h=e.testResults)==null?void 0:h.filter)==null?void 0:b.call(h,R=>R.status==="ERROR").length)||0,skippedTests:((H=(w=e.testResults)==null?void 0:w.filter)==null?void 0:H.call(w,R=>R.status==="SKIPPED").length)||0}}}function sp(e,t){var r;if(e)switch(delete e.rawHeaders,delete e.rawBody,delete e.prettyPrintBody,delete e.parsedBody,delete e.contentType,delete e.tags,t){case"body":case"response":return delete e.request,e;case"short":return delete e.body,delete e.request,e;case"none":return;case"headers":return delete e.body,(r=e.request)==null||delete r.body,e;case"exchange":default:return e}}var Ia=T(require("crypto")),Bt=T(require("fs")),Vt=T(require("path"));var ja=".uctest-deps";async function Ma(e){let t=Vt.default.join(e,ja);try{let r=await Bt.default.promises.readFile(t,"utf-8");return JSON.parse(r)}catch(r){if(r.code==="ENOENT")return;throw r}}async function Va(e,t){let r=Vt.default.join(e,ja);await Bt.default.promises.writeFile(r,JSON.stringify(t,null,2),"utf-8")}async function Ba(e,t){let{globby:r}=await import("globby"),o=(await r("**/*.http",{cwd:t})).sort(),s=Object.keys(e.files).sort();if(!ip(o,s))return{valid:!1,reason:"files_changed"};for(let[n,i]of Object.entries(e.files)){let a=Bt.default.statSync(Vt.default.join(t,n));if((a.mtimeMs!==i.mtime||a.size!==i.size)&&np(Vt.default.join(t,n))!==i.checksum)return{valid:!1,reason:"content_changed",file:n}}return{valid:!0}}function np(e){let t=Bt.default.readFileSync(e);return Ia.default.createHash("sha256").update(t).digest("hex")}function ip(e,t){return e.length!==t.length?!1:e.every((r,o)=>r===t[o])}var Ga=T(require("crypto")),Hs=T(require("fs")),he=T(require("path"));var ap=/\{\{.*?\}\}/;async function Ka(e,t={}){var n;let r=he.default.resolve(e),o=(n=t.files)!=null&&n.length?t.files:await lp(r);if(o.length===0)throw new Error(`No .http files found under ${r}`);let s={version:"1.0",generated:new Date().toISOString(),rootDir:r,files:{},regions:{},regionsByName:{},importGraph:{},checksums:{},mtimes:{}};for(let i of o.sort()){let a=dp(r,i),l=Hs.default.statSync(a),d=Hs.default.readFileSync(a,"utf-8"),u=up(d),p=[],c=new Set,h=pp(d,a,i,c,p,s),b={path:i,checksum:u,mtime:l.mtimeMs,size:l.size,imports:Array.from(c),regionIds:p,hasGlobalRegion:h};s.files[i]=b,s.importGraph[i]=b.imports,s.checksums[i]=u,s.mtimes[i]=l.mtimeMs}return gp(s.importGraph),hp(s),s}async function lp(e){let{globby:t}=await import("globby");return t("**/*.http",{cwd:e})}function dp(e,t){return he.default.isAbsolute(t)?t:he.default.join(e,t)}function up(e){return Ga.default.createHash("sha256").update(e).digest("hex")}function pp(e,t,r,o,s,n){var u,p;let i=e.split(/\r?\n/u),a=!1,l=Na(0),d=c=>{l.endLine=c;let h=cp(l,t,r);if(n.regions[h.id]=h,s.push(h.id),h.name){let b=n.regionsByName[h.name]||[];b.push(h.id),n.regionsByName[h.name]=b}h.isGlobal&&(a=!0)};for(let c=0;c<i.length;c+=1){let h=i[c],b=me.exec(h);if(b){d(Math.max(c-1,l.startLine)),l=Na(c+1);let H=(p=(u=b.groups)==null?void 0:u.title)==null?void 0:p.trim();if(H){let R=Ua(`# ${H}`);R&&_a(R,l,o,c+1,r)}continue}let w=Ua(h);w&&_a(w,l,o,c+1,r),mp(h)&&(l.hasRequest=!0)}return d(i.length-1),a}function Na(e){return{startLine:e,endLine:e,tags:[],refs:[],forceRefs:[],hasRequest:!1}}function cp(e,t,r){let o=`${t}_${e.startLine}`,s=`${r}:${e.startLine}`;return{id:o,modelId:s,file:r,startLine:e.startLine,endLine:e.endLine,name:e.name,tags:ks(e.tags),refs:ks(e.refs),forceRefs:ks(e.forceRefs),isGlobal:!e.hasRequest}}function Ua(e){var s;let t=/^\s*(#+|\/{2,})\s+@(?<key>[^\s]+)\s*(?<value>.*)$/u.exec(e);if(!((s=t==null?void 0:t.groups)!=null&&s.key))return null;let r=t.groups.key;if(!["name","tag","ref","forceRef","import"].includes(r))return null;let o=(t.groups.value||"").trim();return{key:r,value:o}}function _a(e,t,r,o,s){switch(e.key){case"import":eo(e.value,"Dynamic import not allowed",o),r.add(fp(e.value,s));break;case"name":eo(e.value,"Dynamic @name not allowed",o),t.name=e.value;break;case"tag":t.tags.push(...ws(e.value));break;case"ref":eo(e.value,"Dynamic ref not allowed",o),t.refs.push(...ws(e.value));break;case"forceRef":eo(e.value,"Dynamic ref not allowed",o),t.forceRefs.push(...ws(e.value));break;default:break}}function ws(e){return e.split(/[,\s]+/u).map(t=>t.trim()).filter(Boolean)}function eo(e,t,r){if(ap.test(e))throw new Error(`${t} (line ${r}): use literal. Found: ${e}`)}function fp(e,t){if(he.default.isAbsolute(e))return e;let r=he.default.dirname(t);return he.default.normalize(he.default.join(r,e)).split(he.default.sep).join("/")}function mp(e){return/^\s*(GET|POST|PUT|DELETE|PATCH|OPTIONS|HEAD|TRACE|CONNECT)\s+/iu.test(e)}function gp(e){let t=[],r=new Set,o=s=>{if(t.includes(s)){let i=t.indexOf(s),a=[...t.slice(i),s];throw new Error(`Circular import: ${a.join(" \u2192 ")}`)}if(r.has(s))return;r.add(s),t.push(s);let n=e[s]||[];for(let i of n)o(i);t.pop()};Object.keys(e).forEach(o)}function hp(e){for(let t of Object.keys(e.files)){let r=yp(t,e.importGraph),o=new Map;for(let s of r){let n=e.files[s];if(n)for(let i of n.regionIds){let a=e.regions[i];if(a!=null&&a.name){let l=o.get(a.name);if(l)throw new Error(`Duplicate @name "${a.name}" in scope of ${t}: ${l} and ${a.file}:${a.startLine}`);o.set(a.name,`${a.file}:${a.startLine}`)}}}}}function yp(e,t){let r=[],o=[e],s=new Set;for(;o.length>0;){let n=o.shift();if(s.has(n))continue;s.add(n),r.push(n);let i=t[n]||[];for(let a of i)o.push(a)}return r}function ks(e){return Array.from(new Set(e))}function Wa(e){let t=[],r=new Set,o=bp(e);for(let s of o){if(r.has(s.id))continue;let n=[],i=new Set,a=!1,l=s;for(;l&&(n.unshift(l.id),r.add(l.id),l.refs.forEach(d=>i.add(d.id)),l.forceRefs.length!==0);){if(l.forceRefs.length>1){l.forceRefs.forEach(d=>i.add(d.id)),a=!0;break}l=l.forceRefs[0]}if(!a&&n.length>1){let d=n[n.length-1];t.push({id:`chain_${n[0]}_${d}`,regionIds:n,softDeps:i})}}return xp(t)}function bp(e){let t=[],r=new Map;for(let o of Object.values(e.nodes))for(let s of o.forceRefs)r.set(s.id,(r.get(s.id)||0)+1);for(let o of Object.values(e.nodes))o.forceRefs.length>0&&!r.has(o.id)&&t.push(o);return t}function xp(e){let t=[],r=e.sort((o,s)=>s.regionIds.length-o.regionIds.length||o.id.localeCompare(s.id));for(let o of r){let s=t.find(n=>Rp(n.regionIds,o.regionIds));if(s){o.softDeps.forEach(n=>s.softDeps.add(n));continue}t.push(o)}return t}function Rp(e,t){return e.length<t.length?!1:t.every((r,o)=>e[o]===r)}var st=T(require("path"));var vp={createProcessorContext:_e,executeGlobalScripts:Pe};async function Cs(e,t,r,o,s={},n=vp){var b,w;if(s.showPlan)return Ep(e,t),[];let i=o.processedHttpRegions||[];o.processedHttpRegions=i;let a=kp(r,t),l=Hp(r,t.rootDir),d=new Set,u=new Set,p=new Set,c=[],h=!!s.resumeState;for(let H of e.stages)for(let R of H.units)for(let y of R.regionIds){let k=a.get(y);if(!k)throw new Error(`Region ${y} not found in loaded http files`);if(h)if(s.resumeState&&Cp(k.httpRegion,k.httpFile,s.resumeState))h=!1;else{u.add(y);continue}if(!s.showProgress){let N=k.httpFile.fileName,Ce=typeof N=="string"?N:((b=N==null?void 0:N.toString)==null?void 0:b.call(N))||"";!p.has(Ce)&&o.scriptConsole&&(o.scriptConsole.info(`--------------------- ${Ce}  --`),p.add(Ce))}await Ja(k.entry.file,t,l,o,n,d);let K={...o,httpFile:k.httpFile,httpRegion:k.httpRegion,variables:o.variables||{},options:o.options||{},scriptConsole:o.scriptConsole,logResponse:o.logResponse,logStream:o.logStream},O=performance.now(),He=i.length,ye=await k.httpRegion.execute(K,!0);u.add(y),Pp(k.httpRegion,K);let be=i.length,U;if(be>He?U=i[be-1]:(U=wp(k.httpRegion,k.httpFile,O),i.push(U),(w=o.processedHttpRegionListener)==null||w.call(o,U)),c.push(U),!ye)return c}return Lp(e,u),c}function Pp(e,t){let r=j(t.activeEnvironment),o=e.variablesPerEnv[r];o&&F(o,t)}function wp(e,t,r){var s;let o=performance.now();return{id:e.id,filename:t.fileName,symbol:e.symbol,isGlobal:e.isGlobal(),metaData:{...e.metaData},testResults:e.testResults,request:(s=e.response)==null?void 0:s.request,response:e.response,start:r,end:o,duration:o-r}}function kp(e,t){let r=new Map;for(let o of e)for(let s of o.httpRegions){let n=t.regions[s.id];n&&r.set(s.id,{httpRegion:s,httpFile:o,entry:n})}return r}function Hp(e,t){let r=new Map;for(let o of e){let s=Tp(o.fileName,t);s&&r.set(s,o)}return r}async function Ja(e,t,r,o,s,n){var p;let i=j(o.activeEnvironment),a=`${e}::${i}`;if(n.has(a))return;let l=t.importGraph[e]||[];for(let c of l)await Ja(c,t,r,o,s,n);let d=r.get(e);if(!d)throw new Error(`HTTP file not loaded for ${e}`);let u={...o,httpFile:d,httpRegion:d.httpRegions[0]||{},variables:o.variables||{},options:o.options||{},processedHttpRegions:[]};await s.executeGlobalScripts(u);try{if(Array.isArray(d.globalHttpRegions))for(let c of d.globalHttpRegions){let h=(p=c==null?void 0:c.variablesPerEnv)==null?void 0:p[i];h&&F(h,o)}}catch{}u.variables&&(o.variables={...o.variables||{},...u.variables}),n.add(a)}function Cp(e,t,r){let o=Sp(t);return!o||o!==r.fileName?!1:e.symbol.startLine===r.line}function Sp(e){let t=typeof e.fileName=="string"?e.fileName:e.fileName&&"toString"in e.fileName?e.fileName.toString():void 0;if(t)return st.default.isAbsolute(t)?st.default.relative(process.cwd(),t):t}function Tp(e,t){if(!e)return;let r=typeof e=="string"?e:e&&"toString"in e?e.toString():void 0;return r?(st.default.isAbsolute(r)?st.default.relative(t,r):r).split(st.default.sep).join("/"):void 0}function za(e,t){let r=new Set;for(let o of e.stages)for(let s of o.units)for(let n of s.regionIds){let i=t.regions[n];i&&r.add(i.file)}return r.size}function Lp(e,t){let r=e.requestedRegionIds.filter(o=>!t.has(o));if(r.length>0)throw new Error(`Execution coverage failed. Missing requested regions: ${r.join(", ")}`)}function Ep(e,t){let r=[];r.push("Execution Plan:"),e.stages.forEach((o,s)=>{for(let n of o.units){let i=n.type==="chain"?"chain":"region",a=n.regionIds.map(l=>{var d;return((d=t.regions[l])==null?void 0:d.name)||l}).join(" \u2192 ");r.push(`  Stage ${s+1}: [${i}] ${a} (reason: ${n.reason})`)}}),r.push(`Total: ${e.stats.totalRegions} requests`),console.info(r.join(`
`))}function Ya(e){let t={};Object.values(e.regions).forEach(r=>{t[r.id]=Op(r)});for(let r of Object.values(t)){let o=r.region;for(let s of o.refs){let n=Xa(s,o.file,e);if(!n)throw new Error(`ref "${s}" not found in scope ${o.file}`);let i=t[n.id];r.refs.push(i),i.dependents.push(r)}for(let s of o.forceRefs){let n=Xa(s,o.file,e);if(!n)throw new Error(`ref "${s}" not found in scope ${o.file}`);let i=t[n.id];r.forceRefs.push(i),i.dependents.push(r)}}return $p(t),{nodes:t}}function Xa(e,t,r){let o=qp(t,r),s=[];for(let n of o){let i=r.files[n];if(i)for(let a of i.regionIds){let l=r.regions[a];(l==null?void 0:l.name)===e&&s.push(l)}}if(s.length===0)return null;if(s.length>1)throw new Error(`Ambiguous reference "${e}" in scope ${t}: ${s.map(n=>`${n.file}:${n.startLine}`).join(", ")}`);return s[0]}function qp(e,t){let r=[e],o=[e],s=new Set([e]);for(;o.length>0;){let n=o.shift(),i=t.importGraph[n]||[];for(let a of i)s.has(a)||(s.add(a),r.push(a),o.push(a))}return r}function Op(e){return{id:e.id,region:e,refs:[],forceRefs:[],dependents:[]}}function $p(e){let t=new Set,r=new Set,o=(s,n)=>{if(r.has(s.id))return;if(t.has(s.id)){let a=n.indexOf(s.id),l=[...n.slice(a),s.id];throw new Error(`Circular reference: ${l.join(" \u2192 ")}`)}t.add(s.id);let i=[...n,s.id];for(let a of[...s.refs,...s.forceRefs])o(a,i);t.delete(s.id),r.add(s.id)};Object.values(e).forEach(s=>o(s,[]))}function el(e,t,r,o={}){let s=Ap(e,o),n=new Set(s),i=Ip(n,t,r),a=jp(i,r);a.forEach(b=>b.regionIds.forEach(w=>i.add(w))),a.forEach(b=>b.softDeps.forEach(w=>i.add(w)));let l=Qa(e,i,n,a),d;try{d=Za(l,t,a)}catch(b){if(Bp(b))a=[],l=Qa(e,i,n,a),d=Za(l,t,a);else throw b}let u=l.reduce((b,w)=>b+w.regionIds.length,0),p=l.filter(b=>b.reason==="filter_match").length,c=l.filter(b=>b.type==="chain").length,h=l.length-p-c;return{stages:d,requestedRegionIds:s,stats:{totalRegions:u,leafRegions:p,dependencyRegions:h,forceRefChains:c,requestedRegions:s.length}}}function Ap(e,t){if(t.selection&&t.selection.length>0)return t.selection.map(n=>e.regions[n]).filter(n=>!!n&&!n.isGlobal).map(n=>n.id);let r=t.filters||{},o=[],s=Object.values(e.files);for(let n of s)for(let i of n.regionIds){let a=e.regions[i];!a||a.isGlobal||Fp(a,r)&&o.push(a.id)}if(o.length===0&&!Dp(r))for(let n of s)for(let i of n.regionIds){let a=e.regions[i];a&&!a.isGlobal&&o.push(a.id)}return o}function Dp(e){return!!(e.tags&&e.tags.length>0||e.names&&e.names.length>0||e.line!==void 0)}function Fp(e,t){return!(t.tags&&t.tags.length>0&&!t.tags.every(r=>e.tags.includes(r))||t.names&&t.names.length>0&&(!e.name||!t.names.includes(e.name))||typeof t.line=="number"&&(t.line<e.startLine||t.line>e.endLine))}function Ip(e,t,r){let o=new Set,s=[...e],n=new Set;for(r.forEach(a=>a.regionIds.forEach(l=>n.add(l)));s.length>0;){let a=s.pop();if(o.has(a))continue;o.add(a);let l=t.nodes[a];l&&(l.refs.forEach(d=>{o.has(d.id)||s.push(d.id)}),l.forceRefs.forEach(d=>{o.has(d.id)||s.push(d.id)}))}let i=[];for(let a of r)a.regionIds.some(l=>o.has(l))&&(a.regionIds.forEach(l=>o.add(l)),a.softDeps.forEach(l=>{o.has(l)||(o.add(l),i.push(l))}));for(;i.length>0;){let a=i.pop(),l=t.nodes[a];l&&(l.refs.forEach(d=>{o.has(d.id)||(o.add(d.id),i.push(d.id))}),l.forceRefs.forEach(d=>{o.has(d.id)||(o.add(d.id),i.push(d.id))}))}return o}function jp(e,t){return t.filter(r=>r.regionIds.some(o=>e.has(o)))}function Qa(e,t,r,o){let s=[],n=new Set;for(let i of o)s.push({id:i.id,type:"chain",regionIds:i.regionIds,reason:"forceRef_chain"}),i.regionIds.forEach(l=>n.add(l));return t.forEach(i=>{if(n.has(i)||!e.regions[i])return;let l=r.has(i)?"filter_match":"ref_dependency";s.push({id:i,type:"region",regionIds:[i],reason:l})}),s.sort((i,a)=>i.id.localeCompare(a.id)),s}function Mp(e){let t=new Map,r=e.slice().sort((o,s)=>s.regionIds.length-o.regionIds.length||o.id.localeCompare(s.id));for(let o of r)for(let s of o.regionIds)t.has(s)||t.set(s,o);return t}function Za(e,t,r){let o=new Map(e.map(u=>[u.id,u])),s=Vp(e,r),n=new Map,i=new Map;for(let u of e)n.set(u.id,new Set),i.set(u.id,0);let a=(u,p)=>{if(u===p)return;let c=n.get(u);c&&(c.has(p)||(c.add(p),i.set(p,(i.get(p)||0)+1)))};for(let u of e){for(let p of u.regionIds){let c=t.nodes[p];if(!c)continue;[...c.refs.map(b=>b.id),...c.forceRefs.map(b=>b.id)].forEach(b=>{let w=s.get(b),H=s.get(p);w&&H&&a(w,H)})}if(u.type==="chain"){let p=r.find(c=>c.id===u.id);p==null||p.softDeps.forEach(c=>{let h=s.get(c);h&&a(h,u.id)})}}let l=[];i.forEach((u,p)=>{u===0&&l.push(p)}),l.sort();let d=[];for(;l.length>0;){let u=l.shift(),p=o.get(u);if(!p)continue;d.push({units:[p]});let c=n.get(u);c&&c.forEach(h=>{let b=(i.get(h)||0)-1;i.set(h,b),b===0&&(l.push(h),l.sort())})}if(d.length!==e.length){let u=e.map(h=>({unit:h,indegree:i.get(h.id)||0})).filter(h=>h.indegree>0).map(h=>`${h.unit.id}(${h.indegree})`),p=e.filter(h=>!u.some(b=>b.startsWith(h.id))).map(h=>h.id),c=[...u,...p].join(", ");throw new Error(`Circular reference detected in execution plan. Remaining: ${c}`)}return d}function Vp(e,t){let r=new Map,o=Mp(t);for(let s of e)for(let n of s.regionIds)if(s.type==="chain")r.set(n,s.id);else{let i=o.get(n);r.set(n,i?i.id:s.id)}return r}function Bp(e){return e instanceof Error&&e.message.startsWith("Circular reference detected in execution plan")}async function tl(e,t={}){if(!t.noCache){let o=await Ma(e);if(o&&(await Ba(o,e)).valid)return o}let r=await Ka(e,t);return t.noCache||await Va(e,r),r}function Ss(e){if(e.json||e.jsonl)return 1e3;if(e.silent)return 100;if(e.verbose)return 1}var Ts=!1,rl={id:"bailOnFailed",beforeLoop:async function(t){if(Ts){let[r]=t.args;return oe(r.httpRegion,"request skipped because of bail"),!1}return!0},onError:async function(){return Ts=!0,!0},afterTrigger:async function(t){var s,n;return((n=(s=t.args[0].httpRegion.testResults)==null?void 0:s.find)==null?void 0:n.call(s,i=>["FAILED"].includes(i.status)))&&(Ts=!0),!0}};var ol={id:"loggerFlush",afterLoop:async function(t){var o,s;let r=t.args[0];return(s=(o=r==null?void 0:r.scriptConsole)==null?void 0:o.flush)==null||s.call(o),!0}};var sl={id:"testExitCode",onError:async function(){return process.exitCode=10,!0},afterTrigger:async function(t){let r=t.args[0];if(r.httpRegion.testResults===void 0)return!0;let o=!1,s=!1;for(let n of r.httpRegion.testResults){if(n.status==="ERROR"){o=!0;break}n.status==="FAILED"&&(s=!0)}return o?process.exitCode=19:s&&(process.exitCode=20),!0}};function nl(e){return function(r){r.hooks.execute.addInterceptor(ol),r.hooks.execute.addInterceptor(sl),e&&r.hooks.execute.addInterceptor(rl)}}var il=T(require("cli-progress")),Ge=T(require("chalk"));var Nt=class{constructor(t,r){this.totalRequests=t;this.enabled=r;this.bar=null;this.stats={success:0,failed:0,errored:0,skipped:0};this.current=0}start(){this.enabled&&(this.bar=new il.default.SingleBar({format:"Testing... {bar} {percentage}% | {value}/{total} | {stats}",barCompleteChar:"\u2588",barIncompleteChar:"\u2591",hideCursor:!0,clearOnComplete:!1,stopOnComplete:!1}),this.bar.start(this.totalRequests,0,{stats:Ge.default.gray("starting...")}))}update(t){if(!this.bar)return;let r=t.testResults||[],o=r.some(i=>i.status==="ERROR"),s=r.some(i=>i.status==="FAILED"),n=r.some(i=>i.status==="SKIPPED");o?this.stats.errored++:s?this.stats.failed++:n?this.stats.skipped++:this.stats.success++,this.current++,this.bar.update(this.current,{stats:this.formatStats()})}stop(){this.bar&&this.bar.stop()}getStats(){return{...this.stats}}formatStats(){let t=[];return this.stats.success>0&&t.push(Ge.default.green(`${this.stats.success} \u2713`)),this.stats.failed>0&&t.push(Ge.default.red(`${this.stats.failed} \u2717`)),this.stats.errored>0&&t.push(Ge.default.red(`${this.stats.errored} \u26A0`)),this.stats.skipped>0&&t.push(Ge.default.yellow(`${this.stats.skipped} \u2298`)),t.join(" ")||Ge.default.gray("starting...")}};function Ls(e){return e.json||e.jsonl||e.silent||e.verbose?!1:process.stdout.isTTY===!0}async function al(e,t){return Np(t)?Up(e,t):e.map(o=>({httpFile:o}))}function Np(e){return!!(e.tag&&e.tag.length>0||e.name&&e.name.length>0||e.line!==void 0)}function Up(e,t){let r=[],o=t.tag||[],s=t.name||[],n=t.line;for(let i of e){let a=i.httpRegions.filter(l=>!(o.length>0&&!_p(l,o)||s.length>0&&!Gp(l,s)||n!==void 0&&!Kp(l,n)));a.length>0&&r.push({httpFile:i,httpRegions:a})}return r}function _p(e,t){var o;if(!m((o=e.metaData)==null?void 0:o.tag))return!1;let r=e.metaData.tag.split(",").map(s=>s.trim()).filter(Boolean);return r.length===0?!1:t.every(s=>r.includes(s))}function Gp(e,t){var r;return m((r=e.metaData)==null?void 0:r.name)?t.includes(e.metaData.name):!1}function Kp(e,t){return e.symbol.startLine<=t&&e.symbol.endLine>=t}function ul(){return new dl.Command("uctest").description("HTTP test runner for Unsafe Code Lab").usage("[@tag...] [:name...] [path...] [options]").argument("[args...]","Tags (@tag), names (:name), and paths").option("-k, --keep-going","continue running after failures (default: stop on first)").option("--json","use json output").option("--jsonl","stream json lines output").option("-l, --line <line>","line of the http requests",C).option("--no-color","disable color support").option("-o, --output <output>","output format of response (short, body, headers, response, exchange, none)","none").option("--output-failed <output>","output format of failed response (short, body, headers, response, exchange, none)","exchange").option("-s, --silent","log only request").option("--prune-refs","only execute leaf requests (prune referenced dependencies)").option("--no-cache","skip cache, always rebuild dependency model").option("--show-plan","print execution plan without running").option("-r, --resume","resume from last failed request").option("--state-file <path>","path to state file for resume (default: .uctest-state)").option("--timeout <timeout>","maximum time allowed for connections",C).option("--var  <variables...>",'list of variables (e.g foo="bar")').option("-v, --verbose","make the operation more talkative").action(Jp)}function Wp(e){let t=[],r=[],o=[];for(let s of e)if(s.startsWith("@")){let n=s.slice(1);n&&(n.includes(",")&&(console.error(`Error: Commas not supported in tags. Use separate arguments: @${n.split(",").join(" @")}`),process.exit(1)),t.push(n))}else if(s.startsWith(":")){let n=s.slice(1);n&&r.push(n)}else o.push(s);return{tags:t,names:r,paths:o}}async function Jp(e,t){var c,h;let r=Wp(e);r.tags.length>0&&(t.tag=r.tags),r.names.length>0&&(t.name=r.names);let o=r.paths.length>0?r.paths:["./**/*.http"],s=!t.keepGoing,n=sc(t),{httpFiles:i,config:a,httpFileStore:l}=await ic(o,s,n.config||{});n.config=a,nc(t,n);let d=(0,V.join)(process.cwd(),".uctest-state"),u=t.resume?t.stateFile||d:void 0,p=u?await oc(u):void 0;try{if(i.length>0){let b=await al(i,t);if(b.length===0&&(console.error("No tests match the specified filters"),process.exit(1)),t.pruneRefs){await Qp(i,l,b,n,t,p,u,s);return}p&&(b=tc(b,p),p=void 0);let w=zp(b,i),H=w.totalRequests,R=w.totalFiles,y=Ls(t),k=new Nt(H,y),K=0,O=t.jsonl?fl():void 0;t.jsonl?(O==null||O({type:"start",totalRequests:H,totalFiles:R}),n.processedHttpRegionListener=U=>{K+=1,O==null||O({type:"request",index:K,totalRequests:H,request:Mt(U,t)})}):y?n.processedHttpRegionListener=U=>{k.update(U)}:n.processedHttpRegionListener=void 0,n.processedHttpRegions=[],k.start();let He=b.map(({httpFile:U,httpRegions:N})=>async function(){!t.json&&!y&&n.scriptConsole&&n.scriptConsole.info(`--------------------- ${U.fileName}  --`),await Ps(Object.assign({},n,{httpFile:U,httpRegions:N}))});await No(1,...He),k.stop();let ye=n.processedHttpRegions||[],be=t.resume&&s?gl(ye):void 0;if(t.jsonl){K=cl(ye,t,O,K,H);let U=Zr(ye,t);O==null||O({type:"summary",totalRequests:H,totalFiles:R,summary:U.summary})}else pl(n,t);u&&t.resume&&s&&(be?await yl(u,be):await bl(u))}else console.error(`uctest cannot find any .http files matching: ${o.join(", ")}`)}finally{(h=(c=n.scriptConsole)==null?void 0:c.flush)==null||h.call(c)}}function pl(e,t){let r=e.processedHttpRegions||[],o=Zr(r,t);if(t.json)console.info(I(o,2));else if(e.scriptConsole){e.scriptConsole.info("");let s=[];o.summary.successRequests>0&&s.push(nt.default`{green ${o.summary.successRequests} succeeded}`),o.summary.failedRequests>0&&s.push(nt.default`{red ${o.summary.failedRequests} failed}`),o.summary.erroredRequests>0&&s.push(nt.default`{red ${o.summary.erroredRequests} errored}`),o.summary.skippedRequests>0&&s.push(nt.default`{yellow ${o.summary.skippedRequests} skipped}`),e.scriptConsole.info(nt.default`{bold ${o.summary.totalRequests}} requests processed (${s.join(", ")})`)}}function cl(e,t,r,o,s){if(!r)return o;for(let n=o;n<e.length;n+=1)r({type:"request",index:n+1,totalRequests:s,request:Mt(e[n],t)});return Math.max(o,e.length)}function fl(){return e=>{process.stdout.write(`${I(e)}
`)}}function zp(e,t){var a,l,d,u,p;let r=new Map,o=new Map;for(let c of t)for(let h of c.httpRegions){o.set(h,c);let b=v((a=h.metaData)==null?void 0:a.name);if(!b)continue;let w=r.get(b)||[];w.push(h),r.set(b,w)}let s=new Set,n=new Set,i=[];for(let{httpFile:c,httpRegions:h}of e){let b=h??c.httpRegions;for(let w of b)((l=w.metaData)==null?void 0:l.disabled)===!0||(d=w.metaData)!=null&&d.skip||i.push(w)}for(;i.length>0;){let c=i.pop();if(!c||s.has(c))continue;s.add(c);let h=o.get(c);h&&n.add(h);for(let b of ec(c)){let w=r.get(b);if(w)for(let H of w)((u=H.metaData)==null?void 0:u.disabled)===!0||(p=H.metaData)!=null&&p.skip||i.push(H)}}return{totalRequests:s.size,totalFiles:n.size}}function Xp(e){var r,o;let t=[];for(let{httpFile:s,httpRegions:n}of e){let i=n??s.httpRegions;for(let a of i)((r=a.metaData)==null?void 0:r.disabled)===!0||(o=a.metaData)!=null&&o.skip||a.isGlobal()||t.push(a.id)}return t}async function Yp(e,t,r,o,s){let n=new Map;for(let d of r){let u=ml(d.fileName,t.rootDir);u&&n.set(u,d)}let i=new Set;for(let d of e.stages)for(let u of d.units)for(let p of u.regionIds){let c=t.regions[p];c&&i.add(c.file)}let a=Array.from(i);for(;a.length>0;){let d=a.pop();if(!d)continue;let u=t.importGraph[d]||[];for(let p of u)i.has(p)||(i.add(p),a.push(p))}let l={workingDir:process.cwd(),config:s};for(let d of Array.from(i)){if(n.has(d))continue;let u=(0,V.join)(t.rootDir,d),p=await o.getOrCreate(u,async()=>await it.promises.readFile(u,"utf8"),0,l);n.set(d,p),r.push(p)}return l.config}async function Qp(e,t,r,o,s,n,i,a){var be,U;let l=Xp(r),d=Zp(e),u=await tl(d,{noCache:s.noCache}),p=Ya(u),c=Wa(p),h=el(u,p,c,{selection:l,filters:{tags:s.tag,names:s.name,line:s.line}});if(s.showPlan){await Cs(h,u,e,o,{showPlan:!0});return}o.options={...o.options||{},skipRefResolution:!0},o.processedHttpRegions=[];let b=h.requestedRegionIds[0]||((U=(be=h.stages[0])==null?void 0:be.units[0])==null?void 0:U.regionIds[0]);if(b){let N=u.regions[b];if(N){let Ce=e.find(Ut=>ml(Ut.fileName,u.rootDir)===N.file);if(Ce){let Ut=await _e({...o,httpFile:Ce});Ut.variables&&(o.variables={...o.variables||{},...Ut.variables})}}}let w=await Yp(h,u,e,t,o.config);o.config=w||o.config;let H=h.stats.totalRegions,R=za(h,u),y=Ls(s),k=new Nt(H,y),K=0,O=s.jsonl?fl():void 0;s.jsonl?(O==null||O({type:"start",totalRequests:H,totalFiles:R}),o.processedHttpRegionListener=N=>{K+=1,O==null||O({type:"request",index:K,totalRequests:H,request:Mt(N,s)})}):y?o.processedHttpRegionListener=N=>{k.update(N)}:o.processedHttpRegionListener=void 0,k.start(),await Cs(h,u,e,o,{resumeState:n,showProgress:y}),k.stop();let He=o.processedHttpRegions||[],ye=s.resume&&a?gl(He):void 0;if(s.jsonl){K=cl(He,s,O,K,H);let N=Zr(He,s);O==null||O({type:"summary",totalRequests:H,totalFiles:R,summary:N.summary})}else pl(o,s);i&&s.resume&&a&&(ye?await yl(i,ye):await bl(i))}function ml(e,t){if(!e)return;let r=f.fsPath(e)||f.toString(e);return r?((0,V.isAbsolute)(r)?(0,V.relative)(t,r):r).split(V.sep).join("/"):void 0}function gl(e){return e.find(t=>{var r;return(r=t.testResults)==null?void 0:r.some(o=>o.status==="ERROR"||o.status==="FAILED")})}function Zp(e){let t=e.map(i=>f.fsPath(i.fileName)||f.toString(i.fileName)).filter(i=>!!i).map(i=>(0,V.isAbsolute)(i)?i:(0,V.resolve)(process.cwd(),i));if(t.length===0)return process.cwd();let r=(0,V.parse)(t[0]).root||process.cwd(),o=t.map(i=>{let a=(0,V.parse)(i).dir,l=(0,V.relative)(r,a);return l?l.split(V.sep).filter(Boolean):[]}),s=Math.min(...o.map(i=>i.length)),n=[];for(let i=0;i<s;i+=1){let a=o[0][i];if(o.every(l=>l[i]===a))n.push(a);else break}return(0,V.join)(r,...n)}function ec(e){var o,s;let t=[],r=[(o=e.metaData)==null?void 0:o.ref,(s=e.metaData)==null?void 0:s.forceRef];for(let n of r){if(!n||n===!0)continue;let i=v(n);if(!i)continue;let a=i.split(/[,\s]+/u).map(l=>l.trim()).filter(Boolean);t.push(...a)}return t}function tc(e,t){var s,n;let r=[],o=!0;for(let i of e){let a=i.httpRegions??i.httpFile.httpRegions,l=hl(i.httpFile.fileName),d=[];for(let u of a)((s=u.metaData)==null?void 0:s.disabled)===!0||(n=u.metaData)!=null&&n.skip||(o?rc(l,u,t)&&(o=!1,d.push(u)):d.push(u));if(d.length>0){let u=a===i.httpFile.httpRegions&&d.length===a.length;r.push({httpFile:i.httpFile,httpRegions:u?void 0:d})}}return o?e:r}function rc(e,t,r){return!e||e!==r.fileName?!1:t.symbol.startLine===r.line}function hl(e){if(!e)return;let t=f.fsPath(e)||f.toString(e);if(t)return(0,V.isAbsolute)(t)?(0,V.relative)(process.cwd(),t):t}async function oc(e){try{let t=await it.promises.readFile(e,"utf-8");return JSON.parse(t)}catch(t){t.code!=="ENOENT"&&console.warn(`Failed to read resume state from ${e}:`,t);return}}async function yl(e,t){var s;let r=hl(t.filename);if(!r)return;let o={fileName:r,line:t.symbol.startLine,name:v((s=t.metaData)==null?void 0:s.name)};await it.promises.writeFile(e,I(o,2))}async function bl(e){try{await it.promises.unlink(e)}catch(t){t.code!=="ENOENT"&&console.warn(`Failed to clear resume state at ${e}:`,t)}}function sc(e){return{config:{log:{level:Ss(e)},request:{timeout:e.timeout}},variables:e.var?Object.fromEntries(e.var.map(r=>{let o=r.split("=");return[o[0],o.slice(1).join("=")]})):void 0,options:{}}}function nc(e,t){if(e.jsonl)return;let r=new We({level:Ss(e)});if(r.collectMessages(),t.scriptConsole=r,!e.json){t.logStream=lc(e);let o=dc(e,t.config,r);t.logResponse=async(s,n)=>{o&&await o(s,n),r.flush()}}}async function ic(e,t,r){let o=[],s=new qt({cli:nl(t)}),n={workingDir:process.cwd(),config:r},i=[];for(let a of e)i.push(...await ac(a));for(let a of i){let l=await s.getOrCreate(a,async()=>await it.promises.readFile(a,"utf8"),0,n);o.push(l)}return{httpFiles:o,config:n.config,httpFileStore:s}}async function ac(e){let t={gitignore:!0},{globby:r}=await import("globby"),o=await r(e,t);return o&&o.length>0||V.sep==="/"?o:await r(e.replace(/\\/gu,"/"),t)}function lc(e){if(e.output!=="none")return async function(r,o){let s=Buffer.isBuffer(o.body)?o.body.toString("utf-8"):o.body;console.info(`${new Date().toLocaleTimeString()} - ${r}: `,s)}}function dc(e,t,r){var i,a;let o={responseBodyPrettyPrint:!0},s=ll(e.output,o,(i=t==null?void 0:t.log)==null?void 0:i.options),n=ll(e.outputFailed,o,(a=t==null?void 0:t.log)==null?void 0:a.options);if(s||n)return co(l=>r.logPriority(l),s,n)}function ll(e,...t){let r;switch(e){case"body":r={responseBodyLength:0};break;case"headers":r={requestOutput:!0,requestHeaders:!0,responseHeaders:!0};break;case"response":r={responseHeaders:!0,responseBodyLength:0};break;case"none":return;case"short":r={useShort:!0};break;case"timings":r={timings:!0};break;case"exchange":r={requestOutput:!0,requestHeaders:!0,requestBodyLength:0,responseHeaders:!0,responseBodyLength:0,timings:!0};break;default:r={requestOutput:!0,requestHeaders:!0,requestBodyLength:0,responseHeaders:!0,responseBodyLength:0};break}return Object.assign({},...t,r)}async function Rl(){let e=await vt((0,xl.join)(__dirname,"../package.json")),t=ul();return t.version((e==null?void 0:e.version)||"0.0.1"),t}async function uc(e){try{await _o(),await(await Rl()).parseAsync(e)}catch(t){throw console.error(t),process.exitCode||(process.exitCode=1),t}finally{process.exit()}}0&&(module.exports={AbstractRequestClient,ExecuteHook,HookCancel,HttpSymbol,HttpSymbolKind,LogLevel,OnRequestHook,OnResponseHook,OnStreaming,ParseEndRegionHook,ParseHook,ParseMetaDataHook,ProvideAssertValue,ProvideEnvironmentsHook,ProvideVariablesHook,RepeatOrder,ReplaceVariableHook,RequestClientEvent,ResponseLoggingHook,TestResultStatus,VariableType,cli,createEmptyProcessorContext,getEnvironments,getVariables,io,send,store,testSymbols,utils});
//# sourceMappingURL=index.js.map
