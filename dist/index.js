"use strict";var Oa=Object.create;var Lt=Object.defineProperty;var Aa=Object.getOwnPropertyDescriptor;var $a=Object.getOwnPropertyNames;var Da=Object.getPrototypeOf,Ia=Object.prototype.hasOwnProperty;var Xe=(e,t)=>{for(var r in t)Lt(e,r,{get:t[r],enumerable:!0})},cs=(e,t,r,o)=>{if(t&&typeof t=="object"||typeof t=="function")for(let s of $a(t))!Ia.call(e,s)&&s!==r&&Lt(e,s,{get:()=>t[s],enumerable:!(o=Aa(t,s))||o.enumerable});return e};var A=(e,t,r)=>(r=e!=null?Oa(Da(e)):{},cs(t||!e||!e.__esModule?Lt(r,"default",{value:e,enumerable:!0}):r,e)),Fa=e=>cs(Lt({},"__esModule",{value:!0}),e);var ns={};Xe(ns,{AbstractRequestClient:()=>nt,ExecuteHook:()=>ve,HookCancel:()=>st,HttpSymbol:()=>v,HttpSymbolKind:()=>N,LogLevel:()=>De,OnRequestHook:()=>ye,OnResponseHook:()=>be,OnStreaming:()=>xe,ParseEndRegionHook:()=>et,ParseHook:()=>Ye,ParseMetaDataHook:()=>Qe,ProvideAssertValue:()=>Ze,ProvideEnvironmentsHook:()=>rt,ProvideVariablesHook:()=>tt,RepeatOrder:()=>Br,ReplaceVariableHook:()=>ot,RequestClientEvent:()=>ne,ResponseLoggingHook:()=>Re,TestResultStatus:()=>X,VariableType:()=>Z,cli:()=>ms,createEmptyProcessorContext:()=>ls,getEnvironments:()=>cu,getVariables:()=>ba,io:()=>j,send:()=>as,store:()=>Ao,testSymbols:()=>J,utils:()=>y});module.exports=Fa(ns);var ms={};Xe(ms,{createProgram:()=>qa,execute:()=>Bu,initFileProvider:()=>Bs,initIOProvider:()=>Lo});var La=require("path");var y={};Xe(y,{ENVIRONMENT_NONE:()=>Rs,HandlebarsSingleLine:()=>ct,OAuth2Regex:()=>kl,RegionSeparator:()=>Le,addHttpFileRequestClientHooks:()=>mt,addSkippedTestResult:()=>Q,addTestResultToHttpRegion:()=>me,assertHasNoResponseBody:()=>no,assertHasResponseBody:()=>so,assertHeaderContains:()=>oo,assertHeaderEquals:()=>ro,assertMaxTotalTime:()=>to,assertResponseBodyEquals:()=>io,assertStatusEquals:()=>eo,cleanVariables:()=>It,cloneRequest:()=>ys,cloneResponse:()=>ae,createResponseProxy:()=>Ft,decodeJWT:()=>zr,defaultConfigFiles:()=>$t,deleteHeader:()=>Jr,deleteVariableInContext:()=>Se,distinct:()=>ja,ensureString:()=>qt,equalsPath:()=>lo,errorToString:()=>il,executeGlobalScripts:()=>Be,executeRequestClientFactory:()=>go,expandVariable:()=>ks,extensionName:()=>ao,findHttpRegionInContext:()=>Me,findRootDir:()=>Ot,findRootDirOfFile:()=>Et,getBufferEncoding:()=>Ve,getDisplayName:()=>pt,getHeader:()=>q,getHeaderArray:()=>Ja,getHeaderBoolean:()=>Ga,getHeaderNumber:()=>Wa,getHeaderString:()=>Ka,getHttpyacConfig:()=>uo,getMarkdownSyntax:()=>Es,getPartOfBody:()=>Yr,getPlugins:()=>po,getRegionDescription:()=>ho,importHttpFileInContext:()=>ht,isBufferEncoding:()=>bs,isError:()=>te,isHttpRegionSendContext:()=>Ho,isHttpRegionsSendContext:()=>Co,isHttpRequest:()=>E,isHttpRequestMethod:()=>_a,isHttpResponse:()=>Qr,isMimeTypeCSS:()=>_r,isMimeTypeFormUrlEncoded:()=>Pe,isMimeTypeHtml:()=>Ur,isMimeTypeImage:()=>Na,isMimeTypeJSON:()=>at,isMimeTypeJavascript:()=>Mr,isMimeTypeMarkdown:()=>lt,isMimeTypeMultiPartFormData:()=>Kr,isMimeTypeMultiPartMixed:()=>Gr,isMimeTypeNewlineDelimitedJSON:()=>Wr,isMimeTypePdf:()=>Ma,isMimeTypeXml:()=>Nr,isOpenIdInformation:()=>Rl,isProcessorContext:()=>vl,isPromise:()=>Ne,isString:()=>c,isStringEmpty:()=>ke,isUndefined:()=>Fe,iterateDirectoryTree:()=>At,iterateUntilRoot:()=>pe,joinMarkdown:()=>jt,knownMetaData:()=>Is,logResponse:()=>Te,mergeRawHttpHeaders:()=>Za,mergeResponses:()=>Dt,parseComments:()=>ft,parseContentType:()=>we,parseDefaultHeadersFactory:()=>Ro,parseError:()=>He,parseFileImport:()=>gt,parseHandlebarsString:()=>M,parseHandlebarsSymbols:()=>re,parseInlineResponse:()=>Po,parseJson:()=>dt,parseMimeType:()=>it,parseQueryLineFactory:()=>ko,parseRequestHeaderFactory:()=>Bt,parseRequestLineFactory:()=>wo,parseSubsequentLines:()=>Vt,parseUrlLineFactory:()=>vo,promiseQueue:()=>So,randomArrayValue:()=>To,randomData:()=>yt,randomEmail:()=>Ue,randomText:()=>G,repeat:()=>mo,replaceFilePath:()=>le,replaceInvalidChars:()=>el,replaceVariables:()=>$,report:()=>T,requestLoggerFactory:()=>Xr,resolveClientCertificates:()=>xs,setVariableInContext:()=>D,shortenFileName:()=>tl,shrinkCloneResponse:()=>Zr,sleep:()=>ce,stateGenerator:()=>Va,stringifySafe:()=>O,testFactory:()=>ut,testFactoryAsync:()=>co,toAbsoluteFilename:()=>V,toBoolean:()=>ue,toBufferLike:()=>ie,toEnvironmentKey:()=>B,toHttpString:()=>bl,toHttpStringHeader:()=>yo,toHttpStringRequest:()=>Ls,toHttpStringResponse:()=>Ts,toMarkdown:()=>xl,toMarkdownHeader:()=>bo,toMarkdownMeta:()=>$s,toMarkdownRequest:()=>Os,toMarkdownResponse:()=>qs,toMarkdownTestResults:()=>As,toMarkdownTimings:()=>Ds,toMultiLineArray:()=>Y,toMultiLineString:()=>U,toNumber:()=>P,toQueryParams:()=>za,toString:()=>x,unsetVariableInContext:()=>ll,useDefaultOnError:()=>Ce});function ja(e){function t(r,o,s){return s.indexOf(r)===o}return e.filter(t)}var _=A(require("chalk")),hs=require("util");var j={};Xe(j,{Logger:()=>Ie,completionItemProvider:()=>W,fileProvider:()=>p,httpClientProvider:()=>se,javascriptProvider:()=>H,log:()=>f,userInteractionProvider:()=>L});var W={emptyLineProvider:[],variableProvider:[],requestHeaderProvider:[]};var p={EOL:`\r
`,exists:()=>{throw new Error("Not Implemented")},dirname:()=>{throw new Error("Not Implemented")},hasExtension:()=>{throw new Error("Not Implemented")},isAbsolute:()=>{throw new Error("Not Implemented")},joinPath:()=>{throw new Error("Not Implemented")},readFile:()=>{throw new Error("Not Implemented")},readBuffer:()=>{throw new Error("Not Implemented")},writeBuffer:()=>{throw new Error("Not Implemented")},readdir:()=>{throw new Error("Not Implemented")},fsPath:fs,toString:fs};function fs(e){return typeof e=="string"?e:e.toString()}var se={};var H={require:{},evalExpression:async function(t,r){return r.variables[t]}};var K=require("hookpoint"),Ye=class extends K.LastOutHook{constructor(){super(t=>!!t),this.id="ParseHook"}},Qe=class extends K.LastOutHook{constructor(){super(t=>!!t),this.id="ParseMetaDataHook"}},Ze=class extends K.LastOutHook{constructor(){super(t=>t!==!1),this.id="ProvideAssertValue"}},et=class extends K.SeriesHook{constructor(){super(),this.id="ParseEndRegionHook"}},tt=class extends K.SeriesHook{constructor(){super(),this.id="ProvideVariablesHook"}},rt=class extends K.SeriesHook{constructor(){super(),this.id="ProvideEnvironmentsHook"}},ot=class extends K.WaterfallHook{constructor(){super(t=>t===void 0),this.id="ReplaceVariableHook"}},ye=class extends K.SeriesHook{constructor(){super(),this.id="BeforeRequestHook"}},be=class extends K.SeriesHook{constructor(){super(),this.id="AfterRequestHook"}},xe=class extends K.SeriesHook{constructor(){super(),this.id="OnStreaming"}},Re=class extends K.SeriesHook{constructor(){super(),this.id="ResponseLoggingHook"}},ve=class extends K.SeriesHook{constructor(){super(t=>!t),this.id="ExecuteHook"}};var gs=require("hookpoint"),st=gs.HookCancel;var v=class{constructor(t){this.name=t.name||"symbol",this.description=t.description,this.kind=t.kind,this.startLine=t.startLine,this.startOffset=t.startOffset,this.endLine=t.endLine,this.endOffset=t.endOffset,this.children=t.children,this.source=t.source}getSymbolsForLine(t){let r=[];if((this.startLine<=t||this.endLine>=t)&&(r.push(this),this.children))for(let o of this.children)r.push(...o.getSymbolsForLine(t));return r}filter(t){let r=[];if(t(this)&&r.push(this),this.children)for(let o of this.children)r.push(...o.filter(t));return r}};var N=(g=>(g.request="request",g.requestLine="requestLine",g.requestHeader="requestHeader",g.requestBody="requestBody",g.response="response",g.gql="gql",g.proto="proto",g.script="script",g.metaData="metaData",g.comment="comment",g.url="url",g.operator="operator",g.key="key",g.value="value",g.variable="variable",g.path="path",g.variableDefinition="variableDefinition",g.text="text",g))(N||{});var De=(i=>(i[i.trace=1]="trace",i[i.debug=2]="debug",i[i.warn=5]="warn",i[i.info=10]="info",i[i.error=100]="error",i[i.none=1e3]="none",i))(De||{});var Br=(r=>(r[r.sequential=0]="sequential",r[r.parallel=1]="parallel",r))(Br||{});var ne=class extends Event{constructor(r,o){super(r);this.detail=o}},nt=class{constructor(){this.eventEmitter=new EventTarget}addEventListener(t,r){this.eventEmitter.addEventListener(t,o=>this.isRequestClientEvent(o)?r(o):void 0)}removeEventListener(t,r){this.eventEmitter.removeEventListener(t,o=>this.isRequestClientEvent(o)?r(o):void 0)}isRequestClientEvent(t){return t instanceof ne}onMessage(t,r){this.eventEmitter.dispatchEvent(new ne("message",[t,r]))}onProgress(t){this.eventEmitter.dispatchEvent(new ne("progress",t))}onMetaData(t,r){this.eventEmitter.dispatchEvent(new ne("metaData",[t,r]))}onDisconnect(){this.eventEmitter.dispatchEvent(new ne("disconnect",void 0))}triggerEnd(){this.eventEmitter.dispatchEvent(new ne("end",void 0))}};var J={ok:"\u2713",error:"\u2716",skipped:"\u25CB"};var X=(s=>(s.SUCCESS="SUCCESS",s.FAILED="FAILED",s.SKIPPED="SKIPPED",s.ERROR="ERROR",s))(X||{});var Z=(s=>(s.variable="Variable",s.url="Url",s.body="Body",s.filePath="FilePath",s))(Z||{});var Ie=class{constructor(t,r){this.options=t;this.parentLogger=r}collectMessages(){var t;(t=this.parentLogger)==null||t.collectMessages(),this.collectCache=[],this.priorityCache=[]}flush(){var t;(t=this.parentLogger)==null||t.flush(),this.priorityCache=this.flushCache(this.priorityCache),this.collectCache=this.flushCache(this.collectCache)}flushCache(t){if(t){for(let r of t)r();return[]}}writeLog(t,r,o,s){var n,i;if(!((n=this.options)!=null&&n.level)||t>=this.options.level){let a=()=>o(...s);(i=this.options)!=null&&i.logMethod&&(a=()=>{var d,l;return(l=(d=this.options)==null?void 0:d.logMethod)==null?void 0:l.call(d,t,...s)}),r?r.push(a):a()}}info(...t){var r;(r=this.parentLogger)==null||r.info(...t),this.writeLog(10,this.collectCache,console.info,t)}log(...t){var r;(r=this.parentLogger)==null||r.log(...t),this.writeLog(10,this.collectCache,console.log,t)}trace(...t){var r;(r=this.parentLogger)==null||r.trace(...t),this.writeLog(1,this.collectCache,this.options.noTrace?console.debug:console.trace,t)}debug(...t){var r;(r=this.parentLogger)==null||r.debug(...t),this.writeLog(2,this.collectCache,console.debug,t)}error(...t){var r;(r=this.parentLogger)==null||r.error(...t),this.writeLog(100,this.collectCache,console.error,t)}warn(...t){var r;(r=this.parentLogger)==null||r.warn(...t),this.writeLog(5,this.collectCache,console.warn,t)}logPriority(...t){this.writeLog(10,this.priorityCache,console.info,t)}clear(){console.clear()}},f=new Ie({level:5,noTrace:!0});var L={isTrusted:()=>!0,showNote:async function(){throw new Error("Not Implemented")},showInputPrompt:async function(){throw new Error("Not Implemented")},showListPrompt:async function(){throw new Error("Not Implemented")}};function U(e){return e.join(p.EOL)}function Y(e){return e.split(/\r?\n/gu)}function Fe(e){return typeof e>"u"}function c(e){return typeof e=="string"}function ke(e){return typeof e=="string"&&/^(\s*)?$/u.test(e)}function Va(e=30){let t="0123456789abcdefghijklmnopqrstuvwxyzABCDEFGHIJKLMNOPQRSTUVWXYZ-._~",r=[];for(let o=e;o>0;--o)r.push(t[Math.floor(Math.random()*t.length)]);return r.join("")}function x(e){if(c(e))return e;if(typeof e=="number")return`${e}`;if(e instanceof Date)return e.toISOString();if(e instanceof Error)return e.message;if(Buffer.isBuffer(e))return e.toString("utf-8");if(Array.isArray(e)&&e.every(t=>Buffer.isBuffer(t))){let t=e.map(r=>Buffer.isBuffer(r)&&r.toString("utf8"));return O(t)}if(e)return O(e)}function O(e,t=0){try{return JSON.stringify(e,(r,o)=>Ba(o)?Buffer.from(o.data).toString("base64"):o,t)}catch(r){return f.debug("JSON.stringify error",r),JSON.stringify(e,(()=>{let s=new WeakSet;return(n,i)=>{if(typeof i=="object"&&i!==null){if(s.has(i))return;s.add(i)}return i}})(),t)}}function qt(e){return typeof e>"u"||e===null||c(e)?e:`${e}`}function Ba(e){let t=e;return(t==null?void 0:t.type)==="Buffer"&&Array.isArray(t.data)&&!!t.data.length}function ue(e,t=!1){var s;if(typeof e=="boolean")return e;if(typeof e=="number")return!!e;let r=(s=qt(e))==null?void 0:s.trim();if(!r)return t;if(/^true$/iu.test(r))return!0;if(/^false$/iu.test(r))return!1;let o=parseFloat(r);return isNaN(o)?t:!!o}function P(e){if(typeof e=="number")return e;let t=qt(e);if(t){let r=Number.parseFloat(t.trim());if(!Number.isNaN(r))return r}}function ie(e){return Buffer.isBuffer(e)?e:x(e)}function it(e){var n,i;let[t,...r]=e.split(";").map(a=>a.trim()),o=(n=r.find(a=>a.startsWith("charset=")))==null?void 0:n.split("=")[1],s=(i=r.find(a=>a.startsWith("boundary=")))==null?void 0:i.split("=")[1];return{mimeType:t,contentType:e,charset:o,boundary:s}}function at(e){return!!e&&(e.mimeType==="application/json"||e.mimeType==="text/json"||e.mimeType.indexOf("+json")>=0||e.mimeType.indexOf("x-amz-json")>=0)}function Mr(e){return(e==null?void 0:e.mimeType)==="application/javascript"||(e==null?void 0:e.mimeType)==="text/x-javascript"}function Nr(e){return!!e&&(e.mimeType==="application/xml"||e.mimeType==="text/xml"||e.mimeType.indexOf("+xml")>=0)}function Ur(e){return(e==null?void 0:e.mimeType)==="text/html"}function _r(e){return(e==null?void 0:e.mimeType)==="text/css"}function lt(e){return(e==null?void 0:e.mimeType)==="text/markdown"}function Kr(e){return(e==null?void 0:e.mimeType)==="multipart/form-data"}function Gr(e){return(e==null?void 0:e.mimeType)==="multipart/mixed"}function Wr(e){return(e==null?void 0:e.mimeType)==="application/x-ndjson"}function Pe(e){return(e==null?void 0:e.mimeType)==="application/x-www-form-urlencoded"}function Ma(e){return(e==null?void 0:e.mimeType)==="application/pdf"}function Na(e){return e?["image/jpeg","image/gif","image/webp","image/png","image/bmp"].indexOf(e.mimeType)>=0:!1}function _a(e){return e?["ACL","BASELINE-CONTROL","CHECKIN","CHECKOUT","CONNECT","COPY","DELETE","GET","GRAPHQL","HEAD","LOCK","MERGE","MKACTIVITY","MKCALENDAR","MKCOL","MKWORKSPACE","MOVE","OPTIONS","PATCH","POST","PROPFIND","PROPPATCH","PUT","REPORT","SEARCH","TRACE","UNLOCK","VERSION-CONTROL"].includes(e.toUpperCase()):!1}function E(e){return(e==null?void 0:e.protocol)==="HTTP"}function Jr(e,...t){if(e)for(let r of t){let o=Object.entries(e).find(([s])=>s.toLowerCase()===r.toLowerCase());o&&o.length>1&&delete e[o[0]]}}function Ka(e,t){let r=q(e,t);if(c(r))return r}function Ga(e,t,r=!1){let o=q(e,t);return ue(o,r)}function q(e,t){if(e){let r=Object.entries(e).find(([o])=>o.toLowerCase()===t.toLowerCase());if(r&&r.length>1)return r[1]}}function Wa(e,t){let r=q(e,t);return P(r)}function Ja(e,t,r=[]){let o=q(e,t);return o?c(o)?[o]:o:r}function we(e){let t=q(e,"content-type");if(c(t))return it(t)}function zr(e){try{let t=e.split(".");if(t.length!==3)return null;let r=t[1];switch(r=r.replace(/-/gu,"+"),r=r.replace(/_/gu,"/"),r.length%4){case 0:break;case 2:r+="==";break;case 3:r+="=";break;default:return null}let o=new hs.TextDecoder().decode(Buffer.from(r,"base64"));return JSON.parse(o)}catch(t){return f.warn(t),null}}function za(e){return Object.entries(e).filter(([,t])=>!!t).map(([t,r])=>Array.isArray(r)?r.map(o=>`${t}=${encodeURIComponent(o||"")}`).join("&"):`${t}=${encodeURIComponent(r||"")}`).join("&")}function Xr(e,t,r){return async function(s,n){var d,l,u,m,h,R,k,C,I,b;let i=t;if(r&&(n!=null&&n.testResults)&&n.testResults.some(g=>["FAILED","ERROR"].includes(g.status))&&(i=r),!i||i.onlyFailed&&(!(n!=null&&n.testResults)||n.testResults.every(g=>g.status==="SUCCESS")))return;if(e(""),e("---------------------"),e(""),(d=n==null?void 0:n.metaData)!=null&&d.title||(l=n==null?void 0:n.metaData)!=null&&l.name||(u=n==null?void 0:n.metaData)!=null&&u.description){let g=((m=n==null?void 0:n.metaData)==null?void 0:m.title)||((h=n==null?void 0:n.metaData)==null?void 0:h.name);g&&e(_.default`{gray === ${g} ===}`),(R=n==null?void 0:n.metaData)!=null&&R.description&&e(_.default`{gray ${n.metaData.description}}`),e("")}let a=(s==null?void 0:s.request)||(n==null?void 0:n.request);if(a&&(i.useShort?e(_.default`{yellow ${(a==null?void 0:a.method)||"GET"}} {gray ${(a==null?void 0:a.url)||"?"}}`):i.requestOutput&&Xa(a,{headers:i.requestHeaders,bodyLength:i.requestBodyLength}).forEach(g=>e(g))),s)if(i.useShort)e(_.default`{gray =>} {cyan.bold ${s.statusCode}} ({yellow ${((k=s.timings)==null?void 0:k.total)||"?"} ms}, {yellow ${((C=s.meta)==null?void 0:C.size)||"?"}})`);else{let g=[];if(i.responseHeaders&&(g.length>0&&g.push(""),g.push(...Ya(s))),i.timings&&(g.length>0&&g.push(""),g.push(...Qa(s))),c(s.body)&&i.responseBodyLength!==void 0){let F=s.body;i.responseBodyPrettyPrint&&s.prettyPrintBody&&(F=s.prettyPrintBody),F=Yr(F,i.responseBodyLength),F&&(g.length>0&&g.push(""),g.push(F))}e(U(g))}if(n!=null&&n.testResults)for(let g of n.testResults){let F=_.default`{green ${J.ok} ${g.message||"Test passed"}}`;if(g.status==="SKIPPED")F=_.default`{yellow ${J.skipped} Test skipped}`;else if(["ERROR","FAILED"].includes(g.status)){let he=g.error?` (${(I=g.error)==null?void 0:I.displayMessage})`:"";if(F=_.default`{red ${J.error} ${g.message||"Test failed"}${he}}`,!(t!=null&&t.useShort)&&g.status==="ERROR"&&((b=g.error)!=null&&b.error.stack)){let Tt=Y(g.error.error.stack).slice(0,3);F=U([F,...Tt])}}e(F)}}}function Yr(e,t){let r=e;if(!(typeof t>"u"||t<0))return t>0&&(r=e.slice(0,Math.min(e.length,t)),e.length>=t&&(r+=`... (${e.length-t} characters more)`)),r}function Xa(e,t){var o,s,n,i;let r=[];return r.push(_.default`{cyan.bold ${e.method} ${e.url}}`),e.headers&&t.headers&&r.push(...Object.entries(e.headers).map(([a,d])=>_.default`{yellow ${a}}: ${d}`).sort()),E(e)&&((s=(o=e.options)==null?void 0:o.https)!=null&&s.certificate||(i=(n=e.options)==null?void 0:n.https)!=null&&i.pfx)&&r.push(_.default`{yellow client-cert}: true`),c(e.body)&&t.bodyLength!==void 0&&(r.push(""),r.push(_.default`{gray ${Yr(e.body,t.bodyLength)}}`)),r}function Ya(e){let t=[];return t.push(_.default`{cyan.bold ${e.protocol}} {cyan.bold ${e.statusCode}} {bold ${e.statusMessage?` - ${e.statusMessage}`:""}}`),e.headers&&t.push(...Object.entries(e.headers).filter(([r])=>!r.startsWith(":")).map(([r,o])=>_.default`{yellow ${r}}: ${o}`).sort()),t}function Qa(e){let t=[];return e.timings&&(t.push(_.default`{cyan.bold Timings}:`),t.push(...Object.entries(e.timings).filter(([,r])=>!!r).map(([r,o])=>_.default`{yellow ${r}}: ${o}`).sort())),t}function ys(e){return{url:e.url,method:e.method,body:e.body,contentType:e.contentType&&{...e.contentType},headers:e.headers&&{...e.headers},supportsStreaming:e.supportsStreaming}}function Qr(e){let t=e;return!!(t!=null&&t.statusCode)}function Zr(e){let t=ae(e);return delete t.rawBody,delete t.prettyPrintBody,delete t.request,t}function ae(e){return{name:e.name,protocol:e.protocol,statusCode:e.statusCode,statusMessage:e.statusMessage,httpVersion:e.httpVersion,headers:e.headers,body:e.body,rawHeaders:e.rawHeaders,rawBody:e.rawBody,parsedBody:e.parsedBody,prettyPrintBody:e.prettyPrintBody,contentType:e.contentType,timings:e.timings&&{...e.timings},meta:e.meta,tags:e.tags,request:e.request&&ys(e.request)}}function Za(e){let t={};for(let r=0;r<e.length;r+=2){let o=e[r],s=e[r+1];if(typeof s>"u")continue;let n=o.toLowerCase();t[n]=t[n]||[],t[n].push(s)}return t}function je(e,t){if(!e)throw new Error(t)}function eo(e,t){je(e.statusCode===t,`response status is ${e.statusCode} (expected: ${t})`)}function to(e,t){var r,o;je((r=e.timings)!=null&&r.total?e.timings.total<t:!0,`total time is ${(o=e.timings)==null?void 0:o.total} (expected max ${t})`)}function ro(e,t,r){let o=q(e.headers,t);je(o===r,`response header ${t} is ${o} (expected: ${r})`)}function oo(e,t,r){let o=q(e.headers,t);(c(o)||Array.isArray(o))&&je(!!o.indexOf(r),`response header contains ${r}`)}function so(e){console.assert(!!e.body,"response body exists")}function no(e){je(!e.body,"response body does not exists")}function io(e,t){je(e.body===t,`response body equals ${t}`)}function bs(e){return["ascii","utf8","utf-8","utf16le","ucs2","ucs-2","base64","latin1","binary","hex"].indexOf(e)>=0}function Ve(e){return e&&bs(e)?e:"utf8"}async function V(e,t){if(e){if(await p.isAbsolute(e)&&await p.exists(e))return e;if(t&&c(e)){let r=p.joinPath(t,e);if(await p.exists(r))return r}}}function ao(e){let t=p.toString(e),r=t.lastIndexOf(".");if(r>0&&r<t.length-2)return t.slice(r+1)}function el(e){return e.replace(/[/\\?%*:|"<>\s()@\-~,=$]/gu,"_").split("_").filter(r=>r.length>0).join("_")}function tl(e,t=50){let r=[],o=0;for(let n of e.split("_").reverse())n.length+o<t?(r.push(n),o+=n.length+1):r.length===0&&r.push(n);let s=r.reverse().join("_");return s.slice(Math.max(s.length-t,0))}async function Et(e,t,...r){let o=e,s=p.fsPath(e);!await p.isAbsolute(e)&&t&&s&&(o=p.joinPath(t,s));let n=p.dirname(o);return await Ot(n,...r)}async function Ot(e,...t){return At(e,async r=>{let o=await p.readdir(r);if(o.some(s=>t.indexOf(s)>=0))return!0;for(let s of t)if(o.some(n=>s.startsWith(n))&&await p.exists(p.joinPath(r,s)))return!0;return!1})}async function pe(e,t,r){return At(e,async o=>(await r(o),!!t&&lo(t,o)))}async function At(e,t){if(e){if(await t(e))return e;if(!lo(p.dirname(e),e))return At(p.dirname(e),t)}}function lo(e,t){return!!e&&!!t&&p.toString(e)===p.toString(t)}async function uo(e,t){let r;return t&&(r=await rl(t),r||(r=await ol(e,t)),r&&await xs(r,t)),r}var $t=[".httpyac.js",".httpyac.cjs",".httpyac.config.js",".httpyac.config.cjs","httpyac.config.js","httpyac.config.cjs",".httpyac.json","httpyac.config.json"];async function rl(e){let t;for(let r of $t){let o=r&&p.joinPath(e,r);if(o&&await p.exists(o)){t=p.fsPath(o);break}}if(t){let r=p.fsPath(e);if(r&&H.loadModule){let o=H.loadModule(t,r,!0);return typeof o=="function"?o():o}}}async function ol(e,t){let r=[];if(await pe(e,t,async o=>{var n;let s=(n=await dt(p.joinPath(o,"package.json")))==null?void 0:n.httpyac;s&&r.push(s)}),r.length>0)return Object.assign({},...r.reverse())}async function dt(e){try{if(await p.exists(e)){let t=await p.readFile(e,"utf-8");return JSON.parse(t)}}catch(t){f.debug(`json parse of ${e} failed`,t)}}async function xs(e,t){if(e.clientCertificates)for(let[,r]of Object.entries(e.clientCertificates))r.cert&&(r.cert=await V(r.cert,t)||r.cert),r.key&&(r.key=await V(r.key,t)||r.key),r.pfx&&(r.pfx=await V(r.pfx,t)||r.pfx)}async function po(e){let t=await sl(e),r={};if(t!=null&&t.json){let o=[...Object.keys(t.json.dependencies||{}),...Object.keys(t.json.devDependencies||{})].filter(nl);for(let s of o){let n=p.fsPath(t.dir);if(n&&H.loadModule){let i=H.loadModule(s,n);i&&(r[s]=i)}}}return r}async function sl(e){let t=await Ot(e,"package.json");if(t)return{dir:t,json:await dt(p.joinPath(t,"package.json"))}}function nl(e){return/^(httpyac-|@[\w-]+(\.)?[\w-]+\/httpyac-)plugin-/u.test(e)}var Rs="__NONE__";function B(e){return e&&e.length>0?e.sort().join(","):Rs}function te(e){if(!e)return!1;if(e instanceof Error)return!0;let t=e;return!!t.message&&!!t.stack&&!!t.name}function He(e){var t;if(e.stack){let r=/^(?<error>.*):\s*(?<message>.*)\r?\n\s*at (?<file>.*):(?<line>\d*):(?<offset>\d*)/mu.exec(e.stack);if(r&&((t=r.groups)!=null&&t.error))return{error:e,errorType:r.groups.error,message:r.groups.message,file:r.groups.file,line:r.groups.line,offset:r.groups.offset,displayMessage:`${r.groups.error}: ${r.groups.message} - ${r.groups.file}:${r.groups.line}:${r.groups.offset}`}}return{error:e,displayMessage:e.message}}function il(e){return te(e)?O({message:e.message,name:e.name,stack:e.stack}):x(e)}async function Ce(e,t){try{return await e}catch(r){return f.warn("promise has read error",r),t}}var Ss=require("hookpoint");var fo=require("hookpoint");function T(e,t){var r,o;f.debug(t),(o=(r=e.progress)==null?void 0:r.report)==null||o.call(r,{message:t})}async function mo(e,t){var n,i;let r=[],o=1;(n=t.repeat)!=null&&n.count&&t.isMainContext&&(o=t.repeat.count);for(let a=0;a<o;a++)r.push(e);let s=[];if(((i=t.repeat)==null?void 0:i.type)===1){let a=await Promise.all(r.map(d=>d()));for(let d of a)d&&a.push(d)}else for(let a of r){let d=await a();d&&s.push(d)}return Dt(s)}function Dt(e){if(e.length>1){let t=ae(e[0]);delete t.prettyPrintBody,delete t.rawBody,delete t.meta,delete t.timings;let r={responses:[],statusCount:{},count:e.length},o=[];for(let s of e){s.statusCode>t.statusCode&&(t.statusCode=s.statusCode,t.statusMessage=s.statusMessage);let n=`${s.statusCode}`;r.statusCount[n]?r.statusCount[n]+=1:r.statusCount[n]=1,s.timings&&o.push(s.timings),delete s.prettyPrintBody,delete s.parsedBody,delete s.rawBody,r.responses.push(ae(s)),o.length>0&&(t.timings=al(o))}return t.parsedBody=r,t.body=O(r,2),t}return e.pop()}function al(e){let t=[],r=[],o=[],s=[],n=[],i=[],a=[],d=[];for(let u of e)t.push(u.dns||0),r.push(u.download||0),o.push(u.firstByte||0),s.push(u.request||0),n.push(u.tcp||0),i.push(u.tls||0),a.push(u.total||0),d.push(u.wait||0);let l=u=>{let m=u.filter(h=>h>0);if(m.length>0)return m.reduce((h,R)=>h+R,0)/m.length};return{dns:l(t),download:l(r),firstByte:l(o),request:l(s),tcp:l(n),tls:l(i),total:l(a),wait:l(d)}}var vs=require("hookpoint");async function $(e,t,r){var o,s;return(s=(o=r.progress)==null?void 0:o.isCanceled)!=null&&s.call(o)?(f.trace("process canceled by user"),vs.HookCancel):await r.httpFile.hooks.replaceVariable.trigger(e,t,r)}async function le(e,t,r){var s,n,i,a;let o=await $(e,"FilePath",t);if(c(o)){let d=await V(o,p.dirname(t.httpFile.fileName));if(d)return await r(d);let l=`file not found: ${e}`;(n=(s=L).showWarnMessage)==null||n.call(s,l),f.warn(l)}else{let d=`file replace made file invalid: ${e} <> ${o}`;(a=(i=L).showWarnMessage)==null||a.call(i,d),f.warn(d)}}function ks(e,t){if(e&&c(e)){let r=e,o,s=/\{{2}\s*([a-zA-Z0-9_]+)\s*\}{2}/gu;for(;(o=s.exec(r))!==null;){let[n,i]=o,a=ks(t[i],t);t[i]=a,r=r.replace(n,()=>`${a}`)}return r}return e}function D(e,t){if(e){let r=It(e);Object.assign(t.variables,r);let o=B(t.activeEnvironment);t.httpRegion.variablesPerEnv[o]||(t.httpRegion.variablesPerEnv[o]={}),Object.assign(t.httpRegion.variablesPerEnv[o],r)}}function It(e){return Object.fromEntries(Object.entries(e).filter(([t])=>!H.isAllowedKeyword||H.isAllowedKeyword(t)))}function Se(e,t){delete t.variables[e];let r=B(t.activeEnvironment);t.httpRegion.variablesPerEnv[r]&&delete t.httpRegion.variablesPerEnv[r][e]}function ll(e,t){let r=B(t.activeEnvironment),o=t.httpRegion.variablesPerEnv[r];for(let s of Object.keys(e))delete t.variables[s],o&&delete o[s]}var Hs=require("uuid");function co({httpRegion:e},t){return async function(o,s){var i;let n={message:o,status:"SUCCESS"};if(typeof s=="function")try{await s(n)}catch(a){Ps(n,a),t.ignoreErrorFile&&((i=n.error)!=null&&i.errorType)&&(n.error.displayMessage=`${n.error.errorType}: ${n.error.message}`)}me(e,n)}}function Ps(e,t){e.status="FAILED",te(t)?e.error=He(t):e.error={displayMessage:`${t}`,error:new Error(`${t}`)}}function ut({httpRegion:e,variables:t}){let r=function(n,i){let a={message:n,status:"SUCCESS"};if(typeof i=="function")try{i()}catch(d){Ps(a,d)}me(e,a)};function o(){return Qr(t.response)?t.response:e.response}return r.status=s=>{let n=o();n&&r(`response status equals to ${s}`,()=>eo(n,s))},r.totalTime=s=>{let n=o();n&&r(`total time exceeded ${s}`,()=>to(n,s))},r.header=(s,n)=>{let i=o();i&&r(`response header ${s} equals ${n}`,()=>ro(i,s,n))},r.headerContains=(s,n)=>{let i=o();i&&r(`response header ${s} contains ${n}`,()=>oo(i,s,n))},r.responseBody=s=>{let n=o();n&&r(`response body equals ${s}`,()=>io(n,s))},r.hasResponseBody=()=>{let s=o();s&&r("response body exists",()=>so(s))},r.hasNoResponseBody=()=>{let s=o();s&&r("response body does not exists",()=>no(s))},r}function me(e,t){e.testResults||(e.testResults=[]),e.testResults.push(t)}function Q(e,t="request is skipped"){me(e,{message:t,status:"SKIPPED"})}function go(e,t){return async function(r){var s;let{request:o}=r;if(o!=null&&o.url){if(!await fl(r))return!1;let n=e(o,r);D({$requestClient:n},r),r.requestClient=n;let i=ul(n,r),a=((s=n.getSessionId)==null?void 0:s.call(n))||(0,Hs.v4)(),d=yl(t,a,o,()=>{n.disconnect(new Error("user cancellation"))});try{let l=[];pl(n,r),ml(n,r,l),cl(n,r,l),T(r,n.reportMessage);let u=await n.connect(d.connection);f.debug(`requestClient ${o.url} connect`),d.connectionCount++,u!==d.connection&&(d.connection=u),await Promise.all([mo(()=>n.send(),r),gl(r).then(()=>{var R;(R=n.streamEnded)==null||R.call(n)})]);let m=await Promise.all(l),h=Dt(dl(...m));return h&&!await hl(h,r)?!1:(d.connectionCount--,ws(t,d)&&(f.debug(`requestClient ${o.url} disconnect`),n.disconnect()),!0)}catch(l){throw d.connectionCount--,ws(t,d)&&((r.scriptConsole||f).error(r.request),f.debug(`requestClient ${o.url} disconnect`),te(l)?n.disconnect(l):n.disconnect(new Error(x(l)))),l}finally{n.triggerEnd(),i==null||i(),delete r.requestClient,Se("$requestClient",r)}}return!1}}function dl(...e){let t=[];for(let r of e)r&&t.push(r);return t}function ul(e,t){var r,o;if((r=t.progress)!=null&&r.register)return(o=t.progress)==null?void 0:o.register(()=>{Q(t.httpRegion,"user cancellation"),e.disconnect(new Error("user cancellation"))})}function pl(e,t){var r;if(t.isMainContext&&((r=t.progress)!=null&&r.report)){let o=0;e.addEventListener("progress",s=>{var a;let n=s.detail,i=n-o;if(o=n,(a=t.progress)!=null&&a.report){f.trace(`progress to ${n}`);let d=t.progress.divider||1;t.progress.report({message:"request progress",increment:i/d*100})}})}}function ml(e,t,r){e.addEventListener("message",o=>{let[s,n]=o.detail;f.debug(s,(n==null?void 0:n.message)||(n==null?void 0:n.body)),r.push(Promise.resolve(n)),e.supportsStreaming&&!t.httpRegion.metaData.noStreamingLog&&t.logStream&&r.push(t.logStream(s,{...n}))})}function cl(e,t,r){e.addEventListener("metaData",o=>{let[s,n]=o.detail;f.debug(`event ${s} for ${n.protocol}`,(n==null?void 0:n.message)||(n==null?void 0:n.body)),t.httpRegion.metaData.metaDataLogging&&t.logStream&&r.push(t.logStream(s,n))})}async function fl(e){let t=e.hooks.onRequest;return e.progress&&t.addInterceptor(Cs(()=>{var r;return!!((r=e.progress)!=null&&r.isCanceled())})),e.request&&await t.trigger(e.request,e)!==fo.HookCancel}async function gl(e){let t=e.hooks.onStreaming;e.progress&&t.addInterceptor(Cs(()=>{var r;return!!((r=e.progress)!=null&&r.isCanceled())})),await t.trigger(e)}async function hl(e,t){return await t.hooks.onResponse.trigger(Ft(e),t)===fo.HookCancel?!1:(t.httpRegion.response=e,!0)}function Cs(e){return{id:"isCanceled",async beforeTrigger(){return!e()},async afterTrigger(){return!e()}}}function Ft(e){return new Proxy(e,{set(...r){let[o,s,n]=r,i=Reflect.set(...r);return s==="body"&&(delete o.prettyPrintBody,delete o.parsedBody,delete o.rawBody,typeof n=="string"&&(o.rawBody=Buffer.from(n))),i}})}function yl(e,t,r,o){let s=e.getUserSession(t);if(s!=null&&s.connection)return s;let n={id:t,description:"Pending Connection",details:{method:r.method,url:r.url},title:`${r.method} ${r.url}`,type:"Stream",connectionCount:0,delete:o};return e.setUserSession(n),n}function ws(e,t){return t.connectionCount<=0&&(delete t.delete,e.removeUserSession(t.id)),t.connectionCount===0}function pt(e,t="global"){var r,o,s,n;if(e){if(c(e.metaData.title))return e.metaData.title;if(c(e.metaData.name))return e.metaData.name;if((r=e.request)!=null&&r.url){let i=e.request.url.indexOf("?");i<0&&(i=e.request.url.length);let a=((n=(s=(o=e.symbol.children)==null?void 0:o.find)==null?void 0:s.call(o,d=>d.kind==="requestLine"))==null?void 0:n.startLine)||e.symbol.startLine;return`${e.request.method} ${e.request.url.slice(0,i)} (line: ${a+1})`}}return t}function ho(e,t="-"){var r;return c(e.metaData.description)?e.metaData.description:(r=e.request)!=null&&r.url?`${e.request.method} ${e.request.url}`:t}async function Te(e,t){let r;e&&(r=ae(e),await t.hooks.responseLogging.trigger(Ft(r),t)===Ss.HookCancel)||!t.httpRegion.metaData.noLog&&t.logResponse&&await t.logResponse(r,t.httpRegion)}async function Be(e){for(let t of e.httpFile.globalHttpRegions)if(!await t.execute(e))return!1;return!0}function mt(e,t){return{onRequest:t.hooks.onRequest.merge(...t.globalHttpRegions.map(r=>r.hooks.onRequest),e.onRequest),onResponse:t.hooks.onResponse.merge(e.onResponse,...t.globalHttpRegions.map(r=>r.hooks.onResponse)),onStreaming:t.hooks.onStreaming.merge(e.onStreaming,...t.globalHttpRegions.map(r=>r.hooks.onStreaming)),responseLogging:t.hooks.responseLogging.merge(e.responseLogging,...t.globalHttpRegions.map(r=>r.hooks.responseLogging))}}function bl(e,t){let r=[];return e.request&&(r.push(...Ls(e.request,{body:!!(t!=null&&t.requestBody)})),r.push("")),r.push(...Ts(e,{prettyPrint:!!(t!=null&&t.prettyPrint),body:!!(t!=null&&t.responseBody)})),U(r)}function Ts(e,t){let r=[];return r.push(`${e.protocol} ${e.statusCode} ${e.statusMessage?` - ${e.statusMessage}`:""}`),e.headers&&r.push(...yo(e.headers)),t!=null&&t.body&&c(e.body)&&(r.push(""),r.push(t!=null&&t.prettyPrint&&e.prettyPrintBody?e.prettyPrintBody:e.body)),r}function Ls(e,t){let r=[];return r.push(`${e.method} ${e.url}`),e.headers&&r.push(...yo(e.headers)),t!=null&&t.body&&c(e.body)&&(r.push(""),r.push(e.body)),r}function yo(e){return Object.entries(e).map(([t,r])=>{let o=r||"";return r&&(Array.isArray(r)?o=r.join(", "):c(r)||(o=O(r))),`${t}: ${o}`})}function xl(e,t){let r=[];return e.request&&(r.push(...Os(e.request,{body:!!(t!=null&&t.requestBody)})),r.push("")),r.push(...qs(e,{prettyPrint:!!(t!=null&&t.prettyPrint),body:!!(t!=null&&t.responseBody)})),t!=null&&t.testResults&&(r.push(""),r.push(""),r.push(...As(t.testResults))),t!=null&&t.timings&&e.timings&&(r.push(""),r.push(""),r.push(...Ds(e.timings))),t!=null&&t.meta&&e.meta&&(r.push(""),r.push(""),r.push(...$s(e.meta))),jt(r)}function qs(e,t){let r=[];if(r.push(`\`${e.protocol} ${e.statusCode}${e.statusMessage?` - ${e.statusMessage}`:""}\``),e.headers&&r.push(...bo(e.headers)),t!=null&&t.body&&c(e.body)){r.push(""),r.push(`\`\`\`${Es(e.contentType)}`);let o=t.prettyPrint&&e.prettyPrintBody?e.prettyPrintBody:e.body;r.push(jt(Y(o))),r.push("```")}return r}function Es(e){return at(e)?"json":Nr(e)?"xml":Ur(e)?"html":Mr(e)?"js":_r(e)?"css":lt(e)?"markdown":""}function Os(e,t){let r=[];return r.push(`\`${e.method} ${e.url}\``),e.headers&&r.push(...bo(e.headers)),t!=null&&t.body&&c(e.body)&&(r.push(""),r.push("```json"),r.push(jt(Y(e.body))),r.push("```")),r}function As(e){let t=[];t.push("`TestResults`"),t.push("");for(let r of e){let o=`${J.ok}: ${r.message}`;r.status==="SKIPPED"?o=`${J.skipped}: ${r.message}`:["FAILED","ERROR"].includes(r.status)&&(o=`${J.error}: ${r.message}`,r.error&&(o+=` (${r.error.displayMessage})`)),t.push(o)}return t}function bo(e){return Object.entries(e).map(([t,r])=>{let o=r||"";return r&&(Array.isArray(r)?o=r.join(", "):c(r)||(o=O(r))),`*${t}*: ${o}`}).sort()}function $s(e){let t=[];t.push("`Meta`"),t.push("");for(let[r,o]of Object.entries(e))Array.isArray(o)?o.length>0&&t.push(`*${r}*: ${o.join(",")}`):t.push(`*${r}*: ${o}`);return t}function Ds(e){let t=[];return t.push("`Timings`"),t.push(""),e.wait&&t.push(`*Wait*: ${e.wait} ms`),e.dns&&t.push(`*DNS*: ${e.dns} ms`),e.tcp&&t.push(`*TCP*: ${e.tcp} ms`),e.tls&&t.push(`*TLS*: ${e.tls} ms`),e.request&&t.push(`*Request*: ${e.request} ms`),e.firstByte&&t.push(`*First Byte*: ${e.firstByte} ms`),e.download&&t.push(`*Download*: ${e.download} ms`),e.total&&t.push(`*Total*: ${e.total} ms`),t}function jt(e){return e.join(`  ${p.EOL}`)}function Rl(e){let t=e;return!!(t!=null&&t.accessToken)}function vl(e){let t=e;return!!(t!=null&&t.httpRegion)&&!!(t!=null&&t.httpFile)&&!!(t!=null&&t.variables)&&!!(t!=null&&t.config)}var ct=/\{{2}\s*(.+?)\s*\}{2}/gu,Le=/^\s*#{3,}(?<title>.*)$/u,kl=/^\s*(?<type>openid|oauth2)(\s+(?<flow>client(_credentials)?|(authorization_)?code|device(_code)?|password|implicit|hybrid))?(\s+(?<variablePrefix>[^\s]*))?\s*((token_exchange)\s+(?<tokenExchangePrefix>[^\s]*))?\s*$/iu;async function Vt(e,t,r){let o={parseResults:[]},s=e.next();for(;!s.done;){let n=!1;for(let i of t){let a=await i(s.value,r);if(a){o.parseResults.push(a),n=!0;break}}if(!n)break;o.nextLine=s.value.line,s=e.next()}return o}function Bt(e){return async function(r){var s;let o=/^\s*(?<key>[!#$%&'*+\-.^_`|~0-9A-Za-z]+)\s*:\s*(?<value>.*?),?\s*$/u.exec(r.textLine);if((s=o==null?void 0:o.groups)!=null&&s.key){let n=o.groups.key,i=o.groups.value,a=e[n];a?Array.isArray(a)?a.push(i):e[n]=[a,i]:e[n]=i;let d=r.textLine.indexOf(i);return{symbols:[new v({name:n,description:i,kind:"requestHeader",startLine:r.line,startOffset:r.textLine.indexOf(n),endLine:r.line,endOffset:r.textLine.length,children:[new v({name:n,description:"request header key",kind:"key",startLine:r.line,startOffset:r.textLine.indexOf(n),endLine:r.line,endOffset:r.textLine.indexOf(n)+n.length}),i?new v({name:i,description:"request header value",kind:"value",startLine:r.line,startOffset:d,endLine:r.line,endOffset:d+i.length,children:re(i,r.line,d)}):void 0].filter(l=>!!l)})]}}return!1}}function Ro(e=(t,r)=>{r.request&&(r.request.headers?Object.assign(r.request.headers,t):r.request.headers=t)}){return async function(r,o){var n;let s=/^\s*\.{3}(?<variableName>[^\s]+),?\s*$/u.exec(r.textLine);if((n=s==null?void 0:s.groups)!=null&&n.variableName){let i=new xo(s.groups.variableName,e);o.httpRegion.hooks.execute.addObjHook(d=>d.process,i);let a=r.textLine.trim();return{symbols:[new v({name:a||"hader variable",description:"Header Variable",kind:"requestHeader",startLine:r.line,startOffset:r.textLine.indexOf(a),endOffset:r.textLine.length,endLine:r.line,children:[new v({name:s.groups.variableName,description:"Header Variable",kind:"variable",startLine:r.line,startOffset:s.index,endOffset:s.groups.variableName.length,endLine:r.line})]})]}}return!1}}var xo=class{constructor(t,r){this.data=t;this.setHeaders=r;this.id="defaultHeaders"}async process(t){if(this.data&&t.variables){T(t,"set request headers");let r=await H.evalExpression(this.data,t);r&&this.setHeaders(Object.assign({},r),t)}return!0}};function vo(e){return async function(r){if(/^\s*(\/)[^*]*$/u.test(r.textLine)){let o=r.textLine.trim();return e(o),{symbols:[new v({name:o||"URL Part",description:"URL Part",kind:"url",startLine:r.line,startOffset:r.textLine.indexOf(o),endOffset:r.textLine.length,endLine:r.line,children:re(r.textLine,r.line)})]}}return!1}}function ko(e){return async function(r){if(/^\s*(\?|&)((([^(=?&)]+)=(.*))|\{\{.*\}\})\s*$/u.test(r.textLine)){let o=r.textLine.trim();return e(o),{symbols:[new v({name:o||"Query",description:"Query",kind:"url",startLine:r.line,startOffset:r.textLine.indexOf(o),endOffset:r.textLine.length,endLine:r.line,children:re(r.textLine,r.line,0)})]}}return!1}}async function ft(e,t,r=/^\s*((#\s+)|(\/{2}))/u){var o;if(r.test(e.textLine)){let s={symbols:[new v({name:"comment",description:e.textLine,kind:"metaData",startLine:e.line,startOffset:0,endLine:e.line,endOffset:e.textLine.length})]},n=/^\s*(#+|\/{2,})\s+@(?<key>[^\s]*)(\s+)?"?(?<value>.*)?"?$/u.exec(e.textLine);if(n&&n.groups&&n.groups.key){let i=n.groups.key.replace(/-./gu,d=>d[1].toUpperCase());s.symbols[0].children=[new v({name:i||"metadata",description:n.groups.value||"-",kind:"metaData",startLine:e.line,startOffset:0,endLine:e.line,endOffset:e.textLine.length,children:[new v({name:i||"metadata key",description:((o=Is.find(d=>d.name===i))==null?void 0:o.description)||"key of meta data",kind:"key",startLine:e.line,startOffset:e.textLine.indexOf(n.groups.key),endLine:e.line,endOffset:e.textLine.indexOf(n.groups.key)+n.groups.key.length})]})];let a;n.groups.value&&(a=n.groups.value.trim(),s.symbols[0].children.push(new v({name:n.groups.value||"metadata value",description:"value of meta data",kind:"value",startLine:e.line,startOffset:e.textLine.indexOf(n.groups.value),endLine:e.line,endOffset:e.textLine.indexOf(n.groups.value)+n.groups.value.length}))),t.httpRegion.metaData=Object.assign(t.httpRegion.metaData||{},{[i]:a||!0}),await t.httpFile.hooks.parseMetaData.trigger(i,a,t)}return s}return!1}var Is=[{name:"name",description:"responses of a requests with a name are automatically added as variables and can be reused by other requests",completions:["${1}"]},{name:"debug",description:"enable debug log level"},{name:"description",description:"additional description of region",completions:["${1}"]},{name:"disabled",description:"requests can be disabled"},{name:"extension",description:"extension of file for save or openWith.",completions:["${1}"]},{name:"forceRef",description:"When the request is called, it is ensured that the referenced request is always called beforehand",completions:["${1}"]},{name:"import",description:"reference Requests from other files.",completions:["${1}"]},{name:"injectVariables",description:"Inject Variables in request body (needed because of compatibility with Intellij)."},{name:"jwt",description:"supports auto decode of jwt token."},{name:"language",description:"language id of the response view",completions:["${1}"]},{name:"loop",description:"allows multiple Invocations of a Request with different parameters.",completions:["for ${1} of ${2}","for ${1}","while ${1}"]},{name:"keepStreaming",description:"keep streaming until the user session is ended manually"},{name:"noLog",description:"prevent logging of request data in output console"},{name:"noCookieJar",description:"cookieJar support is disabled for this request"},{name:"noClientCert",description:"SSL client certificate is not send for this request"},{name:"noProxy",description:"disable proxy for this request"},{name:"noRejectUnauthorized",description:"all invalid SSL certificates will be ignored and no error will be thrown."},{name:"noResponseView",description:"prevent output in editor document."},{name:"noStreamingLog",description:"prevent logging of streaming request data in output console"},{name:"note",description:"shows a confirmation dialog before sending request",completions:["${1}"]},{name:"openWith",description:"viewType of custom editor to preview files",completions:["${1}"]},{name:"ref",description:"When the request is called, it is ensured that the referenced request is called beforehand",completions:["${1}"]},{name:"ratelimit",description:"allows throttling requests",completions:["minIdleTime ${1}","max ${1} expire ${2}","minIdleTime ${1} max ${2} expire ${3}"]},{name:"save",description:"If specified, the response will not be displayed but saved directly."},{name:"sleep",description:"wait specified milliseconds, before next step.",completions:["${1}"]},{name:"title",description:"additional title of region",completions:["${1}"]},{name:"timeout",description:"set timeout for request",completions:["${1}"]},{name:"verbose",description:"enable trace log level"}],Pl=100;async function M(e,t){if(!c(e))return e;let r,o,s=e,n=0;for(;o!==s&&n++<Pl;)for(o=s;(r=ct.exec(o))!==null;){let[i,a]=r,d=await t(a,i);if(typeof d<"u"&&i===e)return d;let l=d===null?"null":x(d);typeof l<"u"&&(s=s.replace(i,()=>l))}return s}function re(e,t,r=0){let o=[];if(e){let s;for(;(s=ct.exec(e))!==null;){let[n,i]=s;o.push(new v({name:i||"variable",description:i,startLine:t,endLine:t,kind:"variable",startOffset:r+s.index,endOffset:r+s.index+n.length,source:i}))}}return o}async function Po(e,t,r){var n,i;let o=e(),s=o.next();if(!s.done){if(t.data.httpResponseSymbol){let d=t.data.httpResponseSymbol;return d.body.push(s.value.textLine),d.symbol.endLine=s.value.line,d.symbol.endOffset=s.value.textLine.length,{nextParserLine:s.value.line,symbols:[]}}let a=r.exec(s.value.textLine);if(a&&((n=a.groups)!=null&&n.statusCode)){let d={};t.httpRegion.response={protocol:`HTTP/${a.groups.httpVersion||"1.1"}`,httpVersion:a.groups.httpVersion,statusCode:+a.groups.statusCode,statusMessage:a.groups.statusMessage,headers:d};let l=new v({name:"response",description:"response",kind:"response",startLine:s.value.line,startOffset:0,endLine:s.value.line,endOffset:s.value.textLine.length,children:[]});t.data.httpResponseSymbol={symbol:l,body:[]};let u=[t.data.httpResponseSymbol.symbol],m={nextParserLine:s.value.line,symbols:u},h=await Vt(o,[Bt(d)],t);m.nextParserLine=h.nextLine||m.nextParserLine;for(let R of h.parseResults)for(let k of R.symbols)(i=l.children)==null||i.push(k),l.endLine=k.endLine,l.endOffset=k.endOffset;return m}}return!1}function gt(e){let t=/^<(?:(?<injectVariables>@)(?<encoding>\w+)?)?\s+(?<fileName>.+?)\s*$/u.exec(e);if(t&&t.length===4&&t.groups)return{fileName:t.groups.fileName.trim(),injectVariables:!!t.groups.injectVariables,encoding:Ve(t.groups.encoding)}}function wo(e){return async function(r,o){var i,a,d;let s=r(),n=s.next();if(!n.done&&Cl(n.value,o,e)){if(o.httpRegion.request)return{endRegionLine:n.value.line-1,nextParserLine:n.value.line-1,symbols:[]};let l=Hl(n.value,e);if(!l)return!1;o.httpRegion.request=l.request;let u=new v({name:n.value.textLine||"request line",description:`${e.protocol} request-line`,kind:"requestLine",startLine:n.value.line,startOffset:0,endLine:n.value.line,endOffset:n.value.textLine.length,children:[l.symbol]}),m={nextParserLine:n.value.line,symbols:[u]},h={};l.request.headers=h;let R=await Vt(s,[ft,Bt(h),Ro(),ko(k=>l.request.url+=k),vo(k=>l.request.url+=k)],o);m.nextParserLine=R.nextLine||m.nextParserLine;for(let k of R.parseResults)(a=(i=m.symbols)==null?void 0:i.push)==null||a.call(i,...k.symbols);if((d=e.modifyRequest)==null||d.call(e,l.request),l.request.headers){let k=q(l.request.headers,"content-type");c(k)&&(l.request.contentType=it(k))}return o.httpRegion.hooks.execute.addHook(e.protocol.toLowerCase(),go(e.requestClientFactory,e.sessionStore)),m}return!1}}function Hl(e,t){var s,n,i,a;let r=t.methodRegex.exec(e.textLine);if(r&&r.length>1&&r.groups)return{request:{url:r.groups.url,protocol:t.protocol.toUpperCase(),method:((s=r.groups)==null?void 0:s.method)||t.method||t.protocol},symbol:new v({name:r.groups.url||"request",description:`${t.protocol} Url`,kind:"url",startLine:e.line,startOffset:0,endLine:e.line,endOffset:e.textLine.length,children:re(e.textLine,e.line)})};let o=(n=t.protocolRegex)==null?void 0:n.exec(e.textLine);if(o&&o.length>1&&((i=o.groups)!=null&&i.url))return{request:{url:o.groups.url,protocol:t.protocol.toUpperCase(),method:((a=o.groups)==null?void 0:a.method)||t.method||t.protocol},symbol:new v({name:o.groups.url||"request",description:`${t.protocol} Url`,kind:"url",startLine:e.line,startOffset:0,endLine:e.line,endOffset:e.textLine.length,children:re(e.textLine,e.line)})}}function Cl(e,t,r){var o,s,n,i;return ke(e.textLine)||t.forceRegionDelimiter&&t.httpRegion.request?!1:(s=(o=r.methodRegex.exec(e.textLine))==null?void 0:o.groups)!=null&&s.url?!0:!t.httpRegion.request&&r.protocolRegex?!!((i=(n=r.protocolRegex.exec(e.textLine))==null?void 0:n.groups)!=null&&i.url):!1}function Ho(e){let t=e;return!!(t!=null&&t.httpRegion)}function Co(e){let t=e;return Array.isArray(t==null?void 0:t.httpRegions)}function Me(e,t){let r=t.httpFile.findHttpRegion(e);if(r)return r;if(t.options.httpFiles)for(let{ref:o}of t.options.httpFiles.filter(s=>s.base===t.httpFile)){let s=o.findHttpRegion(e);if(s)return s}}async function ht(e,t,r){var s,n;let o=await le(e,r,async i=>{f.debug(`parse imported file ${i}`),r.options.httpFiles||(r.options.httpFiles=[]);let a=r.options.httpFiles.filter(l=>l.ref.fileName===i);if(a.length>0){let l=a[0].ref;return a.some(u=>u.base===r.httpFile)||r.options.httpFiles.push({base:r.httpFile,ref:l}),l}let d=await t.getOrCreate(i,async()=>await p.readFile(i,"utf-8"),0,{workingDir:r.httpFile.rootDir,config:r.config});return r.hooks=mt(r.hooks,d),r.options.httpFiles.push({base:r.httpFile,ref:d}),d});if(o&&(!r.options.globalScriptsExecuted||((n=(s=r.options.globalScriptsExecuted).indexOf)==null?void 0:n.call(s,o))<0)){r.options.globalScriptsExecuted||(r.options.globalScriptsExecuted=[]),f.debug(`execute global scripts for import ${o.fileName}`),r.options.globalScriptsExecuted.push(o);let i={...r,httpFile:o};return await Be(i)}return!!o}function Ne(e){let t=e;return t&&!!t.then}function ce(e){return new Promise(t=>setTimeout(t,e))}async function So(e,...t){let r=[],o=async()=>{let n;for(;n=t.shift();)r.push(await n())},s=[];for(let n=0;n<e;n++)s.push(o());return await Promise.all(s),r}var Fs=A(require("dayjs")),js=require("uuid"),yt={alphabetic:(e=10)=>G(e,"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz"),numeric:(e=10)=>G(e),hexadecimal:(e=10)=>G(e,"1234567890ABCDEF"),email:Ue,float:(e=0,t=100)=>Math.random()*(t-e)+e,integer:(e=0,t=100)=>Math.floor(Math.random()*(t-e)+e),uuid:()=>(0,js.v4)(),date:(e=new Date,t=void 0)=>(0,Fs.default)(e).format(t)};function Ue(){return`${G(30)}@${G(10)}.${To(["com","org","at","de","fr","uk","it","ch","info","edu","asia","gov","app","io"])}`}function G(e,t="ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz0123456789_"){let r=[];if(e>0){let o=t.split("");for(let s=0;s<e;s++)r.push(To(o))}return r.join("")}function To(e){return e[Math.floor(Math.random()*(e.length-1))]}var qe=require("fs"),Vs=require("os"),fe=require("path");async function Lo(){Bs(),await Ll(),Sl()}function Sl(){process.platform==="win32"&&(J.ok="[x]",J.error="[-]",J.skipped="[*]")}function Bs(){p.EOL=Vs.EOL,p.isAbsolute=async e=>(0,fe.isAbsolute)(p.toString(e)),p.dirname=e=>(0,fe.dirname)(p.toString(e)),p.hasExtension=(e,...t)=>{let r=(0,fe.extname)(p.toString(e));return r.startsWith(".")&&(r=r.slice(1)),t.indexOf(r)>=0},p.joinPath=(e,t)=>(0,fe.join)(p.toString(e),t),p.exists=async e=>{try{return!!await qe.promises.stat(p.toString(e))}catch{return!1}},p.readFile=async(e,t)=>{let r=p.fsPath(e);if(r)return qe.promises.readFile(r,t);throw new Error("No valid path for cli")},p.readBuffer=async e=>{let t=p.fsPath(e);if(t){let r=(0,qe.createReadStream)(t);return Tl(r)}throw new Error("No valid path for cli")},p.writeBuffer=(e,t)=>qe.promises.writeFile(p.toString(e),t),p.readdir=async e=>qe.promises.readdir(p.toString(e))}function Tl(e){return new Promise((t,r)=>{let o=[];e.on("data",s=>{Buffer.isBuffer(s)?o.push(s):o.push(Buffer.from(s))}),e.on("end",()=>t(Buffer.concat(o))),e.on("error",s=>r(s)),e.resume()})}async function Ll(){L.showNote=async function(t){return console.log(`Note: ${t}`),!0},L.showInputPrompt=async function(t,r,o){if(r!==void 0)return r;throw new Error("Interactive input not supported in uctest. Use --var to pass values.")},L.showListPrompt=async function(t,r){if(r.length>0)return r[0];throw new Error("Interactive selection not supported in uctest.")},L.getClipboard=async function(){return""},L.setClipboard=async function(t){}}var ze=A(require("chalk")),Ha=require("commander"),St=require("fs"),ge=require("path");var Ks=require("assert");var Mt=class{constructor(){this.id=["endsWith"]}match(t,r){let o=x(t),s=x(r);return o&&s?o==null?void 0:o.endsWith(s):!1}};var Nt=class{constructor(){this.id=["==","===","equals"]}match(t,r){return typeof t=="object"?O(t)===O(r):t===r}};var Ut=class{constructor(){this.id=["exists","isTrue"]}match(t){return!!t}};var _t=class{constructor(){this.id=[">="]}match(t,r){let o=P(t),s=P(r);return o!==void 0&&s!==void 0?o>=s:!1}};var Kt=class{constructor(){this.id=[">"]}match(t,r){let o=P(t),s=P(r);return o!==void 0&&s!==void 0?o>s:!1}};var Gt=class{constructor(){this.id=["contains","includes"]}match(t,r){let o=x(t),s=x(r);return o&&s?o.includes(s):Array.isArray(t)?t.indexOf(r)>=0:!1}};var Wt=class{constructor(){this.id=["isArray"]}match(t){return Array.isArray(t)}};var Jt=class{constructor(){this.id=["isBoolean"]}match(t){return typeof t=="boolean"}};var zt=class{constructor(){this.id=["isFalse"]}match(t){return!t}};var Xt=class{constructor(){this.id=["isNumber"]}match(t){return typeof t=="number"}};var Yt=class{constructor(){this.id=["isString"]}match(t){return typeof t=="string"}};var Qt=class{constructor(){this.id=["<="]}match(t,r){let o=P(t),s=P(r);return o!==void 0&&s!==void 0?o<=s:!1}};var Zt=class{constructor(){this.id=["<"]}match(t,r){let o=P(t),s=P(r);return o!==void 0&&s!==void 0?o<s:!1}};var er=class{constructor(){this.id=["matches"];this.noAutoConvert=!0}match(t,r){let o=x(t),s=x(r);return o&&s?new RegExp(s,"u").test(o):!1}};var Ms=require("crypto");var tr=class{constructor(){this.id=["md5"];this.noAutoConvert=!0}match(t,r){let o=ie(t);return o?(0,Ms.createHash)("md5").update(o).digest("base64")===r:!1}};var rr=class{constructor(){this.id=["!=","!==","not equals"]}match(t,r){return t!==r}};var Ns=require("crypto");var or=class{constructor(){this.id=["sha256"];this.noAutoConvert=!0}match(t,r){let o=ie(t);return o?(0,Ns.createHash)("sha256").update(o).digest("base64")===r:!1}};var Us=require("crypto");var sr=class{constructor(){this.id=["sha512"];this.noAutoConvert=!0}match(t,r){let o=ie(t);return o?(0,Us.createHash)("sha512").update(o).digest("base64")===r:!1}};var nr=class{constructor(){this.id=["startsWith"]}match(t,r){let o=x(t),s=x(r);return o&&s?o==null?void 0:o.startsWith(s):!1}};var _s=[new Mt,new Nt,new Ut,new _t,new Kt,new Gt,new Wt,new Jt,new Xt,new Yt,new Qt,new Zt,new er,new rr,new nr,new or,new tr,new sr,new zt];async function Gs(e,{httpRegion:t}){let o=e().next();if(!o.done&&o.value.textLine){let s=o.value.textLine,i=`^\\s*\\?\\?\\s*(?<type>[^\\s]*)(\\s+(?<value>.*))?\\s+(?<predicate>(${_s.reduce((d,l)=>(d.push(...l.id),d),[]).join("|")}))\\s*(?<expected>.*)\\s*$`,a=new RegExp(i,"iu").exec(s);if(a&&a.groups&&a.groups.type&&a.groups.predicate){let d=a.groups.type,l=a.groups.value,u=a.groups.expected,m=_s.find(h=>{var R;return((R=a.groups)==null?void 0:R.predicate)&&h.id.indexOf(a.groups.predicate)>=0});return m&&t.hooks.onResponse.addHook(`test ${s}`,async(h,R)=>{await co(R,{ignoreErrorFile:!0})(`${l||d} ${m.id[0]} ${u||""}`.trim(),async C=>{let I=await R.httpFile.hooks.provideAssertValue.trigger(d,l,h,R),b=u&&await $(u,"Variable",R);b!==u&&(C.message=`${l||d} ${m.id[0]} ${b}`);let g=m.noAutoConvert?b:El(I,b);(0,Ks.ok)(m.match(I,g),`${l||d} (${I}) ${m.id[0]} ${x(g)||""}`.trim())})}),{nextParserLine:o.value.line,symbols:[new v({name:`assert ${a.groups.type}`,description:`${a.groups.predicate} ${a.groups.expected||""}`.trim(),kind:"script",startLine:o.value.line,startOffset:0,endLine:o.value.line,endOffset:o.value.textLine.length})]}}}return!1}function El(e,t){if(t!=null){if(typeof e=="number")return P(t);if(typeof e=="boolean")return ue(t,!!t);if(typeof e=="string")return x(t);if(e===null&&t==="null")return null;if(e===void 0&&t==="undefined")return;if(typeof e=="object"&&typeof t=="string")try{return JSON.parse(t)}catch{return t}}return t}W.emptyLineProvider.push(()=>[{name:"?? status == ",description:"Status assert (200)"},{name:"?? status == 200",description:"Status assert (200)"},{name:"?? duration <",description:"Duration assert"},{name:"?? body contains",description:"Body assert"},{name:"?? body matches",description:"Body assert"},{name:"?? body md5",description:"Body assert"},{name:"?? body sh256",description:"Body assert"},{name:"?? header",description:"Header assert"}]);function Ws(e,t,r){var o,s,n,i,a,d,l;if(e==="duration")switch(t){case"firstByte":return(o=r==null?void 0:r.timings)==null?void 0:o.firstByte;case"download":return(s=r==null?void 0:r.timings)==null?void 0:s.download;case"wait":return(n=r==null?void 0:r.timings)==null?void 0:n.wait;case"request":return(i=r==null?void 0:r.timings)==null?void 0:i.request;case"tcp":return(a=r==null?void 0:r.timings)==null?void 0:a.tcp;case"tls":return(d=r==null?void 0:r.timings)==null?void 0:d.tls;default:return(l=r==null?void 0:r.timings)==null?void 0:l.total}return!1}function Js(e,t,r){return e==="header"&&t?q(r.headers,t):!1}async function zs(e,t,r,o){return e==="js"&&t?await H.evalExpression(t,o,{response:r}):e==="body"?t?await H.evalExpression(`(response.parsedBody || response.body).${t}`,o,{response:r}):r.body:!1}function Xs(e,t,r){return e==="status"?r==null?void 0:r.statusCode:!1}var ir=class{constructor(){this.id="testFailed";this.before=["processedHttpRegion"]}async onError(t,r){if(te(t)){let{httpRegion:o}=r.args[0];me(o,{message:t.message,error:He(t),status:"ERROR"})}return!0}};function Ys(e){e.hooks.execute.addInterceptor(new ir),e.hooks.provideAssertValue.addHook("status",Xs,{before:["request"]}),e.hooks.provideAssertValue.addHook("header",Js,{before:["request"]}),e.hooks.provideAssertValue.addHook("javascript",zs,{before:["request"]}),e.hooks.provideAssertValue.addHook("duration",Ws,{before:["request"]}),e.hooks.parse.addHook("assert",Gs,{before:["request"]})}W.variableProvider.push(()=>[{name:"$prompt ",description:"Prompt"},{name:"$input",description:"Input"},{name:"$input-askonce",description:"Input"},{name:"$password",description:"Password"},{name:"$pick <placeholder> $value:",description:"Password"},{name:"$pick-askonce <placeholder> $value:",description:"Password"},{name:"$timestamp",description:"Timestamp"},{name:"$datetime",description:"Datetime"},{name:"$localDatetime",description:"Local Datetime"}]);var Qs="$default",Zs="$shared";async function en(e){var t;if((t=e.config)!=null&&t.environments){let r=Object.keys(e.config.environments).filter(o=>[Qs,Zs].indexOf(o)<0);return f.info("Config Env Provider found environments",r),r}return[]}async function tn(e,t){var o;let r=[];if((o=t.config)!=null&&o.environments){let s=t.config.environments;r.push(s[Zs]),e&&e.length>0?r.push(...e.map(n=>s[n])):r.push(s[Qs])}return Object.assign({},...r)}var Ao={};Xe(Ao,{HttpFile:()=>bt,HttpFileStore:()=>xt,HttpRegion:()=>Ke,UserSessionStore:()=>lr,closeHttpRegion:()=>ar,createReaderFactory:()=>qo,getEnvironmentConfig:()=>_e,parseHttpFile:()=>Oo,pluginStore:()=>ee,setSource:()=>Eo,userSessionStore:()=>w});var rn=A(require("chalk")),on=A(require("lodash/merge"));async function _e(e,t){let r=[];if(t){let s=await uo(t.fileName,t.rootDir);s&&r.push(s)}e&&r.push(e);let o=(0,on.default)({log:{level:5,supportAnsiColors:!0},cookieJarEnabled:!0,envDirName:"env"},...r);return Ol(o),o}function Ol(e){var t,r,o;typeof((t=e==null?void 0:e.log)==null?void 0:t.level)>"u"?f.options.level=5:f.options.level=(r=e==null?void 0:e.log)==null?void 0:r.level,((o=e==null?void 0:e.log)==null?void 0:o.supportAnsiColors)===!1&&(rn.default.level=0)}var bt=class{constructor(t,r){this.fileName=t;this.rootDir=r;this.hooks={parse:new Ye,parseMetaData:new Qe,parseEndRegion:new et,provideAssertValue:new Ze,replaceVariable:new ot,provideEnvironments:new rt,provideVariables:new tt,execute:new ve,onStreaming:new xe,onRequest:new ye,onResponse:new be,responseLogging:new Re};this.httpRegions=[]}findHttpRegion(t){return this.httpRegions.find(r=>{var o;return((o=r.metaData)==null?void 0:o.name)===t&&!r.metaData.disabled})}get globalHttpRegions(){return this.httpRegions.filter(t=>t.isGlobal()&&!t.metaData.disabled)}};var ln=require("hookpoint");async function ar(e){await e.httpFile.hooks.parseEndRegion.trigger(e);let{httpRegion:t}=e;e.httpRegion.symbol.name=pt(t),e.httpRegion.symbol.description=ho(t),e.httpFile.httpRegions.push(e.httpRegion),delete e.forceRegionDelimiter}function qo(e,t){return function*(o){for(let s=e;s<t.length;s++){let n=t[s];if(yield{textLine:n,line:s},!o&&Le.test(n))break}}}var an=require("hookpoint");var sn=require("hookpoint");var Ke=class e{constructor(t,r=0){this.httpFile=t;this.variablesPerEnv={};this.metaData={};this.hooks={execute:new ve,onRequest:new ye,onStreaming:new xe,onResponse:new be,responseLogging:new Re};this.dependentsPerEnv=[];this.symbol=new v({name:"-",description:"-",kind:"request",startLine:r,startOffset:0,endLine:r,endOffset:0})}get id(){return`${this.httpFile.fileName}_${this.symbol.startLine}`}isGlobal(){return!(this.request||this.metaData.name)}clone(t){let r=new e(t||this.httpFile);return r.request=this.request,Object.assign(r.symbol,this.symbol),Object.assign(r.hooks,this.hooks),Object.assign(r.variablesPerEnv,this.variablesPerEnv),Object.assign(r.metaData,this.metaData),r}async execute(t,r){var s,n,i;delete this.response,this.testResults=[],t.httpRegion&&this.registerRegionDependent(t.httpRegion),(n=(s=t.progress)==null?void 0:s.report)==null||n.call(s,{message:`${this.symbol.name}`});let o=this.hooks.execute;if(!this.isGlobal()){o=this.httpFile.hooks.execute.merge(o);for(let a of this.httpFile.httpRegions.filter(d=>d.isGlobal()))a instanceof e&&a.registerRegionDependent(this)}try{let a=await o.trigger({...t,httpFile:this.httpFile,httpRegion:this,hooks:mt(this.hooks,this.httpFile),isMainContext:r});return this.isGlobal()||this.resetDependentRegionsWithVisitor(B(t.activeEnvironment),this,[]),a!==sn.HookCancel&&a.every(d=>!!d)}catch(a){return te(a)&&(me(this,{message:a.message,status:"ERROR",error:He(a)}),a.handled||(await((i=t.logResponse)==null?void 0:i.call(t,this.response,this)),a.handled=!0)),!1}}resetDependentRegionsWithVisitor(t,r,o){let s=r.dependentsPerEnv.filter(n=>!o.includes(n));for(let n of s)delete n.response,delete n.variablesPerEnv[t],o.push(n),n instanceof e&&this.resetDependentRegionsWithVisitor(t,n,o)}registerRegionDependent(t){t&&!this.dependentsPerEnv.includes(t)&&t!==this&&this.dependentsPerEnv.push(t)}};function Eo(e,t){for(let r of e)nn(r.symbol,t)}function nn(e,t){e.source=U(t.slice(e.startLine,e.endLine+1));let r=e.endOffset-t[e.endLine].length;if(r>=0&&(r=void 0),e.source=e.source.slice(e.startOffset,r),e.children)for(let o of e.children)nn(o,t)}async function Oo(e,t,r){let o=Y(t),s={lines:o,httpFile:e,httpRegion:new Ke(e,0),data:{},httpFileStore:r};for(let n=0;n<o.length;n++){let i=await e.hooks.parse.trigger(qo(n,o),s);i&&i!==an.HookCancel&&(i.endRegionLine!==void 0&&i.endRegionLine>=0&&(s.httpRegion.symbol.endLine=i.endRegionLine,s.httpRegion.symbol.endOffset=o[i.endRegionLine].length,await ar(s),s.httpRegion=new Ke(e,i.nextParserLine+1)),i.symbols&&(s.httpRegion.symbol.children?s.httpRegion.symbol.children.push(...i.symbols):s.httpRegion.symbol.children=i.symbols),n=i.nextParserLine)}return await ar(s),s.httpRegion.symbol.endLine=o.length-1,s.httpRegion.symbol.endOffset=o[o.length-1].length,Eo(e.httpRegions,o),e}var ee={};var xt=class{constructor(t={}){this.plugins=t;this.storeCache=[]}getFromStore(t,r){let o=p.toString(t),s=this.storeCache.find(n=>n.cacheKey===o);return s||(s={cacheKey:o,version:r},this.storeCache.push(s)),s}get(t){var o;let r=p.toString(t);return(o=this.storeCache.find(s=>s.cacheKey===r))==null?void 0:o.httpFile}getAll(){let t=[];for(let r of this.storeCache)r.httpFile&&t.push(r.httpFile);return t}getOrCreate(t,r,o,s){let n=this.getFromStore(t,o);return o>n.version||!n.httpFile?(n.promise&&o<=n.version||(n.promise=r().then(i=>this.parse(t,i,s)).then(i=>{if(delete n.promise,n.httpFile)for(let a of i.httpRegions){let d=n.httpFile.httpRegions.find(l=>l.symbol.source===a.symbol.source);d&&Object.assign(a.variablesPerEnv,d.variablesPerEnv)}return n.version=o,n.httpFile=i,i}).catch(i=>{throw delete n.promise,n.httpFile&&this.remove(n.httpFile.fileName),i})),n.promise):n.promise||Promise.resolve(n.httpFile)}async parse(t,r,o){let s=await this.initHttpFile(t,o);return await Oo(s,r,this)}remove(t){let r=p.toString(t),o=this.storeCache.findIndex(s=>s.cacheKey===r);return o>=0?(this.storeCache.splice(o,1),!0):!1}rename(t,r){let o=p.toString(t),s=this.storeCache.find(n=>n.cacheKey===o);s&&(s.cacheKey=p.toString(r),s.httpFile&&(s.httpFile.fileName=r))}clear(){this.storeCache.length=0}async initHttpFile(t,r){var d,l;let o=await V(t,r.workingDir)||t,s=await Et(o,r.workingDir,...$t)||await Et(o,r.workingDir,"package.json",((d=r.config)==null?void 0:d.envDirName)||"env")||r.workingDir,n=new bt(o,s);r.config=await _e(r.config,n);let i={...ee,...this.plugins};s&&(Object.assign(i,await po(s)),(l=r.config)!=null&&l.configureHooks&&(i[".httpyac.js"]=r.config.configureHooks));let a=process.env.HTTPYAC_PLUGIN;if(a)try{let u=require(a);u.configureHooks&&(i.HTTPYAC_PLUGIN=u.configureHooks)}catch(u){f.warn("Global Hook Plugin not loaded",u)}return await this.configureHooks(n,r,i),n}async configureHooks(t,r,o){if(r.config){let s={version:"1.0.0",rootDir:t.rootDir,config:r.config,httpFile:t,hooks:t.hooks,log:f,fileProvider:p,sessionStore:w,userInteractionProvider:L,httpClientProvider:se,javascriptProvider:H,utils:y,getHookCancel:()=>ln.HookCancel};for(let[n,i]of Object.entries(o))try{let a=i(s);Ne(a)&&await a}catch(a){f.error(`error in ${n}`,a)}}}};var lr=class{constructor(){this.userSessions=[];this.sessionChangedListener=[]}onSessionChanged(t){return this.sessionChangedListener.push(t),()=>{let r=this.sessionChangedListener.indexOf(t);r>=0&&this.sessionChangedListener.splice(r,1)}}async reset(){for(let t of this.userSessions)t.delete&&t.delete();this.userSessions.length=0,this.notifySessionChanged()}getUserSession(t){return this.userSessions.find(r=>r.id===t)}setUserSession(t){this.removeUserSession(t.id),this.userSessions.push(t),this.notifySessionChanged()}notifySessionChanged(){for(let t of this.sessionChangedListener)t()}removeUserSession(t){let r=this.userSessions.find(o=>o.id===t);r&&(this.userSessions.splice(this.userSessions.indexOf(r),1),r.delete&&r.delete(),this.notifySessionChanged())}isUserSession(t){let r=t;return r&&!!r.description&&!!r.id&&!!r.title&&!!r.type&&!!r.details}},w=new lr;async function dn(){let e=w.getUserSession("last_response");return e!=null&&e.response?{response:e.response}:{}}var un=A(require("lodash/cloneDeep"));var dr=class{constructor(){this.id="createRequest"}async beforeLoop(t){let[r]=t.args;return r.httpRegion.request&&(T(r,"init request"),r.request=(0,un.default)(r.httpRegion.request)),!0}};var pn=require("hookpoint");var $l="variable",ur=class{constructor(){this.id="variable"}async beforeLoop(t){let r=t.args[0];return r.options.lazyVariables=!0,!0}async beforeTrigger(t){var o;let r=t.args[0];return((o=t.hookItem)==null?void 0:o.id)!==$l&&r.options.lazyVariables&&(await this.replaceAllVariables(r),delete r.options.lazyVariables),!0}async replaceAllVariables(t){for(let[r,o]of Object.entries(t.variables)){let s=await $(o,"Variable",t);s!==pn.HookCancel&&(t.variables[r]=s)}}};var pr=class{constructor(){this.id="logResponse"}async afterLoop(t){let r=t.args[0],o;return r.httpRegion.response&&(o=ae(r.httpRegion.response),o.tags||(o.tags=[]),o.tags.push("httpRegion",r.isMainContext?"mainResponse":"refResponse"),delete r.httpRegion.response),await Te(o,r),!0}};var mr=class{constructor(){this.id="processedHttpRegion";this.emitted=new WeakSet}getResponseLoggingInterceptor(){return{id:this.id,afterLoop:this.afterResponseLoggingLoop.bind(this)}}async beforeLoop(t){let[r]=t.args;if(r.processedHttpRegions){let o=this.toProcessedHttpRegion(r);r.processedHttpRegions.push(o)}return!0}async onError(t,r){return this.updateProcessedHttpRegionAfterLoop(r.args[0]),this.emitProcessedHttpRegion(r.args[0]),!0}async afterLoop(t){return this.updateProcessedHttpRegionAfterLoop(t.args[0]),this.emitProcessedHttpRegion(t.args[0]),!0}updateProcessedHttpRegionAfterLoop(t){var o,s,n;let r=(s=(o=t.processedHttpRegions)==null?void 0:o.slice().reverse())==null?void 0:s.find(i=>i.id===t.httpRegion.id);r&&(r.end=performance.now(),r.duration=r.end-r.start,r.metaData={...t.httpRegion.metaData},r.testResults=t.httpRegion.testResults,r.response=t.httpRegion.response||r.response,r.request=((n=t.httpRegion.response)==null?void 0:n.request)||r.request)}async afterResponseLoggingLoop(t){var n;let[r,o]=t.args,s=(n=o.processedHttpRegions)==null?void 0:n.find(i=>i.id===o.httpRegion.id);return s&&(s.request=r.request,s.response=r),this.updateProcessedHttpRegionAfterLoop(o),this.emitProcessedHttpRegion(o),!0}toProcessedHttpRegion(t){return{id:t.httpRegion.id,filename:t.httpFile.fileName,symbol:t.httpRegion.symbol,isGlobal:t.httpRegion.isGlobal(),testResults:t.httpRegion.testResults,start:performance.now()}}emitProcessedHttpRegion(t){var o;if(!t.processedHttpRegionListener)return;let r=(o=t.processedHttpRegions)==null?void 0:o.find(s=>s.id===t.httpRegion.id);r&&!this.emitted.has(r)&&r.duration!==void 0&&(this.emitted.add(r),t.processedHttpRegionListener(r))}};var cr=class{constructor(){this.id="regionScopedVariables"}async beforeLoop(t){var s;let r=t.args[0],o=B(r.activeEnvironment);if((s=r.config)!=null&&s.useRegionScopedVariables){let n=r.options;n.variables=r.variables,r.variables=Object.assign({},r.variables,...r.httpFile.globalHttpRegions.map(i=>i.variablesPerEnv[o]))}else r.variables=Object.assign(r.variables,...r.httpFile.httpRegions.map(n=>n.variablesPerEnv[o]));return!0}async afterLoop(t){var o;let r=t.args[0];if((o=r.config)!=null&&o.useRegionScopedVariables){let s=r.options;if(s.variables){let n=r.variables;r.variables=s.variables,this.autoShareNewVariables(n,r)}}return!0}autoShareNewVariables(t,r){for(let[o,s]of Object.entries(t))r.variables[o]||(r.variables[o]=s)}};function mn(e,t,r){return e==="disabled"?(t?typeof t=="string"&&r.httpRegion.hooks.execute.addHook("disabled",async o=>{let s=await H.evalExpression(t,o);return s&&Q(o.httpRegion),!s}):r.httpRegion.hooks.execute.addInterceptor({id:"disabled",async beforeLoop(o){o.bail=!0;let{httpRegion:s}=o.args[0];return Q(s),!0}}),!0):!1}function cn(e,t,r){return e==="forceRegionDelimiter"&&(r.forceRegionDelimiter=!0),!1}function fn(e,t,r){return e==="import"&&t?(r.httpRegion.hooks.execute.addObjHook(o=>o.process,new $o(t,r.httpFileStore)),!0):!1}var $o=class{constructor(t,r){this.fileName=t;this.httpFileStore=r;this.id="import"}async process(t){return ht(this.fileName,this.httpFileStore,t)}};function gn(e,t,r){return e==="jwt"?(r.httpRegion.hooks.onResponse.addHook("jwt",async o=>{let s=o.parsedBody||o.body;if(s&&typeof s=="object"){let n=Object.entries(s),i=n;t&&(i=n.filter(([l])=>t.indexOf(l)>=0));for(let[l,u]of i){let m=Il(u);m&&n.push([`${l}_parsed`,m])}let a=Object.fromEntries(n),d=O(a,2);o.body=d,o.prettyPrintBody=d,o.parsedBody=a}}),!0):!1}function Il(e){return c(e)?zr(e):null}var hn=require("uuid");function yn(e,t,r){if(e==="keepStreaming"){let o=`keep_streaming_${(0,hn.v4)()}`;return r.httpRegion.hooks.onStreaming.addHook("keepStreaming",async s=>{s.request&&(T(s,"stream until manual cancellation"),await new Promise(n=>{s.requestClient&&s.requestClient.addEventListener("disconnect",()=>n(!0))}))}),r.httpRegion.hooks.onResponse.addHook("keepStreaming",()=>{w.removeUserSession(o)}),!0}return!1}var bn=require("hookpoint"),xn=require("uuid");function Rn(e,t,r){var o,s,n,i;if(e==="loop"&&t){let a=/^\s*for\s+(?<variable>.*)\s+of\s+(?<iterable>.*)\s*/u.exec(t);if((o=a==null?void 0:a.groups)!=null&&o.iterable&&((s=a==null?void 0:a.groups)!=null&&s.variable))return Do(r,{type:1,variable:a.groups.variable,iterable:a.groups.iterable}),!0;let d=/^\s*for\s*(?<counter>\d*)\s*$/u.exec(t);if((n=d==null?void 0:d.groups)!=null&&n.counter)return Do(r,{type:0,counter:Number.parseInt(d.groups.counter,10)}),!0;let l=/^\s*while\s*(?<expression>.*)\s*$/u.exec(t);if((i=l==null?void 0:l.groups)!=null&&i.expression)return Do(r,{type:2,expression:l.groups.expression}),!0}return!1}function Do(e,t){let r=new Io(t);e.httpRegion.hooks.execute.addInterceptor(r),e.httpRegion.hooks.execute.addObjHook(o=>o.process,r)}var Io=class{constructor(t){this.data=t;this.isInLoop=!1;this.id=`loop_${(0,xn.v4)()}`}async beforeLoop(t){return this.hook=t.hook,this.isInLoop&&(t.index=t.hook.items.findIndex(r=>r.id===this.id)),!0}async process(t){if(this.hook&&!this.isInLoop){let r=[];try{this.isInLoop=!0;let o=this.iterate(t),s=await o.next();for(;!s.done;){T(t,`${s.value.index+1} loop pass`);let n={...t,httpRegion:this.createHttpRegionClone(t.httpRegion,s.value.index),variables:Object.assign(t.variables,s.value.variables)};if(await this.hook.trigger(n)===bn.HookCancel)return!1;r.push(n.variables.response),s=await o.next()}t.httpRegion.metaData.name&&r.length>0&&D({[`${t.httpRegion.metaData.name}`]:r[0],[`${t.httpRegion.metaData.name}List`]:r},t)}finally{this.isInLoop=!1}}return!0}async afterTrigger(t){var r;return!this.isInLoop&&((r=t.hookItem)==null?void 0:r.id)===this.id&&(t.bail=!0),!0}async*iterate(t){switch(this.data.type){case 1:yield*this.iterateForOfLoop(t);break;case 0:yield*this.iterateForLoop();break;case 2:yield*this.iterateWhileLoop(t);break;default:break}}async*iterateForOfLoop(t){if(this.data.variable&&this.data.iterable){let r=await H.evalExpression(this.data.iterable,t),o;if(Array.isArray(r)&&(o=r),o){let s=0;for(let n of o){let i={$index:s};i[this.data.variable]=n,yield{index:s,variables:i},s++}}}}async*iterateWhileLoop(t){if(this.data.expression){let r=0;for(;await H.evalExpression(this.data.expression,t);)yield{index:r,variables:{$index:r}},r++}}*iterateForLoop(){if(this.data.counter)for(let t=0;t<this.data.counter;t++)yield{index:t,variables:{$index:t}}}createHttpRegionClone(t,r){let o=t.clone();return o.metaData.name=t.metaData.name?`${t.metaData.name}${r}`:void 0,o}};function vn(e,t,r){return e==="noRedirect"?(r.httpRegion.hooks.onRequest.addHook("noRedirect",async o=>{o.noRedirect=!0}),!0):!1}function kn(e,t,r){return e==="noRejectUnauthorized"?(r.httpRegion.hooks.onRequest.addHook("noRejectUnauthorized",async o=>{o.noRejectUnauthorized=!0}),!0):!1}function Pn(e,t,r){if(e==="note"){let o=t||`Are you sure you want to send the request ${pt(r.httpRegion)}?`;return r.httpRegion.hooks.execute.addInterceptor({id:"note",beforeLoop:()=>L.showNote(o)}),!0}return!1}function wn(e,t,r){return e==="proxy"?(r.httpRegion.hooks.onRequest.addHook("proxy",async o=>{o.proxy=t}),!0):!1}function Hn(e,t,{httpRegion:r}){if(e==="ratelimit"&&t){let o=/^\s*(slot(:)?\s*(?<slot>[^\s]+))?\s*(minIdleTime(:)?\s*(?<minIdleTime>\d*))?\s*(max(:)?\s*(?<max>\d*))\s*(expire(:)?\s*(?<expire>\d*))?\s*$/iu.exec(t);if(o!=null&&o.groups){let s=o.groups.slot||"rateLimit",n=o.groups.minIdleTime||"0",i=o.groups.max||"0",a=o.groups.expire||"0";r.hooks.execute.addHook("rateLimit",async d=>{let l=Vl(s,Number.parseInt(n,10),Number.parseInt(i,10),Number.parseInt(a,10));return l.requests.push(await Fl(l,d)),!0})}}return!1}async function Fl(e,t){for(;e.requests.length>0;){let r=new Date;if(Bl(e.requests,r,e.expire),e.max>0&&e.requests.length>=e.max){let o=e.requests[0],s=e.expire+o.getTime()-r.getTime();s>0&&(T(t,`rate limit max reached. wait for ${s}`),f.debug(`rate limit max reached. wait for ${s} (slot ${e.slot})`),await ce(s),f.debug("rate limit max waited"));continue}if(e.requests.length>0){let o=e.requests[e.requests.length-1];if(o&&e.minIdleTime>0){let s=o.getTime()+e.minIdleTime-r.getTime();if(s>0){T(t,`rate limit minIdleTime, wait for ${s}`),f.debug(`rate limit minIdleTime, wait for ${s} (slot ${e.slot})`),await ce(s),f.debug("rate limit minIdleTime waited");continue}}}return r}return new Date}function jl(e){let t=e;return!!(t!=null&&t.requests)&&t.type==="RateLimit"}function Vl(e,t,r,o){let s=`ratelimit_${e}`,n=w.getUserSession(s);if(jl(n))return n.max=r,n.minIdleTime=t,n.expire=o,n;let i=[];t>0&&i.push(`minIdleTime ${t}ms`),o>0&&i.push(`max ${r} with expire ${o}ms`);let a={id:s,type:"RateLimit",title:`rate limit slot ${e}`,details:{slot:e,minIdleTime:t,max:r,expire:o},description:i.join(", "),slot:e,minIdleTime:t,max:r,expire:o,requests:[]};return w.setUserSession(a),a}function Bl(e,t,r){if(r>0){let o=0;for(let s of e)if(t.getTime()-s.getTime()>=r)o++;else break;e.splice(0,o)}else e.splice(0,e.length-1)}var Cn=20,fr=[],gr=0,Sn=500;function Tn(e,t,r){return["ref","forceRef"].indexOf(e)>=0&&t?(r.httpRegion.hooks.execute.addObjHook(o=>o.process,new Fo({name:t,force:e==="forceRef"})),!0):!1}var Fo=class{constructor(t){this.data=t;this.id="ref"}async process(t){var s;let r=await $(this.data.name,this.id,t);if(typeof r!="string"||!r)throw f.error(`ref ${this.data.name} not resolvable to a valid name: ${this.data.name} -> ${r}`),new Error(`ref ${this.data.name} not resolvable to a valid name: ${this.data.name} -> ${r}`);gr++;let o=`${t.httpRegion.id}:${r}`;if(gr>Sn)throw f.error(`Total reference calls (${gr}) exceeded limit (${Sn})`),new Error(`Too many reference calls (${gr}) - possible infinite loop or runaway forceRef`);if(fr.length>=Cn){let n=fr.slice(-10).join(" -> ");throw f.error(`Reference depth limit (${Cn}) exceeded. Recent refs: ${n}`),new Error(`Reference depth limit exceeded - possible infinite loop. Recent: ${n}`)}fr.push(o);try{let n=!0;T(t,`load reference ${r}`);let i=Me(r,t);if(i){if(this.isReferenceErroredOrSkipped(i))return Q(t.httpRegion),!1;let a=B(t.activeEnvironment);D(i.variablesPerEnv[a],t),f.trace("import variables",i.variablesPerEnv[a]);let d=Fe(t.variables[r])&&!((s=t.processedHttpRegions)!=null&&s.some(l=>l.id===i.id));(this.data.force||d)&&(n=await i.execute(t),n&&D(i.variablesPerEnv[a],t))}else throw f.error(`ref ${r} not found`),new Error(`ref ${r} not found`);return n}finally{fr.pop()}}isReferenceErroredOrSkipped(t){var r;return!!((r=t.testResults)!=null&&r.some(o=>o.status==="ERROR"||o.status==="SKIPPED"))}};function Ln(e,t,r){return e==="responseRef"&&t&&(r.httpRegion.responseRefs||(r.httpRegion.responseRefs=[]),r.httpRegion.responseRefs.push(t)),!1}function qn(e,t,r){return e==="sleep"&&t?(r.httpRegion.hooks.execute.addHook("sleep",async o=>{let s=await H.evalExpression(t,o);return Number.isSafeInteger(s)&&(await T(o,`Sleep for ${s}ms`),await ce(s)),!0}),!0):!1}function En(e,t,r){let o=P(t);return e==="timeout"&&o!==void 0?(r.httpRegion.hooks.onRequest.addHook("timeout",async s=>{s.timeout=o}),!0):!1}function On(e,t,r){if(e==="verbose"||e==="debug"){let o=e==="debug"?2:1;return f.options.level=o,r.httpRegion.hooks.execute.addInterceptor({id:"verbose",async beforeLoop(){return f.options.level=o,!0}}),!0}return!1}async function An(e,{httpRegion:t}){let r=e(!0),o=Nl(r);return o?(t.metaData.description||(t.metaData.description=o.comment),{nextParserLine:o.endLine,symbols:[new v({name:"comment",description:o.comment,kind:"comment",startLine:o.startLine,startOffset:0,endLine:o.endLine,endOffset:o.endOffset})]}):!1}function Nl(e){var r;let t=e.next();if(!t.done){let o=t.value.line,s=/^\s*\/\/\s*(?<comment>.*)\s*$/u.exec(t.value.textLine);if((r=s==null?void 0:s.groups)!=null&&r.comment)return{startLine:o,endLine:o,endOffset:t.value.textLine.length,comment:s.groups.comment};if(/^\s*\/\*$/u.exec(t.value.textLine)){t=e.next();let i=[];for(;!t.done;){if(/^\s*\*\/\s*$/u.test(t.value.textLine))return{startLine:o,endLine:t.value.line,endOffset:t.value.textLine.length,comment:U(i)};i.push(t.value.textLine),t=e.next()}}}return!1}var $n=/^\s*(#+|\/{2})/u;async function Dn(e,t){var i,a;let r=e(),{httpRegion:o,data:s}=t;s.metaTitle&&(o.metaData.title=s.metaTitle.trim(),o.metaData.name||(o.metaData.name=s.metaTitle.trim()),delete s.metaTitle);let n=r.next();if(!n.done){let d=n.value.textLine;if($n.test(d)){if(Ul(t)&&d.trim()!=="###")return f.debug("request with markdown only supports delimiter after request line"),!1;let l={nextParserLine:n.value.line,symbols:[]},u=Le.exec(d);if(u)l.endRegionLine=n.value.line-1,l.symbols.push(new v({name:"separator",description:((i=u.groups)==null?void 0:i.title)||"-",kind:"metaData",startLine:n.value.line,startOffset:0,endLine:n.value.line,endOffset:d.length})),s.metaTitle=(a=u.groups)==null?void 0:a.title;else{let m=await ft(n.value,t,$n);m&&(l.symbols=m.symbols)}return l}}return!1}function Ul(e){var t;if((t=e.httpRegion.request)!=null&&t.headers){let r=we(e.httpRegion.request.headers);if(lt(r))return!0}return!1}async function In(e,t){var o,s,n;let r=e();if(t.httpRegion.request){let i=jo(t),a=r.next();if(!a.done&&(i.rawBody.length>0||!ke(a.value.textLine))){let d=[];!i.symbol||i.symbol.endLine!==a.value.line-1?(i.symbol=new v({name:"request body",description:"request body",kind:"requestBody",startLine:a.value.line,startOffset:0,endLine:a.value.line,endOffset:a.value.textLine.length,children:re(a.value.textLine,a.value.line)}),d.push(i.symbol)):(i.symbol.endLine=a.value.line,i.symbol.endOffset=a.value.textLine.length,(s=(o=i.symbol.children)==null?void 0:o.push)==null||s.call(o,...re(a.value.textLine,a.value.line)));let l=gt(a.value.textLine);return l?(i.rawBody.push(l),(n=i.symbol.children)==null||n.push(new v({name:"filename",description:l.fileName,kind:"path",startLine:a.value.line,startOffset:a.value.textLine.indexOf(l.fileName),endLine:a.value.line,endOffset:a.value.textLine.indexOf(l.fileName)+l.fileName.length}))):i.rawBody.push(a.value.textLine),{nextParserLine:a.value.line,symbols:d}}}return!1}function jo(e){let t=e.data.request_body;return t||(t={rawBody:[]},e.data.request_body=t),t}var hr=class{get id(){return"multipart/mixed"}async beforeLoop(t){var o;let r=t.args[1];if(r.httpRegion.request&&Gr(r.httpRegion.request.contentType)){if(r.forceRegionDelimiter===void 0)r.forceRegionDelimiter=!0;else if(r.forceRegionDelimiter){let s=((o=r.httpRegion.request.contentType)==null?void 0:o.boundary)||"",n=jo(r).rawBody.slice().pop();c(n)&&n.includes(`--${s}--`)&&(r.forceRegionDelimiter=!1)}}return!0}};async function Fn(e,{httpRegion:t}){var s;let o=e().next();if(!o.done){let n=o.value.textLine,i=/^\s*>>(?<force>!)?\s+(?<fileName>.+)\s*$/u.exec(n);if(i&&((s=i.groups)!=null&&s.fileName)){let a=i.groups.fileName.trim(),d=!!i.groups.force;return t.hooks.onResponse.addHook("outputRedirection",async(l,u)=>{try{if(l.rawBody){let m=x(await $(a,"Variable",u));if(m){let h=await _l(m,d,u.httpFile.fileName);h?await p.writeBuffer(h,l.rawBody):f.debug(`file ${a} not found`)}else f.debug(`file ${a} not found`)}}catch(m){f.error(`output redirection failed for ${a}`,m)}}),{nextParserLine:o.value.line,symbols:[new v({name:"outputredirection",description:i.groups.filename,kind:"response",startLine:o.value.line,startOffset:0,endLine:o.value.line,endOffset:o.value.textLine.length,children:[new v({name:"filename",description:a,kind:"path",startLine:o.value.line,startOffset:o.value.textLine.indexOf(a),endLine:o.value.line,endOffset:o.value.textLine.indexOf(a)+a.length})]})]}}}return!1}async function _l(e,t,r){let o=await Vo(e,r);if(!t&&await p.exists(o)){let s=e.lastIndexOf(".");if(s>0&&s<e.length-2){let n=e.slice(0,s),i=e.slice(s+1),a=1;for(o=await Vo(`${n}-${a}.${i}`,r);await p.exists(o);)o=await Vo(`${n}-${a++}.${i}`,r)}}return o}async function Vo(e,t){if(!await p.isAbsolute(e)){let r=p.dirname(t);if(r)return p.joinPath(r,e)}return e}var jn=wo({protocol:"HTTP",methodRegex:/^\s*(?<method>GET|POST|PUT|DELETE|PATCH|HEAD|OPTIONS|CONNECT|TRACE|PROPFIND|PROPPATCH|MKCOL|COPY|MOVE|LOCK|UNLOCK|CHECKOUT|CHECKIN|REPORT|MERGE|MKACTIVITY|MKWORKSPACE|VERSION-CONTROL|BASELINE-CONTROL|MKCALENDAR|ACL|SEARCH|GRAPHQL)\s+(?<url>.+?)$/u,protocolRegex:/^\s*(?<url>.+)\s*$/iu,requestClientFactory(e,t){if(se.createRequestClient)return se.createRequestClient(e,t);throw new Error("Missing Http Client Provider")},modifyRequest(e){e.method==="HTTP"&&(e.method="GET"),E(e)&&Kl(e)},sessionStore:w});function Kl(e){var t;if(e.url){let r=/(?<url>.*)\s+HTTP\/(?<version>(\S+))/u.exec(e.url);(t=r==null?void 0:r.groups)!=null&&t.version&&r.groups.url&&(e.url=r.groups.url.trim(),["1.1","1.0"].indexOf(r.groups.version)<0&&(e.options||(e.options={}),e.options.http2=!0))}}async function Vn(e,t){return Po(e,t,/^\s*HTTP\/(?<httpVersion>\S+)\s*(?<statusCode>[1-5][0-9][0-9])\s*(-)?\s*(?<statusMessage>.*)$/u)}async function Bn(e,{httpRegion:t}){var s;let o=e().next();if(!o.done){let n=o.value.textLine,i=/^\s*<>\s*(?<fileName>.+?)\s*$/u.exec(n);if(i&&((s=i.groups)!=null&&s.fileName)){t.responseRefs||(t.responseRefs=[]);let a=i.groups.fileName;return t.responseRefs.push(a),{nextParserLine:o.value.line,symbols:[new v({name:"responseRef",description:i.groups.filename,kind:"response",startLine:o.value.line,startOffset:0,endLine:o.value.line,endOffset:o.value.textLine.length,children:[new v({name:"filename",description:a,kind:"path",startLine:o.value.line,startOffset:n.indexOf(a),endLine:o.value.line,endOffset:n.indexOf(a)+a.length})]})]}}}return!1}async function Mn(e,{httpRegion:t}){let o=e().next();if(!o.done){let s=o.value.textLine,n=/^\s*@(?<useGlobal>global\.)?(?<key>[^\s=:]*)\s*(?<lazyIndicator>:?)=*\s*"?(?<value>.*)"?\s*$/u.exec(s);if(n&&n.groups&&n.groups.key&&n.groups.value){let i=n.groups.key,a=!!n.groups.lazyIndicator,d=!!n.groups.useGlobal,l=n.groups.value;return t.hooks.execute.addHook(`variable_${i}`,async u=>{let m=l;a?u.options.lazyVariables=!0:m=await $(l,"Variable",u);let h=u.variables.$global;return d&&h&&typeof h=="object"?Object.assign(h,{[i]:m}):D({[i]:m},u),!0}),{nextParserLine:o.value.line,symbols:[new v({name:n.groups.key,description:n.groups.value,kind:"variableDefinition",startLine:o.value.line,startOffset:0,endLine:o.value.line,endOffset:o.value.textLine.length,children:[new v({name:n.groups.key,description:"key",kind:"key",startLine:o.value.line,startOffset:o.value.textLine.indexOf(n.groups.key),endLine:o.value.line,endOffset:o.value.textLine.indexOf(n.groups.key)+n.groups.key.length}),new v({name:n.groups.value,description:"value",kind:"value",startLine:o.value.line,startOffset:o.value.textLine.indexOf(n.groups.value),endLine:o.value.line,endOffset:o.value.textLine.indexOf(n.groups.value)+n.groups.value.length})]})]}}}return!1}function Nn(e){e.httpRegion.hooks.execute.addInterceptor({id:"cancel",beforeLoop:async function(r){var s,n;return(n=(s=r.args[0].progress)==null?void 0:s.isCanceled)!=null&&n.call(s)?(f.debug("process canceled by user"),!1):!0}})}async function Un(e,t){var r;if(e&&((r=t.config)!=null&&r.defaultHeaders)){T(t,"set default request headers");let o=t.config.defaultHeaders;if(!e.headers)e.headers={...o};else for(let[s,n]of Object.entries(o))q(e.headers,s)||(e.headers[s]=n)}}var _n=A(require("encodeurl"));async function Kn(e){e.body&&c(e.body)&&Pe(e.contentType)&&(e.body=(0,_n.default)(e.body))}var Gn={id:"excludeProxy",afterLoop:async function(t){var s,n;let[r,o]=t.args;return r.proxy||(r.proxy=(s=o.config)==null?void 0:s.proxy),r.proxy&&(o.httpRegion.metaData.noProxy||(n=o.config)!=null&&n.proxyExcludeList&&o.config.proxyExcludeList.some(i=>r.url.startsWith(i)))&&delete r.proxy,!0}};var Wn={id:"isTrusted",afterLoop:async function(t){if(!L.isTrusted()){let[r]=t.args;return await L.showNote(`Is call to ${r.method} ${r.url} allowed, because workspace is not trusted.`)}return!0}};var de=require("hookpoint");async function Jn(e,t){if(T(t,"replace variables in request"),e.url){let r=await $(e.url,"Url",t)||e.url;if(r===de.HookCancel)return de.HookCancel;c(r)&&(e.url=r)}if(await Bo(e,t)===!1)return de.HookCancel;if(await Wl(e,t)===!1)return de.HookCancel}async function Bo(e,t){if(e.body){if(c(e.body)){let r=await $(e.body,"Body",t);if(r===de.HookCancel)return!1;c(r)||Buffer.isBuffer(r)?e.body=r:e.body=x(r)}else if(Array.isArray(e.body)){let r=[];for(let o of e.body)if(c(o)){let s=await $(o,"Body",t);if(s===de.HookCancel)return!1;c(s)&&r.push(s)}else r.push(o);e.body=r}}return!0}async function Wl(e,t){if(e.headers)for(let[r,o]of Object.entries(e.headers))if(Array.isArray(o)){let s=[];for(let n of o){let i=await $(n,r,t);if(i===de.HookCancel)return!1;s.push(i)}e.headers[r]=s}else{let s=await $(o,r,t);if(s===de.HookCancel)return!1;e.headers[r]=s}return!0}async function zn(e,t){if(e.body&&Array.isArray(e.body)){let r=[];for(let o of e.body)if(c(o))r.push(o);else if(Buffer.isBuffer(o))r.push(o);else{let s=await o(t);s&&r.push(s)}e.body=r}}async function Xn(e){if(e){let t={Accept:"*/*","User-Agent":"httpyac"};if(!e.headers)e.headers=t;else for(let[r,o]of Object.entries(t))q(e.headers,r)||(e.headers[r]=o)}}async function Yn(e,{variables:t}){Jl(e,t),zl(e,t),Xl(e,t),Ql(e,t),Yl(e)}function Jl(e,t){e&&t&&typeof t.request_rejectUnauthorized<"u"&&(e.noRejectUnauthorized=!ue(t.request_rejectUnauthorized))}function zl(e,t){e&&t&&typeof t.request_noRedirect<"u"&&(e.noRedirect=ue(t.request_noRedirect))}function Xl(e,t){c(t==null?void 0:t.request_proxy)&&(e.proxy=t.request_proxy)}function Yl(e){if(e.proxy||!E(e))return;let t=process.env.https_proxy||process.env.HTTPS_PROXY,r=process.env.http_proxy||process.env.HTTP_PROXY;e.url.toLowerCase().startsWith("https")&&c(t)?e.proxy=t:c(r)&&(e.proxy=process.env.httpProxy)}function Ql(e,t){let r=P(t==null?void 0:t.request_timeout);r!==void 0&&(e.timeout=r)}async function Qn(e,t){e.body&&(e.body=await Mo(e.body,t))}async function Mo(e,t){return c(e)||Buffer.isBuffer(e)?e:await Zl(e,t)}async function Zl(e,t){let r=[];for(let o of e)if(c(o))r.push(o);else if(Buffer.isBuffer(o))r.push(o);else{let s=await o(t);s&&r.push(s)}return r.some(o=>Buffer.isBuffer(o))?Buffer.concat(r.map(o=>Buffer.isBuffer(o)?o:Buffer.from(o))):r.join("")}async function Zn(e){if(e.body&&c(e.body)&&Pe(e.contentType)){let t=Y(e.body);if(t.length>0){let r=[],o=["=","&"];for(let s of t)r.push(o.reduce((n,i)=>n.split(i).map(a=>a.trim()).join(i),s));e.body=r.join("")}}}async function ri(e){var r;let t=rd(e);if(e.httpRegion.request&&t){let o=e.httpRegion.request;sd(t.rawBody);let s=await nd(t.rawBody);if(s.length>0){let n=ad(s,o.contentType);n.length>0&&!n[0].wait&&(o.body=(r=n.shift())==null?void 0:r.body),n.length>0&&dd(n,e)}}}function ei(e,t){return Pe(t)?id(e):(od(e,t),td(e,t))}function td(e,t){let r=[],o=[],s=Kr(t)?`\r
`:p.EOL;for(let n of e)c(n)?o.push(n):(o.length>0&&(o.push(""),r.push(o.join(s)),o.length=0),r.push(n),o.push(""));return o.length>0&&r.length===0?o.join(s):(o.length>0&&r.push(o.join(s)),r)}function rd(e){let t=e.data.request_body;return t&&delete e.data.request_body,t}function od(e,t){e.every(r=>c(r))&&Wr(t)&&e.push("")}function sd(e){for(;e.length>0&&ke(e[e.length-1]);)e.pop();if(e.length>0){let t=e[e.length-1];c(t)&&/\s*<--->\s*/u.test(t)&&e.pop()}}async function nd(e){let t=[];for(let r of e)if(c(r))t.push(r);else{let{injectVariables:o,fileName:s}=r,n=(i,a)=>{var d;if(a.httpRegion.metaData.injectVariables)return!0;if((d=a.config)!=null&&d.requestBodyInjectVariablesExtensions){let l=ao(i);if(l)return a.config.requestBodyInjectVariablesExtensions.indexOf(l)>=0}return!1};t.push(async i=>await le(s,i,async a=>o||n(r.fileName,i)?await p.readFile(a,r.encoding):p.readBuffer(a)))}return t}function id(e){let t=e.reduce((r,o,s)=>{let n=r;return c(o)&&(n+=`${s===0||o.startsWith("&")?"":p.EOL}${o}`),n},"");return c(t)?t:""}function ad(e,t){let r=[],o=[],s=!1;for(let n of e){let i=ld(n);i?(o.push({wait:s,body:ei(r,t)}),s=i.waitForServer,r.length=0):r.push(n)}return r.length>0&&o.push({wait:s,body:ei(r,t)}),o}function ld(e){var t;if(c(e)){let r=/\s*={3}\s*(?<wait>wait-for-server)?\s*$/u.exec(e);if(r)return{waitForServer:!!((t=r==null?void 0:r.groups)!=null&&t.wait)}}}function dd(e,t){t.httpRegion.hooks.onStreaming.addHook("streaming_body",async r=>{if(r.requestClient)return new Promise(o=>{ud(e,r,o)})})}async function ud(e,t,r){var s;let o=0;for(let n of e){let i=e.indexOf(n)===e.length-1;if(n.wait&&o++,o===0)await ti(n,t),i&&r();else{let a=0,d=o;(s=t.requestClient)==null||s.addEventListener("message",async()=>{++a===d&&(await ti(n,t),i&&r())})}}}async function ti(e,t){var r;if(await Bo(e,t),e.body){let o=await Mo(e.body,t);o&&await((r=t.requestClient)==null?void 0:r.send(o))}}async function oi(e){if(e.data.httpResponseSymbol){if(e.httpRegion.response&&e.data.httpResponseSymbol.body.length>0){let t=e.httpRegion.response,r=U(e.data.httpResponseSymbol.body);t.body=r,t.rawBody=Buffer.from(r),t.headers&&(t.contentType=we(t.headers));let o=e.data.httpResponseSymbol.symbol;if(o.children){let s=e.data.httpResponseSymbol.body.at(-1);o.children.push(new v({name:"response body",description:"response body",kind:"response",startLine:o.endLine-e.data.httpResponseSymbol.body.length+1,startOffset:0,endLine:o.endLine,endOffset:(s==null?void 0:s.length)||0}))}}delete e.data.httpResponseSymbol}}async function si(e){let{httpRegion:t,httpFile:r}=e,{metaData:o}=t;pd(o),md(t,r)}function pd(e){let t=e.name;if(typeof t!="string")return;let r=No(e);for(let o of r)if(o===t){let s=`Self-reference detected: region named "${t}" has @ref/@forceRef to itself. This causes an infinite loop. Check for missing ### separator between requests.`;throw f.error(s),new Error(s)}}function md(e,t){let r=e.metaData.name;if(typeof r!="string")return;let o=No(e.metaData);if(o.length===0)return;let s=new Map;for(let l of t.httpRegions){let u=l.metaData.name;typeof u=="string"&&s.set(u,No(l.metaData))}s.set(r,o);let n=new Set,i=[];function a(l){if(i.includes(l)){let m=i.indexOf(l);return[...i.slice(m),l]}if(n.has(l))return null;n.add(l),i.push(l);let u=s.get(l);if(u)for(let m of u){let h=a(m);if(h)return h}return i.pop(),null}let d=a(r);if(d){let u=`Circular reference detected: ${d.join(" -> ")}. This will cause an infinite loop at runtime.`;throw f.error(u),new Error(u)}}function No(e){let t=[];return typeof e.ref=="string"&&t.push(...e.ref.split(/\s*,\s*/)),typeof e.forceRef=="string"&&t.push(...e.forceRef.split(/\s*,\s*/)),t}var ni={id:"escapeVariable",afterLoop:async function(t){let[r]=t.args;if(c(r)){let o=/(?:\\\{){2}([^}]+?)(?:\\\}){2}/gu,s,n=r;for(;c(n)&&(s=o.exec(r))!==null;){let[i,a]=s;n=n.replace(i,()=>`{{${a}}}`)}n!==r&&t.results.push(n)}return!0}};async function ii(e,t,r){return M(e,async o=>{let s=gt(o);if(s){let n=await le(s.fileName,r,async i=>s.injectVariables||s.encoding?await p.readFile(i,s.encoding):p.readBuffer(i));return s.injectVariables&&(n=await $(n,t,r)),n}})}async function ai(e,t,{variables:r,request:o}){if(c(e)&&"Url"===t&&e.startsWith("/")){let s=q(o==null?void 0:o.headers,"Host");if(c(s)){let[,n]=s.toString().split(":");return`${n==="443"||n==="8443"?"https":"http"}://${s}${e}`}if(r.host)return`${r.host}${e}`}return e}async function li(e,t,r){return M(e,async o=>r.variables[o])}var Ge=A(require("dayjs")),Uo=A(require("dayjs/plugin/utc")),di=require("uuid");Ge.default.extend(Uo.default);async function ui(e,t,{variables:r}){return M(e,async o=>{var n,i,a,d,l,u,m,h,R,k,C,I;let s=o.trim();if(s==="$guid")return(0,di.v4)();if(s.startsWith("$randomInt")){let b=/^\$randomInt\s*(?<min>-?\d+)?\s*(?<max>-?\d+)?\s*$/u.exec(s);if(b&&((n=b.groups)!=null&&n.min)&&((i=b.groups)!=null&&i.max)){let g=P((a=b.groups)==null?void 0:a.min)??0,F=P((d=b.groups)==null?void 0:d.max)??100;if(!Number.isNaN(g)&&!Number.isNaN(F)){if(g>F){let he=F;F=g,g=he}return`${Math.floor(Math.random()*(F-g))+g}`}}}else if(s.startsWith("$timestamp")){let b=/^\$timestamp(?:\s(?<offset>-?\d+)\s(?<option>y|Q|M|w|d|h|m|s|ms))?/u.exec(s);if(b){Ge.default.extend(Uo.default);let g=Ge.default.utc();return(l=b.groups)!=null&&l.offset&&((u=b.groups)!=null&&u.option)&&(g=g.add(Number(b.groups.offset),b.groups.option)),`${g.unix()}`}}else if(s.startsWith("$datetime")){let b=/^\$datetime\s(?<type>rfc1123|iso8601|'.+'|".+")(?:\s(?<offset>-?\d+)\s(?<option>y|Q|M|w|d|h|m|s|ms))?/u.exec(s);if((m=b==null?void 0:b.groups)!=null&&m.type){let g=Ge.default.utc();return(h=b.groups)!=null&&h.offset&&((R=b.groups)!=null&&R.option)&&(g=g.add(Number(b.groups.offset),b.groups.option)),b.groups.type==="rfc1123"?g.toDate().toUTCString():b.groups.type==="iso8601"?g.toISOString():g.format(b.groups.type.slice(1,b.groups.type.length-1))}}else if(s.startsWith("$localDatetime")){let b=/^\$localDatetime\s(?<type>rfc1123|iso8601|'.+'|".+")(?:\s(?<offset>-?\d+)\s(?<option>y|Q|M|w|d|h|m|s|ms))?/u.exec(s);if((k=b==null?void 0:b.groups)!=null&&k.type){let g=Ge.default.utc().local();return(C=b.groups)!=null&&C.offset&&((I=b.groups)!=null&&I.option)&&(g=g.add(Number(b.groups.offset),b.groups.option)),b.groups.type==="rfc1123"?g.locale("en").format("ddd, DD MMM YYYY HH:mm:ss ZZ"):b.groups.type==="iso8601"?g.format():g.format(b.groups.type.slice(1,b.groups.type.length-1))}}else{if(s.startsWith("$processEnv"))return process.env[s.slice(11).trim()]||"";if(s.startsWith("$dotenv"))return r[s.slice(7).trim()]||""}})}var pi=require("hookpoint");async function mi(e,t,{variables:r}){return M(e,async o=>{var i;let n=/^\$(?<type>(prompt|input|password))(?<askonce>-askonce)?\s*(?<placeholder>[^$]*)(\$value:\s*(?<value>.*))?\s*$/u.exec(o);if((i=n==null?void 0:n.groups)!=null&&i.placeholder){let a=n.groups.placeholder.trim(),d=n.groups.type,l=`input_${a}`,u=w.getUserSession(l);if(n.groups.askonce){if((r==null?void 0:r[a])!==void 0)return r[a];if(u!=null&&u.answer)return u.answer}let m=d==="password",h=await L.showInputPrompt(a,(u==null?void 0:u.answer)||n.groups.value,m);return h!==void 0?(w.setUserSession({id:l,title:m?a:`${a}=${h}`,description:`Cache for ${d}`,type:"input",details:{placeholder:a,inputType:d,answer:m?void 0:h},answer:h}),h):pi.HookCancel}})}var ci=require("hookpoint");async function fi(e,t,r){return M(e,async o=>{var n,i;let s=/^\$pick(?<save>-askonce)?\s*(?<placeholder>[^$]*)(\$value:\s*(?<value>.*))\s*$/u.exec(o);if((n=s==null?void 0:s.groups)!=null&&n.placeholder&&((i=s==null?void 0:s.groups)!=null&&i.value)){let a=s.groups.placeholder.trim(),d=`input_${a}`,l=w.getUserSession(d);if(l!=null&&l.answer&&s.groups.save)return l.answer;let u=await fd(s.groups.value,r),m=await L.showListPrompt(a,u);return m!==void 0?(w.setUserSession({id:d,title:`${a}=${m}`,description:"Cache for $pick",type:"input",details:{placeholder:a,answer:m},answer:m}),m):ci.HookCancel}})}async function fd(e,t){let r=e.split(",");if(r.length===1)try{let o=await H.evalExpression(e,t);if(Array.isArray(o))return o}catch(o){f.trace("error in quickpick",o)}return r}function gi(e,t){let{httpRegion:r}=t;if(c(r.metaData.name)){let o=r.metaData.name.trim().replace(/\s/gu,"-").replace(/-./gu,s=>s[1].toUpperCase());D({[o]:e.parsedBody||e.body,[`${o}Response`]:e},t)}}var hi={id:"jsonResponseBody",beforeLoop:async function(t){let[r]=t.args;if(r&&at(r.contentType)&&c(r.body)&&r.body.length>0)try{r.parsedBody||(r.parsedBody=JSON.parse(r.body)),r.prettyPrintBody||(r.prettyPrintBody=O(r.parsedBody,2))}catch(o){f.warn("json parse error",r.body,o)}return!0}};function yi(e,t){let r=Zr(e);w.setUserSession({id:"last_response",title:"last response",description:`response of ${t.httpRegion.symbol.name}`,details:{},type:"LAST_RESPONSE",response:r}),t.variables.response=e}function bi(e){yd(e),bd(e),xd(e),Pd(e),kd(e),Rd(e),wd(e),vd(e)}function yd(e){e.hooks.onRequest.addHook("attachDefaultHeaders",Un),e.hooks.onRequest.addHook("setEnvRequestOptions",Yn),e.hooks.onRequest.addHook("resolveRequestBody",zn),e.hooks.onRequest.addHook("setDefaultHttpyacHeaders",Xn),e.hooks.onRequest.addHook("requestVariableReplacer",Jn),e.hooks.onRequest.addHook("transformRequestBody",Qn),e.hooks.onRequest.addHook("transformMultilineFormUrlEncoded",Zn),e.hooks.onRequest.addHook("encodeRequestBody",Kn),e.hooks.onRequest.addInterceptor(Wn),e.hooks.onRequest.addInterceptor(Gn)}function bd(e){e.hooks.onResponse.addHook("handleMetaDataName",gi),e.hooks.onResponse.addHook("setLastResponseInVariables",yi),e.hooks.onResponse.addInterceptor(hi)}function xd(e){e.hooks.parse.addHook("meta",Dn),e.hooks.parse.addHook("comment",An),e.hooks.parse.addHook("variable",Mn),e.hooks.parse.addHook("request",jn),e.hooks.parse.addHook("outputRedirection",Fn),e.hooks.parse.addHook("responseRef",Bn),e.hooks.parse.addHook("response",Vn),e.hooks.parse.addHook("requestBody",In),e.hooks.parse.addInterceptor(new hr)}function Rd(e){e.hooks.parseEndRegion.addHook("registerCancelExecutionInterceptor",Nn),e.hooks.parseEndRegion.addHook("response",oi),e.hooks.parseEndRegion.addHook("requestBody",ri),e.hooks.parseEndRegion.addHook("validateHttpRegion",si)}function vd(e){e.hooks.replaceVariable.addHook("host",ai),e.hooks.replaceVariable.addHook("name",li),e.hooks.replaceVariable.addHook("file",ii),e.hooks.replaceVariable.addHook("showInputBox",mi),e.hooks.replaceVariable.addHook("showQuickPick",fi),e.hooks.replaceVariable.addHook("restClientDynamic",ui),e.hooks.replaceVariable.addInterceptor(ni)}function kd(e){e.hooks.parseMetaData.addHook("disabled",mn),e.hooks.parseMetaData.addHook("import",fn),e.hooks.parseMetaData.addHook("jwt",gn),e.hooks.parseMetaData.addHook("keepStreaming",yn),e.hooks.parseMetaData.addHook("loop",Rn),e.hooks.parseMetaData.addHook("noRedirect",vn),e.hooks.parseMetaData.addHook("noRejectUnauthorized",kn),e.hooks.parseMetaData.addHook("timeout",En),e.hooks.parseMetaData.addHook("note",Pn),e.hooks.parseMetaData.addHook("proxy",wn),e.hooks.parseMetaData.addHook("rateLimit",Hn),e.hooks.parseMetaData.addHook("ref",Tn),e.hooks.parseMetaData.addHook("responseRef",Ln),e.hooks.parseMetaData.addHook("sleep",qn),e.hooks.parseMetaData.addHook("verbose",On),e.hooks.parseMetaData.addHook("forceRegionDelimiter",cn)}function Pd(e){let t=new mr;e.hooks.execute.addInterceptor(new cr),e.hooks.execute.addInterceptor(t),e.hooks.responseLogging.addInterceptor(t.getResponseLoggingInterceptor()),e.hooks.execute.addInterceptor(new dr),e.hooks.execute.addInterceptor(new ur),e.hooks.execute.addInterceptor(new pr)}function wd(e){e.hooks.provideEnvironments.addHook("config",en),e.hooks.provideVariables.addHook("config",tn),e.hooks.provideVariables.addHook("response",dn)}var xi=require("dotenv");var _o=".env";async function Ri(e){let t=[];if(process.env.HTTPYAC_ENV)try{t.push(...await p.readdir(process.env.HTTPYAC_ENV))}catch(s){f.warn(`HTTPYAC_ENV ${process.env.HTTPYAC_ENV} has read error`,s)}let r=p.dirname(e.httpFile.fileName);r&&await pe(r,e.httpFile.rootDir,async s=>{t.push(...await Hd(ki(e),s)),t.push(...await Ce(p.readdir(s),[]))});let o=[];for(let s of t){let n;s.startsWith(`${_o}.`)?n=s.slice(5):s.endsWith(_o)&&(n=s.slice(0,s.length-4)),n&&o.push(n)}return f.info("dotenv Env Provider found environments",o),o}async function Hd(e,t){let r=[];if(e){let o=await V(e,t);o&&r.push(...await Ce(p.readdir(o),[]))}return r}async function vi(e,t){let r=Cd(e),o=[];process.env.HTTPYAC_ENV&&o.push(...await Ko(r,process.env.HTTPYAC_ENV));let s=p.dirname(t.httpFile.fileName);if(s){let n=[];await pe(s,t.httpFile.rootDir,async i=>{n.unshift(...await Sd(ki(t),r,i)),n.unshift(...await Ko(r,i))}),o.push(...n)}return Object.assign({},...o)}function ki(e){var t;return((t=e.config)==null?void 0:t.envDirName)||"env"}function Cd(e){let t=[_o];if(e)for(let r of e)t.push(`${r}.env`,`.env.${r}`);return t}async function Sd(e,t,r){let o=[];if(e){let s=await V(e,r);s&&o.push(...await Ko(t,s))}return o}async function Ko(e,t){let r=await Ce(p.readdir(t),[]),o=e.filter(n=>r.indexOf(n)>=0),s=[];for(let n of o){let i=p.joinPath(t,n);f.trace(`.env environment file found: ${i}`);try{let a=await p.readFile(i,"utf-8"),d=(0,xi.parse)(a);s.push(d)}catch(a){f.trace(`${p.toString(i)} not found`,a)}}return s}function Pi(e){e.hooks.provideEnvironments.addHook("dotenv",Ri),e.hooks.provideVariables.addHook("dotenv",vi)}var wi=A(require("aws4")),Hi=require("url");async function Ci(e,t,r){var s;let{request:o}=r;if(t.toLowerCase()==="authorization"&&c(e)&&E(o)&&(o!=null&&o.url)){let n=/^\s*(aws)\s+(?<accessKeyId>[^\s]*)\s+(?<secretAccessKey>[^\s]*)\s*(token:\s*(?<token>[^\s]*))?\s*(region:\s*(?<region>[^\s]*))?\s*(service:\s*(?<service>[^\s]*))?\s*$/iu.exec(e);if(n&&n.groups&&n.groups.accessKeyId&&n.groups.secretAccessKey){T(r,"get AWS Authorization");let i={accessKeyId:n.groups.accessKeyId,secretAccessKey:n.groups.secretAccessKey,sessionToken:n.groups.token},a=new Hi.URL(o.url);o.headers||(o.headers={});let d={method:o.method,headers:o.headers,host:a.host,path:`${a.pathname}${a.search}`,region:n.groups.region,service:n.groups.service,body:Buffer.isBuffer(o.body)||c(o.body)?o.body:void 0},l=await wi.default.sign(d,i);return Object.assign(o,{http2:!1}),Object.assign(o.headers,l.headers),(s=l.headers)==null?void 0:s.Authorization}}return e}var Td=/^\s*(basic)\s+(?<user>[^\s]*)\s+(?<password>([^\s]+.*))$/iu,Ld=/^\s*(basic)\s+(?<user>.*):(?<password>.*)$/iu;async function Si(e,t){if(t.toLowerCase()==="authorization"&&c(e)){let r=Ld.exec(e)||Td.exec(e);if(r&&r.groups&&r.groups.user)return`Basic ${Buffer.from(`${r.groups.user}:${r.groups.password}`).toString("base64")}`}return e}var Ti=require("url");async function Li(e,t,r){var i,a,d;let{request:o,httpRegion:s,httpFile:n}=r;if(c(e)&&E(o)&&!s.metaData.noClientCert){if(t==="Url"&&((i=r.config)!=null&&i.clientCertificates))await qd(e,o,r);else if(t.toLowerCase().endsWith("clientcert")){let l=/^\s*(cert:\s*(?<cert>[^\s]*)\s*)?(key:\s*(?<key>[^\s]*)\s*)?(pfx:\s*(?<pfx>[^\s]*)\s*)?(passphrase:\s*(?<passphrase>[^\s]*)\s*)?\s*$/u.exec(e);if((a=l==null?void 0:l.groups)!=null&&a.cert||(d=l==null?void 0:l.groups)!=null&&d.pfx){await qi(o,{cert:l.groups.cert,key:l.groups.key,pfx:l.groups.pfx,passphrase:l.groups.passphrase},n);return}}}return e}async function qd(e,t,r){var s,n;let o=Ed(e);if(o&&((s=r.config)!=null&&s.clientCertificates)){let i=(n=r.config)==null?void 0:n.clientCertificates[o.host];i&&await qi(t,i,r.httpFile)}}function Ed(e){try{return new Ti.URL(e)}catch{return}}async function qi(e,t,r){let o=p.dirname(r.fileName);e.options||(e.options={}),e.options.https=Object.assign({},e.options.https,{certificate:await Go(t.cert,o),key:await Go(t.key,o),pfx:await Go(t.pfx,o),passphrase:t.passphrase})}async function Go(e,t){if(e)if(c(e)){let r=await V(e,t);if(r)return await p.readBuffer(r)}else return await p.readBuffer(e)}W.emptyLineProvider.push(()=>[{name:"GET",description:"The GET method requests a representation of the specified resource. Requests using GET should only retrieve data."},{name:"HEAD",description:"The GET method requests a representation of the specified resource. Requests using GET should only retrieve data."},{name:"POST",description:"The POST method is used to submit an entity to the specified resource, often causing a change in state or side effects on the server."},{name:"PUT",description:"The PUT method replaces all current representations of the target resource with the request payload."},{name:"DELETE",description:"The DELETE method deletes the specified resource."},{name:"CONNECT",description:"The CONNECT method establishes a tunnel to the server identified by the target resource."},{name:"OPTIONS",description:"The OPTIONS method is used to describe the communication options for the target resource."},{name:"TRACE",description:"The TRACE method performs a message loop-back test along the path to the target resource."},{name:"PATCH",description:"The PATCH method is used to apply partial modifications to a resource."}]);W.requestHeaderProvider.push(e=>E(e)?[{name:"A-IM",description:"Acceptable instance-manipulations for the request."},{name:"Accept",description:"Media type(s)\xA0that is/are acceptable for the response. See\xA0Content negotiation."},{name:"Accept-Charset",description:"Character sets that are acceptable."},{name:"Accept-Datetime",description:"Acceptable version in time."},{name:"Accept-Encoding",description:"List of acceptable encodings. See\xA0HTTP compression."},{name:"Accept-Language",description:"List of acceptable human languages for response. See\xA0Content negotiation."},{name:"Access-Control-Request-Method",description:"Initiates a request for\xA0cross-origin resource sharing\xA0with\xA0Origin\xA0(below)."},{name:"Access-Control-Request-Headers",description:"Initiates a request for\xA0cross-origin resource sharing\xA0with\xA0Origin\xA0(below)."},{name:"Authorization",description:"Authentication credentials for\xA0HTTP authentication."},{name:"Cache-Control",description:"Used to specify directives that\xA0must\xA0be obeyed by all caching mechanisms along the request-response chain."},{name:"Connection",description:"Control options for the current connection and list of hop-by-hop request fields. Must not be used with HTTP/2."},{name:"Content-Encoding",description:"The type of encoding used on the data. See\xA0HTTP compression."},{name:"Content-Length",description:"The length of the request body in\xA0octets\xA0(8-bit bytes)."},{name:"Content-MD5",description:"A\xA0Base64-encoded binary\xA0MD5\xA0sum of the content of the request body."},{name:"Content-Type",description:"The\xA0Media type\xA0of the body of the request (used with POST and PUT requests)."},{name:"Cookie",description:"An\xA0HTTP cookie\xA0previously sent by the server with\xA0Set-Cookie\xA0(below)."},{name:"Date",description:'The date and time at which the message was originated (in "HTTP-date" format as defined by\xA0RFC 7231 Date/Time Formats).'},{name:"Expect",description:"Indicates that particular server behaviors are required by the client."},{name:"Forwarded",description:"Disclose original information of a client connecting to a web server through an HTTP proxy."},{name:"From",description:"The email address of the user making the request."},{name:"Host",description:"The domain name of the server (for\xA0virtual hosting), and the\xA0TCP port\xA0number on which the server is listening. The\xA0port\xA0number may be omitted if the port is the standard port for the service requested. Mandatory since HTTP/1.1.\xA0If the request is generated directly in HTTP/2, it should not be used."},{name:"HTTP2-Settings",description:"A request that upgrades from HTTP/1.1 to HTTP/2 MUST include exactly one\xA0HTTP2-Setting\xA0header field. The\xA0HTTP2-Settings\xA0header field is a connection-specific header field that includes parameters that govern the HTTP/2 connection, provided in anticipation of the server accepting the request to upgrade."},{name:"If-Match",description:"Only perform the action if the client supplied entity matches the same entity on the server. This is mainly for methods like PUT to only update a resource if it has not been modified since the user last updated it."},{name:"If-Modified-Since",description:"Allows a\xA0304 Not Modified\xA0to be returned if content is unchanged."},{name:"If-None-Match",description:"Allows a\xA0304 Not Modified\xA0to be returned if content is unchanged, see\xA0HTTP ETag."},{name:"If-Range",description:"If the entity is unchanged, send me the part(s) that I am missing; otherwise, send me the entire new entity."},{name:"If-Unmodified-Since",description:"Only send the response if the entity has not been modified since a specific time."},{name:"Max-Forwards",description:"Limit the number of times the message can be forwarded through proxies or gateways."},{name:"Origin",description:"Initiates a request for\xA0cross-origin resource sharing\xA0(asks server for\xA0Access-Control-*\xA0response fields)."},{name:"Pragma",description:"Implementation-specific fields that may have various effects anywhere along the request-response chain."},{name:"Proxy-Authorization",description:"Authorization credentials for connecting to a proxy."},{name:"Range",description:"Request only part of an entity. Bytes are numbered from 0. See\xA0Byte serving."},{name:"Referer",description:'This is the address of the previous web page from which a link to the currently requested page was followed. (The word "referrer" has been misspelled in the RFC as well as in most implementations to the point that it has become standard usage and is considered correct terminology)'},{name:"TE",description:'The transfer encodings the user agent is willing to accept: the same values as for the response header field Transfer-Encoding can be used, plus the "trailers" value (related to the "chunked" transfer method) to notify the server it expects to receive additional fields in the trailer after the last, zero-sized, chunk. Only\xA0trailers\xA0is supported in HTTP/2.'},{name:"Trailer",description:"The Trailer general field value indicates that the given set of header fields is present in the trailer of a message encoded with\xA0chunked transfer coding."},{name:"Transfer-Encoding",description:"The form of encoding used to safely transfer the entity to the user.\xA0Currently defined methods\xA0are:\xA0chunked, compress, deflate, gzip, identity. Must not be used with HTTP/2"},{name:"User-Agent",description:"The\xA0user agent string\xA0of the user agent."},{name:"Upgrade",description:"Ask the server to upgrade to another protocol. Must not be used in HTTP/2."},{name:"Via",description:"Informs the server of proxies through which the request was sent."},{name:"Warning",description:"A general warning about possible problems with the entity body."},{name:"Upgrade-Insecure-Requests",description:"Tells a server which (presumably in the middle of a HTTP -> HTTPS migration) hosts mixed content that the client would prefer redirection to HTTPS and can handle\xA0Content-Security-Policy: upgrade-insecure-requests Must not be used with HTTP/2"},{name:"X-Requested-With",description:"Mainly used to identify\xA0Ajax\xA0requests (most\xA0JavaScript frameworks\xA0send this field with value of\xA0XMLHttpRequest); also identifies Android apps using WebView"},{name:"DNT",description:"Requests a web application to disable their tracking of a user. This is Mozilla`s version of the X-Do-Not-Track header field (since\xA0Firefox 4.0\xA0Beta 11).\xA0Safari\xA0and\xA0IE9\xA0also have support for this field.\xA0On March 7, 2011, a draft proposal was submitted to IETF.\xA0The\xA0W3C\xA0Tracking Protection Working Group is producing a specification."},{name:"X-Forwarded-For",description:"A\xA0de facto\xA0standard\xA0for identifying the originating IP address of a client connecting to a web server through an HTTP proxy or load balancer. Superseded by\xA0Forwarded\xA0header."},{name:"X-Forwarded-Host",description:"A\xA0de facto\xA0standard\xA0for identifying the original host requested by the client in the\xA0Host\xA0HTTP request header, since the host name and/or port of the reverse proxy (load balancer) may differ from the origin server handling the request. Superseded by\xA0Forwarded\xA0header."},{name:"X-Forwarded-Proto",description:"A\xA0de facto\xA0standard\xA0for identifying the originating protocol of an HTTP request, since a reverse proxy (or a load balancer) may communicate with a web server using HTTP even if the request to the reverse proxy is HTTPS. An alternative form of the header (X-ProxyUser-Ip) is used by Google clients talking to Google servers. Superseded by\xA0Forwarded\xA0header."},{name:"Front-End-Https",description:"Non-standard header field used by Microsoft applications and load-balancers"},{name:"X-Http-Method-Override",description:"Requests a web application to override the method specified in the request (typically POST) with the method given in the header field (typically PUT or DELETE). This can be used when a user agent or firewall prevents PUT or DELETE methods from being sent directly (note that this is either a bug in the software component, which ought to be fixed, or an intentional configuration, in which case bypassing it may be the wrong thing to do)."},{name:"X-ATT-DeviceId",description:"Allows easier parsing of the MakeModel/Firmware that is usually found in the User-Agent String of AT&T Devices"},{name:"X-Wap-Profile",description:"Links to an XML file on the Internet with a full description and details about the device currently connecting. In the example to the right is an XML file for an AT&T Samsung Galaxy S2."},{name:"Proxy-Connection",description:"Implemented as a misunderstanding of the HTTP specifications. Common because of mistakes in implementations of early HTTP versions. Has exactly the same functionality as standard Connection field. Must not be used with HTTP/2."},{name:"X-UIDH",description:'Server-side\xA0deep packet insertion\xA0of a unique ID identifying customers of\xA0Verizon Wireless; also known as "perma-cookie" or "supercookie"'},{name:"X-Csrf-Token",description:"Used to prevent\xA0cross-site request forgery. Alternative header names are:\xA0X-CSRFToken\xA0and\xA0X-XSRF-TOKEN"},{name:"X-Request-ID",description:"Correlates HTTP requests between a client and server."},{name:"X-Correlation-ID",description:"Correlates HTTP requests between a client and server."},{name:"Save-Data",description:"The Save-Data client hint request header available in Chrome, Opera, and Yandex browsers lets developers deliver lighter, faster applications to users who opt-in to data saving mode in their browser."}]:[]);var Rt=require("tough-cookie");var yr=class{constructor(){this.id="cookieJar"}async beforeTrigger(t){let{request:r,httpRegion:o,config:s,options:n}=t.args[0];if(E(r)&&!o.metaData.noCookieJar&&(s!=null&&s.cookieJarEnabled)){let i=this.getCookieStorePrefix(t.args[0]),a=w.userSessions.filter(m=>m.type==="Cookie"&&m.id.startsWith(i)),d=new Rt.MemoryCookieStore;for(let m of a)m.cookie&&d.putCookie(m.cookie,h=>{h&&f.info(h)});n.memoryStore=d;let l={};s.cookieJarEnabled!==!0&&Object.assign(l,s.cookieJarEnabled);let u=new Rt.CookieJar(d,l);r.options||(r.options={}),r.options.cookieJar=u}return!0}async afterTrigger(t){let{options:r}=t.args[0],o=r.memoryStore;if(o&&o instanceof Rt.MemoryCookieStore){o.getAllCookies((n,i)=>{if(!n)for(let a of i||[]){let d={id:`${this.getCookieStorePrefix(t.args[0])}_${a.toString()}`,title:`${a.domain} ${a.path} ${a.key}`,description:`${a}`,type:"Cookie",details:Object.fromEntries(Object.entries(a).map(([l,u])=>u?u instanceof Date?[l,u.toISOString()]:[l,u]:[]).filter(l=>l.length>0)),cookie:a};w.setUserSession(d)}});let s=w.userSessions.filter(n=>n.type==="Cookie");for(let n of s)n.cookie&&o.putCookie(n.cookie,i=>{i&&f.info(i)})}return!0}getCookieStorePrefix(t){var r,o;return`Cookies_${B(t.activeEnvironment)}_${((o=(r=t.httpFile.rootDir)==null?void 0:r.toString)==null?void 0:o.call(r))||"none"}`}};var Ei=require("tough-cookie");async function Oi(e,t,r){var s;let{request:o}=r;if(t.toLowerCase()==="cookie"&&E(o)&&o.url&&((s=o.options)==null?void 0:s.cookieJar)instanceof Ei.CookieJar){if(c(e))o.options.cookieJar.setCookie(e,o.url);else if(Array.isArray(e))for(let n of e)await o.options.cookieJar.setCookie(n,o.url);return}return e}var Vi=require("crypto"),Bi=require("url"),Mi=require("uuid");var Ai=require("filesize"),br=A(require("got")),$i=require("http-proxy-agent"),Di=require("https-proxy-agent"),Ii=A(require("lodash/merge")),Fi=require("socks-proxy-agent");async function ji(e,t){try{let r=Wo(e,t),s=await(0,br.default)(e.url||"",r);return Ee(s,e)}catch(r){if(r instanceof br.CancelError)return!1;throw r}}function Wo(e,t){var s;let{config:r}=t,o=(0,Ii.default)({decompress:!0,retry:0,throwHttpErrors:!1,allowGetBody:!0},r==null?void 0:r.request,{method:e.method,headers:e.headers,body:e.body,timeout:e.timeout},e.options);return e.noRedirect&&(o.followRedirect=!1),e.noRejectUnauthorized&&(o.https=((s=e.options)==null?void 0:s.https)||{},o.https.rejectUnauthorized=!1),Od(o,e.proxy),Ad(o.headers),f.debug("request",o),o}function Od(e,t){if(t)if(t.startsWith("socks://")){let r=new Fi.SocksProxyAgent(t);e.agent={http:r,https:r}}else e.agent={http:new $i.HttpProxyAgent(t),https:new Di.HttpsProxyAgent(t)}}function Ad(e){if(e){for(let[t,r]of Object.entries(e))if(typeof r<"u"){let o;Array.isArray(r)?o=r.map(s=>x(s)||s):o=x(r)||"",e[t]=o}}}function Ee(e,t){var r;return{name:`${e.statusCode} - ${t.method||"GET"} ${t.url}`,statusCode:e.statusCode,protocol:`HTTP/${e.httpVersion}`,statusMessage:e.statusMessage,body:e.body,rawHeaders:e.rawHeaders,rawBody:e.rawBody,headers:e.headers,timings:e.timings.phases,httpVersion:e.httpVersion,request:{protocol:"HTTP",method:e.request.options.method,url:`${e.request.options.url}`,headers:e.request.options.headers,body:Jo(e.request.options.body)},contentType:we(e.headers),meta:{ip:e.ip,redirectUrls:e.redirectUrls,size:(0,Ai.filesize)(e.rawHeaders.map(o=>o.length).reduce((o,s)=>o+s,0)+(((r=e.rawBody)==null?void 0:r.length)||0))}}}function Jo(e){if(typeof e=="string"||Buffer.isBuffer(e))return e}var $d=/^\s*(digest)\s+(?<user>[^\s]*)\s+(?<password>([^\s]+.*))$/iu,Dd=/^\s*(digest)\s+(?<user>.*):(?<password>.*)$/iu;async function Ni(e,t,r){let{request:o}=r;if(t.toLowerCase()==="authorization"&&c(e)&&E(o)){let s=Dd.exec(e)||$d.exec(e);if(s&&s.groups&&s.groups.user&&s.groups.password){o.options||(o.options={}),o.options.hooks||(o.options.hooks={}),o.options.hooks.afterResponse||(o.options.hooks.afterResponse=[]),o.options.hooks.afterResponse.push(Id(s.groups.user,s.groups.password,r));return}}return e}function Id(e,t,r){return async function(s,n){let i=s.headers["www-authenticate"];if(s.statusCode===401&&i&&i.toLowerCase().startsWith("digest")){let a=Ee(s,{url:s.request.requestUrl});await Te(a,r);let d=new Bi.URL(s.url),l={qop:"",algorithm:"",realm:"",nonce:"",opaque:""};Vd(l,i);let u=/(^|,)\s*auth\s*($|,)/u.test(l.qop)&&"auth",m=u&&"00000001",h=u&&(0,Mi.v4)().replace(/-/gu,""),R=jd(l.algorithm,e,t,l.realm,l.nonce,h),k=vt(`${s.request.options.method}:${d.pathname}`),C=vt(u?`${R}:${l.nonce}:${m}:${h}:${u}:${k}`:`${R}:${l.nonce}:${k}`);return n({headers:{authorization:`Digest ${Fd({username:e,realm:l.realm,nonce:l.nonce,uri:d.pathname,qop:u,response:C,nc:m,cnonce:h,algorithm:l.algorithm,opaque:l.opaque})}`}})}return s}}function Fd(e){let t=[];for(let[r,o]of Object.entries(e))o&&(["qop","nc","algorithm"].indexOf(r)>=0?t.push(`${r}=${o}`):t.push(`${r}="${o}"`));return t.join(", ")}function vt(e){return(0,Vi.createHash)("md5").update(e).digest("hex")}function jd(e,t,r,o,s,n){let i=vt(`${t}:${o}:${r}`);return n&&(e==null?void 0:e.toLowerCase())==="md5-sess"?vt(`${i}:${s}:${n}`):i}function Vd(e,t){for(let r of t.split(",")){let o=/([a-z0-9_-]+)=(?:"([^"]+)"|([a-z0-9_-]+))/giu.exec(r);o&&(e[o[1]]=o[2]||o[3])}}var kt=A(require("got"));var xr=class extends nt{constructor(r,o){super();this.request=r;this.context=o}get reportMessage(){return`perform Http Request (${this.request.url})`}get supportsStreaming(){return!1}get nativeClient(){return kt.default}async connect(){return this.nativeClient}async send(r){if(E(this.request)&&this.request.url)try{let o=Wo(this.request,this.context);r&&(o.body=ie(r)),this.cancelableRequest=(0,kt.default)(this.request.url,o),this.registerEvents(this.cancelableRequest);let s=await this.cancelableRequest;this.onMessage("message",Ee(s,this.request))}catch(o){if(o instanceof kt.CancelError)return;throw o instanceof TypeError&&o.message==="Invalid URL"&&(o.message=`Invalid URL: ${o.input||this.request.url}`),o}finally{delete this.cancelableRequest}}disconnect(r){var o;r&&((o=this.cancelableRequest)==null||o.cancel(),this.onDisconnect())}registerEvents(r){r.on("downloadProgress",s=>{this.onProgress(s.percent)});let o=s=>(...n)=>{this.onMetaData(s,{protocol:"HTTP",statusCode:0,message:n.length>0?`${x(n[0])}`:void 0,body:{...n}})};r.on("redirect",o("redirect")),r.on("retry",o("retry")),r.on("downloadProgress",o("downloadProgress")),r.on("uploadProgress",o("uploadProgress"))}};async function Ui(e,t){var r,o;if(e&&E(e)){e.options||(e.options={}),(r=e.options)!=null&&r.hooks||(e.options.hooks={}),(o=e.options)!=null&&o.hooks.beforeRedirect||(e.options.hooks.beforeRedirect=[]),e.options.hooks.beforeRequest||(e.options.hooks.beforeRequest=[]);let s;e.options.hooks.beforeRequest.push(n=>{s={protocol:"HTTP",method:n.method,url:`${n.url}`,headers:n.headers,body:Jo(n.body)}}),e.options.hooks.beforeRedirect.push(async(n,i)=>{let a=Ee(i,s||{url:x(n.url)||""});await Te(a,t)})}}function _i(e,t,r){return e==="postRedirectGet"?(r.httpRegion.hooks.onRequest.addHook("postRedirectGet",async o=>{E(o)&&(o.options||(o.options={}),o.options.hooks||(o.options.hooks={}),o.options.hooks.beforeRedirect||(o.options.hooks.beforeRedirect=[]),o.options.hooks.beforeRedirect.push(s=>{s.method="GET",s.body=void 0}))}),!0):!1}se.exchange=ji;se.createRequestClient=(e,t)=>new xr(e,t);function Ki(e){e.hooks.parseMetaData.addHook("postRedirectGet",_i),e.hooks.execute.addInterceptor(new yr),e.hooks.replaceVariable.addHook("aws",Ci),e.hooks.replaceVariable.addHook("basicAuth",Si),e.hooks.replaceVariable.addHook("clientCertificate",Li),e.hooks.replaceVariable.addHook("digestAuth",Ni),e.hooks.replaceVariable.addHook("cookie",Oi),e.hooks.onRequest.addHook("logHttpRedirect",Ui)}var We=class{constructor(t,r,o){this.extensions=t;this.beginCodeBlock=r;this.endCodeBlock=o}async beforeTrigger(t){let r=t.args[0],o=t.args[1];if(p.hasExtension(o.httpFile.fileName,...this.extensions)){let s=this.getHttpBlockLines(o.lines,o.data);t.args[0]=function*(i){if(s.length>0){let a=r(!0);for(let d of a){let l=s.find(u=>u.startLine<=d.line&&d.line<u.endLine);if(l)if(l.startLine===d.line)yield{line:d.line,textLine:"###"};else{if(!i&&Le.test(d.textLine))break;yield d}else break}}}}return!0}getHttpBlockLines(t,r){if(r.codeBlocks)return r.codeBlocks;let o=[],s=-1;for(let n=0;n<t.length;n++){let i=t[n];s<0?Array.isArray(this.beginCodeBlock)?t.length>n+this.beginCodeBlock.length&&this.beginCodeBlock.every((a,d)=>a.test(t[n+d]))&&(s=n+this.beginCodeBlock.length-1,n+=this.beginCodeBlock.length-1):this.beginCodeBlock.test(i)&&(s=n):this.endCodeBlock.test(i)&&(o.push({startLine:s,endLine:n}),s=-1)}return r.codeBlocks=o,o}};var Rr=class extends We{constructor(){super(["adoc","asciidoc","asc"],[/^\[source,http\]\s*$/iu,/^----\s*$/u],/^----\s*$/u);this.id="asciidoc"}};var vr=class extends We{constructor(){super(["md","markdown","mdown","mkdn","mdtxt","mdtext","text","rmd"],/^```\s*(http|rest)$/iu,/^```\s*$/u);this.id="markdown"}};function Gi(e){e.hooks.parse.addInterceptor(new vr),e.hooks.parse.addInterceptor(new Rr)}var z=require("crypto");var kr=class{constructor(){this.hmac=new Xo}sha1(){return new oe((0,z.createHash)("sha1"))}sha256(){return new oe((0,z.createHash)("sha256"))}sha384(){return new oe((0,z.createHash)("sha384"))}sha512(){return new oe((0,z.createHash)("sha512"))}md5(){return new oe((0,z.createHash)("md5"))}},oe=class e{constructor(t){this.hash=t}updateWithText(t,r){let o=Ve(r),s=this.hash.update(Buffer.from(t,o));return new e(s)}updateWithHex(t){let r=this.hash.update(Buffer.from(t,"hex"));return new e(r)}updateWithBase64(t,r){let o=this.hash.update(Buffer.from(t,r?"base64url":"base64"));return new e(o)}digest(){return new zo(this.hash)}},zo=class{constructor(t){this.hash=t}toHex(){return this.hash instanceof z.Hmac?this.hash.digest("hex"):this.hash.digest("hex")}toBase64(t){let r=t?"base64url":"base64";return this.hash instanceof z.Hmac?this.hash.digest(r):this.hash.digest(r)}},Xo=class{sha1(){return new Oe("sha1")}sha256(){return new Oe("sha256")}sha384(){return new Oe("sha384")}sha512(){return new Oe("sha512")}md5(){return new Oe("md5")}},Oe=class{constructor(t){this.algorithm=t}withTextSecret(t,r){let o=(0,z.createHmac)(this.algorithm,Buffer.from(t,Ve(r)));return new oe(o)}withHexSecret(t){let r=(0,z.createHmac)(this.algorithm,Buffer.from(t,"hex"));return new oe(r)}withBase64Secret(t,r){let o=(0,z.createHmac)(this.algorithm,Buffer.from(t,r?"base64url":"base64"));return new oe(o)}};var Wi=require("assert");var Ae=class{constructor(t){this.context=t;this.userSession=this.getIntellijSession()}getIntellijSession(){let t="intellij_global_cache",r=w.getUserSession(t);if(this.isIntellijGlobalCacheSession(r))return r;let o={id:t,title:"Intellij Cache",description:"Global Cache for all Intellij Variables",details:{},type:"intellij_global_cache"};return w.setUserSession(o),o}isIntellijGlobalCacheSession(t){return!!(t!=null&&t.id)&&!!t.title}set(t,r){this.userSession.details[t]=r,D({[t]:r},this.context)}get(t){return this.context.variables[t]}isEmpty(){return Object.entries(this.userSession.details).length===0}clear(t){delete this.userSession.details[t],Se(t,this.context)}clearAll(){for(let[t]of Object.entries(this.userSession.details))this.clear(t)}};var Pr=class{constructor(t){this.context=t;this.global=new Ae(t)}test(t,r){ut(this.context)(t,r)}assert(t,r){(0,Wi.ok)(t,r)}log(t){this.context.scriptConsole&&this.context.scriptConsole.info(t)}exit(){var t;(t=this.context.scriptConsole)==null||t.warn("exit not supported")}};var zi=require("uuid");function wr(e){let t=e.trim();if(["$uuid","$random.uuid"].indexOf(t)>=0)return(0,zi.v4)();if(t==="$timestamp")return x(Date.now());if(t==="$isoTimestamp")return new Date().toISOString();if(t==="$randomInt")return`${Math.floor(Math.random()*1e3)}`;if(t.startsWith("$random.integer")){let r=Ji(t);if(r)return`${Math.floor(r)}`}if(t.startsWith("$random.float")){let r=Ji(t);if(r)return`${r}`}if(t.startsWith("$random.alphabetic"))return Bd(t);if(t.startsWith("$random.alphanumeric"))return Md(t);if(t.startsWith("$random.hexadecimal"))return Nd(t);if(t.startsWith("$random.email"))return Ue()}function Ji(e){var r,o,s,n;let t=/^\$random.(integer|float)\s*\(\s*(?<from>-?\d+)\s*,\s*(?<to>-?\d+)\s*\)$/u.exec(e);if(t&&((r=t.groups)!=null&&r.from)&&((o=t.groups)!=null&&o.to)){let i=P((s=t.groups)==null?void 0:s.from)||0,a=P((n=t.groups)==null?void 0:n.to)||0;if(!Number.isNaN(i)&&!Number.isNaN(a)){if(i>a){let d=a;a=i,i=d}return Math.random()*(a-i)+i}}}function Bd(e){var r,o;let t=/^\$random.alphabetic\s*\(\s*(?<length>-?\d+)\s*\)\s*$/u.exec(e);if(t&&((r=t.groups)!=null&&r.length)){let s=P((o=t.groups)==null?void 0:o.length);if(s)return G(s,"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz")}}function Md(e){var r,o;let t=/^\$random.alphanumeric\s*\(\s*(?<length>-?\d+)\s*\)\s*$/u.exec(e);if(t&&((r=t.groups)!=null&&r.length)){let s=P((o=t.groups)==null?void 0:o.length);if(s)return G(s)}}function Nd(e){var r,o;let t=/^\$random.hexadecimal\s*\(\s*(?<length>-?\d+)\s*\)\s*$/u.exec(e);if(t&&((r=t.groups)!=null&&r.length)){let s=P((o=t.groups)==null?void 0:o.length);if(s)return G(s,"1234567890ABCDEF")}}async function Xi(e,t,r){return M(e,async o=>wr(o))}var Hr=class{url(){return this._url}body(){return this._body||""}constructor(t){var r,o,s,n;this._url=((r=t.request)==null?void 0:r.url)||"",this.method=((o=t.request)==null?void 0:o.method)||"",this._body=((s=t.request)==null?void 0:s.body)&&x((n=t.request)==null?void 0:n.body),this.headers=new Sr(t),this.environment=new Lr(t.variables),this.variables=new Ae(t)}},Cr=class{constructor(t){var r;this.url=new Qo(t),this.method=((r=t.request)==null?void 0:r.method)||"",this.body=new Yo(t),this.headers=new Sr(t),this.environment=new Lr(t.variables),this.variables=new Ae(t)}},Yo=class{constructor(t){this.context=t}getRaw(){var t;return x((t=this.context.request)==null?void 0:t.body)||""}tryGetSubstituted(){var r;let t=Zo(this.getRaw(),this.context.variables);return t&&((r=this.context.request)!=null&&r.body)&&(this.context.request.body=t),t}},Sr=class{constructor(t){this.context=t}all(){var t;return(t=this.context.request)!=null&&t.headers?Object.keys(this.context.request.headers).map(r=>new Tr(r,this.context)):[]}findByName(t){var r;return q((r=this.context.request)==null?void 0:r.headers,t)?new Tr(t,this.context):null}},Tr=class{constructor(t,r){this.name=t;this.context=r}value(){return this.getRawValue()}getRawValue(){var t;return x(q((t=this.context.request)==null?void 0:t.headers,this.name))||""}tryGetSubstitutedValue(){var r;let t=Zo(this.getRawValue(),this.context.variables);return t&&((r=this.context.request)!=null&&r.headers)&&(Jr(this.context.request.headers,this.name),this.context.request.headers[this.name]=t),t}},Qo=class{constructor(t){this.context=t}getRaw(){var t;return((t=this.context.request)==null?void 0:t.url)||""}tryGetSubstituted(){var r;let t=Zo(this.getRaw(),this.context.variables);return t&&((r=this.context.request)!=null&&r.body)&&(this.context.request.body=t),t}},Lr=class{constructor(t){this.variables=t}get(t){let r=x(this.variables[t]);return Fe(r)?null:r}};function Zo(e,t){let r=e,o=[wr,s=>{let n=t[s];if(!Fe(n))return x(n)}];for(let s of o)r=Ud(r,s);return r}function Ud(e,t){if(!c(e))return e;let r,o,s=e,n=0;for(;o!==s&&n++<100;)for(o=s;(r=ct.exec(o))!==null;){let[i,a]=r,d=t(a,i);if(typeof d<"u"&&i===e)return d;let l=x(d);typeof l<"u"&&(s=s.replace(i,()=>l))}return s}var qr=class{constructor(t){this.body=t.parsedBody||t.body,this.status=t.statusCode,this.contentType=es(t.contentType),this.headers=new Er(t.headers)}};function es(e){return{mimeType:(e==null?void 0:e.mimeType)||"application/octet-stream",charset:(e==null?void 0:e.charset)||"utf-8"}}var Er=class{constructor(t){this.headers=t}valueOf(t){if(this.headers){let r=q(this.headers,t);if(r&&c(r))return r}return null}valuesOf(t){if(this.headers){let r=q(this.headers,t);if(r){if(c(r))return[r];if(Array.isArray(r))return r}}return[]}},Or=class{constructor(t,r){this.requestClient=t;this.resolve=r;this.status=0;this.contentType=es();this.lazyHeaders={};this.body={onEachLine:(...o)=>this.onEachLine(...o),onEachMessage:(...o)=>this.onEachMessage(...o)},this.headers=new Er(this.lazyHeaders)}onEachLine(t,r){this.onEachMessage(t,r)}onEachMessage(t,r){let o=s=>{let[,n]=s.detail;this.status=n.statusCode,Object.assign(this.headers,n.headers),this.contentType=es(n.contentType);let i=x(n.body);i&&t(i,()=>{this.requestClient.removeEventListener("message",o),this.resolve()},l=>this.requestClient.send(l))};this.requestClient.addEventListener("message",o),r&&this.requestClient.addEventListener("end",r)}};var Yi=A(require("dayjs"));var Qi=require("uuid"),Ar=class{alphabetic(t=10){return G(t,"ABCDEFGHIJKLMNOPQRSTUVWXYZabcdefghijklmnopqrstuvwxyz")}numeric(t=10){return G(t)}hexadecimal(t=10){return G(t,"1234567890ABCDEF")}get email(){return Ue()}float(t=0,r=100){return Math.random()*(r-t)+t}integer(t=0,r=100){return Math.floor(Math.random()*(r-t)+t)}get uuid(){return(0,Qi.v4)()}date(t=new Date,r=void 0){return(0,Yi.default)(t).format(r)}};var $r=class{btoa(t){return global.btoa(t)}atob(t){return global.atob(t)}};W.variableProvider.push(()=>[{name:"$uuid",description:"UUID"},{name:"$uuid",description:"UUID"},{name:"$random.uuid",description:"UUID"},{name:"$timestamp",description:"Timestamp"},{name:"$isoTimestamp",description:"ISOTimestamp"},{name:"$randomInt",description:"randomInt (0 -1000)"},{name:"$random.integer",description:"integer"},{name:"$random.float",description:"float"},{name:"$random.alphabetic",description:"Alphabetic Text"},{name:"$random.alphanumeric",description:"Alphanumeric Text"},{name:"$random.hexadecimal",description:"Hexadecimal String"},{name:"$random.email",description:"EMail"}]);var Dr=class{constructor(t,r){this.scriptData=t;this.id="intellij";r&&(this.before=["requestVariableReplacer"])}isStreamingScript(t){return["onEachLine","onEachMessage"].some(r=>t.script.indexOf(r)>0)}async processOnRequest(t,r){T(r,"execute Intellij Javascript");let o=await this.loadScript(r);if(this.isStreamingScript(o))return;let s=ts(r);await this.executeScriptData(o,s,r)}async processOnStreaming(t){let r=await this.loadScript(t);if(this.scriptData=r,this.isStreamingScript(r)&&t.requestClient){let o=t.requestClient;await new Promise(s=>{let n=ts(t);n.response=new Or(o,s),this.executeScriptData(r,n,t)})}}async processOnResponse(t,r){T(r,"execute Intellij Javascript");let o=await this.loadScript(r);if(this.isStreamingScript(o))return;let s=ts(r);s.response=new qr(t),await this.executeScriptData(o,s,r)}async executeScriptData(t,r,o){return H.runScript?(await H.runScript(t.script,{fileName:o.httpFile.fileName,context:{console:o.scriptConsole,...r},lineOffset:t.lineOffset}),!0):!1}async loadScript(t){if(this.isIntellijScriptData(this.scriptData))try{return{script:await le(this.scriptData.fileName,t,r=>p.readFile(r,"utf-8"))||"",lineOffset:0}}catch(r){throw(t.scriptConsole||f).error(this.scriptData.fileName,r),new Error(`error loading script ${this.scriptData.fileName}`)}else return this.scriptData}isIntellijScriptData(t){return!!t.fileName}};function ts(e){let t={client:new Pr(e),crypto:new kr,$random:new Ar,$env:process.env,Window:new $r};return e.request&&(e.httpRegion.response?t.request=new Hr(e):t.request=new Cr(e)),t}async function Zi(){let e=w.getUserSession("intellij_global_cache");return(e==null?void 0:e.details)||{}}async function ea(e,{httpRegion:t}){let r=e(),o=Kd(r,!!t.request);if(o){let s=new Dr(o.data,o.isBeforeRequest);return o.isBeforeRequest?t.hooks.onRequest.addObjHook(n=>n.processOnRequest,s):(t.hooks.onStreaming.addObjHook(n=>n.processOnStreaming,s),t.hooks.onResponse.addObjHook(n=>n.processOnResponse,s)),{nextParserLine:o.endLine,symbols:[new v({name:"Intellij Script",description:"Intellij Script",kind:"script",startLine:o.startLine,startOffset:0,endLine:o.endLine,endOffset:o.endOffset,children:o.symbols})]}}return!1}function Kd(e,t){var o,s,n;let r=e.next();if(!r.done){let i=r.value.line,a=/^\s*(?<event>(<|>))\s+(?<fileName>[^\s{%}]+\s*)$/u.exec(r.value.textLine);if((o=a==null?void 0:a.groups)!=null&&o.fileName){if(a.groups.event==="<"&&t)return!1;let u=a.groups.fileName.trim();return{startLine:i,endLine:i,endOffset:r.value.textLine.length,data:{fileName:u},isBeforeRequest:a.groups.event==="<",symbols:[new v({name:"filename",description:u,kind:"path",startLine:r.value.line,startOffset:r.value.textLine.indexOf(u),endLine:r.value.line,endOffset:r.value.textLine.indexOf(u)+u.length})]}}let d=/^\s*(?<event>(<|>))\s+\{%\s*(?<script>.*)\s*%\}\s*$/u.exec(r.value.textLine);if((s=d==null?void 0:d.groups)!=null&&s.script)return d.groups.event==="<"&&t?!1:{startLine:i,endLine:i,endOffset:r.value.textLine.length,data:{script:d.groups.script,lineOffset:i},isBeforeRequest:d.groups.event==="<"};let l=/^\s*(?<event>(<|>))\s+\{%\s*$/u.exec(r.value.textLine);if((n=l==null?void 0:l.groups)!=null&&n.event){if(l.groups.event==="<"&&t)return!1;r=e.next();let u=[];for(;!r.done;){if(/^\s*%\}\s*$/u.test(r.value.textLine))return{startLine:i,endLine:r.value.line,endOffset:r.value.textLine.length,data:{script:U(u),lineOffset:i},isBeforeRequest:l.groups.event==="<"};u.push(r.value.textLine),r=e.next()}}}return!1}async function ta(e,t,r){return M(e,async o=>{if(o.trim()==="$projectRoot")return r.httpFile.rootDir})}async function ra(e){let t=Object.keys(await oa(e));return f.info("Intellij Env Provider found environments",t),t}async function oa(e){var i;let t=[],r=a=>["http-client.env.json","http-client.private.env.json"].includes(a),o=process.env.HTTPYAC_ENV;if(o&&c(o)){let a=await V(o,e.httpFile.rootDir);a&&t.push(...await rs(a,r))}if((i=e.config)!=null&&i.envDirName){let a=await V(e.config.envDirName,e.httpFile.rootDir);a&&t.push(...await rs(a,r))}let s=p.dirname(e.httpFile.fileName);s&&await pe(s,e.httpFile.rootDir,async a=>{t.push(...await rs(a,r))});let n={};t.length>0&&f.trace(`Intellij environment files found: ${t.join(", ")}`),t.sort((a,d)=>{let l=p.toString(a),u=p.toString(d),m=l.endsWith("private.env.json"),h=u.endsWith("private.env.json");return m===h?l.localeCompare(u):m?1:-1});for(let a of t){let d=await Gd(a);if(d)for(let[l,u]of Object.entries(d))n[l]?(p.toString(a).endsWith("private.env.json")||f.warn(`Multiple files with environment ${l} were found.`),Object.assign(n[l],u)):n[l]=u}return n}async function rs(e,t){return(await Ce(p.readdir(e),[])).filter(t).map(o=>p.joinPath(e,o))}async function sa(e,t){let r=await oa(t),o=[];if(e)for(let s of e)o.push(r[s]);return Object.assign({},...o)}async function Gd(e){try{if(await p.exists(e)){let t=await p.readFile(e,"utf-8");return JSON.parse(t)}}catch(t){f.trace(`${e} not found`),f.trace(t)}}function na(e){e.hooks.parse.addHook("intellijScript",ea,{before:["request"]}),e.hooks.provideEnvironments.addHook("intellij",ra),e.hooks.provideVariables.addHook("intellij",sa),e.hooks.provideVariables.addHook("intellij_global",Zi),e.hooks.replaceVariable.addHook("intellijDynamic",Xi,{before:["name"]}),e.hooks.replaceVariable.addHook("intellijProjectContext",ta,{before:["name"]})}W.emptyLineProvider.push(()=>[{name:`{{@streaming
`,description:"Streaming Javascript Block"},{name:`{{@response
`,description:"Response Javascript Block"},{name:`{{@request
`,description:"Request Javascript Block"}]);W.variableProvider.push(()=>[{name:"$random.alphabetic()",description:"random letters"},{name:"$random.number()",description:"random number"},{name:"$random.hexadecimal()",description:"random hexadecimal"},{name:"$random.email()",description:"random email"},{name:"$random.float()",description:"random float"},{name:"$random.integer()",description:"random integer"},{name:"$random.uuid()",description:"random uuid"},{name:"$random.date()",description:"Date format function"}]);async function ia(e){let t=aa(e),r=w.getUserSession(t);return(r==null?void 0:r.details)||{$global:{}}}var Ir=class{constructor(){this.id="globalVariables"}async afterLoop(t){let[r]=t.args,o=r.variables.$global;if(o&&typeof o=="object"&&Object.keys(o).length>0){let s=aa(r.activeEnvironment);w.setUserSession({id:s,title:"global store",description:r.activeEnvironment?`global Variables for ${r.activeEnvironment.join(", ")}`:"global Variables",type:"global_cache",details:{$global:o}})}return!0}};function aa(e){return`global_cache_${B(e)}`}var Fr=class{constructor(t,r){this.context=t;this.httpFileStore=r}findHttpRegionInContext(t){return Me(t,this.context)}async import(t){return await ht(t,this.httpFileStore,this.context)}setVariables(t){D(t,this.context)}async execute(t,r){r&&D(r,this.context);let o;if(c(t)?o=Me(t,this.context):o=t,o&&await(o==null?void 0:o.execute(this.context))){let n=B(this.context.activeEnvironment);D(o.variablesPerEnv[n],this.context)}return this.context.variables}};var Pt=A(require("module")),wt=A(require("path")),la=A(require("vm"));function da(e,t){let r;try{try{r=Pt.default.createRequire(wt.default.resolve(t,"package.json")).resolve(e)}catch{r=require.resolve(e,{paths:[t]})}}catch(o){f.debug(o)}return r}function ua(e,t,r=!1){if(L.isTrusted("loadModule"))try{return r&&Jd(e,t),Pt.default.createRequire(wt.default.resolve(t,"package.json"))(e)}catch{let o=da(e,t);if(o)return r&&os(o),require(o)}}function Wd(e,t){let r=new Pt.default(e,require.main);return r.filename=e,r.paths=Pt.default._nodeModulePaths(wt.default.dirname(e)),t&&r._compile(t,e),r}function Jd(e,t){let r=da(e,t);r&&os(r)}function os(e,t=new Map){let r=require.cache[e];r&&(t.set(e,!0),r.children.forEach(o=>{t.get(o.id)||os(o.id,t)}),delete require.cache[e])}async function Ht(e,t){if(!L.isTrusted("runScript"))return{};let r=zd(t.fileName),o=Wd(r);function s(m){let h=H.require;return h&&h[m]?h[m]:o.require(m)}let n=Yd(t.context),i=Object.assign({$context:n,...n}),a=Object.keys(i),d=`(async function userJS(exports, require, module, __filename, __dirname, context){ with(context){${p.EOL}${e}${p.EOL}}})`;await la.default.runInThisContext(d,{filename:r,lineOffset:t.lineOffset,displayErrors:!0}).apply(i,[o.exports,s,o,r,wt.default.dirname(r),i]),Xd(a,i,t.deleteVariable);let u=o.exports;if(Ne(u))u=await u;else for(let[m,h]of Object.entries(u))Ne(h)&&(u[m]=await h);return u}function zd(e){return p.fsPath(e)||p.toString(e)}function Xd(e,t,r){if(r)for(let o of e)try{t[o]===void 0&&r(o)}catch(s){f.info(`error on delete of ${o}`,s)}}async function jr(e,t,r){if(!L.isTrusted("evalExpression"))return;let o=`exports.$result = (${e});`,s=t.httpRegion.symbol.startLine;if(t.httpRegion.symbol.source){let i=Y(t.httpRegion.symbol.source).findIndex(a=>a.indexOf(e)>=0);i>=0&&(s+=i)}return(await Ht(o,{fileName:t.httpFile.fileName,context:{...t.variables,httpFile:t.httpFile,httpRegion:t.httpRegion,request:t.request,console:t.scriptConsole,$random:yt,...r,$context:t},lineOffset:s})).$result}function Yd(e){let t={};for(let[r,o]of Object.entries(e)){let s=r.trim().replace(/\s/gu,"-").replace(/-./gu,n=>n[1].toUpperCase());ma.indexOf(s)<0&&typeof o<"u"&&(t[s]=o)}return t}function pa(e){return ma.indexOf(e)>=0?(f.warn(`Keyword ${e} prevented, because Javascript Keyword`),!1):Qd.indexOf(e)>=0?(f.warn(`Keyword ${e} prevented, because used by httpYac`),!1):!0}var Qd=["httpFile","httpRegion","request","test","sleep"],ma=["await","break","case","catch","class","const","continue","debugger","default","delete","do","else","enum","export","extends","false","finally","for","function","if","implements","import","in","instanceof","interface","let","new","null","package","private","protected","public","return","super","switch","static","this","throw","try","true","typeof","var","void","while","with","yield"];var eu=/^\s*\{\{(@js\s+)?(?<modifier>\+|@)?(?<event>(request|streaming|response|after|responseLogging)?)?\s*$/iu,tu=/^\s*\}\}\s*$/u;async function ca(e,{httpRegion:t,httpFile:r,httpFileStore:o}){let s=e(),n=s.next();if(!n.done){let i=eu.exec(n.value.textLine);if(i!=null&&i.groups){let a=n.value.line;n=s.next();let d=[];for(;!n.done;){if(tu.test(n.value.textLine)){let l={script:U(d),lineOffset:a},u=i.groups.modifier==="+";switch(i.groups.event){case"request":su(u?r.hooks:t.hooks,l,o);break;case"streaming":ru(u?r.hooks:t.hooks,l,o);break;case"response":nu(u?r.hooks:t.hooks,l,o);break;case"after":au(u?r.hooks:t.hooks,l,o);break;case"responseLogging":iu(u?r.hooks:t.hooks,l,o);break;default:ou(u?r.hooks:t.hooks,l,o);break}return{nextParserLine:n.value.line,symbols:[new v({name:"script",description:"nodejs script",kind:"script",startLine:a,startOffset:0,endLine:n.value.line,endOffset:n.value.textLine.length})]}}d.push(n.value.textLine),n=s.next()}}}return!1}function ru(e,t,r){e.onStreaming.addHook("js",async o=>await Je(t,o,r,"streaming")?void 0:st)}function ou(e,t,r){e.execute.addHook("js",o=>Je(t,o,r))}function su(e,t,r){e.onRequest.addHook("js",async(o,s)=>await Je(t,s,r,"request")?void 0:st)}function nu(e,t,r){e.onResponse.addHook("js",async(o,s)=>(s.variables.response=o,await Je(t,s,r,"response")?void 0:st))}function iu(e,t,r){e.responseLogging.addHook("js",async(o,s)=>{let n=s.variables.response;s.variables.response=o,await Je(t,s,r,"responseLogging"),s.variables.response=n})}function au(e,t,r){e.execute.addInterceptor(new ss(t,r))}var ss=class{constructor(t,r){this.scriptData=t;this.httpFileStore=r;this.id=`afterJavascript_${t.script}`}async afterLoop(t){return await Je(this.scriptData,t.args[0],this.httpFileStore,"after")}};async function Je(e,t,r,o){T(t,o?`execute javascript (@${o})`:"execute javascript");let s=await Ht(e.script,{fileName:t.httpFile.fileName,context:{...t.variables,httpFile:t.httpFile,httpRegion:t.httpRegion,request:t.request,console:t.scriptConsole,sleep:ce,test:ut(t),$httpyac:new Fr(t,r),$random:yt,$context:t},lineOffset:e.lineOffset,deleteVariable:i=>Se(i,t)}),n=s.$cancel;return n&&(delete s.$cancel,Q(t.httpRegion)),D(s,t),!n}async function fa(e,t,r){return await M(e,async(o,s)=>{try{return await jr(o,r)}catch(n){if(t==="Variable")(r.scriptConsole||f).debug(`variable ${o} not defined`),(r.scriptConsole||f).debug(n);else throw(r.scriptConsole||f).error(`expression ${o} throws error`),n;return s}})}var ga=A(require("dayjs")),lu=A(require("uuid"));j.javascriptProvider.loadModule=ua;function ha(e){e.hooks.replaceVariable.addHook("javascript",fa,{before:["aws"]}),e.hooks.parse.addHook("javascript",ca,{before:["request"]}),e.hooks.execute.addInterceptor(new Ir),e.hooks.provideVariables.addHook("globalVariables",ia),du(),j.javascriptProvider.evalExpression=jr,j.javascriptProvider.runScript=Ht,j.javascriptProvider.isAllowedKeyword=pa}function du(){Object.assign(j.javascriptProvider.require,{httpyac:ns,dayjs:ga.default,uuid:lu})}ee.core=bi;ee.dotenv=Pi;ee.http=Ki;ee.intellij=na;ee.injection=Gi;ee.javascript=ha;ee.assert=Ys;var is=require("hookpoint");async function as(e){let t=!1;return Ho(e)?t=await pu(e):Co(e)?t=await ya(e):t=await mu(e),t}async function pu(e){let t=await ls(e);return await Be(t)?await e.httpRegion.execute(t,!0):!1}async function ya(e){let t=await ls(e);if(await Be(t)){e.progress&&(e.progress.divider=e.httpRegions.length);let r=!0;for(let o of e.httpRegions){let s=await o.execute(t,!0);r=r&&s}return r}return!1}async function mu(e){let t=[];for(let r of e.httpFile.httpRegions)e.httpRegionPredicate&&!e.httpRegionPredicate(r)?f.debug(`${r.symbol.name} disabled by predicate`):r.isGlobal()||t.push(r);return await ya({...e,httpRegions:t})}async function ls(e){return Object.assign(e,{variables:await ba(e),options:{}})}async function ba(e){e.config=await _e(e.config,e.httpFile);let t=await e.httpFile.hooks.provideVariables.trigger(e.activeEnvironment,e);if(t===is.HookCancel)return e.variables||{};let r={...e.variables},o=Object.assign(e.variables||{},...t.map(s=>It(s)),r);return f.debug("current environment variables",o),o}async function cu(e){e.config=await _e(e.config,e.httpFile);let t=await e.httpFile.hooks.provideEnvironments.trigger(e);return t!==is.HookCancel&&t.length>0?t.reduce((r,o)=>{for(let s of o)r.indexOf(s)<0&&r.push(s);return r},[]).sort():[]}function Ct(e,t){return e+t}function ds(e,t){let r=[];for(let o of e)r.push(Vr(o,t));return{_meta:{version:"1.1.0"},requests:r,summary:fu(r)}}function fu(e){return{totalRequests:e.length,skippedRequests:e.filter(t=>t.summary.skippedTests>0).length,failedRequests:e.filter(t=>t.summary.failedTests>0).length,successRequests:e.filter(t=>t.summary.failedTests+t.summary.erroredTests+t.summary.skippedTests===0).length,erroredRequests:e.filter(t=>t.summary.erroredTests>0).length,totalTests:e.map(t=>t.summary.totalTests).reduce(Ct,0),failedTests:e.map(t=>t.summary.failedTests).reduce(Ct,0),successTests:e.map(t=>t.summary.successTests).reduce(Ct,0),erroredTests:e.map(t=>t.summary.erroredTests).reduce(Ct,0),skippedTests:e.map(t=>t.summary.skippedTests).reduce(Ct,0)}}function Vr(e,t){var o,s,n,i,a,d,l,u,m,h,R,k,C,I;let r=t.output;return t.outputFailed&&((s=(o=e.testResults)==null?void 0:o.some)!=null&&s.call(o,b=>!b.status))&&(r=t.outputFailed),{fileName:p.fsPath(e.filename)||p.toString(e.filename),response:gu(e.response,r),name:x((n=e.metaData)==null?void 0:n.name)||e.symbol.name,line:e.symbol.startLine,title:x((i=e.metaData)==null?void 0:i.title),description:x((a=e.metaData)==null?void 0:a.description),testResults:e.testResults,timestamp:new Date(performance.timeOrigin+e.start).toISOString(),duration:e.duration,summary:{totalTests:((d=e.testResults)==null?void 0:d.length)||0,failedTests:((u=(l=e.testResults)==null?void 0:l.filter)==null?void 0:u.call(l,b=>b.status==="FAILED").length)||0,successTests:((h=(m=e.testResults)==null?void 0:m.filter)==null?void 0:h.call(m,b=>b.status==="SUCCESS").length)||0,erroredTests:((k=(R=e.testResults)==null?void 0:R.filter)==null?void 0:k.call(R,b=>b.status==="ERROR").length)||0,skippedTests:((I=(C=e.testResults)==null?void 0:C.filter)==null?void 0:I.call(C,b=>b.status==="SKIPPED").length)||0}}}function gu(e,t){var r;if(e)switch(delete e.rawHeaders,delete e.rawBody,delete e.prettyPrintBody,delete e.parsedBody,delete e.contentType,delete e.tags,t){case"body":case"response":return delete e.request,e;case"short":return delete e.body,delete e.request,e;case"none":return;case"headers":return delete e.body,(r=e.request)==null||delete r.body,e;case"exchange":default:return e}}function us(e){if(e.json||e.jsonl)return 1e3;if(e.silent)return 100;if(e.verbose)return 1}var ps=!1,xa={id:"bailOnFailed",beforeLoop:async function(t){if(ps){let[r]=t.args;return Q(r.httpRegion,"request skipped because of bail"),!1}return!0},onError:async function(){return ps=!0,!0},afterTrigger:async function(t){var s,n;return((n=(s=t.args[0].httpRegion.testResults)==null?void 0:s.find)==null?void 0:n.call(s,i=>["FAILED"].includes(i.status)))&&(ps=!0),!0}};var Ra={id:"loggerFlush",afterLoop:async function(t){var o,s;let r=t.args[0];return(s=(o=r==null?void 0:r.scriptConsole)==null?void 0:o.flush)==null||s.call(o),!0}};var va={id:"testExitCode",onError:async function(){return process.exitCode=10,!0},afterTrigger:async function(t){let r=t.args[0];if(r.httpRegion.testResults===void 0)return!0;let o=!1,s=!1;for(let n of r.httpRegion.testResults){if(n.status==="ERROR"){o=!0;break}n.status==="FAILED"&&(s=!0)}return o?process.exitCode=19:s&&(process.exitCode=20),!0}};function ka(e){return function(r){r.hooks.execute.addInterceptor(Ra),r.hooks.execute.addInterceptor(va),e&&r.hooks.execute.addInterceptor(xa)}}async function Pa(e,t){return hu(t)?yu(e,t):e.map(o=>({httpFile:o}))}function hu(e){return!!(e.tag&&e.tag.length>0||e.name&&e.name.length>0||e.line!==void 0)}function yu(e,t){let r=[],o=t.tag||[],s=t.name||[],n=t.line;for(let i of e){let a=i.httpRegions.filter(d=>!(o.length>0&&!bu(d,o)||s.length>0&&!xu(d,s)||n!==void 0&&!Ru(d,n)));a.length>0&&r.push({httpFile:i,httpRegions:a})}return r}function bu(e,t){var o;if(!c((o=e.metaData)==null?void 0:o.tag))return!1;let r=e.metaData.tag.split(",").map(s=>s.trim()).filter(Boolean);return r.length===0?!1:t.every(s=>r.includes(s))}function xu(e,t){var r;return c((r=e.metaData)==null?void 0:r.name)?t.includes(e.metaData.name):!1}function Ru(e,t){return e.symbol.startLine<=t&&e.symbol.endLine>=t}function Ca(){return new Ha.Command("uctest").description("HTTP test runner for Unsafe Code Lab").usage("[@tag...] [:name...] [path...] [options]").argument("[args...]","Tags (@tag), names (:name), and paths").option("-k, --keep-going","continue running after failures (default: stop on first)").option("--json","use json output").option("--jsonl","stream json lines output").option("-l, --line <line>","line of the http requests",P).option("--no-color","disable color support").option("-o, --output <output>","output format of response (short, body, headers, response, exchange, none)","none").option("--output-failed <output>","output format of failed response (short, body, headers, response, exchange, none)","exchange").option("-s, --silent","log only request").option("--prune-refs","only execute leaf requests (prune referenced dependencies)").option("-r, --resume","resume from last failed request").option("--state-file <path>","path to state file for resume (default: .uctest-state)").option("--timeout <timeout>","maximum time allowed for connections",P).option("--var  <variables...>",'list of variables (e.g foo="bar")').option("-v, --verbose","make the operation more talkative").action(ku)}function vu(e){let t=[],r=[],o=[];for(let s of e)if(s.startsWith("@")){let n=s.slice(1);n&&(n.includes(",")&&(console.error(`Error: Commas not supported in tags. Use separate arguments: @${n.split(",").join(" @")}`),process.exit(1)),t.push(n))}else if(s.startsWith(":")){let n=s.slice(1);n&&r.push(n)}else o.push(s);return{tags:t,names:r,paths:o}}async function ku(e,t){var m,h;let r=vu(e);r.tags.length>0&&(t.tag=r.tags),r.names.length>0&&(t.name=r.names);let o=r.paths.length>0?r.paths:["./**/*.http"],s=!t.keepGoing,n=$u(t),{httpFiles:i,config:a}=await Iu(o,s,n.config||{});n.config=a,Du(t,n);let d=(0,ge.join)(process.cwd(),".uctest-state"),l=t.resume?t.stateFile||d:void 0,u=l?await Eu(l):void 0;try{if(i.length>0){let R=await Pa(i,t);R.length===0&&(console.error("No tests match the specified filters"),process.exit(1)),t.pruneRefs&&(R=Tu(R)),u&&(R=Lu(R,u),u=void 0);let k=Cu(R,i),C=k.totalRequests,I=k.totalFiles,b=0,g=t.jsonl?Hu():void 0;t.jsonl?(g==null||g({type:"start",totalRequests:C,totalFiles:I}),n.processedHttpRegionListener=$e=>{b+=1,g==null||g({type:"request",index:b,totalRequests:C,request:Vr($e,t)})}):n.processedHttpRegionListener=void 0,n.processedHttpRegions=[];let F=R.map(({httpFile:$e,httpRegions:Ea})=>async function(){!t.json&&n.scriptConsole&&n.scriptConsole.info(`--------------------- ${$e.fileName}  --`),await as(Object.assign({},n,{httpFile:$e,httpRegions:Ea}))});await So(1,...F);let he=n.processedHttpRegions||[],Tt=t.resume&&s?Su(he):void 0;if(t.jsonl){b=wu(he,t,g,b,C);let $e=ds(he,t);g==null||g({type:"summary",totalRequests:C,totalFiles:I,summary:$e.summary})}else Pu(n,t);l&&t.resume&&s&&(Tt?await Ou(l,Tt):await Au(l))}else console.error(`uctest cannot find any .http files matching: ${o.join(", ")}`)}finally{(h=(m=n.scriptConsole)==null?void 0:m.flush)==null||h.call(m)}}function Pu(e,t){let r=e.processedHttpRegions||[],o=ds(r,t);if(t.json)console.info(O(o,2));else if(e.scriptConsole){e.scriptConsole.info("");let s=[];o.summary.successRequests>0&&s.push(ze.default`{green ${o.summary.successRequests} succeeded}`),o.summary.failedRequests>0&&s.push(ze.default`{red ${o.summary.failedRequests} failed}`),o.summary.erroredRequests>0&&s.push(ze.default`{red ${o.summary.erroredRequests} errored}`),o.summary.skippedRequests>0&&s.push(ze.default`{yellow ${o.summary.skippedRequests} skipped}`),e.scriptConsole.info(ze.default`{bold ${o.summary.totalRequests}} requests processed (${s.join(", ")})`)}}function wu(e,t,r,o,s){if(!r)return o;for(let n=o;n<e.length;n+=1)r({type:"request",index:n+1,totalRequests:s,request:Vr(e[n],t)});return Math.max(o,e.length)}function Hu(){return e=>{process.stdout.write(`${O(e)}
`)}}function Cu(e,t){var a,d,l,u,m;let r=new Map,o=new Map;for(let h of t)for(let R of h.httpRegions){o.set(R,h);let k=x((a=R.metaData)==null?void 0:a.name);if(!k)continue;let C=r.get(k)||[];C.push(R),r.set(k,C)}let s=new Set,n=new Set,i=[];for(let{httpFile:h,httpRegions:R}of e){let k=R??h.httpRegions;for(let C of k)((d=C.metaData)==null?void 0:d.disabled)===!0||(l=C.metaData)!=null&&l.skip||i.push(C)}for(;i.length>0;){let h=i.pop();if(!h||s.has(h))continue;s.add(h);let R=o.get(h);R&&n.add(R);for(let k of Sa(h)){let C=r.get(k);if(C)for(let I of C)((u=I.metaData)==null?void 0:u.disabled)===!0||(m=I.metaData)!=null&&m.skip||i.push(I)}}return{totalRequests:s.size,totalFiles:n.size}}function Su(e){return e.find(t=>{var r;return(r=t.testResults)==null?void 0:r.some(o=>o.status==="ERROR"||o.status==="FAILED")})}function Tu(e){var a,d,l;let t=e.map(u=>({httpFile:u.httpFile,regions:u.httpRegions??u.httpFile.httpRegions})),r=[];for(let{regions:u}of t)for(let m of u)((a=m.metaData)==null?void 0:a.disabled)===!0||(d=m.metaData)!=null&&d.skip||r.push(m);let o=new Map;for(let u of r){let m=x((l=u.metaData)==null?void 0:l.name);if(m){let h=o.get(m)||[];h.push(u),o.set(m,h)}}let s=new Set;for(let u of r)for(let m of Sa(u)){let h=o.get(m);h==null||h.forEach(R=>s.add(R))}let n=new Set(r.filter(u=>!s.has(u))),i=[];for(let{httpFile:u,regions:m}of t){let h=m.filter(k=>n.has(k));if(h.length===0)continue;let R=m===u.httpRegions&&h.length===m.length;i.push({httpFile:u,httpRegions:R?void 0:h})}return i}function Sa(e){var o,s;let t=[],r=[(o=e.metaData)==null?void 0:o.ref,(s=e.metaData)==null?void 0:s.forceRef];for(let n of r){if(!n||n===!0)continue;let i=x(n);if(!i)continue;let a=i.split(/[,\s]+/u).map(d=>d.trim()).filter(Boolean);t.push(...a)}return t}function Lu(e,t){var s,n;let r=[],o=!0;for(let i of e){let a=i.httpRegions??i.httpFile.httpRegions,d=Ta(i.httpFile.fileName),l=[];for(let u of a)((s=u.metaData)==null?void 0:s.disabled)===!0||(n=u.metaData)!=null&&n.skip||(o?qu(d,u,t)&&(o=!1,l.push(u)):l.push(u));if(l.length>0){let u=a===i.httpFile.httpRegions&&l.length===a.length;r.push({httpFile:i.httpFile,httpRegions:u?void 0:l})}}return o?e:r}function qu(e,t,r){return!e||e!==r.fileName?!1:t.symbol.startLine===r.line}function Ta(e){if(!e)return;let t=p.fsPath(e)||p.toString(e);if(t)return(0,ge.isAbsolute)(t)?(0,ge.relative)(process.cwd(),t):t}async function Eu(e){try{let t=await St.promises.readFile(e,"utf-8");return JSON.parse(t)}catch(t){t.code!=="ENOENT"&&console.warn(`Failed to read resume state from ${e}:`,t);return}}async function Ou(e,t){var s;let r=Ta(t.filename);if(!r)return;let o={fileName:r,line:t.symbol.startLine,name:x((s=t.metaData)==null?void 0:s.name)};await St.promises.writeFile(e,O(o,2))}async function Au(e){try{await St.promises.unlink(e)}catch(t){t.code!=="ENOENT"&&console.warn(`Failed to clear resume state at ${e}:`,t)}}function $u(e){return{config:{log:{level:us(e)},request:{timeout:e.timeout}},variables:e.var?Object.fromEntries(e.var.map(r=>{let o=r.split("=");return[o[0],o.slice(1).join("=")]})):void 0}}function Du(e,t){if(e.jsonl)return;let r=new Ie({level:us(e)});if(r.collectMessages(),t.scriptConsole=r,!e.json){t.logStream=ju(e);let o=Vu(e,t.config,r);t.logResponse=async(s,n)=>{o&&await o(s,n),r.flush()}}}async function Iu(e,t,r){let o=[],s=new xt({cli:ka(t)}),n={workingDir:process.cwd(),config:r},i=[];for(let a of e)i.push(...await Fu(a));for(let a of i){let d=await s.getOrCreate(a,async()=>await St.promises.readFile(a,"utf8"),0,n);o.push(d)}return{httpFiles:o,config:n.config}}async function Fu(e){let t={gitignore:!0},{globby:r}=await import("globby"),o=await r(e,t);return o&&o.length>0||ge.sep==="/"?o:await r(e.replace(/\\/gu,"/"),t)}function ju(e){if(e.output!=="none")return async function(r,o){let s=Buffer.isBuffer(o.body)?o.body.toString("utf-8"):o.body;console.info(`${new Date().toLocaleTimeString()} - ${r}: `,s)}}function Vu(e,t,r){var i,a;let o={responseBodyPrettyPrint:!0},s=wa(e.output,o,(i=t==null?void 0:t.log)==null?void 0:i.options),n=wa(e.outputFailed,o,(a=t==null?void 0:t.log)==null?void 0:a.options);if(s||n)return Xr(d=>r.logPriority(d),s,n)}function wa(e,...t){let r;switch(e){case"body":r={responseBodyLength:0};break;case"headers":r={requestOutput:!0,requestHeaders:!0,responseHeaders:!0};break;case"response":r={responseHeaders:!0,responseBodyLength:0};break;case"none":return;case"short":r={useShort:!0};break;case"timings":r={timings:!0};break;case"exchange":r={requestOutput:!0,requestHeaders:!0,requestBodyLength:0,responseHeaders:!0,responseBodyLength:0,timings:!0};break;default:r={requestOutput:!0,requestHeaders:!0,requestBodyLength:0,responseHeaders:!0,responseBodyLength:0};break}return Object.assign({},...t,r)}async function qa(){let e=await dt((0,La.join)(__dirname,"../package.json")),t=Ca();return t.version((e==null?void 0:e.version)||"0.0.1"),t}async function Bu(e){try{await Lo(),await(await qa()).parseAsync(e)}catch(t){throw console.error(t),process.exitCode||(process.exitCode=1),t}finally{process.exit()}}0&&(module.exports={AbstractRequestClient,ExecuteHook,HookCancel,HttpSymbol,HttpSymbolKind,LogLevel,OnRequestHook,OnResponseHook,OnStreaming,ParseEndRegionHook,ParseHook,ParseMetaDataHook,ProvideAssertValue,ProvideEnvironmentsHook,ProvideVariablesHook,RepeatOrder,ReplaceVariableHook,RequestClientEvent,ResponseLoggingHook,TestResultStatus,VariableType,cli,createEmptyProcessorContext,getEnvironments,getVariables,io,send,store,testSymbols,utils});
//# sourceMappingURL=index.js.map
